define("common:widget/blue-book-ad/blue-book-ad.js",function(e,o,i){var a=e("common:widget/lib/tangram/base/base.js"),t=e("common:widget/ui/dialog/dialog.js"),n=(e("common:widget/ui/login/login.js"),e("common:widget/lib/fis/event/event.js").eventCenter),s={ele:a.g("blue-book-ads"),initDom:function(e,o){var i,t=[],n="";o&&o.taskbook&&(i="income"==o.taskbook.name),i&&a.dom.addClass(this.ele,"income-book-ads"),e?(n=i?1==o.redboxToOpen&&o.task_box.open_grade<=o.grade.grade?"你的红包可开启啦！":o.grade.is_know?o.taskbook.max_grade>o.grade.grade?"你有新的任务哦！":"回享本已升至顶级！":"你的回享本升级啦！":!o.box.is_open&&o.box.open_grade<=o.grade.grade?"你的礼包可开启啦！":o.grade.is_know?o.taskbook.max_grade>o.grade.grade?"你有新的任务哦！":"小蓝本已升至顶级！":"你的小蓝本升级啦！",o.grade.is_know||(a.dom.addClass(this.ele,"blue-book-upgrade"),a.dom.setAttr(this.ele,"data-grade",o.grade.grade))):n=i?"登录后开启回享本！":"登录后开启小蓝本！",t.push(i?['<div class="income-book-link">','<div class="book-tip"><p>'+n+"</p></div>",'<div class="yellow-book"></div>',"</div>"].join(""):['<div class="blue-book-link blue-bg">','<div class="blue-book-tip blue-bg">'+n+"</div>","</div>"].join("")),o&&(t.push('<div class="blue-book-title">'),t.push("<strong>"+o.taskbook.title+"</strong>"),t.push('<p>当前等级：<span class="em">'+o.grade.grade+"级</span></p>"),t.push("</div>")),t.push('<em id="blue-close" class="blue-close blue-bg"></em>'),this.ele.innerHTML=t.join(""),this.fixable(),this.bindEvent(i)},_fixable:function(){var e=a.page.getViewWidth(),o=0;e>1400&&(o+=(e-1400)/2),a.dom.fixable(this.ele,{vertival:"bottom",horizontal:"right",offset:{x:o,y:250},autofix:!0}),this.ele.style.display="block"},fixable:function(){var e=this;e._fixable(),(!a.browser.ie||a.browser.ie>7)&&a.on(window,"resize",function(){e._fixable()})},bindEvent:function(e){var o=this;a.on("blue-book-ads","click",function(i){var s=a.event.getTarget(i);"blue-close"!==s.id?n.fire("login.check",{isLogin:function(){var i,n={url:"/taskbook?page=taskbook&name=blue&_="+~new Date,width:912,height:600,name:"小蓝本任务"};if(e&&(n={url:"/taskbook?page=taskbook&name=income&_="+~new Date,width:930,height:603,name:"回享专属本"}),F.context("isLogin")||(F.context("isLogin",1),o.init(),i=function(){window.location.reload(!0)}),t.iframe(n.name,{skin:"blue-book-task",url:n.url,width:n.width,transparent:1,height:n.height,onclose:i}),a.dom.hasClass(o.ele,"blue-book-upgrade")){a.dom.removeClass(o.ele,"blue-book-upgrade");var s=a.dom.getAttr(o.ele,"data-grade"),l="/taskbookasyn?act=confirm_promotion",d="grade="+s;a.ajax.post(l,d,function(){})}}}):o.ele.style.display="none"})},init:function(){var e=F.context("isLogin"),o=this;e?a.ajax.post("/taskbookasyn?act=get_user_info",null,function(e,i){i=a.json.parse(i),0==i.errno&&o.initDom(1,i)}):this.initDom(!1,!1)}};i.exports=s});