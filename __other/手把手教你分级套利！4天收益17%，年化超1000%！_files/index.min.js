$(function(){var f={},b=window.navigator.userAgent.toLowerCase(),g=window.navigator.platform.toLowerCase();f.oLoading=$("#j_pullLoader");f.oWrap=$("#j_items_list").children();f.loadMoreURL=readConfig.load_api||"http://interface.sina.cn/yuedu/index_feed.d.json?",f.page=2;f.loading=0;f.isload=0;function o(){window.addEventListener("scroll",k,false)}function k(u){if(f.loading==0){var p=document.body.scrollTop||document.documentElement.scrollTop,t=$(document).height(),s=document.documentElement.clientHeight;if(p+s/2>=t-s){f.loading=1;f.oLoading.removeClass("hide").addClass("show");if(!f.isload){setTimeout(function(){h()},100);f.isload=1}else{h()}if(window.suda){var r=pullLoaderConfig.oPullLoader.data("sudaclick");if(r){var q={type:"read_index_loadmore",name:r,title:"阅读精彩推荐加载更多",index:0}}if(window.suds_count){window.suds_count(q)}}}}}function h(){var p=f.loadMoreURL,r=f.page;if(!!p==false){return false}if(p.indexOf("?")==-1){p=p+"?"}var q=p+"page="+r+"&act=more&jsoncallback=callbackFunction";$.ajax({url:q,async:false,type:"GET",dataType:"jsonp"})}window.callbackFunction=function(s){if(s.status){var v=s.data;var r=v.length,q=[];var u;var p=[];var t=$("#j_items_list").find(".carditems_list");t.each(function(){p.push($(this).data("id"))});for(i=0;i<r;i++){u=false;for(j=0;j<p.length;j++){if(v[i].docID==p[j]){u=true}}if(u){continue}window.is_rss=0;q.push('<dl class="carditems_list" data-id="'+v[i].docID+'">');if(v[i].pics[0]){if(v[i].bigpic){m(v[i],q,s)}else{c(v[i],q);n(v[i],q,s)}}else{d(v[i],q,s)}q.push("</dl>")}f.oWrap.append(q.join(""));f.page++;if(f.page<=s.count){f.loading=0}f.oLoading.addClass("hide").removeClass("show")}};function c(q,p){p.push('<dt class="carditems_list_dt">');p.push('<a href="'+q.url+'">');p.push('<img src="'+q.pics[0]+'" alt="" />');p.push("</a>");p.push("</dt>")}function d(s,p,q){p.push('<dd class="carditems_list_dd">');p.push('<h3 class="carditems_list_h3">');p.push('<a href="'+s.url+'">'+s.title+"</a>");p.push("</h3>");p.push('<div class="carditems_list_op"><a href="javascript:;">');p.push('<p class="op_rss_tips j_rss_btn" data-mid="'+s.mediaID+'">');if(s.mediaName){p.push('<span class="op_rss_tips_form">'+s.mediaName+"</span>")}else{p.push('<span class="op_rss_tips_form"></span>')}p.push('<span class="op_rss_line">|</span>');for(var r=0;r<q.user_rss.length;r++){if(s.mediaID==q.user_rss[r]){p.push('<span class="op_rss_btn_on">已订</span>');window.is_rss=1;break}}if(!window.is_rss){p.push('<span class="op_rss_btn">订阅</span>')}p.push("</p></a>");p.push("</div>");p.push("</dd>")}function n(s,p,q){p.push('<dd class="carditems_list_dd">');p.push('<h3 class="carditems_list_h3 pic_t_44">');p.push('<a href="'+s.url+'">'+s.title+"</a>");p.push("</h3>");p.push('<div class="carditems_list_op">');p.push('<p class="op_rss_tips j_rss_btn" data-mid="'+s.mediaID+'">');p.push('<span class="op_rss_tips_form">'+s.mediaName+"</span>");p.push('<span class="op_rss_line">|</span>');for(var r=0;r<q.user_rss.length;r++){if(s.mediaID==q.user_rss[r]){p.push('<span class="op_rss_btn_on">已订</span>');window.is_rss=1;break}}if(!window.is_rss){p.push('<span class="op_rss_btn">订阅</span>')}p.push("</p>");p.push("</div>");p.push("</dd>")}function m(s,p,q){p.push('<dd class="carditems_list_dd">');p.push('<a href="'+s.url+'">');p.push('<div class="carditems_pic"><img src="'+s.pics[0]+'" alt="" /></div>');p.push('<h3 class="carditems_list_h3">'+s.title+"</h3></a>");p.push('<div class="carditems_list_op">');p.push('<p class="op_rss_tips j_rss_btn" data-mid="'+s.mediaID+'">');p.push('<span class="op_rss_tips_form">'+s.mediaName+"</span>");p.push('<span class="op_rss_line">|</span>');for(var r=0;r<q.user_rss.length;r++){if(s.mediaID==q.user_rss[r]){p.push('<span class="op_rss_btn_on">已订</span>');window.is_rss=1;break}}if(!window.is_rss){p.push('<span class="op_rss_btn">订阅</span>')}p.push("</p></div></dd>")}function a(){this.type="";this.isLoading=false;this.requestBaseUrl=f.loadMoreURL;this.hasMores={"":true,funny:true,history:true,finance:true,ent:true,tech:true,news:true,photo:true,lady:true,qiwen:true,life:true}}a.prototype={constructor:a,init:function(){this.type="";var p=this;$(".j_comNav li").on("click tap",function(r){r&&r.preventDefault();r&&r.stopPropagation();var q=$(this).data("category");if(p.type===q){return}$(".j_comNav li").find("a").removeClass("active");$(this).find("a").addClass("active");p._selectNewCard(q)});window.addEventListener("scroll",function(){if(!p.isLoading&&p.hasMores[p.type]){p._loaderScroll()}},false)},_selectNewCard:function(q){$(".j_wonderRecommend").removeClass("on");this.type=q;this.hasMores[q]=true;$(".j_allitems").empty();$(".j_loadmores").removeClass("hide").addClass("show");this.isLoading=true;var p=this;setTimeout(function(){p._loadData(true)},700)},_loaderScroll:function(){var p=document.body.scrollTop||document.documentElement.scrollTop,s=$(document).height(),r=document.documentElement.clientHeight;if(p+r/2>=s-r){$(".j_loadmores").removeClass("hide").addClass("show");this.isLoading=true;var q=this;setTimeout(function(){q._loadData(false)},700)}},_loadData:function(p){var r=0;if(p){$(".j_loadmores").data("page",0);r=1}else{r=parseInt($(".j_loadmores").data("page"));r+=1}var q=this.requestBaseUrl+"?page="+r+"&type="+this.type+"&act=more&jsoncallback=callbackFunctionNew&callback=jsonp1";$.ajax({url:q,async:false,type:"GET",dataType:"jsonp"})},show:function(u){if(!u.status){return}var s=u.data;var t="";var v=null;for(var r=0,p=s.length;r<p;r++){v=s[r];if(!v.feedPic||""===v.feedPic){t+="<a href='"+v.URL+"'><dl class='carditems_list'><dd class='carditems_list_dd'><h3 class='carditems_list_h3'>"+v.title+"</h3><p class='carditems_list_op'><span class='op_ico time_num fl'>"+v.mediaName+"</span><span class='op_ico num_ico fr'>"+v.comment+"</span></p></dd></dl></a>"}else{if(v.bigpic){t+="<a href='"+v.URL+"'><dl class='carditems_list'><dd class='carditems_list_dd'><div class='carditems_pic'><img src='"+v.feedPic+"' alt=''></div><h3 class='carditems_list_h3'>"+v.title+"</h3><p class='carditems_list_op'><span class='op_ico time_num fl'>"+v.mediaName+"</span><span class='op_ico num_ico fr'>"+v.comment+"</span></p></dd></dl></a>"}else{t+="<a href='"+v.URL+"' class='clayer_a'><dl class='carditems_list'><dt class='carditems_list_dt'><img src='"+v.feedPic+"' alt=''></dt><dd class='carditems_list_dd'><h3 class='carditems_list_h3 pic_t_44'>"+v.title+"</h3><p class='carditems_list_op'><span class='op_ico time_num fl'>"+v.mediaName+"</span><span class='op_ico num_ico fr'>"+v.comment+"</span></p></dd></dl></a>"}}}var q=$(".j_loadmores").data("page");$(".j_loadmores").data("page",q+1);if(u.hasMore===false){this.hasMores[this.type]=false}$(".j_allitems").append($(t));$(".j_loadmores").removeClass("show").addClass("hide");this.isLoading=false}};window.callbackFunctionNew=function(p){window.carditemLoader.show(p)};function e(){window.carditemLoader=null;window.carditemLoader=new a();window.carditemLoader.init()}setTimeout(function(){e()},300);function l(r){if(typeof r!="object"){return r}if(r.constructor==Object){var p={};for(var q in r){p[q]=l(r[q])}}else{if(r.constructor==Array){var p=[];for(var q=0;q<r.length;q++){p[q]=l(r[q])}}else{var p=new r.constructor(r.valueOf())}}return p}});