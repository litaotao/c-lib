$(function(){var a={subscribe:readConfig.rss_post||"http://yd.sina.cn/rss_post.d.html?",index:"http://interface.sina.cn/yuedu/index_feed.d.json?",my_rss:"http://interface.sina.cn/yuedu/my_rss_feed.d.json?",media_article:"http://interface.sina.cn/yuedu/media_article_feed.d.json?",media_list:"http://interface.sina.cn/yuedu/media_list.d.json?",media_search:readConfig.media_search||"http://yd.sina.cn/media_search.d.json?"};var u;function p(){if($(this).html()=="全部展开"){$(this).parent().find(".rss_items").slice(3).css("display","block");$(this).html("收起")}else{$(this).parent().find(".rss_items").slice(3).css("display","none");$(this).html("全部展开")}}$("body").on("click tap","#j_tap_btn",p);function f(z){var C=null,A=$("#"+z),E=A.children().eq(0).find("a").find("img"),G=E.length,D=A.children().eq(1).find("span"),G=E.length,B=G-2,F=1,I="http://data.3g.sina.com.cn/api/logger/ls_focuspic_log.php",J,y=navigator.userAgent,H=0;C=new Swipe(document.getElementById(z),{startSlide:0,auto:4000,speed:300,callback:function(T,Q){D.html(T+1);var P,M;if(T>H&&T>=1&&T<G-1){P=E.eq(T+1)}else{if(T<H&&T>=2){P=E.eq(T)}else{if(T==G-1&&H==0){P=E.eq(G-1)}else{H=T;return}}}H=T;if(P.length>0){M=P.parent().parent()}if(P.length>0&&M.attr("data-loaded")=="0"){var K=P.attr("data-src"),S=P.attr("alt"),O=new Image(),R=false,N=false,L=null;P.attr("alt","");M.addClass("loading");O.src=K;O.onload=function(){M.removeClass("loading");P.attr("src",K);P.attr("alt",S);M.attr("data-loaded","1")};O.onerror=function(){var V=new Image();L=setTimeout(function(){if(!R){N=true;M.removeClass("loading").addClass("timeout");P.attr("alt","");J="1";$.ajax({type:"POST",async:false,url:I+"?type="+J+"&index="+T+"&src="+K+"&timeout=10&ua="+encodeURIComponent(y),dataType:"jsonp",success:function(W){},error:function(X,W){}})}},10000);var U=new Date().getTime();V.src=K+"?t="+U;V.onload=function(){R=true;clearTimeout(L);M.removeClass("loading");P.attr("src",K);P.attr("alt",S);M.attr("data-loaded","1")};V.onerror=function(){if(!N){R=true;clearTimeout(L);M.removeClass("loading").addClass("error");P.attr("alt","");J="0";$.ajax({type:"POST",async:false,url:I+"?type="+J+"&index="+T+"&src="+K+"&timeout=10&ua="+encodeURIComponent(y),dataType:"jsonp",success:function(W){},error:function(X,W){}})}}}}}})}var t={oComment_nav:$("#j_comment_nav"),wrap:$("#j_wrap")};function k(A){if(A.oComment_nav.length>0){function z(){var E=["","-webkit-","-ms-","-moz-","-o-"],G=E.length,F=document.createElement("div");for(var H=0;H<G;H++){F.style.position=E[H]+"sticky";if(F.style.position!=""){return true}}return false}if(z()){return false}var B=A.wrap,C=A.oComment_nav,D=C.offset().top;distance=C.height();navClone=C.clone();navClone.attr("style","opacity:1; position:fixed; z-index:900; display:none; left:0; right:0;");navClone.data("show",false);$("body").prepend(navClone);function y(){if($(window).scrollTop()<=D){if(navClone.data("show")){navClone.hide();navClone.data("show",false);setTimeout(function(){B.css({"-webkit-transition":"all 0.3s ease","-webkit-transform":"translate3d(0,0,0)"})},50)}}else{if($(window).scrollTop()>=D){if(!navClone.data("show")){navClone.show();navClone.data("show",true);B.css({"-webkit-transition":"all 0.3s ease","-webkit-transform":"translate3d(0,-"+distance+"px,0)"})}}}}window.addEventListener("scroll",y,false)}}function j(y){if(typeof window.onscroll=="function"){var z=window.onscroll;window.onscroll=function(){z();y()}}else{window.onscroll=function(){y()}}}function l(){var B=$(".j_imgdelay"),y=B.length,A=0;if(y==0){return false}var z=document.documentElement.clientHeight;z=z*2;function D(){if(A>=y){return false}for(var F=0;F<y;F++){var G=B.eq(F);if(G.data("imgdelay")===1){continue}var K=document.body.scrollTop||document.documentElement.scrollTop,I=z+K;if(G.offset().top<I){var H=G.find("img"),J=H.length;for(var E=0;E<J;E++){var L=H.eq(E);L.attr("src",L.data("src"))}G.data("imgdelay","1");A=A+1}}}var C;j(function(){if(C){clearTimeout(C);C=null}C=setTimeout(D,200)})}var h={oTop:$("#back_to_top"),oBackTop:$(".j_backTop ")};function q(C){var E=null,A=C.oTop,F=C.oBackTop;if(A.length>0){var y=0,B=0,z=$("body").height(),D=document.documentElement.clientHeight;j(function(){y=document.body.scrollTop||document.documentElement.scrollTop;if(y>z/2){A.show()}else{A.hide()}});A.click(function(){document.body.scrollTop=document.documentElement.scrollTop=0})}}if($("#j_art_wrap").length>0){if(commentConfig.user.usernick){$(document).on("click tap",".j_rss_ico",c)}else{$(document).on("click tap",".j_rss_ico",function(){window.location.href=commentConfig.login.loginurl})}}function c(){var z=$(this).data("mid"),y=a.subscribe,A;A=$(this).hasClass("rss_op_btn")?"add":"del";window.mid=z;window.type=A;if(!!y==false){return false}if(y.indexOf("?")==-1){y=y+"?"}var B={mid:z,type:A};$.ajax({url:y,data:B,type:"POST",dataType:"json",success:function(C){if(C.status){var D=C.data;item=$(".j_rss_ico");if(A=="del"){item.each(function(E){var F=$(item[E]);if(F.data("mid")==z){F.removeClass("rss_op_btn_on");F.addClass("rss_op_btn");F.html("订阅")}})}else{item.each(function(E){var F=$(item[E]);if(F.data("mid")==z){F.removeClass("rss_op_btn");F.addClass("rss_op_btn_on");F.html("已订")}})}}else{if(C.message=="user need login"){window.location.href=C.data.url}}},error:function(D,C){}})}if($(".j_rss_ico").length>0||$(".j_rss_btn").length>0){m()}function m(){var y="http://passport.sina.cn/sso/islogin?entry=wapsso&";w(y,{},function(A){if(A.retcode=="20000000"||A.retcode==20000000){var z=true}else{var z=false}x(z);e(z)})}function w(y,B,E){var z="jsonp_"+Math.random();z=z.replace(".","");window[z]=function(H){E&&E(H);A.removeChild(F);window[z]=null};B.callback=z;var D=[];for(var C in B){D.push(C+"="+encodeURIComponent(B[C]))}var G=D.join("&");var F=document.createElement("script");F.src=y+G;var A=document.getElementsByTagName("head")[0];A.appendChild(F)}function e(y){if($("#my_rss").length>0&&!y){$("#my_rss")[0].addEventListener("click",function(z){u.show();window.floatbtn="my_rss";z.preventDefault()},false)}}function x(y){if($(".j_rss_ico").length>0&&$("#j_wrap").length>0){if(y){$(document).on("click tap",".j_rss_ico",c)}else{if(window.SINA_OUTLOGIN_LAYER){u=window.SINA_OUTLOGIN_LAYER;u.set("sso",{entry:"wapsso"}).init();if($(".j_rss_ico").length>0){for(var z=0;z<$(".j_rss_ico").length;z++){document.addEventListener("click",function(A){var B=A.srcElement||A.target;if($(B).hasClass("j_rss_ico")||$(B).parent().hasClass("j_rss_ico")){u.show();window.floatbtn="j_rss_ico";return}},false)}}u.register("login_success",function(){if(window.floatbtn=="my_rss"){window.location.href=$("#my_rss a").attr("href")}else{window.location.href=window.location.href}});u.register("layer_hide",function(){})}}}if($(".j_rss_btn").length>0&&$("#j_wrap").length>0){if(y){$("#j_wrap").on("click tap",".j_rss_btn",v)}else{if(window.SINA_OUTLOGIN_LAYER){u=window.SINA_OUTLOGIN_LAYER;u.set("sso",{entry:"wapsso"}).init();if($(".j_rss_btn").length>0){for(var z=0;z<$(".j_rss_btn").length;z++){document.addEventListener("click",function(A){var B=A.srcElement||A.target;if($(B).hasClass("j_rss_btn")||$(B).parent().hasClass("j_rss_btn")){u.show();window.floatbtn="j_rss_btn";return}},false)}}u.register("login_success",function(){if(window.floatbtn=="my_rss"){window.location.href=$("#my_rss a").attr("href")}else{window.location.href=window.location.href}});u.register("layer_hide",function(){})}}}}function v(){var z=$(this).data("mid"),y=a.subscribe,A;A=$(this).children().eq(2).hasClass("op_rss_btn")?"add":"del";if(!!y==false){return false}if(y.indexOf("?")==-1){y=y+"?"}var B={mid:z,type:A};$.ajax({url:y,data:B,type:"POST",dataType:"json",success:function(C){if(C.status){var D=C.data;item=$(".j_rss_btn");if(A=="del"){item.each(function(E){var F=$(item[E]);if(F.data("mid")==z){F.children().eq(2).removeClass("op_rss_btn_on");F.children().eq(2).addClass("op_rss_btn");F.children().eq(2).html("订阅")}})}else{item.each(function(E){var F=$(item[E]);if(F.data("mid")==z){F.children().eq(2).removeClass("op_rss_btn");F.children().eq(2).addClass("op_rss_btn_on");F.children().eq(2).html("订阅")}})}}else{if(C.message=="user need login"){window.location.href=C.data.url}}},error:function(D,C){}})}function s(A){if(typeof A!="object"){return A}if(A.constructor==Object){var y={};for(var z in A){y[z]=s(A[z])}}else{if(A.constructor==Array){var y=[];for(var z=0;z<A.length;z++){y[z]=s(A[z])}}else{var y=new A.constructor(A.valueOf())}}return y}function b(A){var z=$("#j_search_result").children();url=a.media_search;var y=$(".media_t_h4");if(!!url==false){return false}if(url.indexOf("?")==-1){url=url+"?"}$.ajax({url:url,type:"POST",data:{text:A},dataType:"json",timeout:10000,success:function(D){if(D.status){var E=D.data;if(E){var C=E.length,B=[];if(C){C=C>3?3:C;for(i=0;i<C;i++){B.push('<a href="'+E[i].url+'">');B.push('<div class="rss_search_items">');B.push('<p class="rss_logo_pic"><img src="'+E[i].logo+'" alt=""/></p>');B.push('<div class="rss_cont">');B.push('<h3 class="rss_cont_h3">'+E[i].title+"</h3>");B.push('<p class="rss_cont_txt">');B.push('<span class="rss_cont_txt_t">'+E[i].doc_title+"</span>");B.push("</p>");B.push("</div>");B.push("</div></a>")}y.hide();z.html(B.join(""))}else{z.html("")}}else{y.show();z.html("")}}else{}}})}function g(y){y.preventDefault();return}var o={};o.searchInput=$("#searchInput");o.mainwrap=$("#main_wrap");var r=false;function d(z){if(z.searchInput.length==0){return}var y=document.getElementsByName("viewport")[0];$(".search_click").on("click tap",function(){if(!r){r=true;var C=$("#j_searchbg"),H=$(".j_search_box"),E=H.find(".j_read_search_wrap21"),B=$("#j_search_result"),F=$("#j_none");E.css({position:"absolute",zIndex:"10000"});C.on("click",function(){var J=$("#j_searchbg"),M=$(".j_search_box"),K=M.find(".j_read_search_wrap21"),I=$("#j_search_result"),L=$("#j_none");y.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no";window.removeEventListener("touchmove",g,false);M.hide();$(".j_read_search_wrap21").hide()});$(".j_cancel").on("click",function(){var J=$("#j_searchbg"),M=$(".j_search_box"),K=M.find(".j_read_search_wrap21"),I=$("#j_search_result"),L=$("#j_none");y.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no";window.removeEventListener("touchmove",g,false);M.hide();$(".j_read_search_wrap21").hide()});var D=null;var G="";function A(){if(D){clearTimeout(D);D=null}setInterval(function(){var I=$.trim($(".j_searchInput").val());if($.trim(G)===I){return}else{G=I;D&&clearTimeout(D);setTimeout(function(){b(I)},30)}},200)}setTimeout(function(){A()},20);E.on("blur",function(){setTimeout(function(){D&&clearTimeout(D);D=null},500)});$(".j_searchCross").on("click tap",function(){$(".j_searchInput").val("")})}$(".j_read_search_wrap21").show();var H=$(".j_search_box"),E=H.find(".j_read_search_wrap21");setTimeout(function(){H.find(".j_searchInput").focus()},300);H.show();y.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui";window.addEventListener("touchmove",g,false)})}function n(A){var y=0;var z=0;while(A){y+=A.offsetLeft;z+=A.offsetTop;A=A.offsetParent}return{left:y,top:z}}setTimeout(function(){f("j_imgSwipe");k(t);l();q(h);d(o)},300)});