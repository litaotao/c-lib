
var loginBox=document.getElementById('loginBox');if(loginBox){(function(){if(typeof window.$WeiboJsApi=='undefined'){window.$WeiboJsApi={};};$WeiboJsApi._ajax=function(config){config=config[0]||{};this.url=config.url||'';this.param=config.param||null;this.callback=config.callback||function(){};this.timeout=config.timeout||15000;this.ontimeout=config.ontimeout||function(){};this.timeoutflag=true;if(typeof window._$WeiboJsApi_callback=='undefined'){window._$WeiboJsApi_callback={};}
this._setJSONRequest();};$WeiboJsApi._ajax.prototype={_setJSONRequest:function(){var head=document.getElementsByTagName('head')[0];var script=document.createElement('script');var fun=this._setRandomFun();var _this=this;var param='';for(var i in this.param){if(param==''){param=i+'='+this.param[i];}else{param+='&'+i+'='+this.param[i];}}
script.type='text/javascript';script.charset='utf-8';if(head){head.appendChild(script);}else{document.body.appendChild(script);}
window._$WeiboJsApi_callback[fun.id]=function(data){_this.callback(data);_this.timeoutflag=false;setTimeout(function(){delete window._$WeiboJsApi_callback[fun.id];script.parentNode.removeChild(script);},100);};script.src=this.url+'&callback='+fun.name+'&'+param;setTimeout(function(){if(_this.timeoutflag){_this.ontimeout();setTimeout(function(){delete window._$WeiboJsApi_callback[fun.id];script.parentNode.removeChild(script);},100);}},_this.timeout);},_setRandomFun:function(){var id='';do{id='$WeiboJsApi'+Math.floor(Math.random()*10000);}while(window._$WeiboJsApi_callback[id])
return{id:id,name:'window._$WeiboJsApi_callback.'+id};}};window.$WeiboJsApi.ajax=function(){return new $WeiboJsApi._ajax(arguments);};window.$WeiboJsApi.getWeiboInfo=function(callbackFun){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/query?appid=com.sina.weibo',callback:callbackFun});};window.$WeiboJsApi.getAppInfo=function(pkgName,callbackFun){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/query?appid='+pkgName,callback:callbackFun});};window.$WeiboJsApi.startWeibo=function(callbackFun){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/si?cmp=com.sina.weibo_com.sina.weibo.SplashActivity&act=android.intent.action.VIEW',callback:callbackFun});};window.$WeiboJsApi.startApp=function(pkgName,activityName,callbackFun){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/si?act=android.intent.action.VIEW&cmp='+pkgName+'_'+activityName,callback:callbackFun});};window.$WeiboJsApi.startScheme=function(schemeNmae,callbackFun){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/si?act=android.intent.action.VIEW&data='+schemeNmae,callback:callbackFun});};window.$WeiboJsApi.getUserInfo=function(obj){return new $WeiboJsApi.ajax({url:'http://127.0.0.1:9527/login?',callback:obj.onsuccess,ontimeout:obj.ontimeout,timeout:obj.timeout});};})();(function(w,doc){function encodeFormData(data){var pairs=[],regexp=/%20/g;var value;for(var key in data){value=data[key].toString();pairs.push(w.encodeURIComponent(key).replace(regexp,'+')+'='+w.encodeURIComponent(value).replace(regexp,'+'));}
return pairs.join('&');}
var toString=Object.prototype.toString;function isFunction(obj){return toString.call(obj)==='[object Function]';}
function isNumber(obj){return toString.call(obj)==='[object Number]';}
function _siteId(prefix){var id=(new Date()).getTime()+Math.floor(Math.random()*100000);return prefix?prefix+''+id:id;}
var head=doc.getElementsByTagName('head')[0]||doc.documentElement;var baseElement=head.getElementsByTagName('base')[0];var READY_STATE_RE=/^(?:loaded|complete|undefined)/;var scriptOnLoad=function(node,callback){node.onload=node.onreadystatechange=function(){if(READY_STATE_RE.test(node.readyState)){node.onload=node.onreadystatechange=null;head.removeChild(node);node=null;}};};function getScript(url,charset){var node=doc.createElement('script');node.src=url;if(charset){node.charset=charset;}
node.async=true;scriptOnLoad(node);if(baseElement){head.insertBefore(node,baseElement);}else{head.appendChild(node);}
return node;}
w.jsonp=function(obj){var jsonpName=obj.jsonp||'callback';var jsonpCallback=_siteId('jsonpcallback');var jsonpParams=jsonpName+'='+jsonpCallback;var timeout=window.setTimeout(function(){if(isFunction(obj.ontimeout)){obj.ontimeout();}},5000);window[jsonpCallback]=function(data){window.clearTimeout(timeout);if(isFunction(obj.onsuccess)){obj.onsuccess(data);}};var andTag=obj.url.indexOf('?')>0?'&':'?';if(obj.data){getScript(obj.url+andTag+encodeFormData(obj.data)+'&'+jsonpParams,obj.charset);}else{getScript(obj.url+andTag+jsonpParams,obj.charset);}};w.cookie={setCookie:function(name,value,expire,path,domain,secure){var cstr=[];cstr.push(name+'='+escape(value));if(expire){var dd=new Date();var expires=dd.getTime()+expire*3600000;dd.setTime(expires);cstr.push('expires='+dd.toGMTString());}
if(path){cstr.push('path='+path);}
if(domain){cstr.push('domain='+domain);}
if(secure){cstr.push(secure);}
doc.cookie=cstr.join(';');},getCookie:function(name){name=name.replace(/([\.\[\]\$])/g,'\\\$1');var rep=new RegExp(name+'=([^;]*)?;','i');var co=doc.cookie+';';var res=co.match(rep);if(res){return res[1]||"";}
else{return"";}},deleteCookie:function(name){doc.cookie=name+'=;'+'expires=Fri, 31 Dec 1999 23:59:59 GMT;';}};})(window,document);(function(w,doc){var $=function(id){return doc.getElementById(id);},nodes={},appFlag=false;nodes.loginBox=$('loginBox');jsonp({url:'http://passport.sina.cn/sso/islogin',data:{entry:'wapsso'},charset:'utf-8',onsuccess:function(loginData){if(loginData.retcode===20000000){nodes.loginBox.href=loginData.data.return_url;var imghtml='<img src="'+loginData.data.portrait_url+'">';if(loginData.data.unread_num>0){imghtml+='<em>'+loginData.data.unread_num+'</em>'}
nodes.loginBox.innerHTML=imghtml;}else if(loginData.retcode===50011039){var needAppTime=cookie.getCookie('needapp');if(needAppTime===''){appFlag=true;}else{var curTime=(new Date()).getTime()/1000;var cookieHours=(curTime-needAppTime)/(60*60);if(cookieHours>24){appFlag=true;}}
if(appFlag){$WeiboJsApi.getUserInfo({onsuccess:function(weiboData){var checkData={entry:'wapsso',id:weiboData.uid,login_state:weiboData.login_state,from:weiboData.from};jsonp({url:'http://passport.sina.cn/sso/checkapp',data:checkData,charset:'utf-8',onsuccess:function(result){if(result.retcode===20000000&&weiboData.login_state===1){nodes.loginBox.href=result.data.return_url;var imghtml='<img src="'+weiboData.portrait_url+'">';if(weiboData.unread_num>0){imghtml+='<em>'+weiboData.unread_num+'</em>'}
nodes.loginBox.innerHTML=imghtml;}else{nodes.loginBox.href=result.data.return_url;}}});},ontimeout:function(){nodes.loginBox.href='http://my.sina.cn/?pos=108&vt=4';},timeout:2000});}else{nodes.loginBox.href='http://my.sina.cn/?pos=108&vt=4';}}}});})(window,document);}
(function(){$(function(){function backTopHandle(){var backTop=$('.j_scrollToTop');if(backTop.length>0){backTop.click(function(){window.scrollTo(0,0);});}}
function backHistory(){var goBack=$('.j_backPrePage');if(goBack.length>0){goBack.click(function(){window.history.length<=1?window.location.href='http://sina.cn':window.history.go(-1);})}}
window.addEventListener('load',function(){backTopHandle();backHistory();},false);function simSelectBind(){$('.j_simselect').each(function(){$(this).on('change',function(){var that=$(this),val=that.val(),text=that.find('option[value="'+val+'"]').text(),oShow=$(this).prev(),showText=oShow.text();oShow.html((text&&text.length>0)?text:val);})})}
function addOnscroll(fn){if(typeof window.onscroll=='function'){var tempFn=window.onscroll;window.onscroll=function(){tempFn();fn();}}else{window.onscroll=function(){fn();}}}
function setSearchContent(evt){searchTimer=setInterval(checkSearchContent,200);}
function checkSearchContent(){if(!searchTimer){return;}
var sInput=$('#searchInput'),cross=$('#searchCross'),searchContent=sInput?$.trim(sInput.val()):'';if(cross){if(searchContent===''){if(cross.css('display')!='none'){cross.css('display','none');}}else{if(cross.css('display')!='block'){cross.css('display','block');}}}};function defaultSearchContent(evt){if(searchTimer){clearInterval(searchTimer);searchTimer=null;}};function clearSearchContent(evt){var sInput=$('#searchInput'),cross=$('#searchCross');cross&&cross.css('display','none');if(sInput){sInput.val('');sInput.focus();}};function searchInit(){if($('#searchInput').length>0&&$('#searchCross').length>0){var sInput=$('#searchInput'),cross=$('#searchCross'),defaultSearch=sInput.attr('placeholder'),searchContent=sInput?$.trim(sInput.val()):'';if(cross&&searchContent===defaultSearch)cross.css('display','none');$(document).on('focus','#searchInput',setSearchContent);$(document).on('blur','#searchInput',defaultSearchContent);$('#searchCross').on('click tap',clearSearchContent);}}
setTimeout(function(){searchInit();},300);window.onpageshow=function(){simSelectBind();$('.p_search_wrap').find('.j_simselect').eq(0).val('news');$('.p_search_wrap').find('.j_simselect').eq(0).prev().html('站内');$('.footer_search').find('.j_simselect').eq(0).val('news');$('.footer_search').find('.j_simselect').eq(0).prev().html('站内');}});})()