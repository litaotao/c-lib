 /**
 * 新浪数据采集
 * @fileoverview suda_log统计
 * @author wangfeng@staff.sina.com.cn
 * @date 2014-09-19
 */
(function(){function d(e){if(typeof window.onload=="function"){var f=window.onload;window.onload=function(){f();e()}}else{window.onload=e}}var a="",c=new Date().getTime();function b(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){a=new Date().getTime();document.removeEventListener("DOMContentLoaded",arguments.callee,false)},false)}else{if(document.getElementById){document.write('<script id="ie-domReady" defer=\'defer\'src="//:"><\/script>');document.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){a=new Date().getTime();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}b();d(function(){var R=window,l=document,x=navigator,Q=x.userAgent,n=R.screen,q=R.location.href;var P="https:"==R.location.protocol?"https://":"http://",u="beacon.sina.com.cn";var o=P+u+"/a.gif?",g=P+u+"/e.gif?";var j="",U="";startTime="",prevPageClickTime="",readyTime="";currTime=parseInt(new Date().getTime()),requestTime="";if(typeof sudaLogConfig!=="undefined"){j=sudaLogConfig.uId!==undefined?sudaLogConfig.uId:"";U=sudaLogConfig.url!==undefined?sudaLogConfig.url:"";if(typeof globalConfig!=="undefined"){startTime=globalConfig.startTime!==undefined?globalConfig.startTime:c}prevPageClickTime=sudaLogConfig.prevPageClickTime!==undefined?sudaLogConfig.prevPageClickTime:0}onloadTime=currTime-startTime;readyTime=a-startTime;requestTime=startTime-prevPageClickTime;var E="";if(window.suda){E="MT=mperform:1|starttime:"+prevPageClickTime+"|endtime:"+startTime+"|clicktime:"+requestTime}var K=l.referrer.toLowerCase();var z="SINAGLOBAL",f="Apache",T="ULV",m="SUP";var S="";var C="",B="";var k=[],N=[];var Y=0,Z=0;function L(ac,aa){var ab=l.getElementsByName(ac);var D=(aa>0)?aa:0;return(ab.length>D)?ab[D].content:""}function t(){var ad=l.getElementsByName("sudameta");var ae=[];for(var D=0;D<ad.length;D++){var ac=ad[D].content;if(ac){if(ac.indexOf(";")!=-1){var af=ac.split(";");for(var ab=0;ab<af.length;ab++){var aa=e(af[ab]);if(!aa){continue}ae.push(aa)}}else{ae.push(ac)}}}return ae}function V(ae,aa,ac,ab){if(ae==""){return""}ab=(ab=="")?"=":ab;aa+=ab;var ad=ae.indexOf(aa);if(ad<0){return""}ad+=aa.length;var D=ae.indexOf(ac,ad);if(D<ad){D=ae.length}return ae.substring(ad,D)}function i(D){if(undefined==D||""==D){return""}return V(l.cookie,D,";","")}function r(ad,D,aa,ac){if(D!=null){if((undefined==ac)||(null==ac)){ac="sina.cn"}if((undefined==aa)||(null==aa)||(""==aa)){l.cookie=ad+"="+D+";domain="+ac+";path=/"}else{var ab=new Date();var ae=ab.getTime();ae=ae+86400000*aa;ab.setTime(ae);ae=ab.getTime();l.cookie=ad+"="+D+";domain="+ac+";expires="+ab.toUTCString()+";path=/"}}}function p(D,ac,ab){var aa=D;if(aa==null){return false}ac=ac||"click";if((typeof ab).toLowerCase()!="function"){return}if(aa.attachEvent){aa.attachEvent("on"+ac,ab)}else{if(aa.addEventListener){aa.addEventListener(ac,ab,false)}else{aa["on"+ac]=ab}}return true}function X(){if(window.event!=null){return window.event}else{if(window.event){return window.event}var aa=arguments.callee.caller;var D;var ab=0;while(aa!=null&&ab<40){D=aa.arguments[0];if(D&&(D.constructor==Event||D.constructor==MouseEvent||D.constructor==KeyboardEvent)){return D}ab++;aa=aa.caller}return D}}function W(D){D=D||X();if(!D.target){D.target=D.srcElement;D.pageX=D.x;D.pageY=D.y}if(typeof D.layerX=="undefined"){D.layerX=D.offsetX}if(typeof D.layerY=="undefined"){D.layerY=D.offsetY}return D}function e(ac){if(typeof ac!=="string"){throw"trim need a string as parameter"}var D=ac.length;var ab=0;var aa=/(\u3000|\s|\t|\u00A0)/;while(ab<D){if(!aa.test(ac.charAt(ab))){break}ab+=1}while(D>ab){if(!aa.test(ac.charAt(D-1))){break}D-=1}return ac.slice(ab,D)}function F(D){return Object.prototype.toString.call(D)==="[object Array]"}function I(ab,af){var ah=e(ab).split("&");var ag={};var aa=function(aj){if(af){return decodeURIComponent(aj)}else{return aj}};for(var ad=0,ae=ah.length;ad<ae;ad++){if(ah[ad]){var ac=ah[ad].split("=");var D=ac[0];var ai=ac[1];if(ac.length<2){ai=D;D="$nullName"}if(!ag[D]){ag[D]=aa(ai)}else{if(F(ag[D])!=true){ag[D]=[ag[D]]}ag[D].push(aa(ai))}}}return ag}function J(aa){var D=new RegExp("^http(?:s)?://([^/]+)","im");if(aa.match(D)){return aa.match(D)[1].toString()}else{return""}}var w={screenSize:function(){return n.width+"x"+n.height},colorDepth:function(){return n.colorDepth||""},appCode:function(){return x.appCodeName||""},appName:function(){return(x.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":x.appName},cpu:function(){return x.cpuClass||x.oscpu||""},platform:function(){return x.platform||""},jsVer:function(){var ad,D,af,ab=1,ac=0,aa=(x.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":x.appName,ae=x.appVersion;if("MSIE"==aa){D="MSIE";ad=ae.indexOf(D);if(ad>=0){af=window.parseInt(ae.substring(ad+5));if(3<=af){ab=1.1;if(4<=af){ab=1.3}}}}else{if(("Netscape"==aa)||("Opera"==aa)||("Mozilla"==aa)){ab=1.3;D="Netscape6";ad=ae.indexOf(D);if(ad>=0){ab=1.5}}}return ab},network:function(){var D="";D=(x.connection&&x.connection.type)?x.connection.type:D;try{l.body.addBehavior("#default#clientCaps");D=l.body.connectionType}catch(aa){D="unkown"}return D},language:function(){return x.systemLanguage||x.language||""},timezone:function(){return new Date().getTimezoneOffset()/60||""},flashVer:function(){return""},javaEnabled:function(){var ab=x.plugins,aa=x.javaEnabled(),ac,ad;if(aa==true){return 1}if(ab&&ab.length){for(var D in ab){ac=ab[D];if(ac.description==null){continue}if(aa!=null){break}ad=ac.description.toLowerCase();if(ad.indexOf("java plug-in")!=-1){aa=parseInt(ac.version);continue}}}else{if(window.ActiveXObject){aa=(new ActiveXObject("JavaWebStart.IsInstalled")!=null)}}return aa?1:0}};var h={pageId:function(){return""},sessionCount:function(){return""},excuteCount:function(){return SUDA.sudaCount},referrer:function(){var D=/^[^\?&#]*.swf([\?#])?/;if((K=="")||(K.match(D))){var aa=V(q,"ref","&","");if(aa!=""){return escape(aa)}}return escape(K)},isHomepage:function(){var aa="";try{l.body.addBehavior("#default#homePage");aa=l.body.isHomePage(q)?"Y":"N"}catch(D){aa="unkown"}return aa},PGLS:function(){return L("stencil")||""},ZT:function(){var D=L("subjectid");D.replace(",",".");D.replace(";",",");return escape(D)},mediaType:function(){return L("mediaid")||""},domCount:function(){return l.getElementsByTagName("*").length||""},iframeCount:function(){return l.getElementsByTagName("iframe").length},onloadTime:onloadTime,readyTime:readyTime,webUrl:U};var H={visitorId:function(){if(""!=z){var D=i(z);if(""==D){D=i(f);var aa=3650;r(z,D,aa)}return D}else{return""}},sessionId:function(){var D=i(f);if(D==""){var aa=new Date();D=Math.random()*10000000000000+"."+aa.getTime();r(f,D)}return D},flashCookie:function(D){return""},lastVisit:function(){var ab=i(f);var ad=i(T);var ac=ad.split(":");var ae="",aa;if(ac.length>=6){if(ab!=ac[4]){aa=new Date();var D=new Date(window.parseInt(ac[0]));ac[1]=window.parseInt(ac[1])+1;if(aa.getMonth()!=D.getMonth()){ac[2]=1}else{ac[2]=window.parseInt(ac[2])+1}if(((aa.getTime()-D.getTime())/86400000)>=7){ac[3]=1}else{if(aa.getDay()<D.getDay()){ac[3]=1}else{ac[3]=window.parseInt(ac[3])+1}}ae=ac[0]+":"+ac[1]+":"+ac[2]+":"+ac[3];ac[5]=ac[0];ac[0]=aa.getTime();r(T,ac[0]+":"+ac[1]+":"+ac[2]+":"+ac[3]+":"+ab+":"+ac[5],360)}else{ae=ac[5]+":"+ac[1]+":"+ac[2]+":"+ac[3]}}else{aa=new Date();ae=":1:1:1";r(T,aa.getTime()+ae+":"+ab+":",360)}return ae},userNick:function(){if(S!=""){return S}var ab=unescape(i(m)),aa="",D="",ad=j,ae="",ac="";if(ab!=""){aa=V(ab,"ag","&","");D=V(ab,"user","&","");j=V(ab,"uid","&","");ae=V(ab,"sex","&","");ac=V(ab,"dob","&","")}S=aa+":"+D+":"+ad+":"+ae+":"+ac;return S},userOrigin:function(){return""},advCount:function(){return""}};var s={CI:function(){var D=["sz:"+w.screenSize(),"dp:"+w.colorDepth(),"ac:"+w.appCode(),"an:"+w.appName(),"cpu:"+w.cpu(),"pf:"+w.platform(),"jv:"+w.jsVer(),"ct:"+w.network(),"lg:"+w.language(),"tz:"+w.timezone(),"fv:"+w.flashVer(),"ja:"+w.javaEnabled()];return"CI="+D.join("|")},PI:function(D){var aa=["pid:"+h.pageId(),"st:"+h.sessionCount(),"et:"+h.excuteCount(),"ref:"+h.referrer(),"hp:"+h.isHomepage(),"PGLS:"+h.PGLS(),"ZT:"+h.ZT(),"MT:"+h.mediaType(),"keys:","dom:"+h.domCount(),"ifr:"+h.iframeCount(),"nld:"+h.onloadTime,"drd:"+h.readyTime,"url:"+h.webUrl];return"PI="+aa.join("|")},UI:function(){var D=["vid:"+H.visitorId(),"sid:"+H.sessionId(),"lv:"+H.lastVisit(),"un:"+H.userNick(),"uo:"+H.userOrigin(),"ae:"+H.advCount(),"lu:","si:","rs:"+0,"dm:"+0];return"UI="+D.join("|")},EX:function(aa,D){aa=(null!=aa)?aa||"":C;D=(null!=D)?D||"":B;return"EX=ex1:"+aa+"|ex2:"+D},MT:function(){return E},V:function(){return"V=2.3.1"},R:function(){return"gUid_"+new Date().getTime()}};function O(D){y(D)}function y(aa){var D=new Image();SUDA.img=D;D.src=aa}function v(D,ac,ab){SUDA.sudaCount++;var aa=o+[s.V(),s.CI(),s.PI(D),s.UI(),s.MT(),s.EX(ac,ab),s.R()].join("&");y(aa)}function M(D,ab,aa){if(SUDA.sudaCount!=0){return}v(D,ab,aa)}function G(ad,D,aa){if(!aa){aa=""}else{aa=escape(aa)}var ac="UATrack||"+i(z)+"||"+i(f)+"||"+H.userNick()+"||"+ad+"||"+D+"||"+h.referrer()+"||"+aa+"||";var ab=g+ac+"&gUid_"+new Date().getTime();O(ab)}function A(ad){var D=W(ad);var ab=D.target;var ae="",aa="";var ac;if(ab!=null&&ab.getAttribute&&(!ab.getAttribute("suda-uatrack")&&!ab.getAttribute("suda-data"))){while(ab!=null&&ab.getAttribute&&(!!ab.getAttribute("suda-uatrack")||!!ab.getAttribute("suda-data"))==false){if(ab==l.body){return}ab=ab.parentNode}}if(ab==null||ab.getAttribute==null){return}ae=ab.getAttribute("suda-uatrack")||ab.getAttribute("suda-data")||"";if(ae){ac=I(ae);if(ab.tagName.toLowerCase()=="a"){aa=ab.href}ac.key&&SUDA.uaTrack&&SUDA.uaTrack(ac.key,ac.value||ac.key,aa)}}window.SUDA=window.SUDA||[];SUDA.sudaCount=SUDA.sudaCount||0;SUDA.log=function(){v.apply(null,arguments)};SUDA.uaTrack=function(){G.apply(null,arguments)};p(l.body,"click",A);M()})})();
