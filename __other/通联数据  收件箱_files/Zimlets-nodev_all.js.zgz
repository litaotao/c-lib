if(!window.com_zimbra_email){
com_zimbra_email={}
}
a=com_zimbra_email;
a.zimletLabel="Email Contact Details";
a.description="Highlights and previews associated contact details for an email address.";
a.search="Search";
a.findEmailBySender="Find Emails From Sender";
a.findEmails="Find Emails...";
a.newEmail="New Email";
a.newIM="New IM";
a.newContact="New Contact";
a.newFilter="New Filter";
a.goToUrl="Go to URL";
a.addToFilter="Add to Filter";
a.preferencesSaved="Preferences Saved";
a.emailZimletPreferences="Email Zimlet Preferences";
a.label="Email";
a.tooltip="Shows Email Zimlet's preferences";
a.VERYSMALL="Very Small";
a.SMALL="Small";
a.MEDIUM="Medium";
a.LARGE="Large";
a.XL="XL";
a["2XL"]="2XL";
a.selectToolTipSize="Please select tool-tip's size: ";
a.rightClickForMoreOptions="Right click for more options";
a.contact="Contact";
a.close="Close";
a.slideTooltip="Email Profile";
a.slideMailTooltip="New Email";
a.slideCalendarTooltip="New Appointment";
a.loading="Loading...";
a.copy="Copy";
a.msg_available="Available";
a.msg_unavailable="Unavailable";
a.msg_busy="Busy";
a.msg_away="Away";
a.msg_dnd="Do not disturb";
a.msg_onthephone="On the phone";
a.msg_vacation="Vacation";
a.msg_unknown="Unknown";
if(!window.com_zimbra_email){
com_zimbra_email={}
}
a=com_zimbra_email;
a.zimletLabel="\u7535\u5b50\u90ae\u4ef6\u8054\u7cfb\u4eba\u8be6\u7ec6\u4fe1\u606f";
a.description="\u7a81\u51fa\u663e\u793a\u5e76\u9884\u89c8\u7535\u5b50\u90ae\u4ef6\u5730\u5740\u7684\u5173\u8054\u8054\u7cfb\u4eba\u8be6\u7ec6\u4fe1\u606f\u3002";
a.search="\u641c\u7d22";
a.findEmailBySender="\u6309\u53d1\u4ef6\u4eba\u67e5\u627e\u7535\u5b50\u90ae\u4ef6";
a.findEmails="\u67e5\u627e\u7535\u5b50\u90ae\u4ef6...";
a.newEmail="\u65b0\u7535\u5b50\u90ae\u4ef6";
a.newIM="\u65b0\u5373\u65f6\u901a\u4fe1";
a.newContact="\u65b0\u8054\u7cfb\u4eba";
a.newFilter="\u65b0\u8fc7\u6ee4\u5668";
a.goToUrl="\u524d\u5f80 URL";
a.addToFilter="\u6dfb\u52a0\u5230\u8fc7\u6ee4\u5668";
a.preferencesSaved="\u9996\u9009\u9879\u5df2\u4fdd\u5b58";
a.emailZimletPreferences="\u7535\u5b50\u90ae\u4ef6 Zimlet \u9996\u9009\u9879";
a.label="\u7535\u5b50\u90ae\u4ef6";
a.tooltip="\u663e\u793a\u7535\u5b50\u90ae\u4ef6 Zimlet \u7684\u9996\u9009\u9879";
a.VERYSMALL="\u7279\u5c0f";
a.SMALL="\u5c0f";
a.MEDIUM="\u4e2d";
a.LARGE="\u5927";
a.XL="\u7279\u5927";
a["2XL"]="2XL";
a.selectToolTipSize="\u8bf7\u9009\u62e9\u5de5\u5177\u63d0\u793a\u7684\u5927\u5c0f: ";
a.rightClickForMoreOptions="\u5355\u51fb\u9f20\u6807\u53f3\u952e\u53ef\u67e5\u770b\u66f4\u591a\u9009\u9879";
a.contact="\u8054\u7cfb\u4eba";
a.close="\u5173\u95ed";
a.slideTooltip="\u7535\u5b50\u90ae\u4ef6\u914d\u7f6e\u6587\u4ef6";
a.slideMailTooltip="\u65b0\u7535\u5b50\u90ae\u4ef6";
a.slideCalendarTooltip="\u65b0\u7ea6\u4f1a";
a.loading="\u6b63\u5728\u52a0\u8f7d...";
a.copy="\u590d\u5236";
a.msg_available="\u53ef\u7528";
a.msg_unavailable="\u6ca1\u7a7a";
a.msg_busy="\u5fd9\u788c";
a.msg_away="\u79bb\u5f00";
a.msg_dnd="\u8bf7\u52ff\u6253\u6270";
a.msg_onthephone="\u901a\u8bdd\u4e2d";
a.msg_vacation="\u4f11\u5047";
a.msg_unknown="\u672a\u77e5";
if(!window.com_zimbra_url){
com_zimbra_url={}
}
a=com_zimbra_url;
a.zimletLabel="URL Links";
a.description="Highlight Web URLs for linking in email messages.";
a.youTubeTitle="Videos from this email";
a.youTubeTitleMax="Showing {0} videos from this email";
a.youTubeClickToToggle="Click to play or hide video";
a.goToUrl="Go to URL";
a.newCalendar="Create New Calendar";
if(!window.com_zimbra_url){
com_zimbra_url={}
}
a=com_zimbra_url;
a.zimletLabel="URL \u94fe\u63a5";
a.description="\u7a81\u51fa\u663e\u793a\u7535\u5b50\u90ae\u4ef6\u4e2d\u7528\u4e8e\u94fe\u63a5\u7684 Web URL\u3002";
a.youTubeTitle="\u6b64\u7535\u5b50\u90ae\u4ef6\u4e2d\u7684\u89c6\u9891";
a.youTubeTitleMax="\u663e\u793a\u6b64\u7535\u5b50\u90ae\u4ef6\u4e2d\u7684 {0} \u89c6\u9891";
a.youTubeClickToToggle="\u5355\u51fb\u53ef\u64ad\u653e\u6216\u9690\u85cf\u89c6\u9891";
a.goToUrl="\u8f6c\u5230 URL";
a.newCalendar="\u521b\u5efa\u65b0\u884c\u4e8b\u5386";
if(!window.com_zimbra_smime){
com_zimbra_smime={}
}
a=com_zimbra_smime;
a.label="Secure Email";
a.description="Sign, verify, encrypt, and decrypt emails with S/MIME";
a.messageSecurityHeader="Security:";
a.signedBy="Signed by {0}";
a.signedByUntrusted="Signed by {0}; authenticity not verified due to untrusted certificate";
a.signedByExpired="Signed by {0}; the certificate has since expired";
a.signatureInvalid="Could not verify the signature of this message";
a.signatureCorrupt="Warning: This message may have been tampered with!";
a.signatureExpired="This certificate has expired";
a.signatureRevoked="Warning: The certificate used to sign this message has been revoked!";
a.signatureWrong="Signed by {0}, but from the wrong address";
a.signatureUnapproved="The signature relies on an unapproved algorithm!";
a.signatureError="An error occurred during the processing of this message";
a.unknownSigningError="Could not sign message due to an unknown error.";
a.knownSigningError="Could not sign message:";
a.dontsignMessage="Don't Sign";
a.signMessage="Sign";
a.signAndEncryptMessage="Sign and Encrypt";
a["invalid-password"]="Invalid password!";
a["unknown-error-title"]="An error occurred";
a["unknown-error"]="We're sorry an error occurred in connection with secure email. Sometimes it works in another browser.";
a["unsupported-browser"]="Secure email is not yet supported in this browser on this OS. Please try Firefox instead.";
a["unsupported-browser-title"]="Browser is not supported";
a["encrypt-cert-not-found"]="Can't encrypt message since the following receivers are missing a certificate:";
a["encrypt-cert-not-found-title"]="Missing certificate.";
a["cert-not-found"]="No matching certificate found! Please either add a certificate to your account, or disable signing / encryption by clicking on the the security button.";
a["cert-not-found-title"]="Missing certificate";
a["cert-not-found-shortMsg"]="No matching certificate found!";
a["attach-convert-error"]="An error occurred while signing/encrypting some of the attachments.";
a["attach-convert-error-title"]="Attachment Error";
a["unapproved-algorithm"]="The message relies on an unapproved algorithm!";
a.enterPassword="Enter your browser password:";
a.passwordLabel="Password:";
a.certificate="Certificate";
a.certificateLabel="Certificate:";
a.smimeCertificate="S/MIME Certificate";
a.loading="Loading...";
a.loadingFail="An error occurred during the processing of this message!";
a.loadingError="Could not process message:";
a.deleteCertificate="Delete Certificate";
a.showCertificate="Show Certificate";
a.hideCertificate="Hide Certificate";
a.missingDecryptionCertificates="Unable to decrypt message; could not find matching certificate.";
a.missingEncryptionCertificates="Encryption certificates are not available for the following recipients:";
a.messageEncrypted="Encrypted";
a.upload="Upload Certificate";
a.uploadInvalid="The uploaded file is not a valid certificate";
a.noJavaError="Please install Java 1.6 or higher in order to use secure email (S/MIME).";
a["noJavaError-title"]="Java is not available!";
a.noJavaErrorIE64="Please install Java 1.6 or higher in order to use secure email (S/MIME). Internet Explorer 64-bit Edition browser requires 64-bit Java plugin.";
a["noJavaErrorIE64-title"]="Java is not available!";
a.spellCheckWarning="Warning: Spell checking will send the contents of your message unencrypted to the server for processing. Click OK to continue, or cancel to end spell checking";
a["certificate.signed"]="";
a["certificate.untrusted"]="Certificate is untrusted";
a["certificate.expired"]="Certificate was expired";
a["certificate.was-signed"]="Certificate has expired since this message was signed";
a["certificate.not-yet"]="Certificate wasn't valid yet";
a["certificate.revoked"]="Certificate is revoked";
a["certificate.wrong-signer"]="Certificate doesn't match message sender";
a["certificate.unknown"]="Certificate error";
a["certificate.default"]="Certificate is unverified";
a.prefSection="Security";
a.prefHeader="Mail Security";
a.prefSecurity="Sign and encrypt message:";
a.prefSecurityAuto="Auto (remember last setting)";
a.prefSecurityNone="Do not sign or encrypt";
a.prefSecuritySign="Sign only";
a.prefSecurityBoth="Sign and encrypt";
a.prefCerts="Certificates:";
a.prefStore="Certificate Store:";
a["store.Keychain"]="Keychain";
a.storeInfoFormat="{0} ({1})";
a.storeInfoFormatFIPS="{0} ({1}, FIPS mode)";
a.certSummaryIssuer="Issued by: {0}";
a.certSummaryExpires="Expires: {0}";
a.certExpand="Show details";
a.certCollapse="Hide details";
a.certSubject="Issued to";
a.certSubjectCN="Common Name";
a.certSubjectOrg="Organization:";
a.certSubjectOrgUnit="Organizational Unit:";
a.certSubjectOtherName="Other Name:";
a.certSubjectEmail="Email:";
a.certSubjectDNS="Domain:";
a.certSubjectX400="X.400:";
a.certSubjectDirectory="Directory:";
a.certSubjectEDI="EDI Party:";
a.certSubjectURI="URI:";
a.certSubjectIP="IP Address:";
a.certSubjectID="Registered ID:";
a.certSubjectCountry="Country:";
a.certSubjectCity="City:";
a.certIssuer="Issued by";
a.certIssuerCN="Common Name:";
a.certIssuerOrg="Organization:";
a.certIssuerOrgUnit="Organizational Unit:";
a.certIssuerCountry="Country:";
a.certIssuerCity="City:";
a.certValidity="Validity";
a.certValidityBegin="Issued on:";
a.certValidityEnd="Valid until:";
a.certInfo="Signature";
a.certInfoSN="Serial number:";
a.certInfoAlg="Algorithm:";
a.searchingCertificate="Searching for certificates\u2026";
a.errorOccurred="An error occurred!";
a.noCertificateFound="None found!";
a.certReplaceMessage="The sender's certificate in Address Book does not match certificate in this message.";
a.certReplaceAction="Replace Certificate of {0}.";
a.pasteFileError="An error occurred while pasting the content.";
a["pasteFileError-title"]="Paste Error!";
a.ok="OK";
a.cancel="Cancel";
if(!window.com_zimbra_smime){
com_zimbra_smime={}
}
a=com_zimbra_smime;
a.label="\u5b89\u5168\u7535\u5b50\u90ae\u4ef6";
a.description="\u4f7f\u7528 S/MIME \u7b7e\u540d\u3001\u9a8c\u8bc1\u3001\u52a0\u5bc6\u548c\u89e3\u5bc6\u7535\u5b50\u90ae\u4ef6";
a.messageSecurityHeader="\u5b89\u5168:";
a.signedBy="\u7531 {0} \u7b7e\u540d";
a.signedByUntrusted="\u7531 {0} \u7b7e\u540d\uff1b\u7531\u4e8e\u8bc1\u4e66\u4e0d\u53ef\u4fe1\u800c\u672a\u9a8c\u8bc1\u771f\u5b9e\u6027";
a.signedByExpired="\u7531 {0} \u7b7e\u540d\uff1b\u8bc1\u4e66\u5df2\u7ecf\u8fc7\u671f";
a.signatureInvalid="\u65e0\u6cd5\u9a8c\u8bc1\u6b64\u90ae\u4ef6\u7684\u7b7e\u540d";
a.signatureCorrupt="\u8b66\u544a: \u6b64\u90ae\u4ef6\u53ef\u80fd\u5df2\u88ab\u7be1\u6539!";
a.signatureExpired="\u6b64\u8bc1\u4e66\u5df2\u8fc7\u671f";
a.signatureRevoked="\u8b66\u544a: \u7528\u4e8e\u7b7e\u540d\u6b64\u90ae\u4ef6\u7684\u8bc1\u4e66\u5df2\u64a4\u9500!";
a.signatureWrong="\u7531 {0} \u7b7e\u540d\uff0c\u4f46\u6765\u6e90\u5730\u5740\u9519\u8bef";
a.signatureUnapproved="\u7b7e\u540d\u4f9d\u8d56\u7684\u7b97\u6cd5\u672a\u83b7\u6279\u51c6!";
a.signatureError="\u5728\u5904\u7406\u6b64\u90ae\u4ef6\u671f\u95f4\u51fa\u9519";
a.unknownSigningError="\u7531\u4e8e\u672a\u77e5\u9519\u8bef\uff0c\u65e0\u6cd5\u7b7e\u540d\u90ae\u4ef6\u3002";
a.knownSigningError="\u65e0\u6cd5\u7b7e\u540d\u90ae\u4ef6:";
a.dontsignMessage="\u4e0d\u7b7e\u540d";
a.signMessage="\u7b7e\u540d";
a.signAndEncryptMessage="\u7b7e\u540d\u5e76\u52a0\u5bc6";
a["invalid-password"]="\u5bc6\u7801\u65e0\u6548!";
a["unknown-error-title"]="\u51fa\u73b0\u4e86\u9519\u8bef";
a["unknown-error"]="\u62b1\u6b49\uff0c\u51fa\u73b0\u4e86\u4e0e\u5b89\u5168\u90ae\u4ef6\u6709\u5173\u7684\u9519\u8bef\u3002\u6709\u65f6\uff0c\u5728\u5176\u4ed6\u6d4f\u89c8\u5668\u4e2d\u53ef\u6b63\u5e38\u8fd0\u884c\u3002";
a["unsupported-browser"]="\u6b64\u64cd\u4f5c\u7cfb\u7edf\u7684\u8be5\u6d4f\u89c8\u5668\u5c1a\u4e0d\u652f\u6301\u5b89\u5168\u7535\u5b50\u90ae\u4ef6\u3002\u8bf7\u5c1d\u8bd5 Firefox\u3002";
a["unsupported-browser-title"]="\u6d4f\u89c8\u5668\u4e0d\u53d7\u652f\u6301";
a["encrypt-cert-not-found"]="\u56e0\u4e3a\u4ee5\u4e0b\u6536\u4ef6\u4eba\u7f3a\u5c11\u8bc1\u4e66\uff0c\u6240\u4ee5\u65e0\u6cd5\u52a0\u5bc6\u90ae\u4ef6:";
a["encrypt-cert-not-found-title"]="\u7f3a\u5c11\u8bc1\u4e66\u3002";
a["cert-not-found"]="\u672a\u627e\u5230\u5339\u914d\u7684\u8bc1\u4e66! \u8bf7\u5c06\u8bc1\u4e66\u6dfb\u52a0\u5230\u60a8\u7684\u5e10\u6237\uff0c\u6216\u66f4\u65b0\u5b89\u5168\u9996\u9009\u9879\u7981\u7528\u7b7e\u540d/\u52a0\u5bc6\u3002";
a["cert-not-found-title"]="\u7f3a\u5c11\u8bc1\u4e66";
a["cert-not-found-shortMsg"]="\u672a\u627e\u5230\u5339\u914d\u7684\u8bc1\u4e66!";
a["attach-convert-error"]="\u7b7e\u540d/\u52a0\u5bc6\u67d0\u4e9b\u9644\u4ef6\u65f6\u51fa\u9519\u3002";
a["attach-convert-error-title"]="\u9644\u4ef6\u9519\u8bef";
a["unapproved-algorithm"]="\u90ae\u4ef6\u4f9d\u8d56\u7684\u7b97\u6cd5\u672a\u83b7\u6279\u51c6!";
a.enterPassword="\u8f93\u5165\u60a8\u7684\u6d4f\u89c8\u5668\u5bc6\u7801:";
a.passwordLabel="\u5bc6\u7801:";
a.certificate="\u8bc1\u4e66";
a.certificateLabel="\u8bc1\u4e66\uff1a";
a.smimeCertificate="S/MIME \u8bc1\u4e66";
a.loading="\u6b63\u5728\u8f7d\u5165...";
a.loadingFail="\u5728\u5904\u7406\u6b64\u90ae\u4ef6\u671f\u95f4\u51fa\u9519!";
a.loadingError="\u65e0\u6cd5\u5904\u7406\u90ae\u4ef6:";
a.deleteCertificate="\u5220\u9664\u8bc1\u4e66";
a.showCertificate="\u663e\u793a\u8bc1\u4e66";
a.hideCertificate="\u9690\u85cf\u8bc1\u4e66";
a.missingDecryptionCertificates="\u65e0\u6cd5\u89e3\u5bc6\u90ae\u4ef6\uff1b\u65e0\u6cd5\u627e\u5230\u5339\u914d\u7684\u8bc1\u4e66\u3002";
a.missingEncryptionCertificates="\u4ee5\u4e0b\u6536\u4ef6\u4eba\u6ca1\u6709\u52a0\u5bc6\u8bc1\u4e66:";
a.messageEncrypted="\u5df2\u52a0\u5bc6";
a.upload="\u4e0a\u8f7d\u8bc1\u4e66";
a.uploadInvalid="\u4e0a\u8f7d\u7684\u6587\u4ef6\u4e0d\u662f\u6709\u6548\u7684\u8bc1\u4e66";
a.noJavaError="\u8bf7\u5b89\u88c5 Java 1.6 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u4ee5\u4fbf\u4f7f\u7528\u5b89\u5168\u90ae\u4ef6 (S/MIME)\u3002";
a["noJavaError-title"]="Java \u4e0d\u53ef\u7528!";
a.noJavaErrorIE64="\u8bf7\u5b89\u88c5 Java 1.6 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u4ee5\u4fbf\u4f7f\u7528\u5b89\u5168\u90ae\u4ef6 (S/MIME)\u3002Internet Explorer 64 \u4f4d\u7248\u672c\u7684\u6d4f\u89c8\u5668\u9700\u8981 64 \u4f4d Java \u63d2\u4ef6\u3002";
a["noJavaErrorIE64-title"]="Java \u4e0d\u53ef\u7528!";
a.spellCheckWarning="\u8b66\u544a: \u62fc\u5199\u68c0\u67e5\u4f1a\u5c06\u60a8\u672a\u52a0\u5bc6\u7684\u90ae\u4ef6\u5185\u5bb9\u53d1\u9001\u5230\u670d\u52a1\u5668\u8fdb\u884c\u5904\u7406\u3002\u5355\u51fb\u201c\u786e\u5b9a\u201d\u7ee7\u7eed\uff0c\u6216\u5355\u51fb\u201c\u53d6\u6d88\u201d\u7ed3\u675f\u62fc\u5199\u68c0\u67e5";
a["certificate.signed"]="";
a["certificate.untrusted"]="\u8bc1\u4e66\u4e0d\u53ef\u4fe1";
a["certificate.expired"]="\u8bc1\u4e66\u5df2\u8fc7\u671f";
a["certificate.was-signed"]="\u81ea\u6b64\u90ae\u4ef6\u7b7e\u540d\u540e\uff0c\u8bc1\u4e66\u5df2\u8fc7\u671f\u3002";
a["certificate.not-yet"]="\u8bc1\u4e66\u5c1a\u672a\u751f\u6548";
a["certificate.revoked"]="\u8bc1\u4e66\u5df2\u64a4\u9500";
a["certificate.wrong-signer"]="\u8bc1\u4e66\u4e0e\u90ae\u4ef6\u53d1\u4ef6\u4eba\u4e0d\u5339\u914d";
a["certificate.unknown"]="\u8bc1\u4e66\u9519\u8bef";
a["certificate.default"]="\u8bc1\u4e66\u672a\u7ecf\u9a8c\u8bc1";
a.prefSection="\u5b89\u5168";
a.prefHeader="\u90ae\u4ef6\u5b89\u5168";
a.prefSecurity="\u7b7e\u540d\u548c\u52a0\u5bc6\u90ae\u4ef6:";
a.prefSecurityAuto="\u81ea\u52a8(\u8bb0\u4f4f\u4e0a\u6b21\u8bbe\u7f6e)";
a.prefSecurityNone="\u4e0d\u7b7e\u540d\u6216\u52a0\u5bc6";
a.prefSecuritySign="\u53ea\u7b7e\u540d";
a.prefSecurityBoth="\u7b7e\u540d\u5e76\u52a0\u5bc6";
a.prefCerts="\u8bc1\u4e66:";
a.prefStore="\u8bc1\u4e66\u50a8\u5e93:";
a["store.Keychain"]="Keychain";
a.storeInfoFormat="{0} ({1})";
a.storeInfoFormatFIPS="{0} ({1}\uff0cFIPS \u6a21\u5f0f)";
a.certSummaryIssuer="\u7b7e\u53d1\u5355\u4f4d: {0}";
a.certSummaryExpires="\u5230\u671f: {0}";
a.certExpand="\u663e\u793a\u8be6\u7ec6\u8d44\u6599";
a.certCollapse="\u9690\u85cf\u8be6\u7ec6\u8d44\u6599";
a.certSubject="\u7b7e\u53d1\u5bf9\u8c61";
a.certSubjectCN="\u5e38\u7528\u540d";
a.certSubjectOrg="\u673a\u6784:";
a.certSubjectOrgUnit="\u673a\u6784\u5355\u4f4d\uff1a";
a.certSubjectOtherName="\u5176\u4ed6\u540d\u79f0:";
a.certSubjectEmail="\u7535\u5b50\u90ae\u4ef6:";
a.certSubjectDNS="\u57df:";
a.certSubjectX400="X.400:";
a.certSubjectDirectory="\u76ee\u5f55:";
a.certSubjectEDI="EDI \u65b9:";
a.certSubjectURI="URI:";
a.certSubjectIP="IP \u5730\u5740:";
a.certSubjectID="\u6ce8\u518c\u7684 ID:";
a.certSubjectCountry="\u56fd\u5bb6\uff1a";
a.certSubjectCity="\u57ce\u5e02\uff1a";
a.certIssuer="\u7b7e\u53d1\u5355\u4f4d";
a.certIssuerCN="\u5e38\u7528\u540d\uff1a";
a.certIssuerOrg="\u673a\u6784:";
a.certIssuerOrgUnit="\u673a\u6784\u5355\u4f4d\uff1a";
a.certIssuerCountry="\u56fd\u5bb6\uff1a";
a.certIssuerCity="\u57ce\u5e02\uff1a";
a.certValidity="\u6709\u6548\u6027";
a.certValidityBegin="\u7b7e\u53d1\u65e5\u671f:";
a.certValidityEnd="\u6709\u6548\u671f\u622a\u6b62:";
a.certInfo="\u7b7e\u540d";
a.certInfoSN="\u5e8f\u53f7:";
a.certInfoAlg="\u7b97\u6cd5:";
a.searchingCertificate="\u6b63\u5728\u641c\u7d22\u8bc1\u4e66\u2026";
a.errorOccurred="\u51fa\u73b0\u4e86\u9519\u8bef!";
a.noCertificateFound="\u4e00\u4e2a\u4e5f\u6ca1\u6709\u627e\u5230!";
a.untrustedCertificateFound="\u53ea\u67e5\u627e\u5230\u4e0d\u53d7\u4fe1\u4efb\u7684\u8bc1\u4e66\uff01";
a.certReplaceMessage="\u5730\u5740\u7c3f\u4e2d\u53d1\u4ef6\u4eba\u7684\u8bc1\u4e66\u4e0e\u6b64\u90ae\u4ef6\u7684\u8bc1\u4e66\u4e0d\u5339\u914d\u3002";
a.certReplaceAction="\u66ff\u6362 {0} \u7684\u8bc1\u4e66\u3002";
a.pasteFileError="\u7c98\u8d34\u5185\u5bb9\u65f6\u51fa\u9519\u3002";
a["pasteFileError-title"]="\u7c98\u8d34\u9519\u8bef!";
a.ok="\u786e\u5b9a";
a.cancel="\u53d6\u6d88";
if(!window.com_zimbra_date){
com_zimbra_date={}
}
a=com_zimbra_date;
a.label="Date";
a.description="Highlights dates, previews associated appointments and creates a link to the calendar.";
a.viewDay="Day";
a.appointmentNewTitle="New Appointment";
a.searchForMessages="Search for mail messages";
a.boundaryTrue="true";
a.boundaryFalse="false";
a["format.boundary"]="true";
a["format1.pattern"]="(today|tonight|this morning)";
a["format1.rule"]="now";
a["format2.pattern"]="(tomorrow night|tomorrow morning|tomorrow)";
a["format2.rule"]="now +1 day";
a["format3.pattern"]="(last night|yesterday morning|yesterday)";
a["format3.rule"]="now -1 day";
a["format4.pattern"]="(this|next) {dayname}";
a["format4.rule"]="now +1 {dayname}";
a["format5.pattern"]="last {dayname}";
a["format5.rule"]="now -1 {dayname}";
a["format6.pattern"]="{weekord} {dayname} (of|in) {monthname}";
a["format6.rule"]="now date=1 +1 {monthname} week={weekord},{dayname}";
a["format7.pattern"]="{weekord} {dayname}";
a["format7.rule"]="now week={weekord},{dayname}";
a["format8.pattern"]="{datenum}(st|nd|rd|th)? (of|in) {monthname}";
a["format8.rule"]="now month={monthname},{datenum}";
a["format9.pattern"]="{monthname} {datenum}(st|nd|rd|th)?.? {timenum}.?(am|pm)";
a["format9.rule"]="now month={monthname},{datenum}";
a["format10.pattern"]="{datenum}(st|nd|rd|th)? {monthname} {timenum}.?(am|pm)";
a["format10.rule"]="now month={monthname},{datenum}";
a["format11.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {militarytimenum} (hrs|hours)";
a["format11.rule"]="now month={monthname},{datenum}";
a["format12.pattern"]="{datenum}(st|nd|rd|th).? {monthname}.? {militarytimenum} (hrs|hours)";
a["format12.rule"]="now month={monthname},{datenum}";
a["format13.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {yearnum}";
a["format13.rule"]="now year={yearnum},{monthname},{datenum}";
a["format14.pattern"]="{dayname}.? {datenum} {monthname} {yearnum}";
a["format14.rule"]="now year={yearnum},{monthname},{datenum}";
a["format15.pattern"]="{dayname}.? {monthname}  {datenum}";
a["format15.rule"]="now month={monthname},{datenum}";
a["format16.pattern"]="{monthname} {datenum}(st|nd|rd|th)?";
a["format16.rule"]="now month={monthname},{datenum}";
a["format17.pattern"]="{datenum} {monthname}.? {yearnum}";
a["format17.rule"]="now year={yearnum},{monthname},{datenum}";
a["format18.pattern"]="{monthnum}/{datenum}/{yearnum}";
a["format18.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format19.pattern"]="{yearnum}-{monthnum}-{datenum}";
a["format19.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format20.pattern"]="{monthname} {yearnum}";
a["format20.rule"]="now year={yearnum},{monthname},1";
a["format21.pattern"]="{dayname}";
a["format21.rule"]="now +1 {dayname}";
a["format22.pattern"]="{datenum}(st|nd|rd|th)? {monthname}.? {yearnum}";
a["format22.rule"]="now year={yearnum},{monthname},{datenum}";
a["format23.pattern"]="Thanksgiving";
a["format23.rule"]="now month=November week=fourth,Thursday";
a["format24.pattern"]="Christmas Eve";
a["format24.rule"]="now month=December,24";
a["format25.pattern"]="Christmas";
a["format25.rule"]="now month=December,25";
a["format26.pattern"]="New Year'?s Eve";
a["format26.rule"]="now month=December,31";
a["format27.pattern"]="New Year'?s Day";
a["format27.rule"]="now +1 year month=January,1";
a["format28.pattern"]="###";
if(!window.com_zimbra_date){
com_zimbra_date={}
}
a=com_zimbra_date;
a.viewDay="\u5929";
a.appointmentNewTitle="\u65b0\u7ea6\u4f1a";
a.searchForMessages="\u641c\u7d22\u90ae\u4ef6";
a.boundaryTrue="true";
a.boundaryFalse="false";
a["format.boundary"]="false";
a["format1.pattern"]="(\u4eca\u5929|\u4eca\u665a|\u4eca\u5929\u4e0a\u5348|\u4eca\u65e5)";
a["format1.rule"]="now";
a["format2.pattern"]="(\u660e\u5929\u665a\u4e0a|\u660e\u5929\u4e0a\u5348|\u660e\u5929)";
a["format2.rule"]="now +1 day";
a["format3.pattern"]="(\u6628\u5929\u665a\u4e0a|\u6628\u5929\u4e0a\u5348|\u6628\u5929)";
a["format3.rule"]="now -1 day";
a["format4.pattern"]="(\u8fd9\u4e2a|\u4e0b\u4e2a|\u4e0b){dayname}";
a["format4.rule"]="now +1 {dayname}";
a["format5.pattern"]="\u4e0a\u4e2a{dayname}";
a["format5.rule"]="now -1 {dayname}";
a["format6.pattern"]="{monthname}{weekord}{dayname}";
a["format6.rule"]="now date=1 +1 {monthname} week={weekord},{dayname}";
a["format7.pattern"]="{weekord}{dayname}";
a["format7.rule"]="now week={weekord},{dayname}";
a["format8.pattern"]="{monthname}{datenum}";
a["format8.rule"]="now month={monthname},{datenum}";
a["format9.pattern"]="{monthname} {datenum} {timenum}.?(am|pm)";
a["format9.rule"]="now month={monthname},{datenum}";
a["format10.pattern"]="{monthname} {datenum} {timenum}.?(am|pm)";
a["format10.rule"]="now month={monthname},{datenum}";
a["format11.pattern"]="{monthname} {datenum} {militarytimenum} (hrs|hours)";
a["format11.rule"]="now month={monthname},{datenum}";
a["format12.pattern"]="{monthname} {datenum} {militarytimenum} (hrs|hours)";
a["format12.rule"]="now month={monthname},{datenum}";
a["format13.pattern"]="{yearnum} {monthname} {datenum}";
a["format13.rule"]="now year={yearnum},{monthname},{datenum}";
a["format14.pattern"]="{yearnum} {monthname} {datenum}, {dayname}";
a["format14.rule"]="now year={yearnum},{monthname},{datenum}";
a["format15.pattern"]="{monthname} {datenum}, {dayname}";
a["format15.rule"]="now month={monthname},{datenum}";
a["format16.pattern"]="{monthname} {datenum}";
a["format16.rule"]="now month={monthname},{datenum}";
a["format17.pattern"]="{yearnum} {monthname} {datenum}";
a["format17.rule"]="now year={yearnum},{monthname},{datenum}";
a["format18.pattern"]="{yearnum}/{monthnum}/{datenum}";
a["format18.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format18.boundary"]="true";
a["format19.pattern"]="{yearnum}-{monthnum}-{datenum}";
a["format19.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format19.boundary"]="true";
a["format20.pattern"]="{yearnum} {monthname}";
a["format20.rule"]="now year={yearnum},{monthname},1";
a["format21.pattern"]="{dayname}";
a["format21.rule"]="now +1 {dayname}";
a["format22.pattern"]="{yearnum} {monthname} {datenum}";
a["format22.rule"]="now year={yearnum},{monthname},{datenum}";
a["format23.pattern"]="\u611f\u6069\u8282";
a["format23.rule"]="now month=November week=fourth,Thursday";
a["format24.pattern"]="\u5723\u8bde\u8282\u524d\u5915";
a["format24.rule"]="now month=December,24";
a["format25.pattern"]="\u5723\u8bde\u8282";
a["format25.rule"]="now month=December,25";
a["format26.pattern"]="\u65b0\u5e74\u524d\u5915";
a["format26.rule"]="now month=December,31";
a["format27.pattern"]="\u65b0\u5e74";
a["format27.rule"]="now +1 year month=January,1";
a["format28.pattern"]="{yearnum}\u5e74{monthnum}\u6708{datenum}\u65e5";
a["format28.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format29.pattern"]="{monthnum}\u6708{datenum}(\u65e5|\u53f7)";
a["format29.rule"]="now month={monthnum},{datenum}";
a["format30.pattern"]="(\u524d\u5929|\u524d\u5929\u665a\u4e0a|\u524d\u5929\u4e0a\u5348)";
a["format30.rule"]="now -2 day";
a["format31.pattern"]="(\u540e\u5929|\u540e\u5929\u665a\u4e0a|\u540e\u5929\u4e0a\u5348)";
a["format31.rule"]="now +2 day";
a["format32.pattern"]="(\u5927\u540e\u5929|\u5927\u540e\u5929\u665a\u4e0a|\u5927\u540e\u5929\u4e0a\u5348)";
a["format32.rule"]="now +3 day";
a["format33.pattern"]="(\u672c|\u8fd9){dayname}";
a["format33.rule"]="now +0 {dayname}";
a["format34.pattern"]="(\u8fd9\u4e2a\u6708|\u672c|\u8fd9){datenum}(\u65e5|\u53f7)";
a["format34.rule"]="now date={datenum}";
a["format35.pattern"]="{yearnum}\u5e74{monthnum}\u6708";
a["format35.rule"]="now year={yearnum},{monthnum},1";
a["format36.pattern"]="{yearnum}\u5e74{monthnum}\u6708{datenum}\u65e5, {dayname}";
a["format36.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format37.pattern"]="###";
if(!window.com_zimbra_webex){
com_zimbra_webex={}
}
a=com_zimbra_webex;
a.label="WebEx";
a.description="Easily schedule, start or join WebEx meetings.";
a.WebExZimlet_insertWebExDetails="Insert WebEx details";
a.WebExZimlet_insertWebExDetailsAndSendAppointment="Insert WebEx details and send appointment";
a.WebExZimlet_label="WebEx";
a.WebExZimlet_toolTip="Easily schedule, start, or join WebEx meetings";
a.WebExZimlet_rightClickForOptions="Please <b>right-click</b> for preferences and other options.";
a.WebExZimlet_quickMeeting="Start a Quick meeting";
a.WebExZimlet_startJoinExistingMeeting="Start or join an existing meeting";
a.WebExZimlet_manageAccounts="Manage Accounts";
a.WebExZimlet_preferences="Preferences";
a.WebExZimlet_selectDefaultTimeZone="Select default Timezone:";
a.WebExZimlet_appendMeetingInfoToSubOrLoc="Append meeting information to subject or location fields:";
a.WebExZimlet_appendToSubject="Append <b>below</b> meeting information to subject field";
a.WebExZimlet_appendToLocation="Append <b>below</b> meeting information to location field";
a.WebExZimlet_informationToAppend="Information to append:";
a.WebExZimlet_appendWebExUrl="Append WebEx URL to";
a.WebExZimlet_appendMeetingPwd="Append meeting password to";
a.WebExZimlet_appendToolFreeNumber="Append Toll-Free conference number to";
a.WebExZimlet_appendTollConfNumber="Append Toll conference number to";
a.WebExZimlet_appendPhonePasscode="Append Phone Passcode to";
a.WebExZimlet_PrefSaved="Saved WebEx Preferences";
a.WebExZimlet_none="None";
a.WebExZimlet_subject="Subject";
a.WebExZimlet_location="Location";
a.WebExZimlet_subjectAndLocation="Subject & Location";
a.WebExZimlet_accountNumber="WebEx Account {0}:";
a.WebExZimlet_accountSettings="Account Settings:";
a.WebExZimlet_userName="WebEx Username:*";
a.WebExZimlet_password="WebEx Password:*";
a.WebExZimlet_companyId="WebEx Company Id:*";
a.WebExZimlet_altHosts="Alternative Host(s)";
a.WebExZimlet_companyIdExample="<br/>Company Id is the first part of the company-specific WebEx URL. <br/>For example: <b>vmware</b> in http://<b>vmware</b>.webex.com/";
a.WebExZimlet_useThisAccountFor="Use this WebEx account for:";
a.WebExZimlet_associateCalendarHdr="Auto-associate a Calendar to a WebEx account:";
a.WebExZimlet_meetingPwd="WebEx Meeting Password:";
a.WebExZimlet_optional="(optional)";
a.WebExZimlet_validateWebExAccntNumber="Validate Account {0}";
a.WebExZimlet_teleConfSettings="Teleconference Settings:";
a.WebExZimlet_tollFreeNumber="Toll-Free Phone Number:";
a.WebExZimlet_tollNumber="Toll-Phone Number:";
a.WebExZimlet_webExUrl="WebEx URL:";
a.WebExZimlet_otherPhoneNumbers="Other Phone Numbers:";
a.WebExZimlet_phonePasscode="Phone passcode:";
a.WebExZimlet_digitsOnly="(digits only)";
a.WebExZimlet_passwordNotRequired="(Password is not required for this meeting.)";
a.WebExZimlet_account1UsedAsDefaultForUnAssociatedCal="Note: Account 1 settings are used for all un-associated Calendars";
a.WebExZimlet_testFailed="Test failed. This WebEx account is not valid.";
a.WebExZimlet_testPassed="Test succeeded. This is a valid WebEx account.";
a.WebExZimlet_errorInWebExXml="Error parsing WebEx XML response or malformed XML.";
a.WebExZimlet_accountNumberNotSetup="WebEx <b>Account {0}</b> is not setup.";
a.WebExZimlet_pleaseWait="Please wait...";
a.WebExZimlet_allCalendars="All Calendars";
a.WebExZimlet_selectAccntToUse="Select WebEx Account";
a.WebExZimlet_webExAccntToUse="WebEx Account:";
a.WebExZimlet_enterYourName="[Enter your name]";
a.WebExZimlet_email="Email:";
a.WebExZimlet_enterYourEmail="[Enter your email]";
a.WebExZimlet_notConfigured="Not configured";
a.WebExZimlet_accntNumberAndName="Account {0} ({1})";
a.WebExZimlet_getAccounts="Account options:";
a.WebExZimlet_help="help";
a.WebExZimlet_startQuickWebExMeeting="Start Quick WebEx Meeting";
a.WebExZimlet_addAttendees="Add Attendee(s):";
a.WebExZimlet_quickMeetingSubject="Quick WebEx Meeting (Please join now)";
a.WebExZimlet_quickMeetingLocation="Quick WebEx Meeting (Please join now)";
a.WebExZimlet_startOrJoinWebExMeeting="Start or Join WebEx Meeting";
a.WebExZimlet_host="Host";
a.WebExZimlet_startTime="Start Time";
a.WebExZimlet_action="Action";
a.WebExZimlet_meetingName="Meeting Name";
a.WebExZimlet_meetingsList="WebEx Meetings List:";
a.WebExZimlet_startJoin="Start/Join";
a.WebExZimlet_fromNowOn="From now on";
a.WebExZimlet_today="Today";
a.WebExZimlet_tomorrow="Tomorrow";
a.WebExZimlet_next7days="Next 7 days";
a.WebExZimlet_savesThisApptAsWebEx="Save as WebEx";
a.WebExZimlet_saveAsWebEx="Save as WebEx";
a.WebExZimlet_successfullyCreatedWebEx="Successfully created WebEx appointment";
a.WebExZimlet_unableToCreateMeeting="Unable to create WebEx meeting";
a.WebExZimlet_noWebExAccount="No WebEx Account(s) have been configured.<br/>Right-click on the Zimlet and Select 'Manage Accounts' to configure.";
a.WebExZimlet_webExError="WebEx Error";
a.WebExZimlet_failureReason="Failure Reason:";
a.WebExZimlet_webExDidntReturnMeetingKey="WebEx did not return meeting key, perhaps, meeting didn't get created on the WebEx server.";
a.WebExZimlet_unableToGetMeetingInfo="Unable to get WebEx meetings information";
a.WebExZimlet_unableToGetJoinOrHostURL="Unable to get WebEx Join/Host Meeting URL";
a.WebExZimlet_couldNotGetJoinMeetingUrl="Could not get Join-Meeting-URL from WebEx";
a.WebExZimlet_unableToDeleteWebExAppt="Unable to Delete WebEx meeting";
a.WebExZimlet_unableToCreateOrModifyMeeting="Unable to create/modify WebEx meeting";
a.WebExZimlet_invalidAlternateHost="Invalid alternative Host.<br/>Alternative Hosts are used to to allow other hosts to schedule meetings on your behalf. To use this feature, this must be configured in your WebEx Profile. <br/><br/>To grant permission for an alternative host:<br/>1. Login to your WebEx account.<br/>2. Browse to Setup > My Profile > Session Options > Scheduling permission.<br/>3. Enter Alternative Hosts.<br/>4. Save your profile.";
a.WebExZimlet_setupAlternateHost="Alternative Hosts are used to to allow other hosts to schedule meetings on your behalf. To use this feature, this must be configured in your WebEx Profile. <br/><br/>To grant permission for an alternative host:<br/>1. Login to your WebEx account.<br/>2. Go to Setup > My Profile > Session Options > Scheduling permission.<br/>3. Enter Alternative Hosts.<br/>4. Save your profile.";
a.WebExZimlet_userPwdCIdRequired="WebEx Username, Password & Company Id are required.";
a.WebExZimlet_couldNotRegisterAttendees="Could not register attendees";
a.cannotContinueInvalidEmails="Cannot continue. Following invalid email(s) found";
a.modifyAlertNotice="WebEx meeting has been successfully created. <br><br>Please Note:<br> If you modify this meeting (other than its body content), you will have to recreate WebEx meeting";
a.WebExZimlet_meetingWasDeleted="WebEx meeting was deleted";
a.WebExZimlet_entireSeriesWillBeDeleted="WebEx Appointment found.<br/> For a recurring appointment, entire series will be deleted on WebEx server.<br/> Do you want to continue?";
a.WebExZimlet_modifyApptAvoidDuplicateInfoWarning="Modifying WebEx Appointment.<br/> Please make sure to remove older WebEx data from body, subject and location fields in order to avoid inserting multiple WebEx information. <br/>Do you want to continue?";
a.WebExZimlet_teleconferenceDetails="Teleconference Details:";
a.WebExZimlet_webExDetails="WebEx  Details:";
if(!window.com_zimbra_webex){
com_zimbra_webex={}
}
a=com_zimbra_webex;
a.label="WebEx";
a.description="\u8f7b\u677e\u5730\u5b89\u6392\u3001\u5f00\u59cb\u6216\u53c2\u52a0 WebEx \u4f1a\u8bae\u3002";
a.WebExZimlet_insertWebExDetails="\u63d2\u5165 WebEx \u8be6\u7ec6\u8d44\u6599";
a.WebExZimlet_insertWebExDetailsAndSendAppointment="\u63d2\u5165 WebEx \u8be6\u7ec6\u4fe1\u606f\u5e76\u53d1\u9001\u7ea6\u4f1a";
a.WebExZimlet_label="WebEx";
a.WebExZimlet_toolTip="\u8f7b\u677e\u5b89\u6392\u3001\u5f00\u59cb\u6216\u53c2\u52a0 WebEx \u4f1a\u8bae";
a.WebExZimlet_rightClickForOptions="\u8bf7<b>\u5355\u51fb\u9f20\u6807\u53f3\u952e</b>\u4ee5\u67e5\u770b\u9996\u9009\u9879\u548c\u5176\u4ed6\u9009\u9879\u3002";
a.WebExZimlet_quickMeeting="\u5f00\u59cb\u7b80\u6613\u4f1a\u8bae";
a.WebExZimlet_startJoinExistingMeeting="\u5f00\u59cb\u6216\u53c2\u52a0\u73b0\u6709\u4f1a\u8bae";
a.WebExZimlet_manageAccounts="\u5e10\u6237\u7ba1\u7406";
a.WebExZimlet_preferences="\u9996\u9009\u9879";
a.WebExZimlet_selectDefaultTimeZone="\u9009\u62e9\u9ed8\u8ba4\u65f6\u533a:";
a.WebExZimlet_appendMeetingInfoToSubOrLoc="\u5c06\u4f1a\u8bae\u4fe1\u606f\u9644\u52a0\u5230\u4e3b\u9898\u6216\u5730\u70b9\u5b57\u6bb5\u4e2d:";
a.WebExZimlet_appendToSubject="\u5c06<b>\u4ee5\u4e0b</b>\u4f1a\u8bae\u4fe1\u606f\u9644\u52a0\u5230\u4e3b\u9898\u5b57\u6bb5\u4e2d";
a.WebExZimlet_appendToLocation="\u5c06<b>\u4ee5\u4e0b</b>\u4f1a\u8bae\u4fe1\u606f\u9644\u52a0\u5230\u5730\u70b9\u5b57\u6bb5\u4e2d";
a.WebExZimlet_informationToAppend="\u8981\u9644\u52a0\u7684\u4fe1\u606f:";
a.WebExZimlet_appendWebExUrl="\u5c06 WebEx URL \u9644\u52a0\u5230";
a.WebExZimlet_appendMeetingPwd="\u5c06\u4f1a\u8bae\u5bc6\u7801\u9644\u52a0\u5230";
a.WebExZimlet_appendToolFreeNumber="\u5c06\u514d\u8d39\u4f1a\u8bae\u7535\u8bdd\u53f7\u7801\u9644\u52a0\u5230";
a.WebExZimlet_appendTollConfNumber="\u5c06\u6536\u8d39\u4f1a\u8bae\u7535\u8bdd\u53f7\u7801\u9644\u52a0\u5230";
a.WebExZimlet_appendPhonePasscode="\u5c06\u7535\u8bdd\u5bc6\u7801\u9644\u52a0\u5230";
a.WebExZimlet_PrefSaved="\u5df2\u4fdd\u5b58 WebEx \u9996\u9009\u9879";
a.WebExZimlet_none="\u65e0";
a.WebExZimlet_subject="\u4e3b\u9898";
a.WebExZimlet_location="\u5730\u70b9";
a.WebExZimlet_subjectAndLocation="\u4e3b\u9898\u548c\u5730\u70b9";
a.WebExZimlet_accountNumber="WebEx \u5e10\u6237 {0}:";
a.WebExZimlet_accountSettings="\u5e10\u6237\u8bbe\u7f6e:";
a.WebExZimlet_userName="WebEx \u7528\u6237\u540d:*";
a.WebExZimlet_password="WebEx \u5bc6\u7801:*";
a.WebExZimlet_companyId="WebEx \u516c\u53f8 Id:*";
a.WebExZimlet_altHosts="\u5907\u9009\u4e3b\u6301\u4eba";
a.WebExZimlet_companyIdExample="<br/>\u516c\u53f8 Id \u662f\u516c\u53f8\u7279\u5b9a\u7684 WebEx URL \u7684\u7b2c\u4e00\u90e8\u5206\u3002<br/>\u4f8b\u5982: http://<b>vmware</b>.webex.com/ \u4e2d\u7684 <b>vmware</b>";
a.WebExZimlet_useThisAccountFor="\u5c06\u6b64 WebEx \u5e10\u6237\u7528\u4e8e:";
a.WebExZimlet_associateCalendarHdr="\u5c06\u884c\u4e8b\u5386\u81ea\u52a8\u5173\u8054\u5230 WebEx \u5e10\u6237:";
a.WebExZimlet_meetingPwd="WebEx \u4f1a\u8bae\u5bc6\u7801:";
a.WebExZimlet_optional="(\u53ef\u9009)";
a.WebExZimlet_validateWebExAccntNumber="\u9a8c\u8bc1\u5e10\u6237 {0}";
a.WebExZimlet_teleConfSettings="\u7535\u8bdd\u4f1a\u8bae\u8bbe\u7f6e:";
a.WebExZimlet_tollFreeNumber="\u514d\u8d39\u7535\u8bdd\u53f7\u7801:";
a.WebExZimlet_tollNumber="\u6536\u8d39\u7535\u8bdd\u53f7\u7801:";
a.WebExZimlet_webExUrl="WebEx URL:";
a.WebExZimlet_otherPhoneNumbers="\u5176\u4ed6\u7535\u8bdd\u53f7\u7801:";
a.WebExZimlet_phonePasscode="\u7535\u8bdd\u5bc6\u7801:";
a.WebExZimlet_digitsOnly="(\u4ec5\u9650\u6570\u5b57)";
a.WebExZimlet_passwordNotRequired="(\u6b64\u4f1a\u8bae\u4e0d\u9700\u8981\u5bc6\u7801\u3002)";
a.WebExZimlet_account1UsedAsDefaultForUnAssociatedCal="\u5907\u6ce8: \u4e3a\u6240\u6709\u4e0d\u5173\u8054\u7684\u884c\u4e8b\u5386\u4f7f\u7528\u7684\u90fd\u662f\u5e10\u6237 1 \u8bbe\u7f6e";
a.WebExZimlet_testFailed="\u6d4b\u8bd5\u5931\u8d25\u3002\u6b64 WebEx \u5e10\u6237\u65e0\u6548\u3002";
a.WebExZimlet_testPassed="\u6d4b\u8bd5\u6210\u529f\u3002\u6b64 WebEx \u5e10\u6237\u6709\u6548\u3002";
a.WebExZimlet_errorInWebExXml="\u5206\u6790 WebEx XML \u56de\u5e94\u65f6\u51fa\u9519\u6216 XML \u5df2\u635f\u574f\u3002";
a.WebExZimlet_accountNumberNotSetup="\u672a\u8bbe\u7f6e WebEx <b>\u5e10\u6237 {0}</b>\u3002";
a.WebExZimlet_pleaseWait="\u8bf7\u7a0d\u5019...";
a.WebExZimlet_allCalendars="\u6240\u6709\u884c\u4e8b\u5386";
a.WebExZimlet_selectAccntToUse="\u9009\u62e9 WebEx \u5e10\u6237";
a.WebExZimlet_webExAccntToUse="WebEx \u5e10\u6237:";
a.WebExZimlet_enterYourName="[\u8f93\u5165\u60a8\u7684\u59d3\u540d]";
a.WebExZimlet_email="\u7535\u5b50\u90ae\u4ef6:";
a.WebExZimlet_enterYourEmail="[\u8f93\u5165\u60a8\u7684\u7535\u5b50\u90ae\u4ef6]";
a.WebExZimlet_notConfigured="\u672a\u914d\u7f6e";
a.WebExZimlet_accntNumberAndName="\u5e10\u6237 {0} ({1})";
a.WebExZimlet_getAccounts="\u5e10\u6237\u9009\u9879:";
a.WebExZimlet_help="\u5e2e\u52a9";
a.WebExZimlet_startQuickWebExMeeting="\u5f00\u59cb WebEx \u7b80\u6613\u4f1a\u8bae";
a.WebExZimlet_addAttendees="\u6dfb\u52a0\u53c2\u4e0e\u8005:";
a.WebExZimlet_quickMeetingSubject="WebEx \u7b80\u6613\u4f1a\u8bae(\u8bf7\u7acb\u5373\u53c2\u52a0)";
a.WebExZimlet_quickMeetingLocation="WebEx \u7b80\u6613\u4f1a\u8bae(\u8bf7\u7acb\u5373\u53c2\u52a0)";
a.WebExZimlet_startOrJoinWebExMeeting="\u5f00\u59cb\u6216\u53c2\u52a0 WebEx \u4f1a\u8bae";
a.WebExZimlet_host="\u4e3b\u6301\u4eba";
a.WebExZimlet_startTime="\u5f00\u59cb\u65f6\u95f4";
a.WebExZimlet_action="\u64cd\u4f5c";
a.WebExZimlet_meetingName="\u4f1a\u8bae\u540d\u79f0";
a.WebExZimlet_meetingsList="WebEx \u4f1a\u8bae\u5217\u8868:";
a.WebExZimlet_startJoin="\u5f00\u59cb/\u53c2\u52a0";
a.WebExZimlet_fromNowOn="\u4ece\u73b0\u5728\u5f00\u59cb";
a.WebExZimlet_today="\u4eca\u5929";
a.WebExZimlet_tomorrow="\u660e\u5929";
a.WebExZimlet_next7days="\u672a\u6765 7 \u5929";
a.WebExZimlet_savesThisApptAsWebEx="\u53e6\u5b58\u4e3a WebEx";
a.WebExZimlet_saveAsWebEx="\u53e6\u5b58\u4e3a WebEx";
a.WebExZimlet_successfullyCreatedWebEx="\u6210\u529f\u521b\u5efa WebEx \u7ea6\u4f1a";
a.WebExZimlet_unableToCreateMeeting="\u65e0\u6cd5\u521b\u5efa WebEx \u4f1a\u8bae";
a.WebExZimlet_noWebExAccount="\u5c1a\u672a\u914d\u7f6e WebEx \u5e10\u6237\u3002<br/>\u5728 Zimlet \u4e0a\u5355\u51fb\u9f20\u6807\u53f3\u952e\uff0c\u7136\u540e\u9009\u62e9\u201c\u5e10\u6237\u7ba1\u7406\u201d\u6765\u8fdb\u884c\u914d\u7f6e\u3002";
a.WebExZimlet_webExError="WebEx \u9519\u8bef";
a.WebExZimlet_failureReason="\u5931\u8d25\u539f\u56e0:";
a.WebExZimlet_webExDidntReturnMeetingKey="WebEx \u672a\u8fd4\u56de\u4f1a\u8bae\u5bc6\u94a5\uff0c\u4e5f\u8bb8\uff0c\u4f1a\u8bae\u4e0d\u662f\u5728 WebEx \u670d\u52a1\u5668\u4e0a\u521b\u5efa\u7684\u3002";
a.WebExZimlet_unableToGetMeetingInfo="\u65e0\u6cd5\u83b7\u53d6 WebEx \u4f1a\u8bae\u4fe1\u606f";
a.WebExZimlet_unableToGetJoinOrHostURL="\u65e0\u6cd5\u83b7\u53d6 WebEx \u53c2\u52a0/\u4e3b\u6301\u4f1a\u8bae URL";
a.WebExZimlet_couldNotGetJoinMeetingUrl="\u65e0\u6cd5\u4ece WebEx \u4e2d\u83b7\u53d6\u53c2\u52a0\u4f1a\u8bae\u7528\u7684 URL";
a.WebExZimlet_unableToDeleteWebExAppt="\u65e0\u6cd5\u5220\u9664 WebEx \u4f1a\u8bae";
a.WebExZimlet_unableToCreateOrModifyMeeting="\u65e0\u6cd5\u521b\u5efa/\u4fee\u6539 WebEx \u4f1a\u8bae";
a.WebExZimlet_invalidAlternateHost="\u5907\u9009\u4e3b\u6301\u4eba\u65e0\u6548\u3002<br/>\u4f7f\u7528\u5907\u9009\u4e3b\u6301\u4eba\u662f\u4e3a\u4e86\u5141\u8bb8\u5176\u4ed6\u4e3b\u6301\u4eba\u4ee3\u8868\u60a8\u5b89\u6392\u4f1a\u8bae\u3002\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u5fc5\u987b\u5728\u60a8\u7684 WebEx \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6b64\u529f\u80fd\u3002<br/><br/>\u8981\u6388\u4e88\u5907\u9009\u4e3b\u6301\u4eba\u76f8\u5173\u6743\u9650:<br/>1. \u767b\u5f55\u5230\u60a8\u7684 WebEx \u5e10\u6237\u3002<br/>2. \u6d4f\u89c8\u81f3\u201c\u8bbe\u7f6e\u201d>\u201c\u6211\u7684\u6863\u6848\u201d>\u201c\u5bf9\u8bdd\u671f\u9009\u9879\u201d>\u201c\u65e5\u7a0b\u5b89\u6392\u6743\u9650\u201d\u3002<br/>3. \u8f93\u5165\u5907\u9009\u4e3b\u6301\u4eba\u3002<br/>4. \u4fdd\u5b58\u60a8\u7684\u6863\u6848\u3002";
a.WebExZimlet_setupAlternateHost="\u4f7f\u7528\u5907\u9009\u4e3b\u6301\u4eba\u662f\u4e3a\u4e86\u5141\u8bb8\u5176\u4ed6\u4e3b\u6301\u4eba\u4ee3\u8868\u60a8\u5b89\u6392\u4f1a\u8bae\u3002\u8981\u4f7f\u7528\u6b64\u529f\u80fd\uff0c\u5fc5\u987b\u5728\u60a8\u7684 WebEx \u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6b64\u529f\u80fd\u3002<br/><br/>\u8981\u6388\u4e88\u5907\u9009\u4e3b\u6301\u4eba\u76f8\u5173\u6743\u9650:<br/>1. \u767b\u5f55\u5230\u60a8\u7684 WebEx \u5e10\u6237\u3002<br/>2. \u6d4f\u89c8\u81f3\u201c\u8bbe\u7f6e\u201d>\u201c\u6211\u7684\u6863\u6848\u201d>\u201c\u5bf9\u8bdd\u671f\u9009\u9879\u201d>\u201c\u65e5\u7a0b\u5b89\u6392\u6743\u9650\u201d\u3002<br/>3. \u8f93\u5165\u5907\u9009\u4e3b\u6301\u4eba\u3002<br/>4. \u4fdd\u5b58\u60a8\u7684\u6863\u6848\u3002";
a.WebExZimlet_userPwdCIdRequired="WebEx \u7528\u6237\u540d\u3001\u5bc6\u7801\u548c\u516c\u53f8 Id \u662f\u5fc5\u9700\u9879\u3002";
a.WebExZimlet_couldNotRegisterAttendees="\u65e0\u6cd5\u6ce8\u518c\u53c2\u4f1a\u8005";
a.cannotContinueInvalidEmails="\u65e0\u6cd5\u7ee7\u7eed\u3002\u53d1\u73b0\u4ee5\u4e0b\u65e0\u6548\u7535\u5b50\u90ae\u4ef6";
a.modifyAlertNotice="\u5df2\u6210\u529f\u521b\u5efa WebEx \u4f1a\u8bae\u3002<br><br>\u8bf7\u6ce8\u610f<br>: \u5982\u679c\u4fee\u6539\u6b64\u4f1a\u8bae(\u800c\u4e0d\u662f\u5176\u5185\u5bb9)\uff0c\u60a8\u5fc5\u987b\u91cd\u65b0\u521b\u5efa WebEx \u4f1a\u8bae";
a.WebExZimlet_meetingWasDeleted="WebEx \u4f1a\u8bae\u5df2\u88ab\u5220\u9664";
a.WebExZimlet_entireSeriesWillBeDeleted="\u627e\u5230 WebEx \u7ea6\u4f1a\u3002<br/>\u5bf9\u4e8e\u5b9a\u671f\u91cd\u590d\u7684\u7ea6\u4f1a\uff0c\u5c06\u5728 WebEx \u670d\u52a1\u5668\u4e0a\u5220\u9664\u6574\u4e2a\u7cfb\u5217\u3002<br/>\u662f\u5426\u7ee7\u7eed?";
a.WebExZimlet_modifyApptAvoidDuplicateInfoWarning="\u4fee\u6539 WebEx \u7ea6\u4f1a\u3002<br/>\u8bf7\u52a1\u5fc5\u4ece\u6b63\u6587\u3001\u4e3b\u9898\u548c\u5730\u70b9\u5b57\u6bb5\u4e2d\u5220\u9664\u65e7\u7684 WebEx \u6570\u636e\uff0c\u4ee5\u514d\u63d2\u5165\u591a\u4e2a WebEx \u4fe1\u606f\u3002<br/>\u662f\u5426\u7ee7\u7eed?";
a.WebExZimlet_teleconferenceDetails="\u7535\u8bdd\u4f1a\u8bae\u8be6\u7ec6\u8d44\u6599:";
a.WebExZimlet_webExDetails="WebEx \u8be6\u7ec6\u8d44\u6599:";
if(!window.com_zimbra_ymemoticons){
com_zimbra_ymemoticons={}
}
a=com_zimbra_ymemoticons;
a.label="Yahoo! Emoticons";
a.description="Displays Yahoo! Emoticons images in email messages.";
a.yahooEmoticons="Yahoo! Emoticons";
a.temporarilyDisableInMail="Temporarily disable in Mail";
a.preferences="Preferences";
if(!window.com_zimbra_ymemoticons){
com_zimbra_ymemoticons={}
}
a=com_zimbra_ymemoticons;
a.label="Yahoo! \u8868\u60c5\u56fe\u6807";
a.description="\u5728\u7535\u5b50\u90ae\u4ef6\u4e2d\u663e\u793a Yahoo! \u8868\u60c5\u56fe\u6807\u56fe\u50cf\u3002";
a.yahooEmoticons="Yahoo! \u8868\u60c5\u56fe\u6807";
a.temporarilyDisableInMail="\u5728\u90ae\u4ef6\u4e2d\u6682\u65f6\u7981\u7528";
a.preferences="\u9996\u9009\u9879";
if(!window.com_zimbra_click2call_cisco){
com_zimbra_click2call_cisco={}
}
a=com_zimbra_click2call_cisco;
a.label="Cisco Click2Call";
a.description="Provides Click to Call capability Cisco UC";
a.provider="Cisco";
a.providerError="Cisco Error";
a.fromPhoneDlgTitle="Place Call";
a.from="From:";
a.to="To:";
a.call="Call";
a.click2callDlgTitle="Cisco Click-To-Call";
a.calling="Connecting...";
a.connectionSuccessfulStr="Call successfully initiated";
a.connectionFailedTryRedialling="Connection failed, try redialing.";
a.callHungUp="Call Hung up";
a.coulNotConnect="Could not connect";
a.hangUp="Hang up";
a.redial="Redial";
a.notAValidPhoneNumber="{0} is not a valid phone number. Please enter a valid phone number.";
a.voicePIN="Voice PIN";
a.voicePINTooltip="Update Voice PIN";
a.pinStr="PIN:";
a.confirmPINStr="Confirm PIN:";
a.voicePINDlgTitle="Update Voice PIN";
a.updatePin="Update PIN";
a.pinAndConfirmPinDidntMatch="PIN and Confirm PIN didn't match";
a.invalidPin="Invalid PIN";
a.pinCanOnlyBeDigits="PIN can only be digits";
a.err_invalidUCInfo="Invalid voice/chat information";
a.err_noPhoneNumber="No device is configured.";
a.err_failedFetchUCINfo="Failed to get user voice/chat information";
if(!window.com_zimbra_click2call_cisco){
com_zimbra_click2call_cisco={}
}
a=com_zimbra_click2call_cisco;
a.label="Cisco \u5355\u51fb\u901a\u8bdd";
a.description="\u63d0\u4f9b\u5355\u51fb\u901a\u8bdd\u529f\u80fd Cisco UC";
a.provider="Cisco";
a.providerError="Cisco \u9519\u8bef";
a.fromPhoneDlgTitle="\u81f4\u7535";
a.from="\u53d1\u4ef6\u4eba\uff1a";
a.to="\u6536\u4ef6\u4eba:";
a.call="\u81f4\u7535";
a.click2callDlgTitle="Cisco \u5355\u51fb\u901a\u8bdd";
a.calling="\u6b63\u5728\u8fde\u63a5...";
a.connectionSuccessfulStr="\u5df2\u6210\u529f\u53d1\u8d77\u547c\u53eb";
a.connectionFailedTryRedialling="\u65e0\u6cd5\u8fde\u63a5\uff0c\u8bf7\u5c1d\u8bd5\u91cd\u62e8\u3002";
a.callHungUp="\u547c\u53eb\u88ab\u6302\u65ad";
a.coulNotConnect="\u65e0\u6cd5\u8fde\u63a5";
a.hangUp="\u6302\u65ad";
a.redial="\u91cd\u62e8";
a.notAValidPhoneNumber="{0} \u4e0d\u662f\u6709\u6548\u7535\u8bdd\u53f7\u7801\u3002\u8bf7\u8f93\u5165\u6709\u6548\u7535\u8bdd\u53f7\u7801\u3002";
a.voicePIN="\u8bed\u97f3 PIN";
a.voicePINTooltip="\u66f4\u65b0\u8bed\u97f3 PIN";
a.pinStr="PIN:";
a.confirmPINStr="\u786e\u8ba4 PIN:";
a.voicePINDlgTitle="\u66f4\u65b0\u8bed\u97f3 PIN";
a.updatePin="\u66f4\u65b0 PIN";
a.pinAndConfirmPinDidntMatch="PIN \u548c\u786e\u8ba4 PIN \u4e0d\u5339\u914d";
a.invalidPin="\u65e0\u6548 PIN";
a.pinCanOnlyBeDigits="PIN \u53ea\u80fd\u662f\u6570\u5b57";
a.err_invalidUCInfo="\u65e0\u6548\u8bed\u97f3/\u804a\u5929\u4fe1\u606f";
a.err_noPhoneNumber="\u672a\u914d\u7f6e\u4efb\u4f55\u8bbe\u5907\u3002";
a.err_failedFetchUCINfo="\u65e0\u6cd5\u83b7\u5f97\u7528\u6237\u8bed\u97f3/\u804a\u5929\u4fe1\u606f";
if(!window.com_zimbra_srchhighlighter){
com_zimbra_srchhighlighter={}
}
a=com_zimbra_srchhighlighter;
a.label="Search Highlighter";
a.description="After a mail search, this Zimlet highlights Search terms with yellow color.";
a.SearchHighlighterZimlet_MenuLabel="Clear Search Highlights";
a.SearchHighlighterZimlet_ZimletError="Search Highlighter Zimlet Error:";
if(!window.com_zimbra_srchhighlighter){
com_zimbra_srchhighlighter={}
}
a=com_zimbra_srchhighlighter;
a.label="\u641c\u7d22\u7a81\u51fa\u663e\u793a";
a.description="\u8fdb\u884c\u90ae\u4ef6\u641c\u7d22\u540e\uff0cZimlet \u5c06\u7528\u9ec4\u8272\u7a81\u51fa\u663e\u793a\u641c\u7d22\u5b57\u3002";
a.SearchHighlighterZimlet_MenuLabel="\u6e05\u9664\u641c\u7d22\u7a81\u51fa\u663e\u793a";
a.SearchHighlighterZimlet_ZimletError="\u641c\u7d22\u7a81\u51fa\u663e\u793a\u7684 Zimlet \u9519\u8bef:";
if(!window.com_zimbra_phone){
com_zimbra_phone={}
}
a=com_zimbra_phone;
a.label="Phone";
a.description="Highlights phone numbers to enable Skype calls.";
a.search="Search";
a.addToContacts="Add To Contacts";
a.call="Call";
a.localPhoneRegEx="(\\+?1?)(-?\\s?\\)?\\.?)(\\(?)\\d{3}(-?\\s?\\)?\\.?)+\\d{3}(-?\\s?\\.?)\\d{4}";
a.countryCode="1";
if(!window.com_zimbra_phone){
com_zimbra_phone={}
}
a=com_zimbra_phone;
a.label="\u7535\u8bdd";
a.description="\u7a81\u51fa\u663e\u793a\u7535\u8bdd\u53f7\u7801\u4ee5\u542f\u7528 Skype \u7535\u8bdd\u3002";
a.search="\u641c\u7d22";
a.addToContacts="\u6dfb\u52a0\u5230\u8054\u7cfb\u4eba";
a.call="\u81f4\u7535";
a.localPhoneRegEx="(\\(?\\+?8?6?)(-?\\s?\\)?\\.?)(\\(?)0?(\\d{2}|\\d{3})*(\\)?)(-?\\s?\\.?)(\\d{7}(\\d)*)";
a.countryCode="86";
if(!window.com_zimbra_voiceprefs){
com_zimbra_voiceprefs={}
}
a=com_zimbra_voiceprefs;
a.voice="Voice";
a.label="Voice Preferences";
a.description="Configure your voice account settings";
a.voicePrefsInstruction="Registered Numbers";
a.phoneNumber="Phone Number";
a.generalHeader="Voice Account Settings";
a.editPhone="Edit Phone";
a.couldNotAddOrUpdatePhone="Could not add or update phone.";
a.voiceError="Voice Error";
a.phoneNotEditable="This phone is not editable";
a.voiceAccountSettingsDlgTitle="Update Account Login";
a.invalidAccountSettings="Invalid password";
a.usernameLabel="Username:";
a.passwordLabel="Password:";
a.missingPassword="Password cannot be blank";
a.accountSettingsUpdated="Account Login updated";
a.updatePinHeader="Update Voice Mail PIN";
a.oldPinLabel="Old PIN:";
a.newPinLabel="New PIN:";
a.confirmNewPinLabel="Confirm New PIN:";
a.newPinAndConfirmPinDoesNotMatch="'New PIN' and 'Confirm New PIN' does not match";
a.updatePassword="Update Account Login";
a.updatePasswordDlgBtn="Update";
a.updatePIN="Reset Voicemail PIN";
a.pleaseSelectVoiceMailAccountAbove="Please select a voice mail account from the above list before updating PIN.";
a.couldNotUpdatePIN="Could not update PIN";
a.voicePINUpdated="Voice PIN updated";
a.invalidOldPin="Invalid old PIN";
a.missingOldPin="Old PIN is required";
a.missingNewPin="New PIN is required";
a.voicePIN="Voice PIN";
a.voicePINTooltip="Update Voice PIN";
a.pinStr="PIN:";
a.confirmPINStr="Confirm PIN:";
a.voicePINDlgTitle="Update Voice PIN";
a.updatePin="Update PIN";
a.pinAndConfirmPinDidntMatch="PIN and Confirm PIN didn't match";
a.invalidPin="Invalid PIN";
a.pinCanOnlyBeDigits="PIN can only be digits";
a.err_failedFetchUCINfo="Failed to get user voice/chat username.";
if(!window.com_zimbra_voiceprefs){
com_zimbra_voiceprefs={}
}
a=com_zimbra_voiceprefs;
a.voice="\u8bed\u97f3";
a.label="\u8bed\u97f3\u9996\u9009\u9879";
a.description="\u914d\u7f6e\u60a8\u7684\u8bed\u97f3\u5e10\u6237\u8bbe\u7f6e";
a.voicePrefsInstruction="\u6ce8\u518c\u7684\u53f7\u7801";
a.phoneNumber="\u7535\u8bdd\u53f7\u7801";
a.generalHeader="\u8bed\u97f3\u5e10\u6237\u8bbe\u7f6e";
a.editPhone="\u7f16\u8f91\u7535\u8bdd";
a.couldNotAddOrUpdatePhone="\u65e0\u6cd5\u6dfb\u52a0\u6216\u66f4\u65b0\u7535\u8bdd\u3002";
a.voiceError="\u8bed\u97f3\u9519\u8bef";
a.phoneNotEditable="\u6b64\u7535\u8bdd\u4e0d\u53ef\u7f16\u8f91";
a.voiceAccountSettingsDlgTitle="\u66f4\u65b0\u5e10\u6237\u767b\u5f55\u540d";
a.invalidAccountSettings="\u5bc6\u7801\u65e0\u6548";
a.usernameLabel="\u7528\u6237\u540d:";
a.passwordLabel="\u5bc6\u7801:";
a.missingPassword="\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a";
a.accountSettingsUpdated="\u5e10\u6237\u767b\u5f55\u540d\u5df2\u66f4\u65b0";
a.updatePinHeader="\u66f4\u65b0\u8bed\u97f3\u90ae\u4ef6 PIN";
a.oldPinLabel="\u65e7 PIN:";
a.newPinLabel="\u65b0 PIN:";
a.confirmNewPinLabel="\u786e\u8ba4\u65b0 PIN:";
a.newPinAndConfirmPinDoesNotMatch="\u201c\u65b0 PIN\u201d\u548c\u201c\u786e\u8ba4\u65b0 PIN\u201d\u4e0d\u5339\u914d";
a.updatePassword="\u66f4\u65b0\u5e10\u6237\u767b\u5f55\u540d";
a.updatePasswordDlgBtn="\u66f4\u65b0";
a.updatePIN="\u91cd\u7f6e\u8bed\u97f3\u90ae\u4ef6 PIN";
a.pleaseSelectVoiceMailAccountAbove="\u8bf7\u5148\u4ece\u4e0a\u9762\u7684\u5217\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u8bed\u97f3\u90ae\u4ef6\u5e10\u6237\uff0c\u7136\u540e\u518d\u66f4\u65b0 PIN\u3002";
a.couldNotUpdatePIN="\u65e0\u6cd5\u66f4\u65b0 PIN";
a.voicePINUpdated="\u8bed\u97f3 PIN \u5df2\u66f4\u65b0";
a.invalidOldPin="\u65e0\u6548\u65e7 PIN";
a.missingOldPin="\u5fc5\u987b\u63d0\u4f9b\u65e7 PIN";
a.missingNewPin="\u5fc5\u987b\u63d0\u4f9b\u65b0 PIN";
a.voicePIN="\u8bed\u97f3 PIN";
a.voicePINTooltip="\u66f4\u65b0\u8bed\u97f3 PIN";
a.pinStr="PIN:";
a.confirmPINStr="\u786e\u8ba4 PIN:";
a.voicePINDlgTitle="\u66f4\u65b0\u8bed\u97f3 PIN";
a.updatePin="\u66f4\u65b0 PIN";
a.pinAndConfirmPinDidntMatch="PIN \u548c\u786e\u8ba4 PIN \u4e0d\u5339\u914d";
a.invalidPin="\u65e0\u6548 PIN";
a.pinCanOnlyBeDigits="PIN \u53ea\u80fd\u662f\u6570\u5b57";
a.err_failedFetchUCINfo="\u65e0\u6cd5\u83b7\u5f97\u7528\u6237\u8bed\u97f3/\u804a\u5929\u7528\u6237\u540d\u3002";
if(!window.com_zimbra_attachcontacts){
com_zimbra_attachcontacts={}
}
a=com_zimbra_attachcontacts;
a.label="Attach Contacts";
a.description="Allows Attaching contacts when composing a new message.";
a.ACZ_tab_label="Contacts";
a.ACZ_tab_button_search="Search";
a.ACZ_NoContactsFound="No contacts found.";
a.ACZ_Send="Forward";
a.ACZ_SendContact="Forward Contact";
a.ACZ_SendContactsAsAttachments="Send Contacts as email attachments";
a.ACZ_more="({0} more)";
if(!window.com_zimbra_attachcontacts){
com_zimbra_attachcontacts={}
}
a=com_zimbra_attachcontacts;
a.label="\u9644\u52a0\u8054\u7cfb\u4eba";
a.description="\u5141\u8bb8\u5728\u7f16\u5199\u65b0\u90ae\u4ef6\u65f6\u9644\u52a0\u8054\u7cfb\u4eba\u3002";
a.ACZ_tab_label="\u8054\u7cfb\u4eba";
a.ACZ_tab_button_search="\u641c\u7d22";
a.ACZ_NoContactsFound="\u627e\u4e0d\u5230\u4efb\u4f55\u8054\u7cfb\u4eba\u3002";
a.ACZ_Send="\u8f6c\u53d1";
a.ACZ_SendContact="\u8f6c\u53d1\u8054\u7cfb\u4eba";
a.ACZ_SendContactsAsAttachments="\u4f5c\u4e3a\u7535\u5b50\u90ae\u4ef6\u9644\u4ef6\u53d1\u9001\u8054\u7cfb\u4eba";
a.ACZ_more="(\u53e6\u5916 {0} \u4e2a)";
if(!window.com_zimbra_attachmail){
com_zimbra_attachmail={}
}
a=com_zimbra_attachmail;
a.label="Email Attacher";
a.description="Attach email messages when composing a new message.";
a.AttachMailZimlet_panel_label="Email Attacher";
a.AttachMailZimlet_panel_tooltip='Adds an "Attach Mail" tab to the compose toolbar "Add Attachment" dialog.';
a.AttachMailZimlet_tab_label="Mail";
a.AttachMailZimlet_tab_button_search="Search";
a.AttachMailZimlet_tab_button_view="View Message";
if(!window.com_zimbra_attachmail){
com_zimbra_attachmail={}
}
a=com_zimbra_attachmail;
a.label="\u7535\u5b50\u90ae\u4ef6\u6dfb\u52a0\u7a0b\u5e8f";
a.description="\u7f16\u5199\u65b0\u90ae\u4ef6\u65f6\u9644\u52a0\u7535\u5b50\u90ae\u4ef6\u3002";
a.AttachMailZimlet_panel_label="\u7535\u5b50\u90ae\u4ef6\u6dfb\u52a0\u7a0b\u5e8f";
a.AttachMailZimlet_panel_tooltip="\u5411\u7f16\u5199\u5de5\u5177\u680f\u201c\u6dfb\u52a0\u9644\u4ef6\u201d\u5bf9\u8bdd\u6846\u6dfb\u52a0\u201c\u6dfb\u52a0\u90ae\u4ef6\u201d\u9009\u9879\u5361\u3002";
a.AttachMailZimlet_tab_label="\u90ae\u4ef6";
a.AttachMailZimlet_tab_button_search="\u641c\u7d22";
a.AttachMailZimlet_tab_button_view="\u67e5\u770b\u90ae\u4ef6";
if(!window.com_zimbra_click2call_mitel){
com_zimbra_click2call_mitel={}
}
a=com_zimbra_click2call_mitel;
a.label="Mitel Click2Call";
a.description="Provides Click to Call capability Mitel UC";
a.provider="Mitel";
a.providerError="Mitel Error";
a.fromPhoneDlgTitle="Place Call";
a.from="From:";
a.to="To:";
a.call="Call";
a.click2callDlgTitle="Mitel Click-To-Call";
a.calling="Connecting...";
a.connectionSuccessfulStr="Call successfully initiated";
a.connectionFailedTryRedialling="Connection failed, try redialing.";
a.callHungUp="Call Hung up";
a.coulNotConnect="Could not connect";
a.hangUp="Hang up";
a.redial="Redial";
a.notAValidPhoneNumber="{0} is not a valid phone number. Please enter a valid phone number.";
a.voicePIN="Voice PIN";
a.voicePINTooltip="Update Voice PIN";
a.pinStr="PIN:";
a.confirmPINStr="Confirm PIN:";
a.voicePINDlgTitle="Update Voice PIN";
a.updatePin="Update PIN";
a.pinAndConfirmPinDidntMatch="PIN and Confirm PIN didn't match";
a.invalidPin="Invalid PIN";
a.pinCanOnlyBeDigits="PIN can only be digits";
if(!window.com_zimbra_click2call_mitel){
com_zimbra_click2call_mitel={}
}
a=com_zimbra_click2call_mitel;
a.label="Mitel \u5355\u51fb\u901a\u8bdd";
a.description="\u63d0\u4f9b\u5355\u51fb\u901a\u8bdd\u529f\u80fd Mitel UC";
a.provider="Mitel";
a.providerError="Mitel \u9519\u8bef";
a.fromPhoneDlgTitle="\u81f4\u7535";
a.from="\u53d1\u4ef6\u4eba\uff1a";
a.to="\u6536\u4ef6\u4eba:";
a.call="\u81f4\u7535";
a.click2callDlgTitle="Mitel \u5355\u51fb\u901a\u8bdd";
a.calling="\u6b63\u5728\u8fde\u63a5...";
a.connectionSuccessfulStr="\u5df2\u6210\u529f\u53d1\u8d77\u547c\u53eb";
a.connectionFailedTryRedialling="\u65e0\u6cd5\u8fde\u63a5\uff0c\u8bf7\u5c1d\u8bd5\u91cd\u62e8\u3002";
a.callHungUp="\u547c\u53eb\u88ab\u6302\u65ad";
a.coulNotConnect="\u65e0\u6cd5\u8fde\u63a5";
a.hangUp="\u6302\u65ad";
a.redial="\u91cd\u62e8";
a.notAValidPhoneNumber="{0} \u4e0d\u662f\u6709\u6548\u7535\u8bdd\u53f7\u7801\u3002\u8bf7\u8f93\u5165\u6709\u6548\u7535\u8bdd\u53f7\u7801\u3002";
a.voicePIN="\u8bed\u97f3 PIN";
a.voicePINTooltip="\u66f4\u65b0\u8bed\u97f3 PIN";
a.pinStr="PIN:";
a.confirmPINStr="\u786e\u8ba4 PIN:";
a.voicePINDlgTitle="\u66f4\u65b0\u8bed\u97f3 PIN";
a.updatePin="\u66f4\u65b0 PIN";
a.pinAndConfirmPinDidntMatch="PIN \u548c\u786e\u8ba4 PIN \u4e0d\u5339\u914d";
a.invalidPin="\u65e0\u6548 PIN";
a.pinCanOnlyBeDigits="PIN \u53ea\u80fd\u662f\u6570\u5b57";
function com_zimbra_attachcontacts_HandlerObject(){}
com_zimbra_attachcontacts_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachcontacts_HandlerObject.prototype.constructor=com_zimbra_attachcontacts_HandlerObject;
var AttachContactsZimlet=com_zimbra_attachcontacts_HandlerObject;
AttachContactsZimlet.SEND_CONTACTS="SEND_CONTACTS_IN_EMAIL";
AttachContactsZimlet.prototype.init=function(){
this._op=ZmOperation.registerOp(AttachContactsZimlet.SEND_CONTACTS,{
image:"MsgStatusSent",text:this.getMessage("ACZ_Send"),tooltip:this.getMessage("ACZ_SendContactsAsAttachments")}
);
this._contactSendListener=new AjxListener(this,this._contactListSendListener);
this.overrideAPI(ZmListController.prototype,"_setContactText",this._setContactText);
this.setEmailActionMenu()
};
AttachContactsZimlet.prototype.initializeAttachPopup=function(o,e){
var t=e._createAttachMenuItem(o,ZmMsg.contacts,new AjxListener(this,this.showAttachmentDialog))
};
AttachContactsZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachContactsZimlet.prototype.showAttachmentDialog=function(){
var e=this._attachDialog=appCtxt.getAttachDialog();
e.setTitle(ZmMsg.attachContact);
this.removePrevAttDialogContent(e._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AttachContactsView=new AttachContactsTabView(this._attachDialog,this)
}
this.AttachContactsView.reparentHtmlElement(e._getContentDiv().childNodes[0],0);
this.AttachContactsView.attachDialog=e;
e.setOkListener(new AjxCallback(this,this._okListener));
this.AttachContactsView.attachDialog.popup();
this.AttachContactsView.attachDialog.enableInlineOption(this._composeMode==DwtHtmlEditor.HTML);
this._addedToMainWindow=true
};
AttachContactsZimlet.prototype.onShowView=function(t){
var e=appCtxt.getViewTypeFromId(t);
if(e==ZmId.VIEW_CONTACT_SIMPLE){
this._addContactActionMenuItem()
}};
AttachContactsZimlet.prototype._okListener=function(){
this.AttachContactsView.uploadFiles();
this.AttachContactsView.setClosed(true);
this.AttachContactsView.attachDialog.popdown()
};
AttachContactsZimlet.prototype.addExtraMsgParts=function(o,e){
if(!e||!this._isDraftInitiatedByThisZimlet){
return
}
if(o&&o.m){
if(!o.m.attach){
o.m.attach={};
o.m.attach.cn=[]
}else{
if(!o.m.attach.cn){
o.m.attach.cn=[]
}}
var s=this.contactIdsToAttach;
if(s){
for(var t=0;
t<s.length;
t++){
var n=s[t];
if(appCtxt.multiAccounts&&s[t].indexOf(":")==-1){
n=[appCtxt.getActiveAccount().id,":",s[t]].join("")
}
o.m.attach.cn.push({
id:n}
)
}}}
this._isDraftInitiatedByThisZimlet=false
};
AttachContactsZimlet.prototype._initContactsReminderToolbar=function(n,e){
var s=AttachContactsZimlet.SEND_CONTACTS;
if(n.getButton(s)||!this._isOkayToAttach()){
return
}
var o=AjxUtil.hashCopy(ZmOperation.SETUP[s]);
o.text=this.getMessage("ACZ_Send");
var t=n.createZimletOp(s,o);
t.addSelectionListener(this._contactSendListener)
};
AttachContactsZimlet.prototype.resetToolbarOperations=function(t,e){
if(t.getOp(AttachContactsZimlet.SEND_CONTACTS)){
t.enable(AttachContactsZimlet.SEND_CONTACTS,e>0&&this._isOkayToAttach())
}};
AttachContactsZimlet.prototype._isOkayToAttach=function(){
this._getContactListIds();
return this.contactIdsToAttach&&this.contactIdsToAttach.length>0
};
AttachContactsZimlet.prototype._contactListSendListener=function(){
this._getContactListIds();
if(this.contactIdsToAttach&&this.contactIdsToAttach.length){
this._openCompose()
}};
AttachContactsZimlet.prototype._getContactListIds=function(){
var t=appCtxt.getApp(ZmApp.CONTACTS).getContactListController();
this.contactIdsToAttach=[];
var e=t.getListView();
if(e){
var o=e.getSelection();
for(var n=0;
n<o.length;
n++){
if(!o[n].isGroup()){
this.contactIdsToAttach.push(o[n].id)
}}}
return this.contactIdsToAttach
};
AttachContactsZimlet.prototype._openCompose=function(){
var t=ZmOperation.NEW_MESSAGE;
var o=new ZmMailMsg();
AjxDispatcher.run("Compose",{
action:t,inNewWindow:false,msg:o}
);
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this._isDraftInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO)
};
AttachContactsZimlet.prototype._setContactText=function(e){
if(this._participantActionMenu){
this._participantActionMenu.enable(AttachContactsZimlet.SEND_CONTACTS,e)
}
arguments.callee.func.apply(this,arguments)
};
AttachContactsZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
AttachContactsZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(new AjxCallback(this,this._getContactFromController,[e]),t,ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._addContactActionMenuItem=function(){
var e=appCtxt.getApp(ZmApp.CONTACTS).getContactListController();
this.addMenuButton(new AjxCallback(this,this._getContactFromController,[e]),e.getActionMenu(),ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._getContactFromController=function(t){
if(t){
if(t instanceof ZmContactListController){
var e=t.getListView();
if(e){
var o=e.getSelection();
if(o&&o.length>1){
return o
}}}
return(t&&t._actionEv&&t._actionEv.contact)||null
}};
AttachContactsZimlet.prototype.addMenuButton=function(e,r,s){
if(e&&r&&!r.getMenuItem(AttachContactsZimlet.SEND_CONTACTS)){
var t=null;
if(AjxUtil.isString(s)){
var n=r.getMenuItem(s);
if(n){
for(t=0,c=r.getChildren();
t<c.length&&c[t]!==n;
t++){}}}else{
if(AjxUtil.isNumber(s)){
t=s
}}
if(!s||t!==null){
var h={
id:AttachContactsZimlet.SEND_CONTACTS,text:this.getMessage("ACZ_SendContact"),image:"MsgStatusSent"};
if(t!==null){
h.index=t+1
}
var o=ZmOperation.defineOperation(null,h);
r.addOp(AttachContactsZimlet.SEND_CONTACTS);
r.addSelectionListener(AttachContactsZimlet.SEND_CONTACTS,new AjxListener(this,this._contactActionMenuListener,e))
}}};
AttachContactsZimlet.prototype._contactActionMenuListener=function(t,n){
var e=t.run();
if(e){
var s=AjxUtil.toArray(e);
if(s.length){
this.contactIdsToAttach=[];
for(var o=0;
o<s.length;
o++){
if(!s[o].isGroup()){
this.contactIdsToAttach.push(s[o].id)
}}
if(this.contactIdsToAttach.length>0){
this._openCompose()
}}}};
AttachContactsZimlet.prototype.overrideAPI=function(o,t,n){
n=n||this[t];
if(n){
var e=o[t];
o[t]=function(){
n.func=e;
return n.apply(this,arguments)
};
o[t].func=e
}};
AttachContactsZimlet.prototype.setEmailActionMenu=function(){
if(window.com_zimbra_email_handlerObject){
this.overrideAPI(com_zimbra_email_handlerObject.prototype,"getActionMenu",AjxCallback.simpleClosure(AttachContactsZimlet._getEmailActionMenu,null,this))
}};
AttachContactsZimlet._getEmailActionMenu=function(t){
var n=Array.prototype.slice.call(arguments,1);
var s=this.getActionMenu.func.apply(this,n);
var o=new AjxCallback(this,this._getActionedContact,[false]);
var e=o.run();
if(e&&!e.isGal&&e.id){
t.addMenuButton(o,s,"NEWCONTACT")
}else{
if(s.getOp(AttachContactsZimlet.SEND_CONTACTS)){
s.enable(AttachContactsZimlet.SEND_CONTACTS,false)
}}
return s
};
ACZimletNavToolBar=function(t){
t.className=t.className||"ACZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
ACZimletNavToolBar.prototype=new ZmButtonToolBar;
ACZimletNavToolBar.prototype.constructor=ACZimletNavToolBar;
ACZimletNavToolBar.prototype.toString=function(){
return"ACZimletNavToolBar"
};
ACZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
ACZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle ACZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
ACZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};
AttachContactsTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
this._createHtml1();
this.closed=true
};
AttachContactsTabView.prototype=new DwtComposite;
AttachContactsTabView.prototype.constructor=AttachContactsTabView;
AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attContact_SearchField";
AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attContact_SearchBtn";
AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attContact_NavBtnCell";
AttachContactsTabView.DEFAULT_CONTACTS_FOLDER="7";
AttachContactsTabView.GROUP_CUTOFF=6;
AttachContactsTabView.prototype.toString=function(){
return"AttachContactsTabView"
};
AttachContactsTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(appCtxt.multiAccounts){
appCtxt.accountList.setActiveAccount(e)
}
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.reset();
this.setSize(Dwt.DEFAULT,"295");
return
}
this.prevAccount=e;
this._createHtml1();
Dwt.byId(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachContactsTabView.prototype.setClosed=function(e){
this._closed=(e!==false)
};
AttachContactsTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachContactsTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachContactsTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachContactsTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
o.push("<table class='AttachContacts_table' width='100%' style='margin-bottom:5px;'>","<TR><td><INPUT type='text' id='",AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD,"'></INPUT></td>","<td width='80%' style='padding:0 2px'><SPAN id='",AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON,"' /></td>","<td><SPAN id='",AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL,"' /></td></TR></table>","<table width='100%'><tr><td valign='top' id='",this._folderTreeCellId,"'></td>","<td  valign='top'><div  id='",this._folderListId,"' ></div>","</td></tr></table>");
this.setContent(o.join(""));
var t=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("ACZ_tab_button_search");
t.setText(e);
t.setImage("Contact");
t.setSize("140");
t.addSelectionListener(new AjxListener(this,this._searchButtonListener));
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(t.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new ACZimletNavToolBar({
parent:this._navigationContainer}
);
var n=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,n);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,n);
Dwt.byId(AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
this.showAttachContactsTreeView();
Dwt.byId(this._folderListId);
Dwt.byId(this._folderListId).onclick=AjxCallback.simpleClosure(this._handleItemSelect,this)
};
AttachContactsTabView.prototype._handleItemSelect=function(n){
if(AjxEnv.isIE){
n=window.event
}
var o=DwtShell.mouseEvent;
o.setFromDhtmlEvent(n);
var e=o.target;
var r=true;
if(e.className=="ImgCheckboxunChecked"||e.className=="ImgCheckboxChecked"){
r=false
}
while(e&&(e.id.indexOf("attachContactsZimlet_row_")==-1)){
e=e.parentNode
}
if(!e){
return
}
this._resetRowSelection(r);
var s=e.id.replace("attachContactsZimlet_row_","");
var t=document.getElementById("attachContactsZimlet_checkbox_"+s);
if(t&&!r){
if(t.className=="ImgCheckboxunChecked"){
this._setCheckBoxSelection(t,true)
}else{
if(t.className=="ImgCheckboxChecked"){
this._setCheckBoxSelection(t,false)
}}}
if(e){
if(e.className.indexOf("Row-selected")>=0){
if(t.className!="ImgCheckboxChecked"){
this._setRowSelection(e,false);
this._selectedItemIds[s]=false
}}else{
this._setRowSelection(e,true);
this._selectedItemIds[s]=true
}}};
AttachContactsTabView.prototype._resetRowSelection=function(n){
for(var o in this._selectedItemIds){
var t=document.getElementById("attachContactsZimlet_checkbox_"+o);
var e=document.getElementById("attachContactsZimlet_row_"+o);
if(!n&&t&&t.className=="ImgCheckboxChecked"){
continue
}
this._setRowSelection(e,false);
this._setCheckBoxSelection(t,false);
if(this._selectedItemIds&&this._selectedItemIds[o]){
this._selectedItemIds[o]=false
}}};
AttachContactsTabView.prototype._setCheckBoxSelection=function(t,e){
if(!t){
return
}
if(!e){
t.className="ImgCheckboxunChecked"
}else{
t.className="ImgCheckboxChecked"
}};
AttachContactsTabView.prototype._setRowSelection=function(e,t){
if(!e){
return
}
if(!t){
e.className=AjxStringUtil.trim(e.className.replace("Row-selected",""))
}else{
if(e.className.indexOf("Row-selected")==-1){
e.className=e.className+" Row-selected"
}}};
AttachContactsTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachContactsTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachContactsTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachContactsTabView.prototype.showResultContents=function(n){
this._checkboxIdAndItemIdMap=[];
this._selectedItemIds={};
var t=[];
var e={};
if(n.response&&n.response.SearchResponse&&n.response.SearchResponse.cn){
e=n.response.SearchResponse;
t=e.cn
}
this._navTB.enable(ZmOperation.PAGE_BACK,e.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,e.more);
var o=t.length;
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+o))
}
this._setListView(t)
};
AttachContactsTabView.prototype._setListView=function(g){
var d=[];
var b=0;
if(g.length==0){
if(!this._noContactsFoundStr){
this._noContactsFoundStr=["<div padding=5px>",this.zimlet.getMessage("ACZ_NoContactsFound"),"</div>"].join("")
}
d[b++]=this._noContactsFoundStr
}else{
var u=[ZmContact.EMAIL_FIELDS,ZmContact.PHONE_FIELDS,ZmContact.IM_FIELDS];
var w=true;
for(var h=0;
h<g.length;
h++){
var v=g[h];
var f;
try{
f=ZmContact.createFromDom(v,{}
)
}
catch(p){
continue
}
if(!f){
continue
}
var l=(w)?"RowOdd AttachContactRow":"RowEven AttachContactRow";
w=!w;
var s=[f.getAttr(ZmContact.F_firstName),f.getAttr(ZmContact.F_middleName),f.getAttr(ZmContact.F_lastName),f.getAttr(ZmContact.F_company)?"("+f.getAttr(ZmContact.F_company)+")":null];
var t=AjxUtil.collapseList(s).join(" ")||ZmContact.computeFileAs(f);
var m;
if(!f.isGroup()){
m=[];
for(var r=0;
r<u.length;
r++){
var n=this._getFirstWorkingAttr(f.getAttrs(),u[r]);
if(n){
m.push(n)
}}
var y="attachContactsZimlet_checkbox_"+v.id;
var o="attachContactsZimlet_row_"+v.id;
d[b++]="<div  class='";
d[b++]=l;
d[b++]="' id='";
d[b++]=o;
d[b++]="'>";
d[b++]="<table width=100%>";
d[b++]="<tr>";
d[b++]="<td width='1px'><div  id='";
d[b++]=y;
d[b++]="' class='ImgCheckboxunChecked'></div></td>";
d[b++]="<td width='1px'>";
d[b++]=AjxImg.getImageHtml(f.getIcon());
d[b++]="</td>";
d[b++]="<td width='98%'><span style=\"font-weight:bold;\">";
d[b++]=AjxStringUtil.htmlEncode(t||ZmMsg.noName);
d[b++]="</span></td></tr>";
for(var r=0;
r<m.length;
r++){
d[b++]="<tr><td></td><td colspan=3>";
d[b++]=AjxStringUtil.htmlEncode(m[r]);
d[b++]="</td></tr>"
}
d[b++]="</table></div>"
}}}
Dwt.setInnerHtml(Dwt.byId(this._folderListId),d.join(""))
};
AttachContactsTabView.prototype._getFirstWorkingAttr=function(s,t){
var o=[];
if(AjxUtil.isArray(t)){
for(var n=0;
n<t.length;
n++){
var e=this._getFirstWorkingAttr(s,t[n]);
if(e){
return e
}}}else{
if(AjxUtil.isString(t)){
if(s[t]){
return s[t]
}}}};
AttachContactsTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return(e!=DwtKeyEvent.KEY_ENTER&&e!=DwtKeyEvent.KEY_END_OF_TEXT)
};
AttachContactsTabView.prototype.gotAttachments=function(){
return false
};
AttachContactsTabView.prototype._getSelectedItems=function(){
var e=[];
for(var t in this._selectedItemIds){
if(this._selectedItemIds[t]){
e.push(t)
}}
return e
};
AttachContactsTabView.prototype.uploadFiles=function(){
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this.zimlet.contactIdsToAttach=this._getSelectedItems();
this.zimlet._isDrafInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO,null,null,null,this.zimlet.contactIdsToAttach)
};
AttachContactsTabView.prototype.showAttachContactsTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.abook.controller.ZmAddrBookTreeController");
AjxPackage.require({
name:["ContactsCore","Contacts"],forceReload:true,callback:e}
)
};
AttachContactsTabView.prototype.reset=function(){
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value="";
var e=AttachContactsTabView.DEFAULT_CONTACTS_FOLDER;
this._currentQuery=this._getQueryFromFolder(e);
this.treeView.setSelected(e);
this._treeListener()
};
AttachContactsTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.ADDRBOOK="ZmAddrBookTreeController"
}
var o=appCtxt.getApp(ZmApp.CONTACTS);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["ADDRBOOK"],overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"295");
this.reset()
};
AttachContactsTabView.prototype._setOverview=function(s){
var n=s.overviewId;
var r=appCtxt.getOverviewController();
var o=r.getOverview(n);
if(!o){
var e={
overviewId:n,overviewClass:"AttachContactsTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:s.treeIds};
o=r.createOverview(e);
o.account=this.prevAccount;
var t={};
t[ZmOrganizer.ID_DLS]=true;
o.set(s.treeIds,t)
}else{
if(s.account){
o.account=s.account
}}
this._overview=o;
Dwt.byId(this._folderTreeCellId).appendChild(o.getHtmlElement());
this.treeView=o.getTreeView("ADDRBOOK");
Dwt.byId(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this);
this._hideRoot(this.treeView)
};
AttachContactsTabView.prototype._treeListener=function(){
var e=this.treeView.getSelected();
if(e){
var t=this._getQueryFromFolder(e.id);
this.executeQuery(t)
}};
AttachContactsTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachContactsTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var h=o.x*0.35;
var r=o.x-h;
var t=e-55;
this._overview.setSize(h,t);
var s=Dwt.byId(this._folderListId);
s.style.width=(r-5)+"px";
s.style.height=t+"px";
s.style.overflow="auto";
s.style.background="white";
return this
};
AttachContactsTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this._searchContacts({
query:this._currentQuery,offset:this._offset,limit:this._limit,callback:o}
)
};
AttachContactsTabView.prototype._searchContacts=function(e){
var t={
SearchRequest:{
_jsns:"urn:zimbraMail"}};
t.SearchRequest.query=e.query+" not #type:group";
t.SearchRequest.types="contact";
t.SearchRequest.limit=e.limit;
t.SearchRequest.offset=e.offset;
t.SearchRequest.fetch="1";
e.response=appCtxt.getAppController().sendRequest({
jsonObj:t,noBusyOverlay:false}
);
this.showResultContents(e)
};
function com_zimbra_webex_HandlerObject(){}
com_zimbra_webex_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_webex_HandlerObject.prototype.constructor=com_zimbra_webex_HandlerObject;
var WebExZimlet=com_zimbra_webex_HandlerObject;
WebExZimlet.PROP_USERNAME={
propId:"webexZimlet_username",label:"WebExZimlet_userName",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_PASSWORD={
propId:"webexZimlet_pwd",label:"WebExZimlet_password",defaultVal:"",extraLabel:"",objType:"password"};
WebExZimlet.PROP_COMPANY_ID={
propId:"webexZimlet_companyId",label:"WebExZimlet_companyId",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_ALT_HOSTS={
propId:"WebExZimlet_altHosts",label:"WebExZimlet_altHosts",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_ASSOCIATED_CALENDAR={
propId:"webexZimlet_AssociatedCalendar",label:"WebExZimlet_useThisAccountFor",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_MEETING_PASSWORD={
propId:"webexZimlet_meetingPwd",label:"WebExZimlet_meetingPwd",defaultVal:"",extraLabel:"WebExZimlet_optional"};
WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER={
propId:"webexZimlet_tollFreePH",label:"WebExZimlet_tollFreeNumber",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_TOLL_PHONE_NUMBER={
propId:"webexZimlet_tollPH",label:"WebExZimlet_tollNumber",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_OTHER_PHONE_NUMBERS={
propId:"webexZimlet_otherPH",label:"WebExZimlet_otherPhoneNumbers",defaultVal:"",extraLabel:""};
WebExZimlet.PROP_PHONE_PASSCODE={
propId:"webexZimlet_phonePasscode",label:"WebExZimlet_phonePasscode",defaultVal:"",extraLabel:"WebExZimlet_digitsOnly"};
WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS=[WebExZimlet.PROP_USERNAME,WebExZimlet.PROP_PASSWORD,WebExZimlet.PROP_COMPANY_ID,WebExZimlet.PROP_MEETING_PASSWORD,WebExZimlet.PROP_ALT_HOSTS];
WebExZimlet.WEBEX_TELECONF_PROPS=[WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_TOLL_PHONE_NUMBER,WebExZimlet.PROP_OTHER_PHONE_NUMBERS,WebExZimlet.PROP_PHONE_PASSCODE];
WebExZimlet.ALL_ACCNT_PROPS=[WebExZimlet.PROP_USERNAME,WebExZimlet.PROP_PASSWORD,WebExZimlet.PROP_COMPANY_ID,WebExZimlet.PROP_MEETING_PASSWORD,WebExZimlet.PROP_ASSOCIATED_CALENDAR,WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_TOLL_PHONE_NUMBER,WebExZimlet.PROP_OTHER_PHONE_NUMBERS,WebExZimlet.PROP_PHONE_PASSCODE,WebExZimlet.PROP_ALT_HOSTS];
WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD={
propId:"webexZimlet_appendWebexMeetingPassword",label:"WebExZimlet_appendMeetingPwd",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER={
propId:"webexZimlet_appendTollFreeConfNumber",label:"WebExZimlet_appendToolFreeNumber",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER={
propId:"webexZimlet_appendTollConfNumber",label:"WebExZimlet_appendTollConfNumber",defaultVal:"NONE",extraLabel:""};
WebExZimlet.PROP_APPEND_PHONE_PASSCODE={
propId:"webexZimlet_appendPhonePasscode",label:"WebExZimlet_appendPhonePasscode",defaultVal:"NONE",extraLabel:""};
WebExZimlet.APPEND_SUB_OPTIONS=[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD,WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER,WebExZimlet.PROP_APPEND_PHONE_PASSCODE];
WebExZimlet.ALL_GENERAL_PROPS=[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD,WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER,WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER,WebExZimlet.PROP_APPEND_PHONE_PASSCODE];
WebExZimlet.WebExToZimbraTZIDMap={
"Etc/GMT+12":"0","Pacific/Midway":"1","Pacific/Honolulu":"2","America/Anchorage":"3","America/Los_Angeles":"4","America/Tijuana":"4","America/Phoenix":"5","America/Chihuahua":"6","America/Denver":"6","America/Chicago":"7","America/Guatemala":"7","America/Mexico_City":"8","America/Regina":"9","America/Bogota":"10","America/New_York":"11","America/Indiana/Indianapolis":"12","America/Halifax":"13","America/Guyana":"13","America/La_Paz":"13","America/Manaus":"13","America/Santiago":"13","America/Caracas":"14","America/St_Johns":"15","America/Sao_Paulo":"16","America/Argentina/Buenos_Aires":"17","America/Godthab":"17","America/Montevideo":"17","Atlantic/South_Georgia":"18","Atlantic/Azores":"19","Atlantic/Cape_Verde":"19","Africa/Casablanca":"20","Africa/Monrovia":"20","Europe/London":"21","Africa/Algiers":"21","Africa/Windhoek":"22","Europe/Belgrade":"22","Europe/Warsaw":"22","Europe/Brussels":"23","Europe/Berlin":"25","Europe/Athens":"26","Africa/Cairo":"28","Africa/Harare":"29","Asia/Amman":"29","Asia/Beirut":"29","Europe/Helsinki":"30","Europe/Minsk":"30","Asia/Jerusalem":"31","Asia/Baghdad":"32","Europe/Moscow":"33","Africa/Nairobi":"34","Asia/Kuwait":"35","Asia/Tehran":"35","Asia/Muscat":"36","Asia/Baku":"37","Asia/Tbilisi":"37","Asia/Yerevan":"37","Asia/Kabul":"38","Asia/Tashkent":"39","Asia/Yekaterinburg":"39","Asia/Karachi":"40","Asia/Kolkata":"41","Asia/Colombo":"42","Asia/Dhaka":"42","Asia/Novosibirsk":"43","Asia/Rangoon":"43","Asia/Bangkok":"44","Asia/Krasnoyarsk":"44","Asia/Hong_Kong":"45","Asia/Irkutsk":"45","Australia/Perth":"46","Asia/Kuala_Lumpur":"47","Asia/Taipei":"48","Asia/Tokyo":"49","Asia/Seoul":"50","Asia/Yakutsk":"51","Australia/Adelaide":"52","Australia/Darwin":"53","Asia/Vladivostok":"54","Australia/Brisbane":"54","Australia/Sydney":"55","Pacific/Guam":"56","Australia/Hobart":"57","Asia/Magadan":"59","Pacific/Auckland":"60","Pacific/Fiji":"61","Pacific/Tongatapu":"61"};
WebExZimlet.WEEK_NAME_MAP={
MO:"MONDAY",TU:"TUESDAY",WE:"WEDNESDAY",TH:"THURSDAY",FR:"FRIDAY",SA:"SATURDAY",SU:"SUNDAY"};
WebExZimlet.prototype.init=function(){
this.metaData=appCtxt.getActiveAccount().metaData;
WebExZimlet.PROP_COMPANY_ID.defaultVal=this.getUserProperty("webexZimlet_companyId")
};
WebExZimlet.prototype.initializeToolbar=function(h,s,o,t){
var e=appCtxt.getViewTypeFromId(t);
if(e==ZmId.VIEW_APPOINTMENT){
this._initCalendarWebexToolbar(s,o)
}else{
if(e==ZmId.VIEW_CONVLIST||e==ZmId.VIEW_CONV||e==ZmId.VIEW_TRAD||e==ZmId.VIEW_CONTACT_SIMPLE||e==ZmId.VIEW_CAL_DAY){
var l=s.getOp(ZmId.OP_ACTIONS_MENU);
if(l){
var r=l.getMenu();
if(r){
if(r.getMenuItem("WEBEX_ZIMLET_START_QUICK_MEETING")){
return
}
var n=r.createMenuItem("WEBEX_ZIMLET_START_QUICK_MEETING",{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_startQuickWebExMeeting")}
);
n.addSelectionListener(new AjxListener(this,this._handleQuickMeetingMenuClick,o))
}}}}};
WebExZimlet.prototype._handleQuickMeetingMenuClick=function(e){
var t=e.getSelection();
if(!t instanceof Array){
this._showOneClickDlg("");
return
}
var o=t[0].type;
var n;
var s=[];
if(o==ZmId.ITEM_CONV){
n=t[0].getFirstHotMsg();
s=n.getEmails().getArray()
}else{
if(o==ZmId.ITEM_MSG){
n=t[0];
s=n.getEmails().getArray()
}else{
if(o==ZmId.ITEM_CONTACT){
s=this._getEmailsFromContacts(t)
}}}
var s=s instanceof Array?s.join(";"):"";
this._showOneClickDlg(s)
};
WebExZimlet.prototype.onAppointmentDelete=function(o){
if(!(o instanceof ZmAppt)){
for(var t in o){
var e=o[t][0];
if(e){
o=e;
break
}}}
this._appt=o;
if(this._appt.id.indexOf(":")>0){
return
}
var n;
if(o.viewMode!=ZmCalItem.MODE_DELETE_INSTANCE){
n=new AjxCallback(this,this._doDeleteWebExAppt)
}else{
n=new AjxCallback(this,this._showDeleteWebExApptYesNoDlg)
}
this._getApptIdsHashMetaData(o.id,n)
};
WebExZimlet.prototype._showDeleteWebExApptYesNoDlg=function(e){
if(!e||!e.meetingKey){
return
}
var t=appCtxt.getYesNoMsgDialog();
t.registerCallback(DwtDialog.YES_BUTTON,this._deleteYesButtonClicked,this,[t,e]);
t.registerCallback(DwtDialog.NO_BUTTON,this._deleteNoButtonClicked,this,t);
t.setMessage(this.getMessage("WebExZimlet_entireSeriesWillBeDeleted"),DwtMessageDialog.WARNING_STYLE);
t.popup()
};
WebExZimlet.prototype._deleteYesButtonClicked=function(t,e){
t.popdown();
this._doDeleteWebExAppt(e)
};
WebExZimlet.prototype._doDeleteWebExAppt=function(s){
var t="";
if(!s||!s.meetingKey){
return
}
t=s.meetingKey;
if(this._appt.viewMode==ZmCalItem.MODE_DELETE||this._appt.viewMode==ZmCalItem.MODE_DELETE_INSTANCE){
if(s.exceptionMeetingKey){
t=s.exceptionMeetingKey
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.DelMeeting">',"<meetingKey>",t,"</meetingKey>","</bodyContent>"].join("");
var o=this.newWebExRequest(n,s);
var e=AjxRpc.invoke(o,this.postUri(s),{
"Content-Type":"text/xml"}
,null,false,false);
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,this.getMessage("WebExZimlet_unableToDeleteWebExAppt"))){
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_meetingWasDeleted"),ZmStatusView.LEVEL_INFO)
};
WebExZimlet.prototype._deleteNoButtonClicked=function(e){
e.popdown()
};
WebExZimlet.prototype._initCalendarWebexToolbar=function(n,e){
if(!n.getButton("SAVE_AS_WEBEX")){
ZmMsg.sforceAdd=this.getMessage("WebExZimlet_saveAsWebEx");
var s=n.opList.length+1;
var o=n.createOp("SAVE_AS_WEBEX",{
image:"WEBEX-panelIcon",text:"WebEx",tooltip:this.getMessage("WebExZimlet_savesThisApptAsWebEx"),index:s}
);
n.addOp("SAVE_AS_WEBEX",s);
this._composerCtrl=e;
this._composerCtrl._webexZimlet=this;
var r=new ZmPopupMenu(o);
o.setMenu(r);
o.noMenuBar=true;
o.removeAllListeners();
o.removeDropDownSelectionListener();
var t=r.createMenuItem(Dwt.getNextId(),{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_insertWebExDetails")}
);
t.addSelectionListener(new AjxListener(this._composerCtrl,this._saveAsWebExHandler,true));
var t=r.createMenuItem(Dwt.getNextId(),{
image:"WEBEX-panelIcon",text:this.getMessage("WebExZimlet_insertWebExDetailsAndSendAppointment")}
);
t.addSelectionListener(new AjxListener(this._composerCtrl,this._saveAsWebExHandler,false))
}};
WebExZimlet.prototype._saveAsWebExHandler=function(o){
try{
if(this._composeView.isValid()){
var n=this._composeView.getAppt();
var t=n.viewMode;
var s={
apptController:this,apptComposeView:this._composeView,appt:n,dontSaveMeeting:o};
if(t!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE&&t!=ZmCalItem.MODE_EDIT&&t!=ZmCalItem.MODE_EDIT_SERIES){
this._webexZimlet._doSaveWebExAppt(s)
}else{
var r=new AjxCallback(this._webexZimlet,this._webexZimlet._checkIfItsWebExUpdate,s);
this._webexZimlet._getApptIdsHashMetaData(n.id,r)
}}}
catch(e){
this._webexZimlet._showErrorMessage(e);
return
}};
WebExZimlet.prototype._checkIfItsWebExUpdate=function(t,e){
if(!e){
this._doSaveWebExAppt(t)
}else{
if(e&&e.meetingKey){
t.webExKeyData=e;
this._showUpdateWebExApptYesNoDlg(t)
}}};
WebExZimlet.prototype._showUpdateWebExApptYesNoDlg=function(t){
var e=appCtxt.getYesNoMsgDialog();
e.registerCallback(DwtDialog.YES_BUTTON,this._updateYesButtonClicked,this,[e,t]);
e.registerCallback(DwtDialog.NO_BUTTON,this._updateNoButtonClicked,this,e);
e.setMessage(this.getMessage("WebExZimlet_modifyApptAvoidDuplicateInfoWarning"),DwtMessageDialog.WARNING_STYLE);
e.popup()
};
WebExZimlet.prototype._updateYesButtonClicked=function(t,e){
t.popdown();
this._doSaveWebExAppt(e)
};
WebExZimlet.prototype._updateNoButtonClicked=function(e){
e.popdown()
};
WebExZimlet.prototype._doSaveWebExAppt=function(e){
var t=new AjxCallback(this,this._doCreateOrUpdateMeeting,e);
this._showSelectAccountDlg({
postCallback:t,appt:e.appt,showOptions:true}
)
};
WebExZimlet.prototype._doCreateOrUpdateMeeting=function(t,e){
t.manuallySelectedAccount=e;
var o=new AjxCallback(this,this._createOrUpdateMeeting,t);
this._getGeneralPrefsMetaData(o)
};
WebExZimlet.prototype._createOrUpdateMeeting=function(s){
var h={};
var o=s.appt;
try{
if(s.manuallySelectedAccount){
this._setCurrentAccntInfoFromAccntNumber(s.manuallySelectedAccount)
}else{
this._setCurrentAccntInfoFromCalendar(o.folderId)
}}
catch(t){
this._showErrorMessage(t);
return
}
h.subject=o.name;
h.loc=AjxStringUtil.urlComponentEncode(o.location);
h.emails=s.emails=o.getAttendees(ZmCalBaseItem.PERSON);
h.duration=(o.endDate.getTime()-o.startDate.getTime())/60000;
h.timeZoneID=WebExZimlet.WebExToZimbraTZIDMap[o.timezone];
h.pwd=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
h.recurrence=this._getRecurrenceString(o);
var e=o.startDate;
h.formattedStartDate=this._formatDate(e);
var n=null;
if(s.webExKeyData&&s.webExKeyData.meetingKey){
n=s.webExKeyData.meetingKey
}
if(o.viewMode!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
h.meetingKey=n
}else{
if(n){
s.seriesMeetingKey=n
}}
var r=new AjxCallback(this,this._createOrUpdateMeetingResponseHdlr,s);
this._getCreateOrModifyMeetingRequest(h,r)
};
WebExZimlet.prototype._getRecurrenceString=function(t){
var l=t.getRecurrence();
var b=l.repeatType;
if(b=="NON"||t.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
return""
}
var y=l.repeatEndCount;
var u=l.repeatEndDate;
var o="";
if(y>1){
o=["<afterMeetingNumber>",y,"</afterMeetingNumber>"].join("")
}else{
if(u){
u=[(u.getMonth()+1),"/",u.getDate(),"/",u.getFullYear()," 00:00:00"].join("");
o=["<expirationDate>",u,"</expirationDate>"].join("")
}}
var p="";
if(b=="WEE"){
var n=l.repeatWeeklyDays;
var g=this._getDayInWeekStr(n,t);
p=["<repeat><repeatType>WEEKLY</repeatType>",g,o,"</repeat>"].join("")
}else{
if(b=="MON"){
var f="";
var h="";
var g="";
var d=l.repeatCustomMonthDay?[l.repeatCustomMonthDay]:l.repeatMonthlyDayList;
var m="";
if(l.repeatBySetPos!="1"){
h=["<weekInMonth>",l.repeatBySetPos,"</weekInMonth>"].join("");
var n=l.repeatCustomDays?l.repeatCustomDays:l.repeatWeeklyDays;
g=this._getDayInWeekStr(n,t);
m=h+g
}else{
if(d.length>0){
f=["<dayInMonth>",d[0],"</dayInMonth>"].join("");
m=f
}}
var e=["<interval>",l.repeatCustomCount,"</interval>"].join("");
p=["<repeat><repeatType>MONTHLY</repeatType>",m,e,o,"</repeat>"].join("")
}else{
if(b=="YEA"){
var f="";
var m="";
var g="";
var r="";
var d=l.repeatCustomMonthDay?[l.repeatCustomMonthDay]:l.repeatMonthlyDayList;
if(l.repeatBySetPos!="1"){
r=["<weekInMonth>",l.repeatBySetPos,"</weekInMonth>"].join("");
var n=l.repeatCustomDays?l.repeatCustomDays:l.repeatWeeklyDays;
g=this._getDayInWeekStr(n,t);
var s=["<monthInYear>",l.repeatYearlyMonthsList,"</monthInYear>"].join("");
m=r+g+s
}else{
f=["<dayInMonth>",d[0],"</dayInMonth>"].join("");
var s=["<monthInYear>",l.repeatYearlyMonthsList,"</monthInYear>"].join("");
m=f+s
}
p=["<repeat><repeatType>YEARLY</repeatType>",m,o,"</repeat>"].join("")
}else{
if(b=="DAI"){
var m="";
if(!l.repeatWeekday){
var m=["<interval>",l.repeatCustomCount,"</interval>"].join("")
}else{
var n=["MO","TU","WE","TH","FR"];
m=this._getDayInWeekStr(n,t)
}
p=["<repeat><repeatType>DAILY</repeatType>",m,o,"</repeat>"].join("")
}}}}
return p
};
WebExZimlet.prototype._getDayInWeekStr=function(n,s){
var e=[];
e.push("<dayInWeek>");
if(n.length>0){
for(var o=0;
o<n.length;
o++){
e.push("<day>",WebExZimlet.WEEK_NAME_MAP[n[o]],"</day>")
}}else{
var t=ZmCalItem.SERVER_WEEK_DAYS[s.startDate.getDay()];
e.push("<day>",WebExZimlet.WEEK_NAME_MAP[t],"</day>")
}
e.push("</dayInWeek>");
return e.join("")
};
WebExZimlet.prototype._getCreateAttendeesRequest=function(t){
var h=t.emails;
var s=t.meetingKey;
var u=[];
var n=0;
for(var r=0;
r<h.length;
r++){
var m=h[r];
var l=m.getEmail?m.getEmail():(m.getAddress?m.getAddress():"");
if(l==""||l==undefined){
continue
}
var d=m.getFullName?m.getFullName():(m.getDispName?m.getDispName():"");
if(r!=0){
u[n++]="<attendees>"
}
u[n++]=["<person><email>",l,"</email>"].join("");
if(d!=""&&d!=undefined){
u[n++]=["<name>",d,"</name>"].join("")
}
u[n++]="</person>";
u[n++]="<joinStatus>INVITE</joinStatus>";
u[n++]=["<sessionKey>",s,"</sessionKey>"].join("");
if(r!=0){
u[n++]="</attendees>"
}}
var o=['<bodyContent xsi:type="java:com.webex.service.binding.attendee.CreateMeetingAttendee">',u.join(""),"</bodyContent>"].join("");
return this.newWebExRequest(o)
};
WebExZimlet.prototype._getCreateOrModifyMeetingRequest=function(A,s){
var p=A.emails;
var B=A.meetingKey;
var l=A.pwd;
var r=A.subject;
var f=A.loc;
var n=A.formattedStartDate;
var t=A.duration;
var g=A.timeZoneID;
var m=A.recurrence?A.recurrence:"";
var b=A.sendWebExEmail;
var w=[];
if(b){
var q=0;
for(var z=0;
z<p.length;
z++){
var W=p[z];
var O=W.getEmail?W.getEmail():(W.getAddress?W.getAddress():"");
if(O==""||O==undefined){
continue
}
var u=W.getFullName?W.getFullName():(W.getDispName?W.getDispName():"");
w[q++]=["<attendee><person><email>",O,"</email>"].join("");
if(u!=""&&u!=undefined){
w[q++]=["<name>",u,"</name>"].join("")
}
w[q++]="</person></attendee>"
}}
var d=this._currentWebExAccount.WebExZimlet_altHosts;
if(this._showSelectAccntsDlg){
if(document.getElementById(this._showSelectAccntsDlg._altHostFieldId)&&this._showSelectAccntsDlg._showOptions){
d=document.getElementById(this._showSelectAccntsDlg._altHostFieldId).value
}
if(document.getElementById(this._showSelectAccntsDlg._mPwdFieldId)){
l=document.getElementById(this._showSelectAccntsDlg._mPwdFieldId).value
}}
if(d!=""&&d!="N/A"&&d.indexOf(";")>0){
d=d.split(";")
}else{
if(d!=""&&d!="N/A"&&d.indexOf(",")>0){
d=d.split(",")
}else{
if(d!=""&&d.indexOf("@")>0){
d=[d]
}}}
var y=[];
if(d instanceof Array){
for(var z=0;
z<d.length;
z++){
var O=d[z];
y.push("<attendee><person><email>",O,"</email></person><role>HOST</role></attendee>")
}}
var v,T;
if(B){
v="java:com.webex.service.binding.meeting.SetMeeting";
T=["<meetingkey>",B,"</meetingkey>"].join("")
}else{
v="java:com.webex.service.binding.meeting.CreateMeeting";
T=""
}
if(!l||l==""||l=="N/A"||l=="null"){
var o=""
}else{
var o=["<accessControl><meetingPassword>",l,"</meetingPassword></accessControl>"].join("")
}
var x="";
x="<attendeeOptions><emailInvitations>TRUE</emailInvitations></attendeeOptions>";
var h=['<bodyContent xsi:type="',v,'">',o,"<metaData><sessionTemplate><default>true</default></sessionTemplate><confName>",AjxStringUtil.xmlEncode(r),"</confName>","<location>",f,"</location></metaData>","<participants><attendees>",w.join(""),y.join(""),"</attendees></participants>","<schedule>","<startDate>",n,"</startDate>","<duration>",t,"</duration>","<timeZoneID>",g,"</timeZoneID></schedule>","<telephony><telephonySupport>@callintype@</telephonySupport>","<enableTSP>@tspEnabled@</enableTSP>","@tspAccountIndex@","<extTelephonyDescription>",this._getWebExBodyString(null,"FIELD",true,true),"</extTelephonyDescription></telephony>",x,T,m,"</bodyContent>"].join("");
this._getTspAccount(h,s)
};
WebExZimlet.prototype._getTspAccount=function(t,n){
var e='<bodyContent xsi:type="java:com.webex.service.binding.user.GetUser"><webExId>'+this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId]+"</webExId></bodyContent>";
var o=this.newWebExRequest(e);
AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleTspAccountEnabled,[t,n]),false,false)
};
WebExZimlet.prototype._handleTspAccountEnabled=function(s,l,d){
var r=false;
var o=1;
var t=this.xmlToObject(d);
if(AjxUtil.get(t,"header","response","result")=="SUCCESS"){
var n=AjxUtil.get(t,"body","bodyContent","tspAccount","tspAccount","accountIndex");
if(n){
r=true;
o=parseInt(n.toString())
}}
var h=r?"CALLIN":"OTHER";
var e=r?"<tspAccountIndex>"+o+"</tspAccountIndex>":"";
s=s.replace("@callintype@",h);
s=s.replace("@tspAccountIndex@",e);
s=s.replace("@tspEnabled@",r);
s=this.newWebExRequest(s);
AjxRpc.invoke(s,this.postUri(),{
"Content-Type":"text/xml"}
,l,false,false)
};
WebExZimlet.prototype._createOrUpdateMeetingResponseHdlr=function(r,e){
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_unableToCreateOrModifyMeeting"))){
return
}
var s;
if(l.body.bodyContent.meetingkey){
s=l.body.bodyContent.meetingkey.toString()
}else{
if(r.webExKeyData&&r.webExKeyData.meetingKey){
s=r.webExKeyData.meetingKey
}}
if(!s){
this.displayErrorMessage(this.getMessage("WebExZimlet_webExDidntReturnMeetingKey"),this.getMessage("WebExZimlet_webExError"));
return
}
var h=r.emails;
if(h&&(h instanceof Array)&&h.length>0){
var o=this._getCreateAttendeesRequest({
emails:r.emails,meetingKey:s}
);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_couldNotRegisterAttendees"))){
return
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GetjoinurlMeeting">',"<meetingKey>",s,"</meetingKey>","</bodyContent>"].join("");
var o=this.newWebExRequest(n);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var l=this.xmlToObject(e);
if(!this._validateWebExResult(l,this.getMessage("WebExZimlet_couldNotGetJoinMeetingUrl"))){
return
}
var t=l.body.bodyContent.joinMeetingURL.toString();
r.joinMeetingUrl=t;
r.meetingKey=s;
this._params=r;
this._appt=r.appt;
this._updateMeetingBodyAndSave(r)
};
WebExZimlet.prototype.onSaveApptSuccess=function(o,t,e){
if(!this._params){
return
}
var n=t.name.indexOf(this._appt.name);
if(this._appt.name!=t.name&&(n==-1||n>0)){
return
}
this._saveApptIdsHashToServer(e.apptId,this._params.meetingKey,this._params.seriesMeetingKey);
this._params=null
};
WebExZimlet.prototype._updateMeetingBodyAndSave=function(n){
var h=n.apptComposeView;
var t="HTML";
if(h.getComposeMode()!="text/html"){
t="PLAIN_TEXT"
}
var l=this._getWebExBodyString(n.joinMeetingUrl,t);
var d=h.getHtmlEditor().getContent();
if(t=="HTML"){
var s=d.lastIndexOf("</body></html>");
var r=d.substr(0,s);
var u=[r,l,"</body></html>"].join("")
}else{
var u=[d,l].join("")
}
if(this._appendToSubjectOrLocation("SUBJECT")){
var m=this._getAddionalStringToAppend("SUBJECT");
if(m!=""){
var e=h._apptEditView._subjectField;
var o=[e.getValue()," [",m,"]"].join("");
e.setValue(o)
}}
if(this._appendToSubjectOrLocation("LOCATION")){
var m=this._getAddionalStringToAppend("LOCATION");
if(m!=""){
var f=h._apptEditView._attInputField[ZmCalBaseItem.LOCATION];
var o=[f.getValue()," [",m,"]"].join("");
f.setValue(o)
}}
h.getHtmlEditor().setContent(u);
if(!n.dontSaveMeeting){
setTimeout(AjxCallback.simpleClosure(this._saveAppt,this,n.apptController),500)
}else{
this._showModifyAlertDialog()
}};
WebExZimlet.prototype._showModifyAlertDialog=function(){
if(!this._modifyAlertDlg){
this._modifyAlertDlg=new DwtMessageDialog({
parent:this.getShell(),buttons:[DwtDialog.OK_BUTTON]}
);
this._modifyAlertDlg.setMessage(this.getMessage("modifyAlertNotice"))
}
this._modifyAlertDlg.popup()
};
WebExZimlet.prototype._saveAppt=function(e){
if(e._sendListener){
e._sendListener()
}else{
if(e._saveListener){
e._saveListener()
}}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_successfullyCreatedWebEx"),ZmStatusView.LEVEL_INFO);
this._showModifyAlertDialog()
};
WebExZimlet.prototype._appendToSubjectOrLocation=function(t){
if(!this._webexZimletGeneralPreferences){
false
}
for(var e in this._webexZimletGeneralPreferences){
if(this._webexZimletGeneralPreferences[e]=="BOTH"||this._webexZimletGeneralPreferences[e]==t){
return true
}}
return false
};
WebExZimlet.prototype._getAddionalStringToAppend=function(t){
if(this._webexZimletGeneralPreferences==undefined){
return""
}
var n=[];
var e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_WEBEX_MEETING_PWD.propId];
var o=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_meetingPwd")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_TOLL_FREE_PHONE_NUMBER.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_TOLL_FREE_PHONE_NUMBER.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_tollFreeNumber")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_TOLL_PHONE_NUMBER.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_TOLL_PHONE_NUMBER.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_tollNumber")," ",o].join(""))
}
e=this._webexZimletGeneralPreferences[WebExZimlet.PROP_APPEND_PHONE_PASSCODE.propId];
o=this._currentWebExAccount[WebExZimlet.PROP_PHONE_PASSCODE.propId];
if((o!=""&&o!="N/A")&&(e=="BOTH"||e==t)){
n.push([this.getMessage("WebExZimlet_phonePasscode")," ",o].join(""))
}
return n.join(", ")
};
WebExZimlet.prototype._getWebExBodyString=function(m,e,d,o){
var l=[];
l.push(o?"":this._getMeetingDetailshdr(this.getMessage("WebExZimlet_teleconferenceDetails"),e));
if(e=="HTML"){
l.push("<table width='94%' align='center'><tr><td>");
l.push("<div style='border-bottom:1px solid #6E6E6E; border-right:1px solid #6E6E6E; border-left:1px solid #CECECE;'>");
l.push("<table width='100%' class='ZPropertySheet' cellspacing='6'>")
}
var p=true;
var t=false;
for(var h=0;
h<WebExZimlet.WEBEX_TELECONF_PROPS.length;
h++){
var r=WebExZimlet.WEBEX_TELECONF_PROPS[h];
var n=this._currentWebExAccount[r.propId];
if(n==""||n=="N/A"){
continue
}
if(h==WebExZimlet.WEBEX_TELECONF_PROPS.length-1){
l.push(this._getMeetingDetailsRow(this.getMessage(r.label),n,e,true,p))
}else{
l.push(this._getMeetingDetailsRow(this.getMessage(r.label),n,e,false,p))
}
p=!p;
t=true
}
if(e=="HTML"){
l.push("</table>");
l.push("</div>");
l.push("</td></tr></table>")
}
var s=t?l.join(""):"";
if(d){
return s
}
var u=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
if(u==""||u=="N/A"){
u=this.getMessage("WebExZimlet_passwordNotRequired")
}
var l=[];
l.push(o?"":this._getMeetingDetailshdr(this.getMessage("WebExZimlet_webExDetails"),e));
if(e=="HTML"){
l.push("<table width='94%' align='center'><tr><td>");
l.push("<div style='border-bottom:1px solid #6E6E6E; border-right:1px solid #6E6E6E; border-left:1px solid #CECECE;'>");
l.push("<table width='100%' class='ZPropertySheet' cellspacing='6'>")
}
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_webExUrl"),m,e,false,true));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_userName"),this.getMessage("WebExZimlet_enterYourName"),e,false,false));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_email"),this.getMessage("WebExZimlet_enterYourEmail"),e,false,true));
l.push(this._getMeetingDetailsRow(this.getMessage("WebExZimlet_meetingPwd"),u,e,true,false));
if(e=="HTML"){
l.push("</table>");
l.push("</div>");
l.push("</td></tr></table>")
}
var f=l.join("");
return f+s
};
WebExZimlet.prototype._getMeetingDetailsRow=function(t,r,e,n,h){
if(r==""||r=="N/A"){
return
}
var o="";
if(e=="PLAIN_TEXT"){
o="\n"
}else{
if(e=="FIELD"){
o=" | "
}}
if(e=="HTML"){
r=r.replace(/\n/g,"<br/>");
var s=!h?" style='background-color:#FBF9F4' ":" style='background-color:#FEFDFC' ";
return["<tr ",s,"><td width='20%'><b>",t,"</b> </td><td> ",r,"</td></tr>"].join("")
}else{
if(n){
return[t,r].join("")
}else{
r=r.replace(/\n/g,o);
return[t," ",r,o].join("")
}}};
WebExZimlet.prototype._getMeetingDetailshdr=function(t,e){
if(e=="HTML"){
return["<br/>","<table width='94%' align='center'><tr><td>","<div style='background:#808080;border-bottom:1px solid #6E6E6E;border-right:1px solid #6E6E6E;font-weight:bold;color:white;padding:2px;'>","<b>",t,"</b>","</div>","</tr></td></table>"].join("")
}else{
return["\n--------------------------------------------------------------------",,"\n",t,"\n--------------------------------------------------------------------\n"].join("")
}};
WebExZimlet.prototype._formatDate=function(t){
t.setMinutes((Math.ceil(t.getMinutes()/15)*15)%60);
t.setSeconds(0);
t.setMilliseconds(0);
var e=new AjxDateFormat("MM/dd/yyyy HH:mm:ss");
return e.format(t)
};
WebExZimlet.prototype.postUri=function(e){
var t=e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
return ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(["https://",t,".webex.com/WBXService/XMLService"].join(""))
};
WebExZimlet.prototype.singleClicked=function(){
this._displayGeneralPrefsDlg()
};
WebExZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
WebExZimlet.prototype.menuItemSelected=function(e){
switch(e){
case"ACCOUNT_PREFERENCES":this._displayAccntPrefsDialog();
break;
case"GENERAL_PREFERENCES":this._displayGeneralPrefsDlg();
break;
case"START_JOIN_MEETING":var t=new AjxCallback(this,this._showAppointmentsList);
this._showSelectAccountDlg({
postCallback:t,appt:null,showOptions:false}
);
break;
case"START_QUICK_MEETING":this._showOneClickDlg();
break
}};
WebExZimlet.prototype.xmlToObject=function(t){
var n=null;
try{
var e=null;
if(t.xml&&t.xml.childNodes.length>0){
e=new AjxXmlDoc.createFromDom(t.xml)
}else{
e=new AjxXmlDoc.createFromXml(t.text)
}
n=e.toJSObject(true,false)
}
catch(o){
this.displayErrorMessage(this.getMessage("WebExZimlet_errorInWebExXml"),t.text,this.getMessage("WebExZimlet_webExError"));
return null
}
if(t.text&&t.text.length>5&&t.text.substring(0,6).toLowerCase()=="<html>"){
n=null;
this.displayErrorMessage(this.getMessage("WebExZimlet_errorInWebExXml"),t.text,this.getMessage("WebExZimlet_webExError"))
}
return n
};
WebExZimlet.prototype.newWebExRequest=function(t,e){
return['<?xml version="1.0" encoding="UTF-8"?>','<serv:message xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ','xmlns:serv="http://www.webex.com/schemas/2002/06/service" ','xmlns:schemaLocation="http://www.webex.com/schemas/2002/06/service http://www.webex.com/schemas/2002/06/service/service.xsd">',"<header>",this.newSecurityContext(e),"</header>","<body>",t,"</body>","</serv:message>"].join("")
};
WebExZimlet.prototype.newSecurityContext=function(e){
var o=e?e.hostName:this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
var n=e?e.hostPwd:this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
var t=e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
return["<securityContext>","<webExID>",o,"</webExID>","<password>",AjxStringUtil.htmlEncode(n),"</password>","<siteName>",t,"</siteName>","</securityContext>"].join("")
};
WebExZimlet.prototype.getCompanyId=function(e){
return e?e.companyId:this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId]
};
WebExZimlet.prototype._displayAccntPrefsDialog=function(){
if(this.accPrefsDlg){
this.accPrefsDlg.popup();
this._addAccntPrefsTabControl();
return
}
this._accPrefsDlgView=new DwtComposite(this.getShell());
this._accPrefsDlgView.setSize("530","400");
this._accPrefsDlgView.getHtmlElement().style.overflow="auto";
this._accPrefsDlgView.getHtmlElement().innerHTML=this._createAccPrefsView();
this.accPrefsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_manageAccounts"),view:this._accPrefsDlgView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.accPrefsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._accPrefsOkBtnListner));
this._addTestAccountButtons();
this._addHelpLinkListeners();
var e=new AjxCallback(this,this._setDataToAccPrefsDlg);
this._getAccPrefsMetaData(e)
};
WebExZimlet.prototype._addAccntPrefsTabControl=function(){
this.accPrefsDlg._tabGroup.removeAllMembers();
for(var e=0;
e<this._accntPrefsObjsHash.length;
e++){
var t=document.getElementById(this._accntPrefsObjsHash[e]);
if(t){
this.accPrefsDlg._tabGroup.addMember(t)
}}
document.getElementById(this._accntPrefsObjsHash[0]).focus()
};
WebExZimlet.prototype._addHelpLinkListeners=function(){
for(var e=0;
e<this._accntPrefsHelpObjsHash.length;
e++){
var t=this._accntPrefsHelpObjsHash[e];
document.getElementById(t.helpLinkId).onclick=AjxCallback.simpleClosure(this._accPrefsShowHelpdialog,this,t.propId)
}};
WebExZimlet.prototype._accPrefsShowHelpdialog=function(e){
var o="";
if(e==WebExZimlet.PROP_ALT_HOSTS.propId){
var o=this.getMessage("WebExZimlet_setupAlternateHost")
}else{
if(e==WebExZimlet.PROP_COMPANY_ID.propId){
var o=this.getMessage("WebExZimlet_companyIdExample")
}}
var t=appCtxt.getMsgDialog();
t.reset();
t.setMessage(o,DwtMessageDialog.INFO_STYLE);
t.popup()
};
WebExZimlet.prototype._addTestAccountButtons=function(){
for(var t=1;
t<6;
t++){
var e=new DwtButton({
parent:this.getShell()}
);
e.setText(AjxMessageFormat.format(this.getMessage("WebExZimlet_validateWebExAccntNumber"),t));
e.setImage("WEBEX-panelIcon");
e.addSelectionListener(new AjxListener(this,this._testWebExAccount,[t]));
document.getElementById("webExZimlet_TestAccountBtn"+t).appendChild(e.getHtmlElement())
}};
WebExZimlet.prototype._getAccPrefsMetaData=function(e){
setTimeout(AjxCallback.simpleClosure(this._doGetAccPrefsMetaData,this,e),500)
};
WebExZimlet.prototype._doGetAccPrefsMetaData=function(e){
this.metaData.get("webexZimletAccountPreferences",null,new AjxCallback(this,this._handleGetAccPrefsMetaData,e))
};
WebExZimlet.prototype._handleGetAccPrefsMetaData=function(o,e){
this._webexZimletAccountPreferences=null;
try{
this._webexZimletAccountPreferences=e.getResponse().BatchResponse.GetMailboxMetadataResponse[0].meta[0]._attrs;
if(o){
o.run(this)
}else{
return this._webexZimletAccountPreferences
}}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._setCurrentAccntInfoFromCalendar=function(n){
var o=this._getAccountNumberFromFolderId(n);
this._currentWebExAccount=[];
for(var e=0;
e<WebExZimlet.ALL_ACCNT_PROPS.length;
e++){
var t=WebExZimlet.ALL_ACCNT_PROPS[e].propId;
this._currentWebExAccount[t]=this._webexZimletAccountPreferences[t+o]
}
this._currentWebExAccountNumber=o;
this._validateCurrentAccount(o)
};
WebExZimlet.prototype._getAccountNumberFromFolderId=function(o){
this._isAtLeastOneAccountConfigured();
var t=1;
for(var e=1;
e<6;
e++){
if(this._webexZimletAccountPreferences[WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId+e]==o){
t=e;
break
}}
return t
};
WebExZimlet.prototype._isAtLeastOneAccountConfigured=function(){
if(this._webexZimletAccountPreferences==undefined){
throw new AjxException(this.getMessage("WebExZimlet_noWebExAccount"),AjxException.INTERNAL_ERROR,this.getMessage("WebExZimlet_label"))
}
for(var e=1;
e<6;
e++){
if(this._isAccountConfigured(e)){
return true
}}
throw new AjxException(this.getMessage("WebExZimlet_noWebExAccount"),AjxException.INTERNAL_ERROR,this.getMessage("WebExZimlet_label"))
};
WebExZimlet.prototype._isAccountConfigured=function(e){
if(!this._webexZimletAccountPreferences){
return false
}
if(this._webexZimletAccountPreferences[WebExZimlet.PROP_USERNAME.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_USERNAME.propId+e]!="N/A"&&this._webexZimletAccountPreferences[WebExZimlet.PROP_PASSWORD.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_PASSWORD.propId+e]!="N/A"&&this._webexZimletAccountPreferences[WebExZimlet.PROP_COMPANY_ID.propId+e]!=""&&this._webexZimletAccountPreferences[WebExZimlet.PROP_COMPANY_ID.propId+e]!="N/A"){
return true
}
return false
};
WebExZimlet.prototype._setCurrentAccntInfoFromAccntNumber=function(o){
this._isAtLeastOneAccountConfigured();
this._currentWebExAccount=[];
for(var e=0;
e<WebExZimlet.ALL_ACCNT_PROPS.length;
e++){
var t=WebExZimlet.ALL_ACCNT_PROPS[e].propId;
this._currentWebExAccount[t]=this._webexZimletAccountPreferences[t+o]
}
this._validateCurrentAccount(o);
this._currentWebExAccountNumber=o
};
WebExZimlet.prototype._validateCurrentAccount=function(s){
var o=this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
var n=this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
var e=this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
if(o==""||o=="N/A"||n==""||n=="N/A"||e==""||e=="N/A"){
var t=this.getMessage("WebExZimlet_accountNumberNotSetup").replace("{0}",s);
throw new AjxException(t,AjxException.INTERNAL_ERROR,"_validateCurrentAccount")
}};
WebExZimlet.prototype._setDataToAccPrefsDlg=function(){
try{
for(var s=1;
s<6;
s++){
var r=true;
if(this._isAccountConfigured(s)){
r=false
}
for(var n=0;
n<WebExZimlet.ALL_ACCNT_PROPS.length;
n++){
var o=WebExZimlet.ALL_ACCNT_PROPS[n].propId;
var t=o+s;
var h;
if(r){
h=WebExZimlet.ALL_ACCNT_PROPS[n].defaultVal
}else{
h=this._webexZimletAccountPreferences[t]
}
if(h=="N/A"||h==""||h==undefined||h=="undefined"){
continue
}
if(o.indexOf(WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId)==-1){
document.getElementById(t).value=h
}else{
this._setMenuValue(t,h)
}}}
this.accPrefsDlg.popup();
this._addAccntPrefsTabControl()
}
catch(e){
this._showErrorMessage(e);
return
}};
WebExZimlet.prototype._setMenuValue=function(n,o){
var e=document.getElementById(n).options;
for(var t=0;
t<e.length;
t++){
if(e[t].value==o){
e[t].selected=true;
break
}}};
WebExZimlet.prototype._createAccPrefsView=function(){
this._accntPrefsObjsHash=[];
this._accntPrefsHelpObjsHash=[];
var t=[];
if(!AjxEnv.isIE){
t.push("<table width='96%' align='center'><tr><td>")
}
for(var o=1;
o<6;
o++){
if(o==1){
var e=this.getMessage("WebExZimlet_account1UsedAsDefaultForUnAssociatedCal")
}else{
var e=""
}
t.push(this._getAccountPrefsHtml(o,e))
}
if(!AjxEnv.isIE){
t.push("</td></tr></table>")
}
return t.join("")
};
WebExZimlet.prototype._getAccountPrefsHtml=function(r,h){
var s=[];
var t=0;
var l=this.getMessage("WebExZimlet_accountNumber").replace("{0}",r);
s.push("<div class='webExZimlet_YellowBold'>");
s.push("<div class='webExZimlet_grayAccntHdr'>",l,"</div>");
s.push("<div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_accountSettings"),"</div>");
s.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
for(var n=0;
n<WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS.length;
n++){
var o=WebExZimlet.SINGLE_WEBEX_ACCNT_PROPS[n];
var d=o.objType?o.objType:"text";
var e=[o.propId,r].join("");
this._accntPrefsObjsHash.push(e);
if(o.propId==WebExZimlet.PROP_COMPANY_ID.propId||o.propId==WebExZimlet.PROP_ALT_HOSTS.propId){
var u=Dwt.getNextId();
this._accntPrefsHelpObjsHash.push({
helpLinkId:u,propId:o.propId}
);
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='",d,"'/>","&nbsp; <a href='javascript:void(0)' id='",u,"'>",this.getMessage("WebExZimlet_help"),"</a></td></tr>")
}else{
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='",d,"'/>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}}
s.push("<tr><td></td><td id='webExZimlet_TestAccountBtn",r,"' ></td></tr>");
s.push("</table>");
s.push("<br/><div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_teleConfSettings"),"</div>");
s.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
for(var n=0;
n<WebExZimlet.WEBEX_TELECONF_PROPS.length;
n++){
var o=WebExZimlet.WEBEX_TELECONF_PROPS[n];
var e=[o.propId,r].join("");
this._accntPrefsObjsHash.push(e);
if(o.propId!=WebExZimlet.PROP_OTHER_PHONE_NUMBERS.propId){
s.push("<tr><td>",this.getMessage(o.label),"</td><td><input id='",e,"'  type='text'/>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}else{
s.push("<tr><td>",this.getMessage(o.label),"</td><td><textarea id='",e,"' rows='5' cols='20'></textarea>","<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></td></tr>")
}}
s.push("</table>");
s.push("<br/><div class='webExZimlet_lightGray'>",this.getMessage("WebExZimlet_associateCalendarHdr"),"</div>");
var o=WebExZimlet.PROP_ASSOCIATED_CALENDAR;
s.push("<div style='padding:5px'><label style='color:blue;font-weight:bold'>",this.getMessage(o.label),"</label><label style='color:gray;'>",this._getCalendarFoldersList(r),"<label style='color:gray;'>",this.getMessage(o.extraLabel),"</label></div></div><br/><br/>");
return s.join("")
};
WebExZimlet.prototype._testWebExAccount=function(n){
var r=document.getElementById(WebExZimlet.PROP_USERNAME.propId+n).value;
var h=document.getElementById(WebExZimlet.PROP_PASSWORD.propId+n).value;
var t=document.getElementById(WebExZimlet.PROP_COMPANY_ID.propId+n).value;
var l={
hostName:r,hostPwd:h,companyId:t};
if(r.length==0||h.length==0||t.length==0){
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_userPwdCIdRequired"),ZmStatusView.LEVEL_WARNING);
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
var s='<bodyContent xsi:type="java:com.webex.service.binding.user.GetUser"><webExId>'+r+"</webExId></bodyContent>";
var o=this.newWebExRequest(s,l);
var e=AjxRpc.invoke(o,this.postUri(l),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleTestWebExAccount),false,false)
};
WebExZimlet.prototype._handleTestWebExAccount=function(e){
var o=this.xmlToObject(e);
if(!this._validateWebExResult(o,this.getMessage("WebExZimlet_testFailed"))){
return
}
var t=appCtxt.getMsgDialog();
t.reset();
t.setMessage(this.getMessage("WebExZimlet_testPassed"));
t.popup()
};
WebExZimlet.prototype._accPrefsOkBtnListner=function(){
var e=[];
for(var n=1;
n<6;
n++){
for(var o=0;
o<WebExZimlet.ALL_ACCNT_PROPS.length;
o++){
var t=WebExZimlet.ALL_ACCNT_PROPS[o].propId+n;
var s=document.getElementById(t).value;
s=s==""?"N/A":s;
e[t]=s
}}
this.metaData.set("webexZimletAccountPreferences",e,null,new AjxCallback(this,this._saveAccPrefsHandler),null,true)
};
WebExZimlet.prototype._saveAccPrefsHandler=function(){
this._webexZimletAccountPreferences=null;
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_PrefSaved"),ZmStatusView.LEVEL_INFO);
this.accPrefsDlg.popdown()
};
WebExZimlet.prototype._getCalendarFoldersList=function(o){
var n=[WebExZimlet.PROP_ASSOCIATED_CALENDAR.propId,o].join("");
this._accntPrefsObjsHash.push(n);
var e=0;
var t=new Array();
t[e++]=["<SELECT id='",n,"'>"].join("");
t[e++]=this._getCalendarsOptionsHtml();
t[e++]="</SELECT>";
return t.join("")
};
WebExZimlet.prototype._getCalendarsOptionsHtml=function(){
if(this._calendarOptionsHtml){
return this._calendarOptionsHtml
}
var r=0;
var d=new Array();
var p=AjxSoapDoc.create("GetFolderRequest","urn:zimbraMail");
var l=p.set("folder");
l.setAttribute("l",appCtxt.getFolderTree().root.id);
var o=new ZmCsfeCommand();
var m=o.invoke({
soapDoc:p,noAuthToken:true}
).Body.GetFolderResponse.folder[0];
var s=m.folder?m.folder:[];
var n=m.link?m.link:[];
var t=s.concat(n);
if(t){
d[r++]=["<option value='ALL'>",this.getMessage("WebExZimlet_allCalendars"),"</option>"].join("");
for(var h=0;
h<t.length;
h++){
var u=t[h];
if(u&&u.view=="appointment"){
var e=u.id;
if(u.zid&&u.rid){
e=[u.zid,":",u.rid].join("")
}
d[r++]=["<option value='",e,"'>",u.name,"</option>"].join("")
}}}
this._calendarOptionsHtml=d.join("");
return this._calendarOptionsHtml
};
WebExZimlet.prototype._displayGeneralPrefsDlg=function(){
if(this.generalPrefsDlg){
this.generalPrefsDlg.popup();
return
}
var e=new DwtComposite(this.getShell());
e.getHtmlElement().style.overflow="auto";
e.getHtmlElement().innerHTML=this._createGeneralPrefsView();
this.generalPrefsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_preferences"),view:e,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.generalPrefsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._generalPrefsOkBtnListner));
var t=new AjxCallback(this,this._setDataToGeneralPrefsDlg);
this._getGeneralPrefsMetaData(t)
};
WebExZimlet.prototype._getGeneralPrefsMetaData=function(e){
this.metaData.get("webexZimletGeneralPreferences",null,new AjxCallback(this,this._handleGetGeneralPrefsMetaData,e))
};
WebExZimlet.prototype._setDefaultGeneralPreferences=function(){
this._webexZimletGeneralPreferences={};
for(var e=0;
e<WebExZimlet.ALL_GENERAL_PROPS.length;
e++){
var t=WebExZimlet.ALL_GENERAL_PROPS[e];
this._webexZimletGeneralPreferences[t.propId]=t.defaultVal
}};
WebExZimlet.prototype._handleGetGeneralPrefsMetaData=function(n,e){
try{
this._webexZimletGeneralPreferences=null;
var t=e.getResponse().BatchResponse.GetMailboxMetadataResponse[0];
if(t.meta&&t.meta[0]){
this._webexZimletGeneralPreferences=t.meta[0]._attrs
}
if(this._webexZimletGeneralPreferences==undefined){
this._setDefaultGeneralPreferences()
}
if(n){
n.run(this)
}else{
return this._webexZimletGeneralPreferences
}}
catch(o){
this._showErrorMessage(o);
return
}};
WebExZimlet.prototype._setDataToGeneralPrefsDlg=function(){
try{
var r=false;
if(this._webexZimletGeneralPreferences==undefined){
var r=true
}
for(var s=0;
s<WebExZimlet.ALL_GENERAL_PROPS.length;
s++){
var o=WebExZimlet.ALL_GENERAL_PROPS[s].propId;
var h;
if(r){
h=WebExZimlet.ALL_GENERAL_PROPS[s].defaultVal
}else{
h=this._webexZimletGeneralPreferences[o]
}
if(h=="N/A"){
continue
}
var e=document.getElementById(o).options;
for(var l=0;
l<e.length;
l++){
if(e[l].value==h||e[l].text==h){
e[l].selected=true;
break
}}}
this.generalPrefsDlg.popup()
}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._createGeneralPrefsView=function(){
var t=[];
t.push("<div class='webExZimlet_YellowBold '>");
t.push("<div class='webExZimlet_gray'>",this.getMessage("WebExZimlet_appendMeetingInfoToSubOrLoc"),"</div>");
t.push("<table class='ZPropertySheet' cellspacing='6'>");
for(var e=0;
e<WebExZimlet.APPEND_SUB_OPTIONS.length;
e++){
var o=WebExZimlet.APPEND_SUB_OPTIONS[e];
t.push("<tr><td class='ZmFieldLabelRight'>",this.getMessage(o.label),"</td><td>",this._getAppendSelectListMenuHtml(o.propId),"</td></tr>")
}
t.push("</table>");
t.push("<br/>");
return t.join("")
};
WebExZimlet.prototype._getAppendSelectListMenuHtml=function(t){
var e=[];
e.push("<select id='",t,"'>");
e.push("<option value='NONE'>",this.getMessage("WebExZimlet_none"),"</option>");
e.push("<option value='SUBJECT'>",this.getMessage("WebExZimlet_subject"),"</option>");
e.push("<option value='LOCATION'>",this.getMessage("WebExZimlet_location"),"</option>");
e.push("<option value='BOTH'>",this.getMessage("WebExZimlet_subjectAndLocation"),"</option>");
e.push("</select>");
return e.join("")
};
WebExZimlet.prototype._generalPrefsOkBtnListner=function(){
var t=[];
try{
for(var s=0;
s<WebExZimlet.ALL_GENERAL_PROPS.length;
s++){
var n=WebExZimlet.ALL_GENERAL_PROPS[s].propId;
var e=document.getElementById(n);
var r=e.options[e.selectedIndex].value;
r=r==""?"N/A":r;
t[n]=r
}
this.metaData.set("webexZimletGeneralPreferences",t,null,new AjxCallback(this,this._saveGeneralPrefsHandler),null,true)
}
catch(o){
this._showErrorMessage(o)
}};
WebExZimlet.prototype._saveGeneralPrefsHandler=function(){
this._webexZimletGeneralPreferences=null;
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_PrefSaved"),ZmStatusView.LEVEL_INFO);
this.generalPrefsDlg.popdown()
};
WebExZimlet.prototype._getApptIdsHashMetaData=function(e,t){
this._currentMetaData=new ZmMetaData(appCtxt.getActiveAccount(),e);
this._currentMetaData.get("webexZimletApptIdsHash",null,new AjxCallback(this,this._handleGetApptIdsHashMetaData,t))
};
WebExZimlet.prototype._handleGetApptIdsHashMetaData=function(n,e){
this._apptIdsMetaData=null;
var t=e.getResponse();
if(t&&t.BatchResponse&&t.BatchResponse.GetCustomMetadataResponse){
t=t.BatchResponse.GetCustomMetadataResponse
}else{
return
}
try{
if(t.meta&&t.meta[0]){
this._apptIdsMetaData=t.meta[0]._attrs
}
if(n){
n.run(this._apptIdsMetaData)
}else{
return this._apptIdsMetaData
}}
catch(o){
this._showErrorMessage(o);
return
}};
WebExZimlet.prototype._saveApptIdsHashToServer=function(n,t,o){
this._currentMetaData=new ZmMetaData(appCtxt.getActiveAccount(),n);
var e=[];
if(this._appt.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){
e.exceptionMeetingKey=t;
if(o&&o!=""){
e.meetingKey=o
}}else{
e.meetingKey=t
}
e.hostName=this._currentWebExAccount[WebExZimlet.PROP_USERNAME.propId];
e.hostPwd=this._currentWebExAccount[WebExZimlet.PROP_PASSWORD.propId];
e.companyId=this._currentWebExAccount[WebExZimlet.PROP_COMPANY_ID.propId];
this._currentMetaData.set("webexZimletApptIdsHash",e,null,null,null,true)
};
WebExZimlet.prototype._showSelectAccountDlg=function(e){
var t=new AjxCallback(this,this._doShowSelectAccountDlg,e);
this._getAccPrefsMetaData(t)
};
WebExZimlet.prototype._doShowSelectAccountDlg=function(r){
var h=r.postCallback;
var n=r.appt;
var o=r.showOptions?true:false;
var s=1;
if(n&&n.folderId){
s=this._getAccountNumberFromFolderId(n.folderId)
}
if(this._showSelectAccntsDlg){
this._showSelectAccntsDlg._postCallback=h;
if(s){
this._setMenuValue("webExZimlet_accountsToSelectList",s)
}
this._showSelectAccntsDlg._showOptions=o;
this._setSelectAccntDlgData(s);
this._setSelectAccntListeners();
this._setSelectAccntOptions();
this._showSelectAccntsDlg.popup();
return
}
try{
var e=this._getAccountsSelectListMenuHtml("webExZimlet_accountsToSelectList")
}
catch(t){
this._showErrorMessage(t);
return
}
this._showSelectAccntsDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_selectAccntToUse"),standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this._showSelectAccntsDlg._showOptions=o;
this._showSelectAccntDlgView=new DwtComposite(this.getShell());
this._showSelectAccntDlgView.getHtmlElement().style.overflow="auto";
this._showSelectAccntDlgView.getHtmlElement().innerHTML=this._createShowSelectAccntView(e);
this._showSelectAccntsDlg.setView(this._showSelectAccntDlgView);
this._showSelectAccntsDlg._postCallback=h;
this._showSelectAccntsDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._showSelectAccntDlgOkBtnListner));
if(s){
this._setMenuValue("webExZimlet_accountsToSelectList",s)
}
this._setSelectAccntDlgData(s);
this._setSelectAccntListeners();
this._setSelectAccntOptions();
this._showSelectAccntsDlg.popup()
};
WebExZimlet.prototype._setSelectAccntDlgData=function(o){
try{
this._setCurrentAccntInfoFromAccntNumber(o)
}
catch(e){
this._showErrorMessage(e);
return
}
var n=this._currentWebExAccount[WebExZimlet.PROP_ALT_HOSTS.propId];
var t=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
document.getElementById(this._showSelectAccntsDlg._altHostFieldId).value=n=="N/A"?"":n;
document.getElementById(this._showSelectAccntsDlg._mPwdFieldId).value=t=="N/A"?"":t
};
WebExZimlet.prototype._setSelectAccntOptions=function(){
var e=this._showSelectAccntsDlg._showOptions?"block":"none";
document.getElementById("webexZimlet_showSelectAccnts_OptionsDiv").style.display=e
};
WebExZimlet.prototype._setSelectAccntListeners=function(){
document.getElementById(this._showSelectAccntsDlg._altHelpLinkId).onclick=AjxCallback.simpleClosure(this._accPrefsShowHelpdialog,this,WebExZimlet.PROP_ALT_HOSTS.propId);
document.getElementById("webExZimlet_accountsToSelectList").onchange=AjxCallback.simpleClosure(this._setNewAccountData,this)
};
WebExZimlet.prototype._setNewAccountData=function(){
var t=document.getElementById("webExZimlet_accountsToSelectList").value;
try{
this._setCurrentAccntInfoFromAccntNumber(t)
}
catch(e){
this._showErrorMessage(e);
return
}
this._setSelectAccntDlgData(t)
};
WebExZimlet.prototype._createShowSelectAccntView=function(e){
try{
var o=[];
this._showSelectAccntsDlg._altHostFieldId="WebExZimlet_showSelectAccntsDlg_altHostFieldId";
this._showSelectAccntsDlg._altHelpLinkId="WebExZimlet_showSelectAccntsDlg_altHelpLinkId";
this._showSelectAccntsDlg._mPwdFieldId="WebExZimlet_showSelectAccntsDlg_mPwdFieldId";
o.push("<div style='padding:5px;'>",this.getMessage("WebExZimlet_webExAccntToUse")," <span>",e,"</span></div>");
o.push("<br/>");
o.push("<div id='webexZimlet_showSelectAccnts_OptionsDiv' >");
o.push("<div><b>",this.getMessage("WebExZimlet_getAccounts"),"</b></div>");
o.push("<table class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
o.push("<tr><td>",this.getMessage(WebExZimlet.PROP_ALT_HOSTS.label),"</td><td><input  id='",this._showSelectAccntsDlg._altHostFieldId,"'  type='text'/>","&nbsp; <a href='javascript:void(0)' id='",this._showSelectAccntsDlg._altHelpLinkId,"'>",this.getMessage("WebExZimlet_help"),"</a></td></tr>");
o.push("<tr><td>",this.getMessage(WebExZimlet.PROP_MEETING_PASSWORD.label),"</td><td><input id='",this._showSelectAccntsDlg._mPwdFieldId,"'  type='text'/>","<label style='color:gray;'>",this.getMessage(WebExZimlet.PROP_MEETING_PASSWORD.extraLabel),"</label></td></tr>");
o.push("</table>");
o.push("</div>");
return o.join("")
}
catch(t){
this._showErrorMessage(t)
}};
WebExZimlet.prototype._showSelectAccntDlgOkBtnListner=function(){
try{
this._validateCurrentAccount(document.getElementById("webExZimlet_accountsToSelectList").value)
}
catch(e){
this._showErrorMessage(e);
return
}
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
this._showSelectAccntsDlg.popdown();
this._showSelectAccntsDlg._postCallback.run(document.getElementById("webExZimlet_accountsToSelectList").value)
};
WebExZimlet.prototype._showAppointmentsList=function(e){
if(!this._webexZimletAccountPreferences){
var t=new AjxCallback(this,this._showMeetingListDlg,[e,"NOW_ON"]);
this._getAccPrefsMetaData(t)
}else{
this._showMeetingListDlg(e,"NOW_ON")
}};
WebExZimlet.prototype._getMeetingsList=function(h,p){
appCtxt.getAppController().setStatusMsg(this.getMessage("WebExZimlet_pleaseWait"),ZmStatusView.LEVEL_INFO);
try{
this._setCurrentAccntInfoFromAccntNumber(h)
}
catch(u){
this._showErrorMessage(u);
return
}
var f=new Date();
var s=new Date(f.getTime()+(1*24*3600*1000));
var y=new Date(f.getTime()+(7*24*3600*1000));
if(p=="TODAY"){
var g=0;
var l=f
}else{
if(p=="TOMORROW"){
var g=0;
var l=s
}else{
if(p=="NEXT_7_DAYS"){
var g=0;
var l=f
}else{
var g=f.getHours()-1;
var l=f
}}}
g=g<10?"0"+g:g;
var t=l.getMonth()+1;
t=t<10?"0"+t:t;
var d=l.getDate();
d=d<10?"0"+d:d;
var m=["<startDateStart>",t,"/",d,"/",l.getFullYear()," ",g,":00:00","</startDateStart>"].join("");
var b="";
if(p=="TODAY"||p=="TOMORROW"){
b=["<startDateEnd>",t,"/",d,"/",l.getFullYear()," ","23:00:00","</startDateEnd>"].join("")
}else{
if(p=="NEXT_7_DAYS"){
var r=y.getDate();
r=r<10?"0"+r:r;
var e=y.getMonth()+1;
e=e<10?"0"+e:e;
b=["<startDateEnd>",e,"/",r,"/",y.getFullYear()," ","23:00:00","</startDateEnd>"].join("")
}}
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.LstsummaryMeeting" ','xmlns:meet="http://www.webex.com/schemas/2002/06/service/meeting">',"<listControl><startFrom>1</startFrom><maximumNum>20</maximumNum></listControl>","<order><orderBy>STARTTIME</orderBy><orderAD>ASC</orderAD></order>","<dateScope>",m,b,"</dateScope></bodyContent>"].join("");
var o=this.newWebExRequest(n);
AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,new AjxCallback(this,this._handleGetMeetingsList,[p]),false,false)
};
WebExZimlet.prototype._handleGetMeetingsList=function(t,e){
var o=this.xmlToObject(e);
if(!this._validateWebExResult(o,this.getMessage("WebExZimlet_unableToGetMeetingInfo"))){
return
}
this._setMeetingListView(o,t);
this._addShowMeetingListListeners()
};
WebExZimlet.prototype._showMeetingListDlg=function(t,e){
if(this._meetingLstDlg){
this._meetingListDlgView.getHtmlElement().innerHTML=["<label style='font-weight:bold;font-size:12px;color:blue;'>",this.getMessage("WebExZimlet_pleaseWait"),"</div>"].join("");
this._meetingLstDlg.popup();
this._getMeetingsList(t,e);
return
}
this._meetingListDlgView=new DwtComposite(this.getShell());
this._meetingListDlgView.setSize("570","200");
this._meetingListDlgView.getHtmlElement().style.background="white";
this._meetingListDlgView.getHtmlElement().style.overflow="auto";
this._meetingListDlgView.getHtmlElement().innerHTML=["<label style='font-weight:bold;font-size:12px;color:blue;'>",this.getMessage("WebExZimlet_pleaseWait"),"</div>"].join("");
this._meetingLstDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_startOrJoinWebExMeeting"),view:this._meetingListDlgView,standardButtons:[DwtDialog.CANCEL_BUTTON]}
);
this._meetingLstDlg.popup();
this._getMeetingsList(t,e)
};
WebExZimlet.prototype._addShowMeetingListListeners=function(){
for(var t in this._startMeetingStartLinkIdMap){
document.getElementById(t).onclick=AjxCallback.simpleClosure(this._onStartLinkClicked,this,this._startMeetingStartLinkIdMap[t])
}
var e=AjxCallback.simpleClosure(this._meetingListTypesMenuHandler,this);
document.getElementById("webExZimlet_meetingsListTypesMenu").onchange=e
};
WebExZimlet.prototype._meetingListTypesMenuHandler=function(){
var e=document.getElementById("webExZimlet_meetingsListTypesMenu").value;
this._getMeetingsList(this._currentWebExAccountNumber,e)
};
WebExZimlet.prototype._onStartLinkClicked=function(r){
var s=false;
if(r.hostWebExId==this._currentWebExAccount.webexZimlet_username){
s=true;
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GethosturlMeeting">',"<meetingKey>",r.meetingKey,"</meetingKey>","</bodyContent>"].join("")
}else{
var n=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GetjoinurlMeeting">',"<meetingKey>",r.meetingKey,"</meetingKey>","</bodyContent>"].join("")
}
var o=this.newWebExRequest(n);
var e=AjxRpc.invoke(o,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var h=this.xmlToObject(e);
if(!this._validateWebExResult(h,this.getMessage("WebExZimlet_unableToGetJoinOrHostURL"))){
return
}
var t="";
if(s){
t=h.body.bodyContent.hostMeetingURL.toString()
}else{
t=h.body.bodyContent.joinMeetingURL.toString()
}
window.open(t)
};
WebExZimlet.prototype._setMeetingListView=function(t,s){
var l=t.body.bodyContent.meeting;
if(!l){
l=[]
}else{
if(!(l instanceof Array)){
l=[l]
}}
this._startMeetingStartLinkIdMap={};
var n=[];
n.push("<div class='webExZimlet_lightGray'>","Show meetings: ",this._getMeetingListTypesMenu(s),"</div>");
n.push("<table class='webex_hoverTable' cellspacing=0px width=100%>");
n.push("<tr align=left><th>",this.getMessage("WebExZimlet_host"),"</th><th width=50%>",this.getMessage("WebExZimlet_meetingName"),"</th><th>",this.getMessage("WebExZimlet_startTime"),"</th><th>",this.getMessage("WebExZimlet_action"),"</th></tr>");
var h=true;
for(var o=0;
o<l.length;
o++){
var d="RowEven";
var r=l[o];
var e=Dwt.getNextId();
this._startMeetingStartLinkIdMap[e]={
meetingKey:r.meetingKey.toString(),hostWebExId:r.hostWebExID.toString()};
if(!h){
d="RowOdd"
}
n.push("<tr class='",d,"'>","<td>",r.hostWebExID,"</td>","<td>",AjxStringUtil.urlComponentDecode(r.confName),"</td>","<td>",r.startDate,"<br/><label style='color:gray;font-size:10px'>",this._getTimeZoneName(r.timeZone.toString()),"</label></td>","<td><a href='javascript:void(0)' id='",e,"' >",this.getMessage("WebExZimlet_startJoin"),"</a></td>","</tr>");
h=!h
}
n.push("</table>");
this._meetingListDlgView.getHtmlElement().innerHTML=n.join("")
};
WebExZimlet.prototype._getMeetingListTypesMenu=function(s){
if(!s){
s="NOW_ON"
}
var e={
NOW_ON:this.getMessage("WebExZimlet_fromNowOn"),TODAY:this.getMessage("WebExZimlet_today"),TOMORROW:this.getMessage("WebExZimlet_tomorrow"),NEXT_7_DAYS:this.getMessage("WebExZimlet_next7days")};
var t=[];
t.push("<select id='webExZimlet_meetingsListTypesMenu'>");
for(var n in e){
var o=n==s?" selected ":"";
t.push("<option value='",n,"' ",o," >",e[n],"</option>")
}
t.push("</select>");
return t.join("")
};
WebExZimlet.prototype._getTimeZoneName=function(e){
var o=e.split(",");
var n=[];
for(var t=1;
t<o.length;
t++){
n.push(o[t])
}
return n.join(",")
};
WebExZimlet.prototype._showOneClickDlg=function(e){
if(!e){
e=""
}
if(this._oneClickDlg){
this._setAttendeesToOneClickDlg(e);
this._oneClickDlg.popup();
return
}
var t=new AjxCallback(this,this._doShowOneClickDlg,e);
this._getAccPrefsMetaData(t)
};
WebExZimlet.prototype._doShowOneClickDlg=function(o){
try{
var e=this._getAccountsSelectListMenuHtml("webExZimlet_oneClickAccountSelect")
}
catch(t){
this._showErrorMessage(t);
return
}
this._oneClickDlgView=new DwtComposite(this.getShell());
this._oneClickDlgView.getHtmlElement().style.overflow="auto";
this._oneClickDlgView.getHtmlElement().innerHTML=this._createOneClickMeetingView(e);
this._oneClickDlg=new ZmDialog({
parent:this.getShell(),title:this.getMessage("WebExZimlet_startQuickWebExMeeting"),view:this._oneClickDlgView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this._oneClickDlg.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._oneClickDlgOkBtnListner));
this._addAutoCompleteHandler();
this._addToButton();
this._setAttendeesToOneClickDlg(o);
this._oneClickDlg.popup()
};
WebExZimlet.prototype._addToButton=function(t){
var e=new DwtButton({
parent:this.getShell()}
);
e.setText(ZmMsg.to);
e.addSelectionListener(new AjxListener(this,this._handleToButton));
document.getElementById("webexZimlet__oneClickMeeting_toButton").appendChild(e.getHtmlElement())
};
WebExZimlet.prototype._handleToButton=function(t){
if(!this._contactPicker){
AjxDispatcher.require("ContactsCore");
var e=[{
id:AjxEmailAddress.TO,label:ZmMsg[AjxEmailAddress.TYPE_STRING[AjxEmailAddress.TO]]}
];
this._contactPicker=new ZmContactPicker(e);
this._contactPicker.registerCallback(DwtDialog.OK_BUTTON,this._contactPickerOkCallback,this)
}
this._contactPicker.popup()
};
WebExZimlet.prototype._contactPickerOkCallback=function(e){
var f=false;
used={};
var s=[];
var n=e&&e.getArray();
if(n&&n.length){
for(var o=0,r=n.length;
o<r;
o++){
var u=n[o];
var d=u.isAjxEmailAddress?u&&u.getAddress():u;
if(!d){
continue
}
d=d.toLowerCase();
if(!used[d]){
s.push(u.address);
used[d]=true;
f=true
}}
var m=document.getElementById("webExZimlet_oneClickAttendeesField");
var l=AjxEmailAddress.parseEmailString(m.value).good.getArray();
var t=[];
var r=l.length;
for(var o=0;
o<r;
o++){
t.push(l[o].address)
}
s=t.concat(s);
var h=s.join(AjxEmailAddress.SEPARATOR);
m.value=h
}
this._contactPicker.popdown()
};
WebExZimlet.prototype._setAttendeesToOneClickDlg=function(e){
if(!e||e==""){
e=""
}
document.getElementById("webExZimlet_oneClickAttendeesField").value=e
};
WebExZimlet.prototype._addAutoCompleteHandler=function(){
if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)||appCtxt.get(ZmSetting.GAL_ENABLED)){
var e={
dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_EMAIL,keyUpCallback:this._acKeyUpListener.bind(this),contextId:this.name};
this._acAddrSelectList=new ZmAutocompleteListView(e);
this._acAddrSelectList.handle(document.getElementById("webExZimlet_oneClickAttendeesField"))
}};
WebExZimlet.prototype._acKeyUpListener=function(o,t,e){};
WebExZimlet.prototype._createOneClickMeetingView=function(e){
var t=[];
t.push("<table width='100%' class='webExZimlet_table ZPropertySheet' cellspacing='6'>");
t.push("<tr><td colspan='2' class='ZmFieldLabelRight'>",this.getMessage("WebExZimlet_webExAccntToUse")," </td><td>",e,"</td></tr>");
t.push("<tr>","<td width='30'></td><td width='15' id='webexZimlet__oneClickMeeting_toButton'></td>","<td><input  style='width:400px;' type='text' id='webExZimlet_oneClickAttendeesField'> </input></td></tr>");
t.push("</table>");
return t.join("")
};
WebExZimlet.prototype._oneClickDlgOkBtnListner=function(){
var s=document.getElementById("webExZimlet_oneClickAccountSelect").value;
var e=this._getValidEmailsAsString("webExZimlet_oneClickAttendeesField");
if(e==""){
return
}
var o={
accntNumber:s,attendees:e};
var t=new AjxCallback(this,this._createOneClickMeetingAndLaunch,o);
var n=new AjxCallback(this,this._getGeneralPrefsMetaData,t);
this._getAccPrefsMetaData(n);
this._oneClickDlg.popdown()
};
WebExZimlet.prototype._createOneClickMeetingAndLaunch=function(t){
try{
this._setCurrentAccntInfoFromAccntNumber(t.accntNumber)
}
catch(l){
this._showErrorMessage(l);
return
}
var s={};
s.subject=this.getMessage("WebExZimlet_quickMeetingSubject");
s.loc=this.getMessage("WebExZimlet_quickMeetingLocation");
if(t.attendees&&t.attendees!=""){
s.emails=AjxEmailAddress.parseEmailString(t.attendees).good.getArray()
}else{
s.emails=[]
}
s.duration=60;
var n="";
try{
n=appCtxt.getActiveAccount().settings.getInfoResponse.prefs._attrs.zimbraPrefTimeZoneId
}
catch(r){
n="America/Los_Angeles"
}
s.timeZoneID=WebExZimlet.WebExToZimbraTZIDMap[n];
s.pwd=this._currentWebExAccount[WebExZimlet.PROP_MEETING_PASSWORD.propId];
var h=new Date();
var u=h.getTime()+(h.getTimezoneOffset()*60000);
var o=new Date(u);
s.formattedStartDate=this._formatDate(new Date());
s.meetingKey=null;
s.sendWebExEmail=true;
var m=new AjxCallback(this,this._createOneClickMeetingHdlr);
this._getCreateOrModifyMeetingRequest(s,m)
};
WebExZimlet.prototype._createOneClickMeetingHdlr=function(e){
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,"Unable to create meeting")){
return
}
var n=null;
if(r.body.bodyContent.meetingkey){
n=r.body.bodyContent.meetingkey.toString()
}
if(!n){
this.displayErrorMessage("WebEx did not return meeting key, perhaps, meeting didn't get created on the WebEx server.","WebEx Error");
return
}
var o=['<bodyContent xsi:type="java:com.webex.service.binding.meeting.GethosturlMeeting">',"<meetingKey>",n,"</meetingKey>","</bodyContent>"].join("");
var t=this.newWebExRequest(o);
var e=AjxRpc.invoke(t,this.postUri(),{
"Content-Type":"text/xml"}
,null,false,false);
var r=this.xmlToObject(e);
if(!this._validateWebExResult(r,this.getMessage("WebExZimlet_unableToCreateMeeting"))){
return
}
var s=r.body.bodyContent.hostMeetingURL.toString();
window.open(s)
};
WebExZimlet.prototype._validateWebExResult=function(s,o){
var e=false;
if(!o){
o=""
}
if(!s){
e=true
}else{
if(!s.header||!s.header.response||!s.header.response.result||s.header.response.result!="SUCCESS"){
e=true
}}
if(e){
var n=[];
n.push(o);
if(s&&s.header&&s.header.response&&s.header.response.reason){
var t="";
if(s.header.response.exceptionID&&s.header.response.exceptionID.toString()=="040007"){
t=this.getMessage("WebExZimlet_invalidAlternateHost")
}
n.push("<br/><b>",this.getMessage("WebExZimlet_failureReason")," </b><label style='color:red;font:bold'>",s.header.response.reason,"<br/>",t,"</label>")
}
this._showErrorMessage(n.join(""));
return false
}
return true
};
WebExZimlet.prototype._showErrorMessage=function(o){
var t="";
if(o instanceof AjxException){
t=o.msg
}else{
t=o
}
var e=appCtxt.getMsgDialog();
e.reset();
e.setMessage(t,DwtMessageDialog.WARNING_STYLE);
e.popup()
};
WebExZimlet.prototype._getAccountsSelectListMenuHtml=function(s){
this._isAtLeastOneAccountConfigured();
var o=[];
o.push("<select id='",s,"'>");
for(var t=1;
t<6;
t++){
var n=this._webexZimletAccountPreferences["webexZimlet_username"+t];
if(n==""||n=="N/A"){
n=this.getMessage("WebExZimlet_notConfigured")
}
var e=AjxMessageFormat.format(this.getMessage("WebExZimlet_accntNumberAndName"),[t,n]);
o.push("<option value='",t,"'>",e,"</option>")
}
o.push("</select>");
return o.join("")
};
WebExZimlet.prototype.doDrop=function(e){
switch(e.TYPE){
case"ZmContact":this.contactDropped(e);
break;
case"ZmAppt":this.apptDropped(e);
break;
case"ZmConv":case"ZmMailMsg":this.mailDropped(e);
break
}};
WebExZimlet.prototype.apptDropped=function(o){
var t=o.srcObj.getAttendees(ZmCalBaseItem.PERSON);
var n=[];
for(var e=0;
e<t.length;
e++){
n.push(t[e].getEmail())
}
this._showOneClickDlg(n.join(";"))
};
WebExZimlet.prototype.mailDropped=function(e){
if(e instanceof Array){
e=e[0]
}
this.srcMsgObj=e.srcObj;
if(this.srcMsgObj.type=="CONV"){
this.srcMsgObj=this.srcMsgObj.getFirstHotMsg()
}
var t=this.srcMsgObj.getEmails().getArray().join(";");
this._showOneClickDlg(t)
};
WebExZimlet.prototype.contactDropped=function(e){
var t=this._getEmailsFromContacts(e);
this._showOneClickDlg(t.join(";"))
};
WebExZimlet.prototype._getEmailsFromContacts=function(t){
if(!(t instanceof Array)){
t=[t]
}
var r=[];
for(var o=0;
o<t.length;
o++){
var s=t[o];
s=s.attr||s._attr?(s.attr?s.attr:s._attr):s;
var n=s.email?s.email:(s.email2?s.email2:(s.email3?s.email3:""));
if(n!=""&&n!=undefined&&n!="undefined"){
r.push(n)
}}
return r
};
WebExZimlet.prototype._getValidEmailsAsString=function(t){
var o=document.getElementById(t);
if(o){
var r=o.value;
if(r!=""){
var e=AjxEmailAddress.parseEmailString(r);
var n=e.bad.getArray().toString();
if(n!=""){
this._showErrorMessage(this.getMessage("cannotContinueInvalidEmails")+"<br>"+n);
return""
}
var s=e.good.size()?e.good.getArray():e.all.getArray()
}}
return s.join(";")
};
function com_zimbra_srchhltr_HandlerObject(){}
com_zimbra_srchhltr_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_srchhltr_HandlerObject.prototype.constructor=com_zimbra_srchhltr_HandlerObject;
var SearchHighlighterZimlet=com_zimbra_srchhltr_HandlerObject;
SearchHighlighterZimlet.prototype.init=function(){
this._searchController=appCtxt.getSearchController();
this._skipKeys=["in:","attachment:","has:","is:","before:","after:","date:","larger:","smaller:","from:","to:","cc:","bcc:","and","or","not"];
this._skipKeysLen=this._skipKeys.length;
this._spanIds=[]
};
SearchHighlighterZimlet.prototype.match=function(o,h){
this._setRegExps();
if(this._regexps.length==0){
return
}
var t=this._regexps;
var n=null;
for(var s=0;
s<t.length;
++s){
var r=t[s];
r.lastIndex=h;
var e=r.exec(o);
if(e&&e[0]!=""){
if(!n||e.index<n.index){
n=e;
n.matchLength=e[0].length;
return n
}}}
return n
};
SearchHighlighterZimlet.prototype.generateSpan=function(o,e,s,n,t){
var r=Dwt.getNextId();
this._spanIds.push(r);
o[e++]=["<span id= '",r,"'class='ZmSearchResult'>",AjxStringUtil.htmlEncode(s),"</span>"].join("");
return e
};
SearchHighlighterZimlet.prototype._getSearchWords=function(t){
if(!t){
return[]
}
t=t.toLowerCase().replace(/in:\"(\w?[^a-zA-Z0-9_\"]?)+\"|in:(\w?[^a-zA-Z0-9_\"\s]?)+/g,"");
t=AjxStringUtil.trim(t);
if(t==""){
return[]
}
var o=t.split(" ");
var s=[];
for(var l=0;
l<o.length;
l++){
var m=AjxStringUtil.trim(o[l]);
if(m==""){
continue
}
var f=false;
for(var h=0;
h<this._skipKeysLen;
h++){
var r=this._skipKeys[h];
if(m.indexOf(r)==0||m.indexOf("("+r)==0||m.indexOf("(("+r)==0){
f=true;
break
}}
if(!f){
m=m.replace("subject:","").replace("content:","");
s.push(m)
}}
var n=[];
for(var r=0;
r<s.length;
r++){
var e=s[r];
e=e.replace(/\(/g,"").replace(/\)/g,"");
if(e==""){
continue
}
var u=e.length;
if((e.indexOf('"')==0)||(e.lastIndexOf('"')==u-1)){
e=e.replace(/\"/g,"")
}
if((e.indexOf("|")==0)||(e.lastIndexOf("|")==u-1)){
e=e.replace(/\|/g,"")
}
if(e!=""){
n.push(e)
}}
return searchWordHighlighter_unique(n)
};
function searchWordHighlighter_unique(e){
var o=[],n,t=e.length;
for(n=0;
n<t;
n++){
if(!searchWordHighlighter_arrayHasEl(o,e[n])){
o.push(e[n])
}}
return o
}
function searchWordHighlighter_arrayHasEl(o,t){
for(var e=0;
e<o.length;
e++){
if(o[e]==t){
return true
}}
return false
}
SearchHighlighterZimlet.prototype._setRegExps=function(){
this._currentSearchQuery=(this._searchController.currentSearch)?this._searchController.currentSearch.query:null;
if(!this._oldSearchQuery||this._currentSearchQuery!=this._oldSearchQuery){
var n=this._getSearchWords(this._currentSearchQuery);
this._regexps=[];
try{
for(var t=0;
t<n.length;
t++){
this._regexps.push(new RegExp(n[t],"ig"))
}}
catch(o){
appCtxt.getAppController().setStatusMsg([this.getMessage("SearchHighlighterZimlet_ZimletError")," ",o].join(""),ZmStatusView.LEVEL_WARNING);
this._regexps=[]
}
this._oldSearchQuery=this._currentSearchQuery
}};
SearchHighlighterZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
SearchHighlighterZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(e,t)
};
SearchHighlighterZimlet.prototype.addMenuButton=function(t,s){
var e="COM_ZIMBRA_SEARCH_WORD_HIGHLIGHTER_ZIMLET";
var n=this.getMessage("SearchHighlighterZimlet_MenuLabel");
if(!s.getMenuItem(e)){
var r={
id:e,text:n,image:"search"};
var o=ZmOperation.defineOperation(null,r);
s.addOp(e,1000);
s.addSelectionListener(e,new AjxListener(this,this._clearSearchWordHighlights,t))
}};
SearchHighlighterZimlet.prototype._clearSearchWordHighlights=function(s){
var h=appCtxt.getAppViewMgr().getCurrentView();
var l;
if(h.getItemView){
l=h.getItemView()
}else{
if(h.getMsgView){
l=h.getMsgView()
}}
if(!l){
return
}
var e=l.getDocument();
if(!e){
var t=l.getHTMLElId();
if(t){
var d=document.getElementById(t+"_body__iframe");
if(!AjxEnv.isIE){
if(d){
e=d.contentDocument
}}else{
if(d){
e=d.contentWindow.document
}}}}
for(var n=0;
n<this._spanIds.length;
n++){
var o=document.getElementById(this._spanIds[n]);
var r;
if(e!=undefined||e!=null){
r=e.getElementById(this._spanIds[n])
}
if((o!=undefined)&&(o.className!=undefined)){
o.className=""
}
if((r!=undefined)&&(r.className!=undefined)){
r.className=""
}}
this._spanIds=[]
};
function com_zimbra_attachmail_HandlerObject(){}
com_zimbra_attachmail_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachmail_HandlerObject.prototype.constructor=com_zimbra_attachmail_HandlerObject;
var AttachMailZimlet=com_zimbra_attachmail_HandlerObject;
AttachMailZimlet.prototype.initializeAttachPopup=function(o,e){
var t=e._createAttachMenuItem(o,ZmMsg.mail,new AjxListener(this,this.showAttachmentDialog))
};
AttachMailZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachMailZimlet.prototype.showAttachmentDialog=function(){
var t=this._attachDialog=appCtxt.getAttachDialog();
t.setTitle(ZmMsg.attachMail);
this.removePrevAttDialogContent(t._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AMV=new AttachMailTabView(this._attachDialog,this)
}
this.AMV.reparentHtmlElement(t._getContentDiv().childNodes[0],0);
this.AMV.attachDialog=t;
t.setOkListener(new AjxCallback(this.AMV,this.AMV.uploadFiles));
var e=appCtxt.getCurrentView();
var o=new AjxCallback(e,e._attsDoneCallback,[true]);
t.setUploadCallback(o);
this.AMV.attachDialog.popup();
this._addedToMainWindow=true
};
AttachMailZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
AttachMailZimlet.prototype.singleClicked=function(){};
AttachMailTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
var n=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(n.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=n;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype=new DwtComposite;
AttachMailTabView.prototype.constructor=AttachMailTabView;
AttachMailTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attMsg_SearchField";
AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attMsg_SearchBtn";
AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON="attDlg_attMsg_ViewMsgBtn";
AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attMsg_NavBtnCell";
AttachMailTabView.prototype.toString=function(){
return"AttachMailTabView"
};
AttachMailTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=e;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
this._currentQuery=e;
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachMailTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachMailTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachMailTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
var d=0;
o[d++]='<table width="100%" style="margin-bottom:5px">';
o[d++]='<TR><td width="20%"><INPUT type="text" id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_FIELD;
o[d++]='" style="padding:4px"></INPUT></td>';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON;
o[d++]='" style="margin: 0 2px" />';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON;
o[d++]='" style="margin: 0 2px" /></td>';
o[d++]='<td align="right" width="60%"><SPAN id="';
o[d++]=AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL;
o[d++]='" /></td></TR></table>';
o[d++]='<table width="100%">';
o[d++]="<tr>";
o[d++]='<td valign="top" id="'+this._folderTreeCellId+'">';
o[d++]="</td>";
o[d++]='<td  valign="top"  id="'+this._folderListId+'">';
o[d++]="</td>";
o[d++]="</tr>";
o[d++]="</table>";
this.setContent(o.join(""));
var h=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("AttachMailZimlet_tab_button_search");
h.setText(e);
h.addSelectionListener(new AjxListener(this,this._searchButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(h.getHtmlElement());
var r=new DwtButton({
parent:this}
);
var l=this.zimlet.getMessage("AttachMailZimlet_tab_button_view");
r.setText(l);
r.addSelectionListener(new AjxListener(this,this._viewMsgButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON).appendChild(r.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new AMZimletNavToolBar({
parent:this._navigationContainer}
);
var s=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,s);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,s);
document.getElementById(AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
var t={
parent:appCtxt.getShell(),className:"AttachMailTabBox AttachMailList",posStyle:DwtControl.ABSOLUTE_STYLE,view:ZmId.VIEW_BRIEFCASE_ICON,type:ZmItem.ATT};
var n=this._tabAttachMailView=new ZmAttachMailListView(t);
this.showAttachMailTreeView();
n.reparentHtmlElement(this._folderListId);
n.addSelectionListener(new AjxListener(this,this._listSelectionListener));
Dwt.setPosition(n.getHtmlElement(),Dwt.RELATIVE_STYLE)
};
AttachMailTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachMailTabView.prototype._viewMsgButtonListener=function(o){
var e=this.getSelectedMsgs();
for(var t=0;
t<e.length;
t++){
e[t].load({}
);
ZmMailMsgView.detachMsgInNewWindow(e[t])
}};
AttachMailTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachMailTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachMailTabView.prototype.searchFolder=function(t){
var e=AjxSoapDoc.create("SearchRequest","urn:zimbraMail");
e.setMethodAttribute("types","message");
e.setMethodAttribute("limit",t.limit);
e.setMethodAttribute("offset",t.offset);
e.set("query",t.query);
t.response=appCtxt.getAppController().sendRequest({
soapDoc:e,noBusyOverlay:false}
);
this.handleSearchResponse(t)
};
AttachMailTabView.prototype.handleSearchResponse=function(t){
var e=t.response;
if(e&&(e.SearchResponse||e._data.SearchResponse)){
t.searchResponse=e.SearchResponse||e._data.SearchResponse;
t.items=this.processDocsResponse(t)
}
if(t.callback){
t.callback.run(t)
}};
AttachMailTabView.prototype.processDocsResponse=function(s){
var o=s.searchResponse.m;
var e=new ZmMailList(ZmItem.MSG,this._currentSearch);
e.setHasMore(s.searchResponse.more);
if(o==undefined){
return e
}
for(var t=0;
t<o.length;
t++){
var n=o[t];
e.addFromDom(n)
}
return e
};
AttachMailTabView.prototype.showResultContents=function(n){
var t=n.items;
this._navTB.enable(ZmOperation.PAGE_BACK,n.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,t.hasMore());
var o=t.size();
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+t.size()))
}
if(t){
this._list=t
}else{
this._list=new ZmList(ZmItem.BRIEFCASE_ITEM)
}
var e=this._tabAttachMailView;
e.set(this._list)
};
AttachMailTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return(e!=DwtKeyEvent.KEY_ENTER&&e!=DwtKeyEvent.KEY_END_OF_TEXT)
};
AttachMailTabView.prototype.gotAttachments=function(){
return false
};
AttachMailTabView.prototype.getSelectedMsgs=function(){
var e=this._tabAttachMailView;
return e.getSelection()
};
AttachMailTabView.prototype.uploadFiles=function(o,e){
if(!e){
e=[];
var t=this.getSelectedMsgs();
if(!t||(t.length==0)){
return
}
for(var n in t){
e.push(t[n].id)
}}
if(o==undefined){
o=this.attachDialog
}
if(o._uploadCallback){
o._uploadCallback.run(AjxPost.SC_OK,null,null,e)
}
o.popdown()
};
AttachMailTabView.prototype.showAttachMailTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.mail.controller.ZmMailFolderTreeController");
AjxPackage.require({
name:"MailCore",forceReload:true,callback:e}
)
};
AttachMailTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.FOLDER="ZmMailFolderTreeController"
}
var o=appCtxt.getApp(ZmApp.MAIL);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["FOLDER"],fieldId:this._folderTreeCellId,overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"275");
this._currentQuery=this._getQueryFromFolder("2");
setTimeout(AjxCallback.simpleClosure(this.treeView.setSelected,this.treeView,2),100)
};
AttachMailTabView.prototype._setOverview=function(n){
var o=n.overviewId;
var s=appCtxt.getOverviewController();
var t=s.getOverview(o);
if(!t){
var e={
overviewId:o,overviewClass:"AttachMailTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:n.treeIds};
t=s.createOverview(e);
t.account=this.prevAccount;
t.set(n.treeIds)
}else{
if(n.account){
t.account=n.account
}}
t.setSelected(this.prevAccount.id+":"+ZmFolder.ID_INBOX,"FOLDER");
this._overview=t;
document.getElementById(n.fieldId).appendChild(t.getHtmlElement());
this.treeView=t.getTreeView("FOLDER");
this.treeView.addSelectionListener(new AjxListener(this,this._treeListener));
this._hideRoot(this.treeView)
};
AttachMailTabView.prototype._treeListener=function(o,e){
o=o||window.event;
if(e||o.detail==DwtTree.ITEM_SELECTED){
var t=this.treeView.getSelected();
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value=['in:"',t.getSearchPath(),'"'].join("");
var n=this._getQueryFromFolder(t.id);
this.executeQuery(n);
this._tabAttachMailView.focus()
}};
AttachMailTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachMailTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var r=o.x*0.35;
var s=o.x-r;
var t=e-55;
this._overview.setSize(r,t);
this._tabAttachMailView.setSize(s-5,t);
return this
};
AttachMailTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this.searchFolder({
query:t,offset:this._offset,limit:this._limit,callback:o}
)
};
ZmAttachMailController=function(e,t){
if(arguments.length==0){
return
}};
ZmAttachMailController.prototype=new ZmListController;
ZmAttachMailController.prototype.constructor=ZmAttachMailController;
ZmAttachMailController.prototype._resetToolbarOperations=function(){};
ZmAttachMailListView=function(e){
this._showCheckboxColSpan=appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)?1:0;
ZmListView.call(this,e);
this._controller=new ZmAttachMailController()
};
ZmAttachMailListView.prototype=new ZmListView;
ZmAttachMailListView.prototype.constructor=ZmAttachMailListView;
ZmAttachMailListView.prototype._getDivClass=function(t,e,o){
return""
};
ZmAttachMailListView.prototype._getCellContents=function(u,d,m,h,t,e){
var n=m.fragment?AjxStringUtil.htmlEncode(m.fragment.slice(0,80)):"";
var l=m.getAddress("FROM");
if(l.name!=""){
l=l.name
}else{
l=l.address
}
var o="";
var r=2;
if(m.hasAttach){
o="<td width='16px'><div class='ImgAttachment'/></td>";
r=3
}
u[d++]="<div class='AttachMailRowDiv'>";
u[d++]="<table width='100%'>";
var s=m.subject?AjxStringUtil.htmlEncode(m.subject.slice(0,32)):ZmMsg.noSubject;
u[d++]="<tr>";
if(this._showCheckboxColSpan==1){
u[d++]="<td rowspan=3 style='vertical-align:middle;' width='20'><center>";
d=this._getImageHtml(u,d,"CheckboxUnchecked",this._getFieldId(m,ZmItem.F_SELECTION));
u[d++]="</center></td>"
}
u[d++]=o;
u[d++]="<td align='left' width='80%'><span class='AttachMailSubject'> "+s+"</span></td>";
u[d++]="<td width='20%' align='right'>";
u[d++]=AjxDateUtil.computeDateStr(e.now||new Date(),m.date);
u[d++]="</td></tr>";
u[d++]="<tr><td align='left' colspan='"+r+"'><span class='AttachMailFrom'> ";
u[d++]=l;
u[d++]="</span></td></tr>";
if(n!=""){
u[d++]="<tr><td align=left colspan="+r+"><span class='AttachMailFrag'>"+n+"</span></td></tr>"
}
u[d++]="</table></div>";
return d
};
AMZimletNavToolBar=function(t){
t.className=t.className||"AMZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
AMZimletNavToolBar.prototype=new ZmButtonToolBar;
AMZimletNavToolBar.prototype.constructor=AMZimletNavToolBar;
AMZimletNavToolBar.prototype.toString=function(){
return"AMZimletNavToolBar"
};
AMZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
AMZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle AMZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
AMZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};
function Com_Zimbra_Url(){}
Com_Zimbra_Url.prototype=new ZmZimletBase();
Com_Zimbra_Url.prototype.constructor=Com_Zimbra_Url;
Com_Zimbra_Url.prototype.init=function(){
this._disablePreview=this.getBoolConfig("disablePreview",true);
this._youtubePreview=this.getBoolConfig("youtubePreview",true);
this._alexaId=this.getConfig("alexaThumbnailId");
if(this._alexaId){
this._alexaId=AjxStringUtil.trim(this._alexaId);
this._alexaKey=AjxStringUtil.trim(this.getConfig("alexaThumbnailKey"))
}
Com_Zimbra_Url.REGEXES=[];
var e=this.getConfig("ZIMLET_CONFIG_REGEX_VALUE");
if(e){
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}
if(/^\s*true\s*$/i.test(this.getConfig("supportUNC"))){
e=this.getConfig("ZIMLET_UNC_REGEX_VALUE");
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}};
Com_Zimbra_Url.THUMB_URL="http://images.websnapr.com/?url=";
Com_Zimbra_Url.THUMB_SIZE='width="200" height="150"';
Com_Zimbra_Url.IGNORE=AjxUtil.arrayAsHash([".",",",";","!","*",":","?",")","]","}"]);
Com_Zimbra_Url.prototype.match=function(u,h){
for(var n=0;
n<Com_Zimbra_Url.REGEXES.length;
n++){
var d=Com_Zimbra_Url.REGEXES[n];
d.lastIndex=h;
var t=d.exec(u);
if(!t){
continue
}
var e=t[0];
var l=e.charAt(e.length-1);
while(e.length&&Com_Zimbra_Url.IGNORE[l]){
if(l==")"){
var r=0;
var s=0;
for(var o in e){
if(e[o]=="("){
r++
}else{
if(e[o]==")"){
s++
}}}
if(r==s){
break
}}
e=e.substring(0,e.length-1);
l=e.charAt(e.length-1)
}
t[0]=e;
return t
}};
Com_Zimbra_Url.prototype._getHtmlContent=function(r,d,s,e){
var h=s.replace(/\"/g,'"').replace(/^\s+|\s+$/g,"");
if(h.substr(0,4)=="www."){
h="http://"+h
}
if(h.indexOf("\\\\")==0){
s.isUNC=true;
h="file://"+h
}
h=h.replace(/\\/g,"/");
var l="<a target='_blank' href='"+h;
if(h.split(/[\?#]/)[0]==(""+window.location).split(/[\?#]/)[0]){
var n=h.substr(h.indexOf("?"));
if(n){
var o=AjxStringUtil.parseQueryString(h);
if(o){
var t=o.app;
if(t&&t.length>0){
t=t.toUpperCase();
if(appCtxt.getApp(ZmApp[t])){
l="<a href='javascript:top.appCtxt.getAppController().activateApp(top.ZmApp."+t+", null, null);"
}}}}}
r[d++]=l;
r[d++]="'>";
r[d++]=AjxStringUtil.htmlEncode(s);
r[d++]="</a>";
return d
};
Com_Zimbra_Url.prototype.toolTipPoppedUp=function(n,s,o,t){
var e=s.replace(/^\s+|\s+$/g,"");
if(/^\s*true\s*$/i.test(this.getConfig("stripUrls"))){
e=e.replace(/[?#].*$/,"")
}
if(e.indexOf("\\\\")==0){
e="file:"+e
}
e=e.replace(/\\/g,"/");
if(this._disablePreview||e.indexOf("file://")==0){
this._showUrlThumbnail(e,t)
}else{
if(this._alexaId){
this._showAlexaThumbnail(e,t)
}else{
(new Image()).src=this.getResource("blank_pixel.gif");
this._showFreeThumbnail(e,t)
}}};
Com_Zimbra_Url.prototype.clicked=function(){
var e=DwtShell.getShell(window).getToolTip();
if(e){
e.popdown()
}
return true
};
Com_Zimbra_Url.prototype._showUrlThumbnail=function(t,e){
e.innerHTML="<b>URL:</b> "+AjxStringUtil.htmlEncode(decodeURI(t))
};
Com_Zimbra_Url.prototype._showFreeThumbnail=function(t,e){
var n=[];
var o=0;
n[o++]="<img src='";
n[o++]=this.getResource("blank_pixel.gif");
n[o++]="' ";
n[o++]=Com_Zimbra_Url.THUMB_SIZE;
n[o++]=" style='background: url(";
n[o++]='"';
n[o++]=Com_Zimbra_Url.THUMB_URL;
n[o++]=t;
n[o++]='"';
n[o++]=")'/>";
e.innerHTML=n.join("")
};
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE={};
Com_Zimbra_Url.ALEXA_CACHE_EXPIRES=10*60*1000;
Com_Zimbra_Url.prototype._showAlexaThumbnail=function(e,o){
o.innerHTML=["<table style='width: 200px; height: 150px; border-collapse: collapse' cellspacing='0' cellpadding='0'><tr><td align='center'>",ZmMsg.fetchingAlexaThumbnail,"</td></tr></table>"].join("");
var r=Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e];
if(r){
var f=new Date().getTime()-r.timestamp;
if(f<Com_Zimbra_Url.ALEXA_CACHE_EXPIRES){
var l=["<img src='",r.img,"' />"].join("");
o.firstChild.rows[0].cells[0].innerHTML=l;
return
}else{
delete Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e]
}}
var t=new Date(),s=Com_Zimbra_Url.zeroPad;
var d=s(t.getUTCFullYear(),4)+"-"+s(t.getUTCMonth()+1,2)+"-"+s(t.getUTCDate(),2)+"T"+s(t.getUTCHours(),2)+":"+s(t.getUTCMinutes(),2)+":"+s(t.getUTCSeconds(),2)+".000Z";
var n=this._computeAlexaSignature(d);
var u={
Service:"AlexaSiteThumbnail",Action:"Thumbnail",AWSAccessKeyId:this._alexaId,Timestamp:d,Signature:n,Size:"Large",Url:e};
var m=[];
for(var h in u){
m.push(h+"="+AjxStringUtil.urlComponentEncode(u[h]))
}
m="http://ast.amazonaws.com/xino/?"+m.join("&");
this.sendRequest(null,m,null,new AjxCallback(this,this._alexaDataIn,[o,e,m]),true)
};
Com_Zimbra_Url.prototype._computeAlexaSignature=function(e){
return AjxSHA1.b64_hmac_sha1(this._alexaKey,"AlexaSiteThumbnailThumbnail"+e)+"="
};
Com_Zimbra_Url.prototype._alexaDataIn=function(n,o,h,e){
var t=AjxXmlDoc.createFromDom(e.xml);
var r=t.toJSObject(true,false,true);
r=r.Response;
if(r.ResponseStatus.StatusCode=="Success"){
if(r.ThumbnailResult.Thumbnail.Exists=="true"){
var s=["<img src='",r.ThumbnailResult.Thumbnail,"' />"].join("");
n.firstChild.rows[0].cells[0].innerHTML=s;
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[o]={
img:r.ThumbnailResult.Thumbnail,timestamp:new Date().getTime()}
}else{
this._showFreeThumbnail(o,n)
}}else{
this._showFreeThumbnail(o,n)
}};
Com_Zimbra_Url.zeroPad=function(o,t){
var e=""+o;
while(e.length<t){
e="0"+e
}
return e
};
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1="youtube.com/watch?";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2="youtube.com/v/";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3="youtu.be/";
Com_Zimbra_Url.YOUTUBE_FEED="http://gdata.youtube.com/feeds/api/videos/@ID?alt=jsonc&v=2";
Com_Zimbra_Url.YOUTUBE_EMBED_URL="www.youtube.com/embed/";
Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL="http://img.youtube.com/vi/@ID.jpg";
Com_Zimbra_Url.PROTOCOL=location.protocol;
Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS=5;
Com_Zimbra_Url.prototype._getYouTubeFeed=function(){
for(var t in this._youTubeHash){
var e=Com_Zimbra_Url.YOUTUBE_FEED;
e=e.replace("@ID",t);
e=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(e);
var o={
url:e,callback:new AjxCallback(this,this._parseYouTubeFeed,[t])};
AjxLoader.load(o)
}};
Com_Zimbra_Url.prototype._parseYouTubeFeed=function(youTubeId,req){
if(req.status!=200){
var thumbnail=Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL.replace("@ID",youTubeId);
var title="";
this._youTubeHash[youTubeId]={
thumbnail:thumbnail,title:title};
this._buildYouTubeImageHtml(youTubeId)
}else{
var json=eval("("+req.responseText+")");
var thumbnail=json.data.thumbnail.sqDefault;
var title=json.data.title;
this._youTubeHash[youTubeId]={
thumbnail:thumbnail,title:title};
this._buildYouTubeImageHtml(youTubeId)
}};
Com_Zimbra_Url.prototype.getYouTubeId=function(o){
var n=null;
var t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1);
if(t!=-1){
var e=AjxStringUtil.parseQueryString(o);
if(e&&e.v){
n=e.v
}}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2.length))
}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3.length))
}}}
return n
};
Com_Zimbra_Url.prototype._showYouTubeVideo=function(o,n){
if(!o||!n){
return
}
var t=document.getElementById("youtube-video_"+this._viewId+"_"+n);
var e=document.getElementById("youtube-iframe_"+this._viewId+"_"+n);
if(t){
if(!Dwt.getVisible(t)){
t.innerHTML="<br/>"+this._showYouTubeEmbed(o,n);
Dwt.setVisible(t,true);
this._setYouTubeOpacity(o,n,true)
}else{
if(e&&e.src==Com_Zimbra_Url.PROTOCOL+"//www.youtube.com/embed/"+o){
Dwt.setVisible(t,false);
this._setYouTubeOpacity(o,n,false)
}else{
t.innerHTML="<br/>"+this._showYouTubeEmbed(o,n);
this._setYouTubeOpacity(o,n,true)
}}}};
Com_Zimbra_Url.prototype._showYouTubeEmbed=function(e,t){
return'<iframe id="youtube-iframe_'+this._viewId+"_"+t+'" class="youtube-player" type="text/html"width="640" height="385"src="'+Com_Zimbra_Url.PROTOCOL+"//"+Com_Zimbra_Url.YOUTUBE_EMBED_URL+e+'?autoplay=1&rel=0" frameborder="0"></iframe>'
};
Com_Zimbra_Url.prototype._showYouTubeThumbnail=function(e){
return"<div class='thumb-wrapper'><div class='play'></div><img src='"+this._youTubeHash[e].thumbnail+"' border='2'></div>"
};
Com_Zimbra_Url.prototype._getAllYouTubeLinks=function(l){
if(!l){
return null
}
var r=l.match(/(\b(((http | https)\:\/\/)?(www\.)?((youtube\.com\/watch\?v=)|(youtube\.com\/watch\?.*\&v=)|(youtube\.com\/v\/)|(youtu\.be\/))((-)?[0-9a-zA-Z_-]+)?(&\w+=\w+)*)\b)/gi);
var o={};
var t=0;
if(r){
for(var n=0;
n<r.length;
n++){
var e=this.getYouTubeId(r[n]);
if(!o.hasOwnProperty(e)){
o[e]=r[n];
t++
}}
if(t>Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS){
var s={};
var d=1;
for(var h in o){
if(d>Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS){
this._youTubeHitMax=true;
return s
}
s[h]=true;
d++
}
return s
}
return o
}
return null
};
Com_Zimbra_Url.prototype._buildYouTubeImageHtml=function(n){
if(!this._youTubeHash||!n||document.getElementById("YOUTUBE_"+n+"_"+this._viewId+"_"+this._msgId)){
return
}
var t=this._showYouTubeThumbnail(n);
var o=document.createElement("div");
o.className="youTubeImagePreview";
o.innerHTML=t;
o.id="YOUTUBE_"+n+"_"+this._viewId+"_"+this._msgId;
this._youTubeCtrlHash[this._msgId].getHtmlElement().appendChild(o);
this._youTubeCtrlHash[this._msgId].setData(o.id,{
youTubeId:n,msgId:this._msgId}
);
var s=document.getElementById("youtube_"+this._viewId+"_"+this._msgId);
var e=document.getElementById("youtube-video_"+this._viewId+"_"+this._msgId);
if(s&&e){
s.insertBefore(this._youTubeCtrlHash[this._msgId].getHtmlElement(),e);
Dwt.setVisible(s,true)
}};
Com_Zimbra_Url.prototype._onYouTubeClickListener=function(e){
if(e&&e.target&&e.target.parentNode&&e.target.parentNode.parentNode){
var n=e.target.parentNode.parentNode.id.replace("YOUTUBE_","");
n=n.replace("_"+this._viewId,"");
var t=n.substring(0,11);
var o=n.substring(12);
if(t&&o){
this._showYouTubeVideo(t,o)
}}};
Com_Zimbra_Url.prototype._onYouTubeMouseOver=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid white"
}};
Com_Zimbra_Url.prototype._onYouTubeMouseOut=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid"
}};
Com_Zimbra_Url.prototype._setYouTubeOpacity=function(o,n,t){
var e=document.getElementById("YOUTUBE_"+o+"_"+this._viewId+"_"+n);
if(e&&e.firstChild&&t){
e=e.firstChild;
e.style.opacity=0.4;
e.style.filter="alpha(opacity=40)";
for(var s in this._youTubeHash){
if(s!=o){
e=document.getElementById("YOUTUBE_"+s+"_"+this._viewId+"_"+n);
if(e&&e.firstChild){
e.firstChild.style.opacity="";
e.firstChild.style.filter=""
}}}}else{
if(e&&e.firstChild){
e=e.firstChild;
e.style.opacity="";
e.style.filter=""
}}};
Com_Zimbra_Url.prototype.onConvView=function(o,e,t){
this._isConv=true;
this.renderYouTube(o,t)
};
Com_Zimbra_Url.prototype.onMsgView=function(o,e,t){
this._isConv=false;
this.renderYouTube(o,t)
};
Com_Zimbra_Url.prototype.renderYouTube=function(o,r){
if(!this._youtubePreview||appCtxt.isChildWindow){
return
}
this._youTubeHitMax=false;
this._youTubeHash={};
this._youTubeCtrlHash={};
var m=r?r.getContent():"";
this._youTubeHash=m&&this._getAllYouTubeLinks(m);
if(!this._youTubeHash){
return
}
this._msgId=o.id;
this._viewId=appCtxt.getCurrentViewId();
var h=appCtxt.getCurrentView().getItemView();
var s=this._isConv?(h._msgViews&&h._msgViews[this._msgId]&&h._msgViews[this._msgId]._msgBodyDivId):h._msgBodyDivId;
var t=document.getElementById(s);
if(t){
var e=document.createElement("DIV");
e.className="video-panel";
e.id="youtube_"+this._viewId+"_"+this._msgId;
e.style.display="none";
var l=this.getMessage("youTubeTitle");
if(this._youTubeHitMax){
l=this.getMessage("youTubeTitleMax").replace("{0}",Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS)
}
e.innerHTML="<h3 class='user_font_"+appCtxt.get(ZmSetting.FONT_NAME)+"'>"+l+"</h3>";
var u=document.createElement("div");
u.style.padding="5px";
t.appendChild(u);
t.appendChild(e);
var d=document.createElement("div");
d.id="youtube-video_"+this._viewId+"_"+this._msgId;
d.style.display="none";
d.className="movie-player";
e.appendChild(d);
this._getYouTubeFeed();
var n=new DwtControl({
parent:appCtxt.getShell()}
);
n.addListener(DwtEvent.ONMOUSEDOWN,this._onYouTubeClickListener.bind(this));
n.addListener(DwtEvent.ONMOUSEOVER,this._onYouTubeMouseOver.bind(this));
n.addListener(DwtEvent.ONMOUSEOUT,this._onYouTubeMouseOut.bind(this));
n.reparentHtmlElement(d);
this._youTubeCtrlHash[this._msgId]=n
}};
Com_Zimbra_Url.CALENDAR_URL_EXTENSION="ics";
Com_Zimbra_Url.prototype.getActionMenu=function(n,t,e){
var o=AjxStringUtil.parseURL(n),r=o.fileName,s=r?r.substring(r.lastIndexOf(".")+1):"";
if(!appCtxt.get(ZmApp.SETTING[ZmId.APP_CALENDAR])||s!=Com_Zimbra_Url.CALENDAR_URL_EXTENSION){
return false
}
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Url._actionObject=n;
Com_Zimbra_Url._actionSpan=t;
Com_Zimbra_Url._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Url.prototype.menuItemSelected=function(t,e){
switch(t){
case"NEWCAL":this._newCalListener(e);
break;
case"GOTOURL":this._goToUrlListener();
break
}};
Com_Zimbra_Url.prototype._goToUrlListener=function(){
window.open(Com_Zimbra_Url._actionObject,"_blank")
};
Com_Zimbra_Url.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Url.prototype._newCalListener=function(o){
AjxDispatcher.require(["CalendarCore","Calendar"]);
var e=appCtxt.getOverviewController();
var s=e.getTreeController(ZmOrganizer.CALENDAR);
var n={
url:Com_Zimbra_Url._actionObject};
s._newListener(o);
var t=appCtxt.getNewCalendarDialog();
t.setICalData(n)
};
Com_Zimbra_Date=function(e){
if(arguments.length==1){
this._generateRegex(e)
}};
Com_Zimbra_Date.prototype=new ZmZimletBase();
Com_Zimbra_Date.prototype.constructor=Com_Zimbra_Date;
Com_Zimbra_Date.prototype.TYPE=ZmObjectManager.DATE;
Com_Zimbra_Date.validate=function(e,n,t){
if(e<1||e>31){
return false
}
if(n<0||n>11){
return false
}
if((n==3||n==5||n==8||n==10)&&e==31){
return false
}
if(t&&n==1){
var o=(t%4==0&&(t%100!=0||t%400==0));
if(e>29||(e==29&&!o)){
return false
}}
return true
};
Com_Zimbra_Date.prototype.getCurrentDate=function(e){
var t=this[ZmObjectManager.ATTR_CURRENT_DATE];
return t?t:new Date()
};
Com_Zimbra_Date.prototype.init=function(){
Com_Zimbra_Date.prototype._zimletContext=this._zimletContext;
Com_Zimbra_Date.prototype._className="Object";
this._initDateObjectHandlers()
};
Com_Zimbra_Date.prototype.getActionMenu=function(o,t,e){
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Date._actionObject=o;
Com_Zimbra_Date._actionSpan=t;
Com_Zimbra_Date._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Date.prototype.menuItemSelected=function(e){
switch(e){
case"DAYVIEW":this.showDayView(Com_Zimbra_Date._actionContext.date);
break;
case"NEWAPPT":this._newApptListener();
break;
case"SEARCHMAIL":this._searchMailListener();
break
}};
Com_Zimbra_Date.prototype.toolTipPoppedUp=function(o,n,t,e){
var s=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!s){
return
}
e.innerHTML=s.getDateToolTip(t?t.date:new Date())
};
Com_Zimbra_Date.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Date.prototype.getAppInMainWindow=function(o){
var t=this.getMainWindow();
if(!t){
return null
}
var e=t.appCtxt;
if(!e){
return null
}
return e.getApp(o)
};
Com_Zimbra_Date.prototype.clicked=function(o,n,t,e){
this.showDayView(t.date)
};
Com_Zimbra_Date.prototype.showDayView=function(e){
var t=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!t){
return
}
t.showDayView(e);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype.match=function(g,f){
if(!Com_Zimbra_Date.PATTERNS){
return null
}
var r,t,d,p,n,s;
for(s=0;
s<Com_Zimbra_Date.REGEXES.length;
s++){
p=Com_Zimbra_Date.REGEXES[s];
p.lastIndex=f;
n=p.exec(g);
if(n&&n[0]&&(!r||n[0].length>r[0].length)){
r=n;
d=Com_Zimbra_Date.RULES[s];
t=p.mapping;
break
}}
if(!r){
return null
}
try{
var h,u;
for(s in t){
h=t[s];
u=r[s];
d=d.replace(new RegExp("\\{"+h+"\\}","gi"),u)
}
var o=new Date(this.getCurrentDate().getTime());
r.context={
rule:d,date:AjxDateUtil.calculate(d,o),monthOnly:0,valid:true};
return r
}
catch(l){
if(window.console&&window.console.log){
console.log(l)
}
return null
}};
Com_Zimbra_Date.prototype._initDateObjectHandlers=function(){
if(!appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
return
}
Com_Zimbra_Date.MAPPINGS={
datenum:"(3[0-1]|0[1-9]|[1-9]|[1-2][0-9])",dayname:"("+AjxDateUtil.S_DAYNAME+")",weekord:"("+AjxDateUtil.S_WEEKORD+")",monthnum:"(0[1-9]|[1-9]|1[0-2])",monthname:"("+AjxDateUtil.S_MONTHNAME+")",yearnum:"(\\d{2}|[1-9]\\d{2,3})",fullyearnum:"(\\d{4})",number:"(\\d+)",timenum:"(1[0-2]:?[0-5][0-9]|[1-9]:?[0-5][0-9]|1[0-2]|[1-9])",militarytimenum:"(2[0-3]:?[0-5][0-9]|[0-1][0-9]:?[0-5][0-9])"};
Com_Zimbra_Date.PATTERNS=[];
Com_Zimbra_Date.RULES=[];
Com_Zimbra_Date.REGEXES=[];
var o,s;
for(o=1;
s=this.getMessage("format"+o+".pattern");
o++){
if(s.match(/^\?\?\?+/)){
break
}
if(s.match(/^###+/)){
break
}
if(s.match(/^#/)){
continue
}
Com_Zimbra_Date.PATTERNS.push(s);
Com_Zimbra_Date.RULES.push(this.getMessage("format"+o+".rule"))
}
for(o=0;
o<Com_Zimbra_Date.DEFAULT_FORMATS.length;
o++){
Com_Zimbra_Date.PATTERNS.push(Com_Zimbra_Date.DEFAULT_FORMATS[o]);
Com_Zimbra_Date.RULES.push(Com_Zimbra_Date.DEFAULT_FORMATS[++o])
}
var t=this.getMessage("boundaryTrue");
var r,n;
var e=this.getMessage("format.boundary")||t;
for(o=0;
o<Com_Zimbra_Date.PATTERNS.length;
o++){
s=Com_Zimbra_Date.PATTERNS[o];
s=s.replace(/\s+/g,"\\s+");
s=s.replace(/\(([^\)]+)\)/g,"(?:$1)");
Com_Zimbra_Date.__replaceKeyword_group=1;
Com_Zimbra_Date.__replaceKeyword_mapping={};
s=s.replace(/\{([a-z]+)\}/g,Com_Zimbra_Date.__replaceKeyword);
r=this.getMessage("format"+(o+1)+".boundary");
if((r!=""&&r==t)||e==t){
s="\\b"+s+"\\b"
}
n=new RegExp(s,"gi");
n.mapping=Com_Zimbra_Date.__replaceKeyword_mapping;
Com_Zimbra_Date.REGEXES.push(n)
}
ZmObjectManager.registerHandler(this,ZmObjectManager.DATE,this._zimletContext.priority)
};
Com_Zimbra_Date.prototype._newApptListener=function(){
var t=this.getMainWindow();
if(!t){
return
}
var e=new t.AjxCallback(this,this._handleLoadNewAppt);
t.AjxDispatcher.require(["CalendarCore","Calendar","CalendarAppt"],false,e,null,true)
};
Com_Zimbra_Date.prototype._handleLoadNewAppt=function(){
var e=this.getMainWindow();
if(!e){
return null
}
e.appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);
e.AjxDispatcher.run("GetCalController").newAppointmentHelper(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype._searchMailListener=function(){
var e=this.getMainWindow(ZmApp.CALENDAR);
if(!e){
return
}
e.appCtxt.getSearchController().dateSearch(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.__replaceKeyword_mapping=null;
Com_Zimbra_Date.__replaceKeyword_group=-1;
Com_Zimbra_Date.__replaceKeyword=function(e,t){
var n=Com_Zimbra_Date.MAPPINGS;
t=t.toLowerCase();
if(!n[t]){
return e
}
var o=Com_Zimbra_Date.__replaceKeyword_mapping;
var s=Com_Zimbra_Date.__replaceKeyword_group++;
o[s++]=t;
return n[t]
};
Com_Zimbra_Date.DEFAULT_FORMATS=["Dante Mateo Comfort","2011-03-01T17:26:00Z","Brooke Ellen Henrikson","2009-10-17T10:20:00Z","Nicholas Mateo Damon","2008-07-18T17:35:00Z","Shyar Parag Shah","2008-07-16T04:51:00Z","Diego Isaac Comfort","2006-12-08T20:05:00Z","Nila Dharmaraj","2006-03-19T16:30:00Z","Nikhil Dharmaraj","2001-08-22T20:00:00Z"];
function Com_Zimbra_Phone(){}
Com_Zimbra_Phone.prototype=new ZmZimletBase();
Com_Zimbra_Phone.prototype.constructor=Com_Zimbra_Phone;
Com_Zimbra_Phone.PEOPLE_SEARCH_TOOLBAR_ID="phone";
Com_Zimbra_Phone.prototype._getHtmlContent=function(n,e,t,o){
var s=Com_Zimbra_Phone.getCallToLink(t);
n[e++]=['<a href="',s,'" onclick="window.top.Com_Zimbra_Phone.unsetOnbeforeunload()">',AjxStringUtil.htmlEncode(t),"</a>"].join("");
return e
};
Com_Zimbra_Phone.prototype.toolTipPoppedUp=function(n,s,t,e){
var o={
contentObjText:s,callStr:this.getMessage("call")};
e.innerHTML=AjxTemplate.expand("com_zimbra_phone.templates.Phone#Tooltip",o)
};
Com_Zimbra_Phone.prototype.menuItemSelected=function(e){
switch(e){
case"SEARCH":this._searchListener();
break;
case"ADDCONTACT":this._contactListener();
break;
case"CALL":this._callListener();
break
}};
Com_Zimbra_Phone.prototype.onPeopleSearchShow=function(n,e,s){
n._clearText(s+"-phone");
var o=e&&e.getAttr(ZmContact.F_workPhone);
if(o){
var t=new DwtText({
parent:appCtxt.getShell(),parentElement:s+"-phone",index:0,id:"NewCall",className:"FakeAnchor"}
);
t.isLinkText=true;
t.setText(o);
t.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._peopleSearchItemListener));
t.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,n.peopleItemMouseOverListener));
t.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,n.peopleItemMouseOutListener))
}};
Com_Zimbra_Phone.prototype._peopleSearchItemListener=function(o){
var t=o.target.innerHTML;
var e=Com_Zimbra_Phone.getCallToLink(t);
Com_Zimbra_Phone.unsetOnbeforeunload();
window.location=e
};
Com_Zimbra_Phone.prototype._searchListener=function(){
appCtxt.getSearchController().search({
query:this._actionObject}
)
};
Com_Zimbra_Phone.prototype._contactListener=function(){
var e=new ZmContact(null);
e.initFromPhone(this._actionObject,this.getConfig("defaultContactField"));
AjxDispatcher.run("GetContactController").show(e)
};
Com_Zimbra_Phone.prototype._callListener=function(){
var e=Com_Zimbra_Phone.getCallToLink(this._actionObject.toString());
Com_Zimbra_Phone.unsetOnbeforeunload();
window.location=e
};
Com_Zimbra_Phone.resetOnbeforeunload=function(){
window.onbeforeunload=ZmZimbraMail._confirmExitMethod
};
Com_Zimbra_Phone.unsetOnbeforeunload=function(){
window.onbeforeunload=null;
this._timerObj=new AjxTimedAction(null,Com_Zimbra_Phone.resetOnbeforeunload);
AjxTimedAction.scheduleAction(this._timerObj,3000)
};
Com_Zimbra_Phone.getCallToLink=function(t){
if(!t){
return""
}
var e=AjxStringUtil.trim(t,true);
if(!/^(?:\+|00)/.test(e)){
if(this.countryCode==1){
e="+1"+e
}}
return"callto:"+e
};
Com_Zimbra_Phone.prototype.match=function(o,s){
var n=this.RE;
n.lastIndex=s;
var e=n.exec(o);
if(!e){
return e
}
var t=e[0];
if(t.length>10&&t[0]!="+"&&!(AjxUtil.arrayContains(t," "))&&!(AjxUtil.arrayContains(t,"."))&&!(AjxUtil.arrayContains(t,"-"))){
return null
}else{
e[0]=t;
return e
}};
AjxTemplate.register("com_zimbra_phone.templates.Phone#Tooltip",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table cellpadding=2 cellspacing=0 border=0><tr valign='center'><td>";
e[o++]=AjxImg.getImageHtml("Telephone");
e[o++]="</td><td><b><div style='white-space:nowrap'>";
e[o++]=s.callStr;
e[o++]="</div></b></td><td><div style='white-space:nowrap'>";
e[o++]=AjxStringUtil.htmlEncode(s.contentObjText);
e[o++]="</div></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"Tooltip"}
,true);
AjxPackage.define("com_zimbra_phone.templates.Phone");
AjxTemplate.register("com_zimbra_phone.templates.Phone",AjxTemplate.getTemplate("com_zimbra_phone.templates.Phone#Tooltip"),AjxTemplate.getParams("com_zimbra_phone.templates.Phone#Tooltip"));
AjxTemplate.register("com_zimbra_email.templates.Email1#Frame",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div id='UnknownPersonSlide_Frame' style='background:white;display:block;height:100%;overflow:auto;padding:10px;'><table width='100%'><tr><td valign='top' width='65'><div id=\"";
e[o++]=s.photoParentId;
e[o++]='"></div></td><td><div id="';
e[o++]=s.textDivId;
e[o++]="\" style='margin-left:10px;'></div></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"Frame"}
,true);
AjxPackage.define("com_zimbra_email.templates.Email1");
AjxTemplate.register("com_zimbra_email.templates.Email1",AjxTemplate.getTemplate("com_zimbra_email.templates.Email1#Frame"),AjxTemplate.getParams("com_zimbra_email.templates.Email1#Frame"));
AjxTemplate.register("com_zimbra_email.templates.Email1#ContactDetails",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
if(s.fullName){
e[o++]="<div><label id='UnknownPersonSlide_NameAnchorId' class='FakeAnchor' style='font-size:15px;font-weight:bold;'>";
e[o++]=AjxStringUtil.htmlEncode(s.fullName);
e[o++]="</label></div>"
}
e[o++]="<table style='margin-bottom:.5em;'><tr id='row_Presence'><td><div id='img_Presence'></div></td><td><label id='text_Presence'></label></td></tr></table>";
if(s.jobTitle){
e[o++]="<div><label >";
e[o++]=AjxStringUtil.htmlEncode(s.jobTitle);
e[o++]="</label></div>"
}
if(s.email){
e[o++]="<div><label  id='UnknownPersonSlide_EmailAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.email);
e[o++]="</label></div>"
}
if(s.mobilePhone){
e[o++]="<div><label id='UnknownPersonSlide_mobilePhoneAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.mobilePhone);
e[o++]=" (";
e[o++]=ZmMsg.cell;
e[o++]=")</label></div>"
}
if(s.workPhone){
e[o++]="<div><label id='UnknownPersonSlide_workPhoneAnchorId' class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.workPhone);
e[o++]=" (";
e[o++]=ZmMsg.work;
e[o++]=")</label></div>"
}
if(s.address){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.address);
e[o++]=" (";
e[o++]=ZmMsg.work;
e[o++]=")</label></div>"
}
if(s.imURI){
e[o++]="<div><label> ";
e[o++]=s.imURI;
e[o++]=" (";
e[o++]=ZmMsg.imShort;
e[o++]=")</label></div>"
}
return n?e.length:e.join("")
}
,{
id:"ContactDetails"}
,true);
function com_zimbra_email_handlerObject(){
this.isPrimaryEmailTooltip=true;
this._isBubble={};
this._bubbleClassName="addrBubble";
this._bubbleParams={};
this._internalId=Dwt.getNextId();
DwtControl.ALL_BY_ID[this._internalId]=this
}
com_zimbra_email_handlerObject.prototype=new ZmZimletBase();
com_zimbra_email_handlerObject.prototype.constructor=com_zimbra_email_handlerObject;
var EmailTooltipZimlet=com_zimbra_email_handlerObject;
EmailTooltipZimlet.IM_NEW_IM="im new im";
EmailTooltipZimlet.IM_NEW_BUDDY="im new buddy";
EmailTooltipZimlet.NEW_FILTER="__new__";
EmailTooltipZimlet.MAILTO_RE=/^mailto:[\x27\x22]?([^@?&\x22\x27]+@[^@?&]+\.[^@?&\x22\x27]+)[\x27\x22]?/;
EmailTooltipZimlet.tooltipWidth=280;
EmailTooltipZimlet.prototype.init=function(){
if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){
AjxDispatcher.require(["ContactsCore","Contacts"]);
if(appCtxt.get(ZmSetting.IM_ENABLED)){
this._presenceCache=[]
}}
this._prefDialog=new EmailToolTipPrefDialog(this);
this._subscriberZimlets=[];
this._presenceProvider=null;
this._preLoadImgs();
this._convModeCount=0;
this._presenceCache=[]
};
EmailTooltipZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
EmailTooltipZimlet.prototype.singleClicked=function(){
this._prefDialog.popup()
};
EmailTooltipZimlet.prototype._getRoster=function(){
if(!this._roster&&appCtxt.get(ZmSetting.IM_ENABLED)&&!(!appCtxt.get(ZmSetting.IM_PREF_AUTO_LOGIN)&&!appCtxt.getApp(ZmApp.IM).hasRoster())){
this._roster=AjxDispatcher.run("GetRoster");
var e=this._roster.getRosterItemList();
e.addChangeListener(new AjxListener(this,this._rosterChangeListener))
}
return this._roster
};
EmailTooltipZimlet.prototype._rosterChangeListener=function(d){
if(d.event!=ZmEvent.E_MODIFY){
return
}
var l=d.getDetail("fields");
var n=ZmRosterItem.F_PRESENCE in l;
if(n){
var t=d.getItems();
var r={};
for(var h=t.length;
--h>=0;
){
var u=t[h];
r[u.getAddress()]=u
}
var e=this._presenceCache;
for(var h=e.length;
--h>=0;
){
var o=e[h];
var u=r[o.im_addr];
if(u){
var s=document.getElementById(o.img_id);
if(s&&u.getPresence().getShow()==ZmRosterPresence.SHOW_ONLINE){
AjxImg.setImage(s,u.getPresence().getIcon(true),true)
}else{}}}}};
EmailTooltipZimlet.prototype.onConvStart=function(){
if(this._convModeCount==0){
this._clearBubbles()
}
this._convModeCount++
};
EmailTooltipZimlet.prototype.onConvEnd=function(){
this._convModeCount--
};
EmailTooltipZimlet.prototype.onFindMsgObjects=function(){
if(this._convModeCount==0){
this._clearBubbles()
}};
EmailTooltipZimlet.prototype._clearBubbles=function(){
if(appCtxt.get(ZmSetting.USE_ADDR_BUBBLES)){
this._bubbleList=new ZmAddressBubbleList();
this._bubbleList.addSelectionListener(new AjxListener(this,this._bubbleSelectionListener));
this._bubbleList.addActionListener(new AjxListener(this,this._bubbleActionListener));
this._bubbleParams={}
}};
EmailTooltipZimlet.prototype.generateSpan=function(n,r,o,t,e,d){
d=d||{};
if(d.addrBubbles){
this._isBubble[t]=true;
var l=o.isGroup&&o.canExpand&&appCtxt.get("EXPAND_DL_ENABLED");
if(l&&!this._aclv){
var h={
dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_FULL,options:{
addrBubbles:true,massDLComplete:true}
,selectionCallback:this._dlAddrSelected.bind(this),contextId:this.name};
this._aclv=new ZmAutocompleteListView(h)
}
var s={
parent:appCtxt.getShell(),parentId:this._internalId,addrObj:o,id:t,canExpand:l,email:this._getAddress(o),separator:AjxEmailAddress.SEPARATOR};
ZmAddressInputField.BUBBLE_OBJ_ID[t]=this._internalId;
this._bubbleParams[t]=s;
n[r++]="<span id='"+t+"'>";
n[r++]="</span>";
return r
}else{
return ZmObjectHandler.prototype.generateSpan.apply(this,arguments)
}};
EmailTooltipZimlet.prototype.onMsgView=function(){
this._createBubbles()
};
EmailTooltipZimlet.prototype.onConvView=function(){
this._createBubbles()
};
EmailTooltipZimlet.prototype._createBubbles=function(){
for(var o in this._bubbleParams){
if(!document.getElementById(o)){
continue
}
var t=this._bubbleParams[o];
var e=new ZmAddressBubble(t);
e.replaceElement(o);
if(this._bubbleList){
this._bubbleList.add(e)
}}};
EmailTooltipZimlet.prototype._bubbleSelectionListener=function(t){
var e=t.item;
if(e&&t.detail===DwtEvent.ONDBLCLICK){
this._composeListener(t,e.address)
}};
EmailTooltipZimlet.prototype._bubbleActionListener=function(t){
var e=t.item;
var o=this.getActionMenu(e.addrObj);
if(o){
this._actionBubble=e;
o.popup(0,t.docX,t.docY)
}};
EmailTooltipZimlet.prototype._menuPopdownListener=function(){
if(!appCtxt.get(ZmSetting.USE_ADDR_BUBBLES)){
return
}
if(this._actionBubble){
this._actionBubble.setClassName(this._bubbleClassName)
}
AjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){
this._actionBubble=null;
if(this._bubbleList){
this._bubbleList.clearRightSelection()
}}
),10)
};
EmailTooltipZimlet.prototype.getClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype.getHoveredClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getHoveredClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype.getActiveClassName=function(o,e,t){
return(this._isBubble[t])?this._bubbleClassName:ZmObjectHandler.prototype.getActiveClassName.apply(this,arguments)
};
EmailTooltipZimlet.prototype._getHtmlContent=function(n,l,o,e,t,u){
if(o instanceof AjxEmailAddress){
var e=window.parentAppCtxt||window.appCtxt;
var h=e.getApp(ZmApp.CONTACTS);
var s=h&&h.getContactByEmail(o.address);
var r=this._getBuddy(s,o.address);
if(h&&!s&&s!==null){
var d=new AjxCallback(this,this._handleResponseGetContact,[n,l,o,t,u]);
h.getContactByEmail(o.address,d)
}
return this._updateHtmlContent(n,l,o,s,r,t,u)
}else{
n[l++]=AjxStringUtil.htmlEncode(o);
return l
}};
EmailTooltipZimlet.prototype._updateHtmlContent=function(s,m,n,r,d,t,f){
var h;
var o=d&&d.getPresence();
if(o&&o.getShow()==ZmRosterPresence.SHOW_ONLINE){
var l=Dwt.getNextId();
h=[AjxStringUtil.htmlEncode(d.getDisplayName()),AjxImg.getImageHtml(o.getIcon(true),"display:inline; padding-left:13px","id="+l)].join("");
var e={
contact:r,buddy:d,im_addr:d.getAddress(),img_id:l};
this._presenceCache.push(e);
if(this._presenceCache.length>50){
this._presenceCache.splice(0,1)
}
this._getRoster()
}else{
h=AjxStringUtil.htmlEncode(n.toString(f&&f.shortAddress))
}
var u=t&&document.getElementById(t);
if(u){
u.innerHTML=h
}else{
s[m++]=h;
return m
}};
EmailTooltipZimlet.prototype._handleResponseGetContact=function(s,t,h,r,n,e){
if(e){
var o=this._getBuddy(e,h.address);
this._updateHtmlContent(s,t,h,e,o,r,n)
}};
EmailTooltipZimlet.prototype._getBuddy=function(e,t){
if(appCtxt.isChildWindow){
return
}
var o;
if(appCtxt.get(ZmSetting.IM_ENABLED)&&!(!appCtxt.get(ZmSetting.IM_PREF_AUTO_LOGIN)&&!appCtxt.getApp(ZmApp.IM).hasRoster())){
o=e&&e.getBuddy();
if(!o){
o=AjxDispatcher.run("GetRoster").getRosterItem(t)
}}
return o
};
EmailTooltipZimlet.prototype.hoverOut=function(e,t,n,o){
if(!this.tooltip){
return
}
if(o&&this._bubbleParams[o]){
return
}
this._hoverOver=false;
this.tooltip._poppedUp=false;
setTimeout(AjxCallback.simpleClosure(this.popDownIfMouseNotOnSlide,this),700)
};
EmailTooltipZimlet.prototype.popDownIfMouseNotOnSlide=function(){
if(this._hoverOver){
return
}else{
if(this.slideShow&&this.slideShow.isMouseOverTooltip){
return
}else{
if(this.tooltip){
this.tooltip._poppedUp=true;
this.tooltip.popdown()
}}}};
EmailTooltipZimlet.prototype.popdown=function(){
this._hoverOver=false;
if(this.tooltip){
this.tooltip._poppedUp=true;
this.tooltip.popdown()
}};
EmailTooltipZimlet.prototype.addSubscriberZimlet=function(e,o,t){
this._subscriberZimlets.push(e);
if(o){
this.primarySubscriberZimlet=e
}
if(t&&t.presenceCallback&&!this._presenceProvider){
this._presenceProvider=t.presenceCallback
}};
EmailTooltipZimlet.prototype.hoverOver=function(t,n,e,h,s){
var o=DwtShell.getShell(window);
var r=o.getToolTip();
r.setContent('<div id="zimletTooltipDiv"/>',true);
this.x=e;
this.y=h;
if(!this.toolTipPoppedUp(s,t,n,document.getElementById("zimletTooltipDiv"))){
r.popup(e,h,true,new AjxCallback(this,this.hoverOut,t,n,s))
}};
EmailTooltipZimlet.prototype.toolTipPoppedUp=function(o,n,t,e){
var r=appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,{
address:n}
);
if(r){
var s=document.getElementById("zimletTooltipDiv");
if(s){
s.innerHTML=r
}
return false
}
return true
};
EmailTooltipZimlet.prototype.onHoverOverEmailInList=function(t,n,o){
if(!t||!t.address){
return false
}
var e=n?n.docX:this.x;
var s=n?n.docY:this.y;
this.noRightClick=o;
return this.handleHover(t,null,e,s)
};
EmailTooltipZimlet.prototype.handleHover=function(t,o,e,r,s,n){
if(n&&this._bubbleParams[n]){
return false
}
this._hoverOver=true;
this._initializeProps(t,o,e,r,s);
appCtxt.notifyZimlets("onEmailHoverOver",[this],{
waitUntilLoaded:true}
);
if(this.primarySubscriberZimlet){
this.primarySubscriberZimlet.showTooltip();
return true
}
this._unknownPersonSlide=new UnknownPersonSlide();
this._unknownPersonSlide.onEmailHoverOver(this);
this._unknownPersonSlide.showTooltip();
return true
};
EmailTooltipZimlet.prototype._initializeProps=function(t,e,h,r,l){
if(!this.seriesAnimation){
this.seriesAnimation=new SeriesAnimation()
}
this.seriesAnimation.reset();
var o=DwtShell.getShell(window);
var d=o.getToolTip();
d.setContent('<div id="zimletTooltipDiv"></div>',true);
this.x=h;
this.y=r;
this.tooltip=d;
Dwt.setHandler(d._div,DwtEvent.ONMOUSEOUT,AjxCallback.simpleClosure(this.hoverOut,this));
var s=(t instanceof AjxEmailAddress)?t.address:t;
var n=this.isMailToLink(s);
if(n){
s=(this.parseMailToLink(s)).to||s
}
this.emailAddress=s;
this.fullName=(t instanceof AjxEmailAddress)?t.name:"";
this.canvas=document.getElementById("zimletTooltipDiv");
this.slideShow=new EmailToolTipSlideShow(this,this.canvas);
this.contextMenu=this.getActionMenu(t,l,e,false)
};
EmailTooltipZimlet.prototype._preLoadImgs=function(){
this._busyImg=new Image();
this._busyImg.src=this.getResource("img/EmailZimlet_busy.gif");
this._unknownPersonImg=new Image();
this._unknownPersonImg.src=this.getResource("img/UnknownPerson_dataNotFound.jpg")
};
EmailTooltipZimlet.prototype.showBusyImg=function(e,t,s){
var n=s?this.y+s:this.y;
var o=t?this.x+t:this.x;
this._busyImg.style.top=n;
this._busyImg.style.left=o;
this._busyImg.style.display="block";
this._busyImg.style.position="absolute";
this._busyImg.style.zIndex="500";
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImg,this,e),4000)
};
EmailTooltipZimlet.prototype.showLoadingAtId=function(e,o){
var t=document.getElementById(o);
t.innerHTML=["<br/><br/><label style='color:gray'>",ZmMsg.loading,"</label>"].join("");
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImgAtId,this,e,o),4000)
};
EmailTooltipZimlet.prototype._handleNoImgAtId=function(e,t){
clearTimeout(this._busyImgTimer);
if(e){
e.run()
}};
EmailTooltipZimlet.prototype._handleNoImg=function(e){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none";
if(e){
e.run()
}};
EmailTooltipZimlet.prototype.hideBusyImg=function(){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none"
};
EmailTooltipZimlet.prototype.createFilterMenu=function(e){
if(this._filterMenu){
return
}
this._newFilterMenuItem=e.getOp("ADDTOFILTER");
this._filterMenu=new ZmPopupMenu(e);
this._newFilterMenuItem.setMenu(this._filterMenu);
this._rules=AjxDispatcher.run("GetFilterRules");
this._rules.addChangeListener(new AjxListener(this,this._rulesChangeListener));
this._resetFilterMenu()
};
EmailTooltipZimlet.prototype.createSearchMenu=function(t){
if(this._searchMenu){
return
}
var e=[ZmOperation.SEARCH,ZmOperation.SEARCH_TO];
var n={};
n[ZmOperation.SEARCH]={
textKey:"findEmailFromRecipient"};
n[ZmOperation.SEARCH_TO]={
textKey:"findEmailToRecipient"};
this._searchMenu=new ZmActionMenu({
parent:t,menuItems:e,overrides:n}
);
var o=t.getOp("SEARCHEMAILS");
o.setMenu(this._searchMenu)
};
EmailTooltipZimlet.prototype._resetFilterMenu=function(){
var e=this._filterMenu.getItems();
while(e.length>0){
this._filterMenu.removeChild(e[0])
}
this._rules.loadRules(false,new AjxCallback(this,this._populateFiltersMenu))
};
EmailTooltipZimlet.prototype._populateFiltersMenu=function(t){
var o=t.getResponse();
var n=this._filterMenu;
var s=new DwtMenuItem({
parent:n}
);
s.setText(this.getMessage("newFilter"));
s.setImage("Plus");
s.setData(Dwt.KEY_OBJECT,EmailTooltipZimlet.NEW_FILTER);
s.addSelectionListener(new AjxListener(this,this._filterItemSelectionListener));
if(o.size()){
n.createSeparator()
}
for(var e=0;
e<o.size();
e++){
this._addFilter(n,o.get(e))
}};
EmailTooltipZimlet.prototype._rulesChangeListener=function(e){
if(e.type!=ZmEvent.S_FILTER){
return
}
if(!e.handled){
this._resetFilterMenu();
e.handled=true
}};
EmailTooltipZimlet.prototype._filterItemSelectionListener=function(t){
var e=t.item;
var o=true;
var s=e.getData(Dwt.KEY_OBJECT);
if(s==EmailTooltipZimlet.NEW_FILTER){
o=false;
s=new ZmFilterRule();
s.addAction(ZmFilterRule.A_KEEP)
}else{
s=this._rules.getRuleByName(s.name)||s
}
var r=this._getAddress(this._actionObject);
if(AjxUtil.isString(r)&&this.isMailToLink(r)){
r=(this.parseMailToLink(r)).to||r
}
var n=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];
s.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_IS,r,n);
appCtxt.getFilterRuleDialog().popup(s,o)
};
EmailTooltipZimlet.prototype._addFilter=function(n,o,t){
var e=new DwtMenuItem({
parent:n,index:t}
);
e.setText(AjxStringUtil.clipByLength(o.name,20));
e.setData(Dwt.KEY_OBJECT,o);
e.addSelectionListener(new AjxListener(this,this._filterItemSelectionListener))
};
EmailTooltipZimlet.prototype.getActionMenu=function(n,u,t){
var l=ZmZimletBase.prototype.getActionMenu.call(this,n,u,t);
var s=appCtxt.isChildWindow;
if(!s&&appCtxt.get(ZmSetting.FILTERS_ENABLED)&&l.getOp("ADDTOFILTER")){
this.createFilterMenu(l)
}
if(!s&&appCtxt.get(ZmSetting.SEARCH_ENABLED)&&l.getOp("SEARCHEMAILS")){
this.createSearchMenu(l)
}
var h=this._getAddress(n);
if(this.isMailToLink(h)){
h=(this.parseMailToLink(h)).to||h
}
if(!(appCtxt.get(ZmSetting.CONTACTS_ENABLED)||appCtxt.isOffline)){
if(l.getOp("NEWCONTACT")){
l.removeOp("NEWCONTACT")
}}
var e=l.getOp("NEWIM");
if(e){
if(s||!appCtxt.get(ZmSetting.IM_ENABLED)){
l.removeOp("NEWIM")
}else{
var o=n instanceof AjxEmailAddress?n:new AjxEmailAddress(n);
ZmImApp.updateImMenuItemByAddress(e,o)
}}
if(l.getOp("SEARCHEMAILS")&&(s||!appCtxt.get(ZmSetting.SEARCH_ENABLED))){
ZmOperation.removeOperation(l,"SEARCHEMAILS",l._menuItems)
}else{
if(n&&n.type){
if(l.getOp("SEARCHEMAILS")){
if(n.type=="FROM"){
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromSender);
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToSender)
}else{
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipient);
ZmOperation.setOperation(this._searchMenu,ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipient)
}
this._searchMenu.addSelectionListener("SEARCH",new AjxListener(this,this.menuItemSelected,["SEARCH",n]));
this._searchMenu.addSelectionListener("SEARCH_TO",new AjxListener(this,this.menuItemSelected,["SEARCH_TO",n]))
}}}
if(l.getOp("ADDTOFILTER")&&(s||!appCtxt.get(ZmSetting.FILTERS_ENABLED))){
ZmOperation.removeOperation(l,"ADDTOFILTER",l._menuItems)
}
var d=appCtxt.getApp(ZmApp.CONTACTS);
var r=d&&d.getContactByEmail(h);
var m=l.getOp("NEWCONTACT");
if(m){
m.setVisible(true)
}
if(r){
if(r.isDistributionList()&&m){
m.setVisible(false)
}
ZmOperation.setOperation(l,"NEWCONTACT",ZmOperation.EDIT_CONTACT)
}else{
if(d&&!r&&r!==null){
if(l.getOp("NEWCONTACT")){
l.getOp("NEWCONTACT").setText(ZmMsg.loading)
}
var f=new AjxCallback(this,this._handleResponseGetContact1,[l]);
d.getContactByEmail(h,f)
}else{
ZmOperation.setOperation(l,"NEWCONTACT",ZmOperation.NEW_CONTACT,ZmMsg.AB_ADD_CONTACT)
}}
if(!l.isListenerRegistered(DwtEvent.POPDOWN)){
l.addPopdownListener(new AjxListener(this,this._menuPopdownListener))
}
return l
};
EmailTooltipZimlet.prototype._handleResponseGetContact1=function(n,e){
var t=e?ZmOperation.EDIT_CONTACT:ZmOperation.NEW_CONTACT;
var o=e?null:ZmMsg.AB_ADD_CONTACT;
ZmOperation.setOperation(n,"NEWCONTACT",t,o)
};
EmailTooltipZimlet.prototype.isMailToLink=function(e){
return(!!(e.search(/mailto/i)!=-1))
};
EmailTooltipZimlet.prototype.parseMailToLink=function(o){
var t={};
var e=o.match(/\bsubject=([^&]+)/i);
t.subject=e?decodeURIComponent(e[1]):null;
e=o.match(/\bto\:([^&]+)/);
if(!e){
e=o.match(/\bmailto\:([^\?]+)/i)
}
t.to=e?decodeURIComponent(e[1]):null;
e=o.match(/\bbody=([^&]+)/i);
t.body=e?decodeURIComponent(e[1]):null;
return t
};
EmailTooltipZimlet.prototype.clicked=function(o,s,e,n){
var t=o&&o.id;
if(t&&this._bubbleParams[t]){
return
}
if(this.tooltip){
this.tooltip.popdown()
}
this._actionObject=s;
this._composeListener(n,this._getAddress(s))
};
EmailTooltipZimlet.prototype.menuItemSelected=function(o,t,e){
switch(o){
case"SEARCH":this._searchListener();
break;
case"SEARCH_TO":this._searchToListener();
break;
case"SEARCHBUILDER":this._browseListener();
break;
case"NEWEMAIL":this._composeListener(e);
break;
case"NEWIM":this._newImListener(e);
break;
case"NEWCONTACT":this._contactListener(true);
break;
case"ADDTOFILTER":this._filterListener();
break;
case"GOTOURL":this._goToUrlListener();
break
}};
EmailTooltipZimlet.prototype._getYahooHint=function(){
var t=[];
var e=0;
t[e++]="<center><table border=0><tr><td valign=top><div class='ImgWebSearch'></div></td><td>";
t[e++]=ZmMsg.leftClickYahoohint;
t[e++]="<div class='TooltipHint'>";
t[e++]=ZmMsg.rightClickHint;
t[e++]="</div></td></tr></table></center>";
return t.join("")
};
EmailTooltipZimlet.prototype._getAddress=function(e){
return e.isAjxEmailAddress?e.address:e
};
EmailTooltipZimlet.prototype._contactListener=function(t){
this.popdown();
var e=new AjxCallback(this,this._handleLoadContact,[t]);
AjxDispatcher.require(["ContactsCore","Contacts"],false,e,null,true)
};
EmailTooltipZimlet.prototype._newImListener=function(e){
ZmImApp.getImMenuItemListener().handleEvent(e)
};
EmailTooltipZimlet.prototype._getActionedContact=function(t){
var e;
var o=this._actionObject;
if(this._actionObject){
if(this._actionObject.toString()=="ZmContact"){
e=this._actionObject
}else{
if(AjxUtil.isString(this._actionObject)){
o=this._getAddress(this._actionObject);
if(this.isMailToLink(o)){
o=(this.parseMailToLink(o)).to||o
}
e=AjxDispatcher.run("GetContacts").getContactByEmail(o)
}else{
e=AjxDispatcher.run("GetContacts").getContactByEmail(this._actionObject.address)
}}}
if(e==null&&t){
e=new ZmContact(null);
e.initFromEmail(o)
}
return e
};
EmailTooltipZimlet.prototype._handleLoadContact=function(t){
var e=this._getActionedContact(true);
if(window.parentAppCtxt){
var o=window.parentAppCtxt.getApp(ZmApp.CONTACTS);
o.getContactController().show(e,t)
}else{
AjxDispatcher.run("GetContactController").show(e,t)
}};
EmailTooltipZimlet.prototype._composeListener=function(t,r){
this.popdown();
var n=this._actionObject;
r=r?this._getAddress(r):(n?this._getAddress(n):"");
var s={};
var e=(!appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&t.shiftKey)||(appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&!t.shiftKey);
if(this.isMailToLink(r)){
var o=this.parseMailToLink(r);
s.toOverride=o.to;
s.subjOverride=o.subject;
s.extraBodyText=o.body;
r=o.to||r
}
s.action=ZmOperation.NEW_MESSAGE;
s.inNewWindow=e;
if(!s.toOverride){
s.toOverride=r+AjxEmailAddress.SEPARATOR
}
if(n&&n.isAjxEmailAddress&&n.address==r){
s.toOverride=n
}
AjxDispatcher.run("Compose",s)
};
EmailTooltipZimlet.prototype._browseListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().fromBrowse(e)
};
EmailTooltipZimlet.prototype._searchListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().fromSearch(this._getAddress(e))
};
EmailTooltipZimlet.prototype._searchToListener=function(){
var e=this._getAddress(this._actionObject);
if(this.isMailToLink(e)){
e=(this.parseMailToLink(e)).to||e
}
appCtxt.getSearchController().toSearch(this._getAddress(e))
};
EmailTooltipZimlet.prototype._filterListener=function(){
var e=new AjxCallback(this,this._handleLoadFilter);
AjxDispatcher.require(["PreferencesCore","Preferences"],false,e,null,true)
};
EmailTooltipZimlet.prototype._handleLoadFilter=function(){
appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);
var t=new ZmFilterRule();
var o=this._getAddress(this._actionObject);
if(AjxUtil.isString(o)&&this.isMailToLink(o)){
o=(this.parseMailToLink(o)).to||o
}
var e=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];
t.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_IS,o,e);
t.addAction(ZmFilterRule.A_KEEP);
appCtxt.getFilterRuleDialog().popup(t)
};
EmailTooltipZimlet.prototype._goToUrlListener=function(){
var n=this._getAddress(this._actionObject);
if(AjxUtil.isString(n)&&this.isMailToLink(n)){
n=(this.parseMailToLink(n)).to||n
}
var o=n.split("@");
if(o.length){
var t=o[o.length-1];
var e=t.split(".");
this._actionUrl="http://"+((e.length<=2)?"www."+t:t)
}
if(this._actionUrl){
window.open(this._actionUrl,"_blank")
}else{
this.displayStatusMessage(ZmMsg.errorCreateUrl)
}};
EmailTooltipZimlet.prototype._phoneListener=function(e){
if(!e){
return
}
appCtxt.notifyZimlets("onPhoneClicked",[e],{
waitUntilLoaded:true}
)
};
EmailTooltipZimlet.prototype._imListener=function(e){
if(!e){
return
}};
EmailTooltipZimlet.prototype.animateOpacity=function(h,s,e,t){
this.changeOpac(s,document.getElementById(h).style);
var o=Math.round(t/100);
var r=0;
var n=document.getElementById(h).style;
if(s>e){
for(i=s;
i>=e;
i--){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}}};
EmailTooltipZimlet.prototype.changeOpac=function(e,t){
t.opacity=(e/100);
t.MozOpacity=(e/100);
t.KhtmlOpacity=(e/100);
t.zoom=1;
t.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+e+")"
};
EmailTooltipZimlet.prototype.openCenteredWindow=function(o){
this.popdown();
var n=800;
var e=600;
var h=parseInt((screen.availWidth/2)-(n/2));
var r=parseInt((screen.availHeight/2)-(e/2));
var t="width="+n+",height="+e+",status,resizable,left="+h+",top="+r+"screenX="+h+",screenY="+r;
var s=window.open(o,"subWind",t);
if(!s){
this._showWarningMsg(ZmMsg.popupBlocker)
}};
EmailTooltipZimlet.prototype.expandBubble=function(o,t){
var e=document.getElementById(o);
if(e){
var n=Dwt.getLocation(e);
n.y+=Dwt.getSize(e).y+2;
this._aclv.expandDL({
email:t,loc:n}
)
}};
EmailTooltipZimlet.prototype._dlAddrSelected=function(e,t){
this._composeListener(t,e)
};
EmailToolTipSlideShow.mainDivId="EmailZimlet_slidesMainDiv";
EmailToolTipSlideShow.navDivId="EmailZimlet_slidesNavDiv";
EmailToolTipSlideShow.navTableRowId="EmailZimlet_slidesNavTableRow";
function EmailToolTipSlideShow(e,t){
this.slidesIconAndSlideMap=[];
this.numberOfSlides=0;
this.emailZimlet=e;
this.canvas=t;
this._createFrame(t);
this.mainDiv=document.getElementById(EmailToolTipSlideShow.mainDivId);
this.navDiv=document.getElementById(EmailToolTipSlideShow.navDivId);
this.navTableRow=document.getElementById(EmailToolTipSlideShow.navTableRowId);
this.currentSelectCellId=null;
this.currentSlideId=null;
this.navDiv.onclick=AjxCallback.simpleClosure(this._handleClick,this);
t.onmouseover=AjxCallback.simpleClosure(this.handleMouseOver,this);
t.onmouseout=AjxCallback.simpleClosure(this.handleMouseOut,this);
this.mainDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px";
this.navDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px"
}
EmailToolTipSlideShow.prototype._createFrame=function(e){
e.innerHTML=["<div id='",EmailToolTipSlideShow.mainDivId,"'></div>","<div id='",EmailToolTipSlideShow.navDivId,"'>","<div class='horizsep'></div>","<table width=100%><tr id='",EmailToolTipSlideShow.navTableRowId,"'>","</tr></table></div>"].join("")
};
EmailToolTipSlideShow.prototype._handleClick=function(o){
if(!o){
var o=window.event
}
var t;
if(o.target){
t=o.target
}else{
if(o.srcElement){
t=o.srcElement
}}
if(t.nodeType==3){
t=t.parentNode
}
if(t.id){
if(this.slidesIconAndSlideMap[t.id]){
this.slidesIconAndSlideMap[t.id].select()
}}};
EmailToolTipSlideShow.prototype.addSlide=function(e,t){
e.slideShow=this;
if(!t){
t=this.numberOfSlides
}
this.slidesIconAndSlideMap[e.iconDivId]=e;
var o=document.createElement("div");
o.id=e.id;
o.style.display="none";
this.mainDiv.appendChild(o);
o.innerHTML=e.html;
this._insertSlideIcon(e);
this.numberOfSlides++
};
EmailToolTipSlideShow.prototype._insertSlideIcon=function(e){
var r=e.iconName;
var n=e.iconDivId;
var t=e.selectCellId;
var o=e.name;
var s=this.navTableRow.insertCell(0);
this._insertIconHtml(s,t,o,n,r)
};
EmailToolTipSlideShow.prototype._insertIconHtml=function(n,e,t,o,s){
n.align="center";
n.id=e;
n.innerHTML=["<div title='",t,"' id='",o,"' class='Img",s,"' style='cursor:pointer;'></div>"].join("")
};
EmailToolTipSlideShow.prototype.handleMouseOver=function(){
this.isMouseOverTooltip=true
};
EmailToolTipSlideShow.prototype.handleMouseOut=function(){
this.isMouseOverTooltip=false;
this.emailZimlet.hoverOut()
};
function EmailToolTipSlide(o,n,s,e,t){
this.html=o;
this.visible=n;
this.iconName=s;
this.id=Dwt.getNextId();
this.iconDivId=Dwt.getNextId();
this.selectCellId=Dwt.getNextId();
this.slideShow=null;
this.canvasElement=null;
this._selectCallback=e;
this.name=t
}
EmailToolTipSlide.prototype.select=function(){
if(this.slideShow.currentSlideId){
document.getElementById(this.slideShow.currentSlideId).style.display="none"
}
document.getElementById(this.id).style.display="block";
this.slideShow.currentSlideId=this.id;
if(this.slideShow.currentSelectCellId){
document.getElementById(this.slideShow.currentSelectCellId).style.background=""
}
document.getElementById(this.selectCellId).style.display="none";
this.slideShow.currentSelectCellId=this.selectCellId;
if(this._selectCallback){
this._selectCallback.run()
}};
EmailToolTipSlide.prototype.setCanvasElement=function(e){
this.canvasElement=e
};
EmailToolTipSlide.prototype.setInfoMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideMsgColor")
};
EmailToolTipSlide.prototype.setErrorMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideErrorColor")
};
EmailToolTipSlide.prototype._appendMsg2Slide=function(o,e){
var t=["<div class='EmailToolTipSlideText ",e,"'>",o,"</div>"].join("");
if(this.canvasElement){
this.canvasElement.innerHTML=t
}};
EmailToolTipSlide.prototype.clearSlideMessage=function(t,e){
if(this.canvasElement){
this.canvasElement.innerHTML=""
}};
function EmailToolTipPrefDialog(e){
this.zimlet=e;
this.emailZimlet_tooltipArea=this.zimlet.getUserProperty("emailZimlet_tooltipArea");
if(!this.emailZimlet_tooltipArea){
this.emailZimlet_tooltipArea=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]
}
this.updateEmailTooltipSize()
}
EmailToolTipPrefDialog.SIZE_VERYSMALL="VERYSMALL";
EmailToolTipPrefDialog.SIZE_SMALL="SMALL";
EmailToolTipPrefDialog.SIZE_MEDIUM="MEDIUM";
EmailToolTipPrefDialog.SIZE_LARGE="LARGE";
EmailToolTipPrefDialog.SIZE_XL="XL";
EmailToolTipPrefDialog.DIMENSIONS=[];
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL]="220px x 130px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_SMALL]="230px x 140px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]="280px x 150px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_LARGE]="260px x 200px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_XL]="270px x 210px";
EmailToolTipPrefDialog.prototype.updateEmailTooltipSize=function(){
var e=this.emailZimlet_tooltipArea.replace(/px/ig,"");
var t=e.split(" x ");
EmailTooltipZimlet.tooltipWidth=t[0];
EmailTooltipZimlet.tooltipHeight=t[1]
};
function SeriesAnimation(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
}
SeriesAnimation.prototype.startAnimation=function(){
this._animateNextItem()
};
SeriesAnimation.prototype.reset=function(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
};
SeriesAnimation.prototype.addFadeIn=function(e,t){
this._addObjs({
objId:e,aType:"FADEIN",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addPause=function(e){
this._addObjs({
objId:"__PAUSE__",aType:"PAUSE",endingOpac:null,millisecs:e}
)
};
SeriesAnimation.prototype.addFadeOut=function(e,t){
this._addObjs({
objId:e,aType:"FADEOUT",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addslideUp=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEUP",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addslideDown=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEDOWN",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addZoomIn=function(o,e,n,t){
this._addObjs({
objId:o,aType:"ZOOMIN",objWidth:e,objHeight:n,zoomByThisPixels:t}
)
};
SeriesAnimation.prototype._addObjs=function(n){
var o=n.objId;
var e=n.aType;
var t=o+Dwt.getNextId();
this._objIdAndAnimationTypeMap[t]=n;
this._objsToAnimate.push(t)
};
SeriesAnimation.prototype._animate=function(s){
var n=s.objId;
var t=s.aType;
if(n.indexOf("__PAUSE__")==-1&&!document.getElementById(n)){
this.reset();
return
}
if(n.indexOf("__PAUSE__")==-1){
document.getElementById(n).style.display="block"
}
if(t=="FADEOUT"){
var r=s.endingOpac?s.endingOpac:0;
this._animateOpacity(n,100,r,500)
}else{
if(t=="PAUSE"){
this._animatePause(s.millisecs)
}else{
if(t=="FADEIN"){
var r=s.endingOpac?s.endingOpac:100;
this._animateOpacity(n,0,r,500)
}else{
if(t=="SLIDEUP"){
var o=s.endHeightPercent?s.endHeightPercent:100;
this._animateSliding(n,o,t,500)
}else{
if(t=="SLIDEDOWN"){
var o=s.endHeightPercent?s.endHeightPercent:0;
this._animateSliding(n,o,t,500)
}else{
if(t=="ZOOMIN"){
var e=s.zoomByThisPixels?s.zoomByThisPixels:0;
this._animateZoomIn(s)
}}}}}}};
SeriesAnimation.prototype._animateZoomIn=function(h){
var n=document.getElementById(h.objId);
var r=n.style;
var o=h.objWidth;
var e=h.objHeight;
var t=h.zoomByThisPixels;
var s=2;
var l=0;
for(i=0;
i<t;
i++){
if(i==t-1){
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),false),(l*s))
}
l++
}};
SeriesAnimation.prototype._zoomInItem=function(n,o,e,t){
n.width=o;
n.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateSliding=function(o,t,e,n){
var s=Math.round(n/100);
var l=0;
var r=document.getElementById(o).style;
var h=Math.round(document.getElementById(o).offsetHeight);
if(e=="SLIDEUP"){
for(i=h;
i<=t;
i++){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}else{
if(e=="SLIDEDOWN"){
for(i=h;
i>=t;
i--){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}}};
SeriesAnimation.prototype._animateOpacity=function(l,s,e,t){
var h=document.getElementById(l);
if(!h){
this.reset();
return
}
this._changeOpac(s,h.style);
var o=Math.round(t/100);
var r=0;
var n=h.style;
if(s>e){
for(i=s;
i>=e;
i--){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}}};
SeriesAnimation.prototype._changeHeight=function(e,o,t){
o.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._changeOpac=function(t,o,e){
if(!o){
return
}
o.opacity=(t/100);
o.MozOpacity=(t/100);
o.KhtmlOpacity=(t/100);
o.zoom=1;
o.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")";
if(e){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateNextItem=function(){
if(this._objsToAnimate.length==0){
return
}
var e=this._objsToAnimate[0];
var t=this._objIdAndAnimationTypeMap[e];
this._objsToAnimate.splice(0,1);
this._animate(t)
};
SeriesAnimation.prototype._animatePause=function(e){
setTimeout(AjxCallback.simpleClosure(this._animateNextItem,this),e)
};
function UnknownPersonSlide(){}
UnknownPersonSlide.PHOTO_ID="unkownPerson_photoBG";
UnknownPersonSlide.PHOTO_PARENT_ID="unkownPerson_photoBGDiv";
UnknownPersonSlide.TEXT_DIV_ID="unkownPerson_TextDiv";
UnknownPersonSlide.DOMAIN="";
UnknownPersonSlide.WIDTH=65;
UnknownPersonSlide.HEIGHT=80;
UnknownPersonSlide.prototype.onEmailHoverOver=function(e){
e.addSubscriberZimlet(this,false);
this.emailZimlet=e;
this._alwaysSetTooltipToSmall();
this._presenceCache=this.emailZimlet._presenceCache
};
UnknownPersonSlide.prototype._alwaysSetTooltipToSmall=function(){
var t=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL];
var e=t.replace(/px/ig,"");
var o=e.split(" x ");
this._tooltipWidth=o[0];
this._tooltipHeight=o[1]
};
UnknownPersonSlide.prototype.showTooltip=function(){
if(appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
this._setCalendarFrame()
}
if(appCtxt.get(ZmSetting.MAIL_ENABLED)){
this._setMailFrame()
}
this._setContactFrame();
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null);
this._slide.select()
};
UnknownPersonSlide.prototype._setContactFrame=function(){
this.emailZimlet.hideBusyImg();
var t=this._getTooltipBGHtml();
var e=new AjxCallback(this,this._handleContactSlideSelect);
this._slide=new EmailToolTipSlide(t,true,"UnknownPerson_contact",e,this.emailZimlet.getMessage("slideTooltip"));
this.emailZimlet.slideShow.addSlide(this._slide);
this._mainDiv=document.getElementById(UnknownPersonSlide.TEXT_DIV_ID);
this._slide.setCanvasElement(this._mainDiv)
};
UnknownPersonSlide.prototype._setMailFrame=function(){
var t=new AjxCallback(this,this._handleMailSlideSelect);
var e=new EmailToolTipSlide(null,true,"Mail_icon",t,this.emailZimlet.getMessage("slideMailTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setCalendarFrame=function(){
var t=new AjxCallback(this,this._handleCalendarSlideSelect);
var e=new EmailToolTipSlide(null,true,"Calendar_icon",t,this.emailZimlet.getMessage("slideCalendarTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setPresence=function(){};
UnknownPersonSlide.prototype._handleImgLoadFailure=function(){
var e=new Image();
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e);
e.id=UnknownPersonSlide.PHOTO_ID;
e.src=this.emailZimlet.getResource("img/UnknownPerson_dataNotFound.jpg")
};
UnknownPersonSlide.prototype._handleImageLoad=function(e){
this.emailZimlet.hideBusyImg();
var t=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
if(!t){
return
}
t.innerHTML="";
t.style.textAlign="center";
t.appendChild(e);
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)!=-1){
e.onclick=AjxCallback.simpleClosure(this._handleProfileImageClick,this);
e.style.cursor="pointer";
e.style.maxHeight=UnknownPersonSlide.HEIGHT+"px";
e.style.maxWidth=UnknownPersonSlide.WIDTH+"px"
}
if(AjxEnv.isIE){
e.height=UnknownPersonSlide.HEIGHT
}};
UnknownPersonSlide.prototype._handleProfileImageClick=function(){};
UnknownPersonSlide.prototype._handleAllClicks=function(o){
var n;
this.emailZimlet.popdown();
if(AjxEnv.isIE){
o=window.event
}
if(o.which){
n=(o.which==3)
}else{
if(o.button){
n=(o.button==2)
}}
if(n){
DwtUiEvent.setBehaviour(o,true,false);
this.emailZimlet.contextMenu.popup(100,this.emailZimlet.x,this.emailZimlet.y);
return
}
var t=DwtShell.mouseEvent;
t.setFromDhtmlEvent(o);
var e=t.target;
if(e.id=="UnknownPersonSlide_EmailAnchorId"){
this.emailZimlet._composeListener(null,this.emailZimlet.emailAddress)
}else{
if(e.id=="UnknownPersonSlide_NameAnchorId"){
this.emailZimlet._contactListener(true)
}else{
if(e.id=="UnknownPersonSlide_mobilePhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.mobilePhone)
}else{
if(e.id=="UnknownPersonSlide_workPhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.workPhone)
}else{
if(e.id=="UnknownPersonSlide_imAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
ZmZimbraMail.unloadHackCallback();
location.href=this.imURI;
this.emailZimlet._imListener(this.imURI);
return false
}}}}}};
UnknownPersonSlide.prototype._handleRightClick=function(t){
var e;
if(!t){
var t=window.event
}
if(t.which){
e=(t.which==3)
}else{
if(t.button){
e=(t.button==2)
}}
if(!e){
return
}
this.emailZimlet.popdown();
DwtUiEvent.setBehaviour(t,true,false);
this.emailZimlet.contextMenu.popup(100,this.emailZimlet.x,this.emailZimlet.y)
};
UnknownPersonSlide.prototype._handleContactSlideSelect=function(){
if(this._slide.loaded){
return
}
this._slide.loaded=true;
this._getContactDetailsAndShowTooltip()
};
UnknownPersonSlide.prototype._handleMailSlideSelect=function(){
this.emailZimlet.popdown();
this.emailZimlet._composeListener(null,this.emailZimlet.emailAddress)
};
UnknownPersonSlide.prototype._handleCalendarSlideSelect=function(){
this.emailZimlet.popdown();
var e=new ZmAppt();
var t=this.emailZimlet._getActionedContact()||new AjxEmailAddress(this.emailZimlet.emailAddress);
e.setAttendees(t,ZmCalBaseItem.PERSON);
AjxDispatcher.run("GetCalController").newAppointment(e,null,null,null)
};
UnknownPersonSlide.prototype._getContactDetailsAndShowTooltip=function(){
this._slide.setInfoMessage(this.emailZimlet.getMessage("loading"));
var t=AjxDispatcher.run("GetContacts");
var e=t?t.getContactByEmail(this.emailZimlet.emailAddress):null;
if(e||!appCtxt.get(ZmSetting.GAL_ENABLED)){
this._handleContactDetails(null,e)
}else{
var r,n,o;
r={
SearchGalRequest:{
_jsns:"urn:zimbraAccount"}};
n=r.SearchGalRequest;
n.type="account";
n.name=this.emailZimlet.emailAddress;
n.offset=0;
n.limit=3;
var s=new AjxCallback(this,this._handleContactDetails);
appCtxt.getAppController().sendRequest({
jsonObj:r,asyncMode:true,callback:s,noBusyOverlay:true}
)
}};
UnknownPersonSlide.prototype._handleContactDetails=function(t,e){
var o=null;
var d=null;
if(t){
var s=t.getResponse();
var n=s.SearchGalResponse;
var l=n.cn;
if(l&&l[0]){
d=l[0].id;
o=l[0]._attrs
}}
o=o||e&&e.attr||{};
o.fullName=this.emailZimlet.fullName||o.fullName||e&&e._fileAs;
this._presentity=o.email=this.emailZimlet.emailAddress||o.email;
var h=e&&e.getImageUrl(UnknownPersonSlide.WIDTH);
this._setProfileImage(h);
this._setContactDetails(o);
this._popupToolTip();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._getPresence=function(){
var e=new Date();
var t=this._presenceCache[this._presentity]&&this._presenceCache[this._presentity].timestamp||0;
if(e-t<5000){
return this._presenceCache[this._presentity]
}
if(this.emailZimlet._presenceProvider){
this.emailZimlet._presenceProvider(this._presentity,this._handlePresence.bind(this))
}
return null
};
UnknownPersonSlide.prototype._handlePresence=function(t){
if(!t){
return
}
var e=this._presenceCache[this._presentity];
if(!e){
e=this._presenceCache[this._presentity]={}
}
e.presenceStatus=t.presenceStatus;
e.notes=t.notes;
e.timestamp=new Date();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._popupToolTip=function(){
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null)
};
UnknownPersonSlide.prototype._getTooltipBGHtml=function(e){
var o=";";
var n=";";
if(AjxEnv.isIE){
var o="width:100%;";
var n="left:3%;"
}
var t={
photoParentId:UnknownPersonSlide.PHOTO_PARENT_ID,textDivId:UnknownPersonSlide.TEXT_DIV_ID,width:o,left:n};
return AjxTemplate.expand("com_zimbra_email.templates.Email1#Frame",t)
};
UnknownPersonSlide.prototype._setContactDetails=function(h){
if(h.workState||h.workCity||h.workStreet||h.workPostalCode){
var e=h.workState||"";
var o=h.workCity||"";
var l=h.workStreet||"";
var d=h.workPostalCode||"";
var r=[l," ",o," ",e," ",d].join("");
h.address=AjxStringUtil.trim(r)
}
var s=h.imAddress||h.imAddress1||h.imAddress2||h.imAddress3;
if(s){
imParts=s.split(":");
if(imParts.length==2){
var t=imParts[0];
s=s.split(":")[1];
if(t&&t=="other"){
t="im"
}else{
if(t&&t=="aol"){
t="aim"
}}
s="<a  id='UnknownPersonSlide_imAnchorId' href='"+t+":"+AjxStringUtil.htmlEncode(s.substring(2))+"'>"+AjxStringUtil.htmlEncode(s.substring(2))+"</a>";
this.imURI=h.imURI=s
}}
if(!this.emailZimlet.noRightClick){
h.rightClickForMoreOptions=false
}
this.attribs=h;
h=this._formatTexts(h);
var n=AjxTemplate.expand("com_zimbra_email.templates.Email1#ContactDetails",h);
document.getElementById(UnknownPersonSlide.TEXT_DIV_ID).innerHTML=n;
document.getElementById("UnknownPersonSlide_Frame").onmouseup=AjxCallback.simpleClosure(this._handleAllClicks,this);
this._removeCustomAttrs(h)
};
UnknownPersonSlide.prototype._removeCustomAttrs=function(e){
if(e.rightClickForMoreOptions){
delete e.rightClickForMoreOptions
}
if(e.formattedEmail){
delete e.formattedEmail
}
if(e.address){
delete e.address
}
if(e.presence){
delete e.presence
}
if(e.imURI){
delete e.imURI
}};
UnknownPersonSlide.prototype._formatTexts=function(t){
var e=t.email?t.email:"";
t.formattedEmail=e;
if(e.length>25){
var o=e.split("@");
var n=o[0];
var r=o[1];
if(n.length>25){
n=n.substring(0,24)+".."
}
t.formattedEmail=[n," @",r].join("")
}
var s=t.fullName?t.fullName:"";
if(s==e){
t.fullName=""
}
return t
};
UnknownPersonSlide.prototype._setProfileImage=function(n){
var o=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
o.width=o.style.width=UnknownPersonSlide.WIDTH;
o.height=o.style.height=UnknownPersonSlide.HEIGHT;
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)==-1||!n){
this._handleImgLoadFailure();
return
}
var t=new Image();
t.src=n;
t.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,t);
var e=new AjxCallback(this,this._handleImgLoadFailure);
this.emailZimlet.showLoadingAtId(e,UnknownPersonSlide.PHOTO_PARENT_ID)
};
UnknownPersonSlide.prototype._isKnownPresenceCode=function(o){
if(!this._presenceCodes){
var e=["dnd","vacation","on-the-phone","busy","unavailable","away","available","unknown"];
this._presenceCodes={};
for(var t=0;
t<e.length;
t++){
this._presenceCodes[e[t]]=true
}}
return this._presenceCodes[o]
};
UnknownPersonSlide.prototype._setPresenceUI=function(){
var o=this._getPresence();
var n=o&&o.presenceStatus;
var s=document.getElementById("row_Presence");
var r=document.getElementById("img_Presence");
var t=document.getElementById("text_Presence");
if(!s||!r||!t){
return
}
if(n){
if(!this._isKnownPresenceCode(n)){
n="unknown"
}
s.style.display="";
var e=n.split("-").join("");
r.className="Img_"+e;
if(o.notes){
t.innerHTML=o.notes
}else{
t.innerHTML=this.emailZimlet.getMessage("msg_"+e)
}}else{
s.style.display="none"
}
return
};
ZmClick2CallZimlet=function(){};
ZmClick2CallZimlet.prototype=new ZmZimletBase();
ZmClick2CallZimlet.prototype.constructor=ZmClick2CallZimlet;
ZmClick2CallZimlet.OP_CLICK_2_CALL_ZIMLET_VOICE_PIN="CLICK_2_CALL_ZIMLET_VOICE_PIN";
ZmClick2CallZimlet.prototype.init=function(){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
if(this.initialized){
return
}
ZmZimletBase.prototype.init.apply(this,arguments);
var e=appCtxt.getApp(ZmApp.VOICE);
if(!e){
this.initialized=true;
return
}
e.registerUCProvider(this);
var t=AjxSoapDoc.create("GetUCInfoRequest","urn:zimbraVoice");
var s=new AjxCallback(this,this._handleResponseUCInfo,[true]);
var o=new AjxCallback(this,this._handleErrorResponseUCInfo,[true]);
var n={
soapDoc:t,asyncMode:true,noBusyOverlay:true,callback:s,errorCallback:o};
appCtxt.getAppController().sendRequest(n);
this.initialized=true
};
ZmClick2CallZimlet.prototype._handleResponseUCInfo=function(n,e){
var t=e.getResponse();
if(t.GetUCInfoResponse){
var o=t.GetUCInfoResponse.attrs&&t.GetUCInfoResponse.attrs[0]&&t.GetUCInfoResponse.attrs[0]._attrs;
if(o){
this.username=o.zimbraUCUsername;
this.password=o.zimbraUCPassword;
this.serverUrl=o.zimbraUCCallControlURL
}
this._getVoiceInfo(n);
this._isLoaded=true
}
this.soapAPI=new ZmClick2CallProviderAPIs(this,this.serverUrl,this.username,this.password)
};
ZmClick2CallZimlet.prototype._handleErrorResponseUCInfo=function(e,t){};
ZmClick2CallZimlet.prototype._getVoiceInfo=function(t){
var e=AjxSoapDoc.create("GetVoiceInfoRequest","urn:zimbraVoice");
var s=new AjxCallback(this,this._handleResponseVoiceInfo,[t]);
var o=new AjxCallback(this,this._handleErrorResponseVoiceInfo,[t]);
var n={
soapDoc:e,asyncMode:true,noBusyOverlay:true,callback:s,errorCallback:o};
appCtxt.getAppController().sendRequest(n);
this._gettingVoiceInfo=true
};
ZmClick2CallZimlet.prototype._handleResponseVoiceInfo=function(o,e){
var t=e.getResponse();
if(t.GetVoiceInfoResponse&&t.GetVoiceInfoResponse.storeprincipal){
this.contactId=t.GetVoiceInfoResponse.storeprincipal[0]&&t.GetVoiceInfoResponse.storeprincipal[0].id;
this._getPresence();
this._isLoaded=true
}};
ZmClick2CallZimlet.prototype._handleErrorResponseVoiceInfo=function(o,e){
var t=appCtxt.getApp(ZmApp.VOICE);
if(!t){
return
}
if(!o){
t.processErrors(e)
}
return true
};
ZmClick2CallZimlet.prototype._getPresence=function(){
return;
var e=this.soapAPI.getPresence(this.contactId,new AjxCallback(this,this._handleResponsePresence))
};
ZmClick2CallZimlet.prototype._handleResponsePresence=function(e){
var t=e
};
ZmClick2CallZimlet.prototype.getErrorDescription=function(t){
var e=ZmMsg.voicemailErrorUnknown;
if(!t.code){
return e
}
if(t.code.indexOf("mitel")!=-1){
msg=t.msg||"";
if(msg.indexOf("401")!=-1){
e=ZmMsg.voicemailErrorAuthFailure
}else{
if(msg.indexOf("0009")!=-1){
e=ZmMsg.voicemailErrorPIN
}else{
if(msg.toLowerCase().indexOf("null")!=-1){
e=ZmMsg.voicemailErrorPIN
}else{
if(t.code=="mitel.INVALID_PIN"){
e=ZmMsg.voicemailErrorPIN
}}}}}else{
if(t.code==ZmVoiceApp.ERROR_CODE_AUTH){
e=ZmMsg.voicemailErrorAuthFailure
}}
return e
};
ZmClick2CallZimlet.prototype.hasVoicePIN=function(){
return true
};
ZmClick2CallZimlet.prototype.initializeToolbar=function(n,o,t,e){};
ZmClick2CallZimlet.prototype.getPresence=function(){};
ZmClick2CallZimlet.prototype._changeVoicePinListener=function(){
if(!this._voicePINDlg){
this._voicePINDlg=new ZmClick2CallVoicePINDlg(this)
}
this._voicePINDlg.popup()
};
ZmClick2CallZimlet.prototype.toolTipPoppedUp=function(n,s,t,e){
var o={
contentObjText:s,phoneStr:ZmMsg.phone};
e.innerHTML=AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#Tooltip",o)
};
ZmClick2CallZimlet.prototype.clicked=function(t,e){
this.toPhoneNumber=e;
this._showFromPhoneDlg()
};
ZmClick2CallZimlet.prototype.display=function(e){
this.toPhoneNumber=e;
this._showFromPhoneDlg()
};
ZmClick2CallZimlet.prototype._showFromPhoneDlg=function(){
if(!this.zmFromPhoneDlg){
this.zmFromPhoneDlg=new ZmClick2CallFromPhoneDlg(this.getShell(),this,this._destinationsInZimbra)
}
this.zmFromPhoneDlg.toPhoneNumber=this.toPhoneNumber;
this.zmFromPhoneDlg.showDialog()
};
ZmClick2CallZimlet.prototype.onEmailHoverOver=function(e){
e.addSubscriberZimlet(this,false,{
presenceCallback:this.getPresence.bind(this)}
);
this.emailZimlet=e;
this._addSlide()
};
ZmClick2CallZimlet.prototype.onPhoneClicked=function(e){
if(!this.zmFromPhoneDlg){
this.zmFromPhoneDlg=new ZmClick2CallFromPhoneDlg(this.getShell(),this,this._destinationsInZimbra)
}
this.zmFromPhoneDlg.toPhoneNumber=this.toPhoneNumber=e;
this.zmFromPhoneDlg.showDialog()
};
ZmClick2CallZimlet.prototype.getEmailZimlet=function(){
return this.emailZimlet
};
ZmClick2CallZimlet.prototype._addSlide=function(){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
var t=this._getTooltipBGHtml();
var e=new AjxCallback(this,this._handleSlideSelect);
this._slide=new EmailToolTipSlide(t,true,"Click2CallZimletIcon",e,"Click to call");
this.emailZimlet.slideShow.addSlide(this._slide)
};
ZmClick2CallZimlet.prototype._handleSlideSelect=function(){
if(this._slide.loaded){
return
}
this.emailZimlet.tooltip.setSticky(false);
this.emailZimlet.popdown();
this._setDefaultPhoneNumber();
this._showFromPhoneDlg();
if(this._slide){
this._slide.loaded=true
}};
ZmClick2CallZimlet.prototype._setDefaultPhoneNumber=function(){
this.toPhoneNumber="";
if(!this.emailZimlet){
return
}
var t=this.emailZimlet._subscriberZimlets;
if(!AjxUtil.isArray(t)||AjxUtil.isEmpty(t)){
return
}
var o=false;
var e=t.length-1;
for(;
e>=0;
e--){
if(AjxUtil.isInstance(t[e],UnknownPersonSlide)){
o=true;
break
}}
if(!o){
return
}
this.toPhoneNumber=this._getContactPhoneNumber(t[e].attribs)
};
ZmClick2CallZimlet.prototype._getContactPhoneNumber=function(e){
if(!ZmEditContactView||!ZmEditContactView.prototype||!ZmEditContactView.prototype.getPhoneOptions){
return""
}
var n=ZmEditContactView.prototype.getPhoneOptions.call(this);
if(!AjxUtil.isArray(n)||AjxUtil.isEmpty(n)){
return""
}
if(!e){
return""
}
for(var o in e){
if(!o){
continue
}
for(var t=0;
t<n.length;
t++){
if(n[t].value.indexOf("Phone")>=0&&o.indexOf(n[t].value)>=0&&!AjxUtil.isEmpty(e[o])){
return e[o]
}}}
return""
};
ZmClick2CallZimlet.prototype._getTooltipBGHtml=function(){
return AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#Frame")
};
ZmClick2CallZimlet.prototype.match=function(o,s){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
var n=this.RE;
n.lastIndex=s;
var e=n.exec(o);
if(!e){
return e
}
var t=e[0];
if(t.length>10&&t[0]!="+"&&!(AjxUtil.arrayContains(t," "))&&!(AjxUtil.arrayContains(t,"."))&&!(AjxUtil.arrayContains(t,"-"))){
return null
}else{
e[0]=t;
return e
}};
ZmClick2CallZimlet.prototype.disableUnreadOp=function(){
return true
};
var Base64={
_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(o){
var e="";
var u,l,r,d,h,s,n;
var t=0;
o=Base64._utf8_encode(o);
while(t<o.length){
u=o.charCodeAt(t++);
l=o.charCodeAt(t++);
r=o.charCodeAt(t++);
d=u>>2;
h=((u&3)<<4)|(l>>4);
s=((l&15)<<2)|(r>>6);
n=r&63;
if(isNaN(l)){
s=n=64
}else{
if(isNaN(r)){
n=64
}}
e=e+this._keyStr.charAt(d)+this._keyStr.charAt(h)+this._keyStr.charAt(s)+this._keyStr.charAt(n)
}
return e
}
,decode:function(o){
var e="";
var u,l,r;
var d,h,s,n;
var t=0;
o=o.replace(/[^A-Za-z0-9\+\/\=]/g,"");
while(t<o.length){
d=this._keyStr.indexOf(o.charAt(t++));
h=this._keyStr.indexOf(o.charAt(t++));
s=this._keyStr.indexOf(o.charAt(t++));
n=this._keyStr.indexOf(o.charAt(t++));
u=(d<<2)|(h>>4);
l=((h&15)<<4)|(s>>2);
r=((s&3)<<6)|n;
e=e+String.fromCharCode(u);
if(s!=64){
e=e+String.fromCharCode(l)
}
if(n!=64){
e=e+String.fromCharCode(r)
}}
e=Base64._utf8_decode(e);
return e
}
,_utf8_encode:function(t){
t=t.replace(/\r\n/g,"\n");
var e="";
for(var s=0;
s<t.length;
s++){
var o=t.charCodeAt(s);
if(o<128){
e+=String.fromCharCode(o)
}else{
if((o>127)&&(o<2048)){
e+=String.fromCharCode((o>>6)|192);
e+=String.fromCharCode((o&63)|128)
}else{
e+=String.fromCharCode((o>>12)|224);
e+=String.fromCharCode(((o>>6)&63)|128);
e+=String.fromCharCode((o&63)|128)
}}}
return e
}
,_utf8_decode:function(e){
var t="";
var o=0;
var n=c1=c2=0;
while(o<e.length){
n=e.charCodeAt(o);
if(n<128){
t+=String.fromCharCode(n);
o++
}else{
if((n>191)&&(n<224)){
c2=e.charCodeAt(o+1);
t+=String.fromCharCode(((n&31)<<6)|(c2&63));
o+=2
}else{
c2=e.charCodeAt(o+1);
c3=e.charCodeAt(o+2);
t+=String.fromCharCode(((n&15)<<12)|((c2&63)<<6)|(c3&63));
o+=3
}}}
return t
}};
function ZmClick2CallProviderAPIs(t,e,n,o){
this.zimlet=t;
this._serverUrl=e;
this._email=n;
this._password=o
}
ZmClick2CallProviderAPIs.prototype.getDestinationsXML=function(){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mod="http://www.mitel.com/ucs/ws/model">',"<soapenv:Header/>","<soapenv:Body>","<mod:GetDestinations/>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getAccountInfoXML=function(){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mod="http://www.mitel.com/ucs/ws/model">',"<soapenv:Header/>","<soapenv:Body>","<mod:GetAccountInfo/>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getUCInfoXML=function(){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mod="http://www.mitel.com/ucs/ws/model">',"<soapenv:Header/>","<soapenv:Body>","<mod:GetUCInfo/>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getPhysicalDeviceInformationXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ed4="http://www.ecma-international.org/standards/ecma-323/csta/ed4">',"<soapenv:Header/>","<soapenv:Body>","<ed4:GetPhysicalDeviceInformation>","<ed4:device>",t,"</ed4:device>","</ed4:GetPhysicalDeviceInformation>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getMakeCallXML=function(e,t){
var o=[];
o.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ed4="http://www.ecma-international.org/standards/ecma-323/csta/ed4">',"<soapenv:Header/>","<soapenv:Body>","<ed4:MakeCall>","<ed4:callingDevice>",e,"</ed4:callingDevice>","<ed4:calledDirectoryNumber>",t,"</ed4:calledDirectoryNumber>","</ed4:MakeCall>","</soapenv:Body>","</soapenv:Envelope>");
return o.join("")
};
ZmClick2CallProviderAPIs.prototype.getCallLogsXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mod="http://www.mitel.com/ucs/ws/model">',"<soapenv:Header/>","<soapenv:Body>","<mod:GetCallLogs>","<mod:type>",t,"</mod:type>","</mod:GetCallLogs>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getPresenceXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:mod="http://www.mitel.com/ucs/ws/model">',"<soapenv:Header/>","<soapenv:Body>","<mod:GetStatusSnapShot>","<mod:accountId>",t,"</mod:accountId>","</mod:GetStatusSnapShot>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getStartSessionRequestXML=function(o,e){
var t=[];
t.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:NpViewService">',"<soapenv:Header/>","<soapenv:Body>","<urn:StartSessionRequest>","<Mailbox>",o,"</Mailbox>","<Pin>",e,"</Pin>","</urn:StartSessionRequest>","</soapenv:Body>","</soapenv:Envelope>");
return t.join("")
};
ZmClick2CallProviderAPIs.prototype.getMessagesRequestXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:NpViewService">',"<soapenv:Header/>","<soapenv:Body>","<urn:GetMessagesRequest>","<SessionHandle>",t,"</SessionHandle>","</urn:GetMessagesRequest>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getMessageUrlRequestXML=function(o,e){
var t=[];
t.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:NpViewService">',"<soapenv:Header/>","<soapenv:Body>","<urn:GetMessageUrlRequest>","<SessionHandle>",o,"</SessionHandle>","<RecordingID>",e,"</RecordingID>","</urn:GetMessageUrlRequest>","</soapenv:Body>","</soapenv:Envelope>");
return t.join("")
};
ZmClick2CallProviderAPIs.prototype.getEndSessionRequestXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:NpViewService">',"<soapenv:Header/>","<soapenv:Body>","<urn:EndSessionRequest>","<SessionHandle>",t,"</SessionHandle>","</urn:EndSessionRequest>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getClearConnectionXML=function(t){
var e=[];
e.push('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ed4="http://www.ecma-international.org/standards/ecma-323/csta/ed4">',"<soapenv:Header/>","<soapenv:Body>","<ed4:ClearConnection>","<ed4:connectionToBeCleared>","<ed4:deviceID>",t,"</ed4:deviceID>","</ed4:connectionToBeCleared>","</ed4:ClearConnection>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.doClick2Call=function(e,t,h){
var o=this.getMakeCallXML(e,t);
var n=new Array();
n.Authorization=this.make_basic_auth(this._email,this._password);
n["content-type"]="text/xml";
n["content-length"]=o.length;
var r=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
var s=new AjxCallback(this,this._call2CallHandler,h);
AjxRpc.invoke(o,r,n,s,AjxRpcRequest.HTTP_POST)
};
ZmClick2CallProviderAPIs.prototype._call2CallHandler=function(n,t){
var o;
var e={};
if(!t.success){
o=this.xmlToObject(t);
if(o&&o.Body&&o.Body.Fault&&o.Body.Fault.faultstring){
e.success=false;
e.error=o.Body.Fault.faultstring.toString()
}else{
e.success=false;
e.error=""
}}else{
o=this.xmlToObject(t);
if(o.Body&&o.Body.MakeCallResponse){
e.success=true
}}
if(n){
n.run(e)
}};
ZmClick2CallProviderAPIs.prototype.doHangUp=function(e,s){
var t=this.getClearConnectionXML(e);
var o=new Array();
o.Authorization=this.make_basic_auth(this._email,this._password);
o["content-type"]="text/xml";
o["content-length"]=t.length;
var n=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
AjxRpc.invoke(t,n,o,new AjxCallback(this,this._hangupHandler,s),AjxRpcRequest.HTTP_POST)
};
ZmClick2CallProviderAPIs.prototype.getPresence=function(o,s){
var e=this.getPresenceXML(o);
var t=new Array();
t.Authorization=this.make_basic_auth(this._email,this._password);
t["content-type"]="text/xml";
t["content-length"]=e.length;
var n=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
n=n.substring(0,n.length-4);
n=n+"ucs";
AjxRpc.invoke(e,n,t,new AjxCallback(this,this._presenceHandler,s),AjxRpcRequest.HTTP_POST)
};
ZmClick2CallProviderAPIs.prototype._hangupHandler=function(o,t){
var e={};
e={
success:true};
if(o){
o.run(e)
}};
ZmClick2CallProviderAPIs.prototype._presenceHandler=function(n,t){
var o=this.xmlToObject(t);
var e={};
if(!t.success){
if(o&&o.Body&&o.Body.Fault&&o.Body.Fault.faultstring){
e.success=false;
e.error=o.Body.Fault.faultstring.toString()
}else{
e.success=false;
e.error=""
}}else{
o=this.xmlToObject(t);
if(o.Body){
e.success=true
}}
if(n){
n.run(e)
}};
ZmClick2CallProviderAPIs.prototype.make_basic_auth=function(t,o){
var e=t+":"+o;
var n=Base64.encode(e);
return"Basic "+n
};
ZmClick2CallProviderAPIs.prototype.xmlToObject=function(e,t){
if(!e.success){
return
}
if(t){
var o=new AjxXmlDoc.createFromDom(e.xml)
}else{
var o=new AjxXmlDoc.createFromDom(e.xml).toJSObject(true,false)
}
return o
};
ZmClick2CallDlg=function(e,t){
this.toPhoneNumber="";
this.fromPhoneNumber="";
this.zimlet=t;
this.soapCalls=this.zimlet.soapAPI;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._dialogView.setSize(300,150);
DwtDialog.call(this,{
parent:e,className:"ZmClick2CallDlg",title:this.zimlet.getMessage("click2callDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.NO_BUTTONS],mode:DwtBaseDialog.MODELESS}
);
this._setWhiteBackground();
this._buttonDesc={};
this._callingStr=this.zimlet.getMessage("calling");
this._connectionFailedStr=this.zimlet.getMessage("connectionFailedTryRedialling");
this._connectionSuccessfulStr=this.zimlet.getMessage("connectionSuccessfulStr");
this._callHungUpStr=this.zimlet.getMessage("callHungUp");
this._addMinimizeAndCloseBtns()
};
ZmClick2CallDlg.prototype=new DwtDialog;
ZmClick2CallDlg.prototype.constructor=ZmClick2CallDlg;
ZmClick2CallDlg.prototype.CONTROLS_TEMPLATE=null;
ZmClick2CallDlg.PHOTO_ID="click2CallDlg_photoBG";
ZmClick2CallDlg.PHOTO_PARENT_ID="click2CallDlg_photoBGDiv";
ZmClick2CallDlg.TEXT_DIV_ID="click2CallDlg_TextDiv";
ZmClick2CallDlg.prototype._dragStart=function(e,t){};
ZmClick2CallDlg.prototype._setWhiteBackground=function(){
var e=this._dialogView.getHtmlElement();
while(e&&e.className&&e.className.indexOf("WindowInnerContainer")==-1){
e=e.parentNode
}
if(e==null){
return
}
e.style.backgroundColor="white"
};
ZmClick2CallDlg.prototype.popup=function(){
DwtDialog.prototype.popup.call(this);
this._searchAndShowContactInfo();
this._showAsCalling();
this._animateCallingText();
this._callingTxtInterval=setInterval(AjxCallback.simpleClosure(this._animateCallingText,this),700)
};
ZmClick2CallDlg.prototype._addMinimizeAndCloseBtns=function(){
var e=["<table><tbody><tr><td class='minWidth' ></td>","<td class='",this._titleEl.className,"' id='",this._titleEl.id,"'> ",this._titleEl.innerHTML,"</td>","<td  width='22px' align='center' ><div style='cursor:pointer;' id='FromPhoneDlg_minMaxBtn' class='ImgClick2Call-minimize-icon' /></td>","<td  width='22px' align='center' ><div style='cursor:pointer;' id='FromPhoneDlg_closeBtn' class='ImgCloseGray' /></td>","</tr></tbody></table>"];
var o=document.createElement("div");
o.innerHTML=e.join("");
var t=this._titleEl.parentNode.parentNode;
t.replaceChild(o.firstChild.firstChild.firstChild,this._titleEl.parentNode);
this._minMaxeDlgBtn=document.getElementById("FromPhoneDlg_minMaxBtn");
this._minMaxeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleMinMaxDlg,this);
this._closeDlgBtn=document.getElementById("FromPhoneDlg_closeBtn");
this._closeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleCloseDlg,this)
};
ZmClick2CallDlg.prototype._handleMinMaxDlg=function(){
if(this._minMaxeDlgBtn.className=="ImgClick2Call-minimize-icon"){
this._dlgTopPosB4Minimize=(this.getHtmlElement().style.top).replace("px","");
this._minMaxeDlgBtn.className="ImgClick2Call-maximize-icon";
this.getHtmlElement().style.top=(document.body.offsetHeight-25)+"px"
}else{
if(this._minMaxeDlgBtn.className=="ImgClick2Call-maximize-icon"){
this._minMaxeDlgBtn.className="ImgClick2Call-minimize-icon";
this.getHtmlElement().style.top=this._dlgTopPosB4Minimize+"px"
}}};
ZmClick2CallDlg.prototype._handleCloseDlg=function(){
this._hideActionId=null;
this.popdown()
};
ZmClick2CallDlg.prototype._searchAndShowContactInfo=function(e,n,h){
if(!e){
e=1
}
if(!n){
n=this.toPhoneNumber
}
var r,o,t;
r={
SearchRequest:{
_jsns:"urn:zimbraMail"}};
o=r.SearchRequest;
o.types="contact";
o.query=n;
o.offset=0;
o.limit=e;
if(!h){
h=""
}
var s=new AjxCallback(this,this._handleContactSearch,h);
appCtxt.getAppController().sendRequest({
jsonObj:r,asyncMode:true,callback:s,noBusyOverlay:true}
)
};
ZmClick2CallDlg.prototype._handleContactSearch=function(e,t){
var r;
var u={};
if(t){
var h;
var s=t.getResponse();
var d=s.SearchResponse.cn;
if(e&&e!=""){
e.run(d);
return
}
if(d){
h=d[0]
}
if(h&&h._attrs){
u=h._attrs;
if(u.image){
var n=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);
r=[n,"/?auth=co&id=",h.id,"&part=",u.image.part,"&t=",(new Date()).getTime()].join("")
}
u.toPhoneNumber=this.toPhoneNumber;
this._setContactDetails(u,r);
return
}}
var f,o,l;
f={
SearchGalRequest:{
_jsns:"urn:zimbraAccount"}};
o=f.SearchGalRequest;
o.type="account";
o.name=this.toPhoneNumber;
o.offset=0;
o.limit=1;
var m=new AjxCallback(this,this._handleGalSearchResponse);
appCtxt.getAppController().sendRequest({
jsonObj:f,asyncMode:true,callback:m,noBusyOverlay:true}
)
};
ZmClick2CallDlg.prototype._handleGalSearchResponse=function(o){
var e=false;
var n={};
if(o){
var s=o.getResponse();
var h=s.SearchGalResponse.cn;
if(h&&h[0]&&h[0]._attrs){
n=s.SearchGalResponse.cn[0]._attrs;
e=true
}}
n.toPhoneNumber=this.toPhoneNumber;
var r;
if(n.photoFileName){
var t=n.photoFileName?n.photoFileName:"noname.jpg";
r=ZmZimletBase.PROXY+ZmClick2CallDlg.PHOTO_BASE_URL+n.photoFileName
}
this._setContactDetails(n,r)
};
ZmClick2CallDlg.prototype._getTooltipBGHtml=function(e){
var o=";";
var n=";";
if(AjxEnv.isIE){
var o="width:100%;";
var n="left:3%;"
}
var t={
photoParentId:ZmClick2CallDlg.PHOTO_PARENT_ID,textDivId:ZmClick2CallDlg.TEXT_DIV_ID,width:o,left:n};
return AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#Frame",t)
};
ZmClick2CallDlg.prototype._setContactDetails=function(l,s){
var o=l;
if(l.workState||l.workCity||l.workStreet||l.workPostalCode){
var e=l.workState?l.workState:"";
var n=l.workCity?l.workCity:"";
var d=l.workStreet?l.workStreet:"";
var u=l.workPostalCode?l.workPostalCode:"";
var h=[d," ",n," ",e," ",u].join("");
o.address=AjxStringUtil.trim(h)
}
o=this._formatTexts(o);
o.callingStr=this._callingStr;
o.connectionFailedStr=this._connectionFailedStr;
o.callSuccessfulStr=this._connectionSuccessfulStr;
o.callHungUpStr=this._callHungUpStr;
var r=AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#ContactDetails",o);
this._dialogView.getHtmlElement().innerHTML=r;
this._setProfileImage(s);
var t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("hangUp"));
t.setImage("Click2CallPhoneHangupBtn");
t.addSelectionListener(new AjxListener(this,this._handleHangUpBtnClick));
document.getElementById("click2CallDlg_hangupBtnDiv").appendChild(t.getHtmlElement());
t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("redial"));
t.setImage("Telephone");
t.addSelectionListener(new AjxListener(this,this._redialBtnHandler));
document.getElementById("click2CallDlg_reDialBtnDiv").appendChild(t.getHtmlElement());
this._removeCustomAttrs(l)
};
ZmClick2CallDlg.prototype._showAsCalling=function(){
var e={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"block",click2CallDlg_reDialBtnDiv:"none",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(e)
};
ZmClick2CallDlg.prototype.showErrorMsgAndRedial=function(e){
var t={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"block",click2callDlg_reDialMsgDiv:"block",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(t)
};
ZmClick2CallDlg.prototype._showHungUpMsgAndRedial=function(){
var e={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"block",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"block"};
this._showHideCardParts(e)
};
ZmClick2CallDlg.prototype._showCallCompleted=function(){
var e={
click2CallDlg_hangupBtnDiv:"block",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"none",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"block",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(e);
this._hideActionId=AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._handleCloseDlg),10000)
};
ZmClick2CallDlg.prototype._showHideCardParts=function(r){
clearInterval(this._callingTxtInterval);
var s=document.getElementById("click2CallDlg_hangupBtnDiv");
var t=document.getElementById("ringingPhoneMsgDiv");
var h=document.getElementById("click2CallDlg_reDialBtnDiv");
var n=document.getElementById("click2callDlg_reDialMsgDiv");
var o=document.getElementById("click2callDlg_callCompletedMsgDiv");
var e=document.getElementById("click2callDlg_callHungUpMsgDiv");
if(s){
document.getElementById("click2CallDlg_hangupBtnDiv").style.display=r.click2CallDlg_hangupBtnDiv
}
if(t){
document.getElementById("ringingPhoneMsgDiv").style.display=r.ringingPhoneMsgDiv
}
if(h){
document.getElementById("click2CallDlg_reDialBtnDiv").style.display=r.click2CallDlg_reDialBtnDiv
}
if(n){
document.getElementById("click2callDlg_reDialMsgDiv").style.display=r.click2callDlg_reDialMsgDiv
}
if(o){
document.getElementById("click2callDlg_callCompletedMsgDiv").style.display=r.click2callDlg_callCompletedMsgDiv
}
if(e){
document.getElementById("click2callDlg_callHungUpMsgDiv").style.display=r.click2callDlg_callHungUpMsgDiv
}};
ZmClick2CallDlg.prototype._animateCallingText=function(){
var e=document.getElementById("click2Call_callingLabel");
if(e){
if(this.__callingLableColor=="red"){
this.__callingLableColor="maroon"
}else{
this.__callingLableColor="red"
}
e.style.color=this.__callingLableColor
}else{
clearInterval(this._callingTxtInterval)
}};
ZmClick2CallDlg.prototype._redialBtnHandler=function(){
this._callingTxtInterval=setInterval(AjxCallback.simpleClosure(this._animateCallingText,this),700);
this._showAsCalling();
this.clickToCall(true)
};
ZmClick2CallDlg.prototype._removeCustomAttrs=function(o){
var t=["rightClickForMoreOptions","formattedEmail","address","toPhoneNumber","callingStr","connectionFailedStr","callSuccessfulStr","callHungUpStr"];
for(var n=0;
n<t.length;
n++){
var e=t[n];
if(o[e]){
delete o[e]
}}};
ZmClick2CallDlg.prototype._formatTexts=function(t){
var e=t.email?t.email:"";
t.formattedEmail=e;
if(e.length>25){
var o=e.split("@");
var n=o[0];
var r=o[1];
if(n.length>25){
n=n.substring(0,24)+".."
}
t.formattedEmail=[n," @",r].join("")
}
var s=t.fullName?t.fullName:"";
if(s==e){
t.fullName=""
}
return t
};
ZmClick2CallDlg.prototype._setProfileImage=function(o){
var t=document.getElementById(ZmClick2CallDlg.PHOTO_PARENT_ID);
t.width=65;
t.height=80;
t.style.width=65;
t.style.height=80;
if(!o||o==""){
this._handleImgLoadFailure();
return
}
var e=new Image();
e.src=o;
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e)
};
ZmClick2CallDlg.prototype._handleImgLoadFailure=function(){
var e=new Image();
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e);
e.id=ZmClick2CallDlg.PHOTO_ID;
e.src=this.zimlet.getResource("img/unknownPerson.jpg")
};
ZmClick2CallDlg.prototype._handleImageLoad=function(e){
var t=document.getElementById(ZmClick2CallDlg.PHOTO_PARENT_ID);
if(!t){
return
}
t.innerHTML="";
t.appendChild(e);
e.width=65;
e.height=80
};
ZmClick2CallDlg.prototype.clickToCall=function(e){
if(!e){
this.popup()
}
this.soapCalls.doClick2Call(this.fromPhoneNumber,this.toPhoneNumber,new AjxCallback(this,this._click2CallHandler))
};
ZmClick2CallDlg.prototype._click2CallHandler=function(e){
if(!e.success){
this.showErrorMsgAndRedial()
}else{
this._showCallCompleted()
}};
ZmClick2CallDlg.prototype._handleHangUpBtnClick=function(){
this.soapCalls.doHangUp(this.fromPhoneNumber,new AjxCallback(this,this._hangupHandler))
};
ZmClick2CallDlg.prototype._hangupHandler=function(e){
if(!e.success){
this.showErrorMsgAndRedial()
}else{
if(this._hideActionId){
AjxTimedAction.cancelAction(this._hideActionId);
this._hideActionId=null
}
this._showHungUpMsgAndRedial("")
}};
ZmClick2CallFromPhoneDlg=function(e,t){
this.zimlet=t;
this.toPhoneNumber="";
this._dialogView=new DwtComposite(appCtxt.getShell());
this._dialogView.setSize(300,125);
DwtDialog.call(this,{
parent:e,className:"ZmClick2CallFromPhoneDlg",title:this.zimlet.getMessage("fromPhoneDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.NO_BUTTONS],mode:DwtBaseDialog.MODELESS}
);
this._setWhiteBackground();
if(!this.click2CallDlg){
this.click2CallDlg=new ZmClick2CallDlg(this.zimlet.getShell(),this.zimlet)
}
this._buttonDesc={};
this._isLoaded=false;
this.RE=new RegExp("\\+?\\b\\d([0-9\\(\\)\\.\\s\\-]){8,20}\\d\\b");
this.RE_EXT=new RegExp("\\d{1,8}")
};
ZmClick2CallFromPhoneDlg.prototype=new ZmDialog;
ZmClick2CallFromPhoneDlg.prototype.constructor=ZmClick2CallFromPhoneDlg;
ZmClick2CallFromPhoneDlg.prototype.CONTROLS_TEMPLATE=null;
ZmClick2CallFromPhoneDlg.prototype._setWhiteBackground=function(){
var e=this._dialogView.getHtmlElement();
while(e&&e.className&&e.className.indexOf("WindowInnerContainer")==-1){
e=e.parentNode
}
if(e==null){
return
}
e.style.backgroundColor="white"
};
ZmClick2CallFromPhoneDlg.prototype.showDialog=function(){
if(!this._isLoaded){
appCtxt.setStatusMsg(ZmMsg.loading);
this._getVoiceInfoAndShowDlg()
}else{
this.setToPhoneText();
if(AjxUtil.isEmpty(this.zimlet.toPhoneNumber)){
this.btnCall.setEnabled(false)
}else{
this.btnCall.setEnabled(true)
}
this.popup()
}};
ZmClick2CallFromPhoneDlg.prototype._getVoiceInfoAndShowDlg=function(){
var e=AjxSoapDoc.create("GetVoiceInfoRequest","urn:zimbraVoice");
var n=new AjxCallback(this,this._handleResponseVoiceInfo);
var t=new AjxCallback(this,this._handleErrorResponseVoiceInfo);
var o={
soapDoc:e,asyncMode:true,noBusyOverlay:true,callback:n,errorCallback:t};
appCtxt.getAppController().sendRequest(o);
this._gettingVoiceInfo=true
};
ZmClick2CallFromPhoneDlg.prototype._handleResponseVoiceInfo=function(e){
var t=e.getResponse();
if(t.GetVoiceInfoResponse&&t.GetVoiceInfoResponse.phone){
var o=t.GetVoiceInfoResponse.phone;
this._createCallFromHtml(o);
this.setToPhoneText();
this._addMinimizeAndCloseBtns();
this.popup();
this._isLoaded=true
}};
ZmClick2CallFromPhoneDlg.prototype._addMinimizeAndCloseBtns=function(){
var e=["<table><tbody><tr><td colspan='4'>","<div id='",this._titleEl.id,"' style='position:relative;height:26px;'>","<div class='",this._titleEl.className,"' style='position:absolute;left:0;margin-right:44px;'>",this._titleEl.innerHTML,"</div>","<div id='fromPhoneDlg_minMaxBtn' class='ImgClick2Call-minimize-icon' style='cursor:pointer;position:absolute;right:25px;top:5px;'></div>","<div id='fromPhoneDlg_closeBtn' class='ImgCloseGray' style='cursor:pointer;position:absolute;right:3px;top:5px;'></div></div>","</td></tr></tbody></table>"];
var o=document.createElement("div");
o.innerHTML=e.join("");
var t=this._titleEl.parentNode.parentNode;
t.replaceChild(o.firstChild.firstChild.firstChild,this._titleEl.parentNode);
this._minMaxeDlgBtn=document.getElementById("fromPhoneDlg_minMaxBtn");
this._minMaxeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleMinMaxDlg,this);
this._closeDlgBtn=document.getElementById("fromPhoneDlg_closeBtn");
this._closeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleCloseDlg,this)
};
ZmClick2CallFromPhoneDlg.prototype._handleMinMaxDlg=function(){
if(this._minMaxeDlgBtn.className=="ImgClick2Call-minimize-icon"){
this._dlgTopPosB4Minimize=(this.getHtmlElement().style.top).replace("px","");
this._minMaxeDlgBtn.className="ImgClick2Call-maximize-icon ";
this.getHtmlElement().style.top=(document.body.offsetHeight-25)+"px"
}else{
if(this._minMaxeDlgBtn.className=="ImgClick2Call-maximize-icon "){
this._minMaxeDlgBtn.className="ImgClick2Call-minimize-icon";
this.getHtmlElement().style.top=this._dlgTopPosB4Minimize+"px"
}}};
ZmClick2CallFromPhoneDlg.prototype._handleCloseDlg=function(){
this.popdown()
};
ZmClick2CallFromPhoneDlg.prototype._createCallFromHtml=function(e){
var o={
fromStr:this.zimlet.getMessage("from"),toStr:this.zimlet.getMessage("to")};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#fromPhoneDlg",o);
this._toPhoneTxtInput=document.getElementById("click2CallDlg_callToPHText");
this._toPhoneTxtInput.onkeyup=AjxCallback.simpleClosure(this._handleToPhChanged,this);
this._setFromPhoneMenu(e);
this._setToPhoneMenu();
var t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("call"));
t.setImage("Telephone");
t.addSelectionListener(new AjxListener(this,this._makeCall));
document.getElementById("click2CallFromPhoneDlg_callBtn").appendChild(t.getHtmlElement());
this.btnCall=t;
if(AjxUtil.isEmpty(this.zimlet.toPhoneNumber)){
this.btnCall.setEnabled(false)
}};
ZmClick2CallFromPhoneDlg.prototype._handleToPhChanged=function(){
if(AjxUtil.isEmpty(document.getElementById("click2CallDlg_callToPHText").value)){
this.btnCall.setEnabled(false);
return
}
this.btnCall.setEnabled(true)
};
ZmClick2CallFromPhoneDlg.prototype._setFromPhoneMenu=function(o){
if(!o){
return
}
var s=[];
var n=0;
s[n++]="<select id=\"click2CallFromPhoneDlg_callFromMenu\" style='width:200px' >";
for(var t=0;
t<o.length;
t++){
var e=o[t];
if(!e.c2cDeviceId){
continue
}
s[n++]=["<option value='",e.c2cDeviceId,"'>",e.label," (",e.name,")</option>"].join("")
}
s[n++]="</select>";
document.getElementById("click2CallFromPhoneDlg_menuDiv").innerHTML=s.join("")
};
ZmClick2CallFromPhoneDlg.prototype._setToPhoneMenu=function(){
this.emailZimlet=this.zimlet.getEmailZimlet();
var e=this.emailZimlet&&this.emailZimlet.contactCard&&this.emailZimlet.contactCard.attribs;
if(!e){
return
}
this.click2CallDlg.toPhoneNumber=this.zimlet.toPhoneNumber=e.mobilePhone||e.workPhone
};
ZmClick2CallFromPhoneDlg.prototype._makeCall=function(){
this.click2CallDlg.toPhoneNumber=document.getElementById("click2CallDlg_callToPHText").value;
this.click2CallDlg.fromPhoneNumber=document.getElementById("click2CallFromPhoneDlg_callFromMenu").value;
if(!this.isValidPhoneNumber(this.click2CallDlg.toPhoneNumber)){
this._showError(AjxMessageFormat.format(this.zimlet.getMessage("notAValidPhoneNumber"),[this.click2CallDlg.toPhoneNumber]));
return
}
this.popdown();
this.click2CallDlg.clickToCall()
};
ZmClick2CallFromPhoneDlg.prototype.isValidPhoneNumber=function(e){
return this.RE.test(e)||this.RE_EXT.test(e)
};
ZmClick2CallFromPhoneDlg.prototype.setToPhoneText=function(){
document.getElementById("click2CallDlg_callToPHText").value=this.zimlet.toPhoneNumber||""
};
ZmClick2CallFromPhoneDlg.prototype.popdown=function(){
ZmDialog.prototype.popdown.call(this)
};
ZmClick2CallVoicePINDlg=function(e){
if(!e){
return
}
this.zimlet=e;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._createView();
var t=new DwtDialog_ButtonDescriptor(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID,this.zimlet.getMessage("updatePin"),DwtDialog.ALIGN_RIGHT);
DwtDialog.call(this,{
parent:appCtxt.getShell(),title:this.zimlet.getMessage("voicePINDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.CANCEL_BUTTON],extraButtons:[t]}
);
this.setButtonListener(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID,new AjxListener(this,this._updateBtnHandler));
this._pinField=document.getElementById("click2CallVoicePINDlg_PIN_field");
this._confirmPinField=document.getElementById("click2CallVoicePINDlg_PIN_confirm_field");
this._addTabControl();
this.RE=new RegExp("\\d+","g")
};
ZmClick2CallVoicePINDlg.prototype=new DwtDialog;
ZmClick2CallVoicePINDlg.prototype.constructor=ZmClick2CallVoicePINDlg;
ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID="click2call_voice_pin_dlg_update_btn";
ZmClick2CallVoicePINDlg.PIN_FIELD_ID="click2CallVoicePINDlg_PIN_field";
ZmClick2CallVoicePINDlg.CONFIRM_PIN_FIELD_ID="click2CallVoicePINDlg_PIN_confirm_field";
ZmClick2CallVoicePINDlg.prototype._createView=function(){
var e={
pinStr:this.zimlet.getMessage("pinStr"),confirmPINStr:this.zimlet.getMessage("confirmPINStr"),pinFieldId:ZmClick2CallVoicePINDlg.PIN_FIELD_ID,confirmPinFieldId:ZmClick2CallVoicePINDlg.CONFIRM_PIN_FIELD_ID};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("com_zimbra_click2call_mitel.templates.ZmClick2Call#voicePINDlg",e)
};
ZmClick2CallVoicePINDlg.prototype._updateBtnHandler=function(){
if(this._pinField&&this._confirmPinField){
if(this._pinField.value==""&&this._confirmPinField.value==""){
return false
}else{
if(this._pinField.value!=this._confirmPinField.value){
this.zimlet.displayErrorMessage(this.zimlet.getMessage("pinAndConfirmPinDidntMatch"),this.zimlet.getMessage("pinAndConfirmPinDidntMatch"),this.zimlet.getMessage("invalidPin"));
return false
}else{
if(!this.isPINDigits(this._pinField.value)){
this.zimlet.displayErrorMessage(this.zimlet.getMessage("pinCanOnlyBeDigits"),this.zimlet.getMessage("pinCanOnlyBeDigits"),this.zimlet.getMessage("invalidPin"));
return false
}else{
this._updatePIN(this._pinField.value)
}}}}};
ZmClick2CallVoicePINDlg.prototype._addTabControl=function(){
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(this._pinField,0);
this._tabGroup.addMember(this._confirmPinField,1);
this._tabGroup.addMember(this.getButton(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID),2);
this._tabGroup.addMember(this.getButton(ZmClick2CallVoicePINDlg.CANCEL_BUTTON),3)
};
ZmClick2CallVoicePINDlg.prototype.isPINDigits=function(e){
return this.RE.test(e)
};
ZmClick2CallVoicePINDlg.prototype._updatePIN=function(e){};
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call#Frame",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div id='Click2CallZimlet_MainDiv' align='center' \n";
e[o++]="\t\t\tstyle='display:block;overflow:auto;background:white;'></div>";
return n?e.length:e.join("")
}
,{
id:"Frame"}
,true);
AjxPackage.define("com_zimbra_click2call_mitel.templates.ZmClick2Call");
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call",AjxTemplate.getTemplate("com_zimbra_click2call_mitel.templates.ZmClick2Call#Frame"),AjxTemplate.getParams("com_zimbra_click2call_mitel.templates.ZmClick2Call#Frame"));
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call#ContactDetails",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table height=\"100%\" width=\"100%\"><tr><td colspan=2><div id='ringingPhoneMsgDiv'><label id='click2Call_callingLabel' style='color:maroon;'>";
e[o++]=s.callingStr;
e[o++]="</label></div><div id='click2callDlg_reDialMsgDiv' style='display:none;'><div><label style='color:red;'>";
e[o++]=s.connectionFailedStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div><div id='click2callDlg_callCompletedMsgDiv' style='display:none;'><div><label style='color:green;'>";
e[o++]=s.callSuccessfulStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div><div id='click2callDlg_callHungUpMsgDiv' style='display:none;'><div><label style='color:green;'>";
e[o++]=s.callHungUpStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div></td></tr><tr><td style='width:75px;'><div id='click2CallDlg_photoBGDiv' align='center'></div></td><td><div id='click2CallDlg_TextDiv'>";
if(s.firstName&&s.lastName){
e[o++]="<div><label style='font-size:13px;'>";
e[o++]=s.firstName;
e[o++]=" ";
e[o++]=s.lastName;
e[o++]="</label></div><div><label class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.toPhoneNumber);
e[o++]="</label></div>"
}else{
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.toPhoneNumber);
e[o++]="</label></div>"
}
if(s.jobTitle){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.jobTitle);
e[o++]="</label></div>"
}
if(s.company){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.company);
e[o++]="</label></div>"
}
e[o++]="</div></td></tr><tr><td colspan=2 align='center'><table><tr><td><div id='click2CallDlg_hangupBtnDiv' style='display:none;'></div></td><td><div id='click2CallDlg_reDialBtnDiv' style='display:none;'></div></td></tr></table></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"ContactDetails"}
,true);
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call#fromPhoneDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div style='padding:5px;'><table class='ZPropertySheet' cellspacing='6' width='100%'><tr><td class='ZmFieldLabelRight'><label for='click2CallFromPhoneDlg_menuDiv'>";
e[o++]=s.fromStr;
e[o++]="</label></td><td><div id='click2CallFromPhoneDlg_menuDiv'></div></td><tr></tr><td class='ZmFieldLabelRight'><label for='click2CallDlg_callToPHText'>";
e[o++]=s.toStr;
e[o++]="</label></td><td><input type=text id='click2CallDlg_callToPHText' style='width:200px'></text></td></tr></table><table width='100%' style='margin-top:25px;'><tr><td id='click2CallFromPhoneDlg_callBtn' align='center'></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"fromPhoneDlg"}
,true);
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call#Tooltip",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table><tr><td>";
e[o++]=AjxImg.getImageHtml("Telephone");
e[o++]="</td><td><div style='white-space:nowrap'>";
e[o++]=s.phoneStr;
e[o++]=":</div></td><td><div style='white-space:nowrap'>";
e[o++]=AjxStringUtil.htmlEncode(s.contentObjText);
e[o++]="</div></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"Tooltip"}
,true);
AjxTemplate.register("com_zimbra_click2call_mitel.templates.ZmClick2Call#voicePINDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div style='padding:5px;' ><table class='ZPropertySheet' cellspacing='6' width='100%'><tr><td class='ZmFieldLabelRight'><label for='";
e[o++]=s.pinFieldId;
e[o++]="'>";
e[o++]=s.pinStr;
e[o++]="</label></td><td><input id='";
e[o++]=s.pinFieldId;
e[o++]="' type='password' style='width:200px'></text></td></tr><tr><td class='ZmFieldLabelRight'><label for='";
e[o++]=s.confirmPinFieldId;
e[o++]="'>";
e[o++]=s.confirmPINStr;
e[o++]="</label></td><td><input id='";
e[o++]=s.confirmPinFieldId;
e[o++]="' type='password' style='width:200px'></text></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"voicePINDlg"}
,true);
ZmClick2CallZimlet=function(){};
ZmClick2CallZimlet.prototype=new ZmZimletBase();
ZmClick2CallZimlet.prototype.constructor=ZmClick2CallZimlet;
ZmClick2CallZimlet.OP_CLICK_2_CALL_ZIMLET_VOICE_PIN="CLICK_2_CALL_ZIMLET_VOICE_PIN";
ZmClick2CallZimlet.prototype.init=function(){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
ZmZimletBase.prototype.init.apply(this,arguments);
var e=appCtxt.getApp(ZmApp.VOICE);
if(!e){
return
}
e.registerUCProvider(this);
this.UC_INFO_LOADED=false;
this.getUserUCInfo()
};
ZmClick2CallZimlet.prototype._handleLoginResponse=function(e){};
ZmClick2CallZimlet.prototype._handlePresenceResponse=function(e){
alert(e.imStatus)
};
ZmClick2CallZimlet.prototype.getUserUCInfo=function(){
var e=AjxSoapDoc.create("GetUCInfoRequest","urn:zimbraVoice");
var n=new AjxCallback(this,this._handleUCInfoResponse);
var t=new AjxCallback(this,this._handleErrorResponseUCInfo);
var o={
soapDoc:e,asyncMode:true,noBusyOverlay:true,callback:n,errorCallback:t};
appCtxt.getAppController().sendRequest(o)
};
ZmClick2CallZimlet.prototype._handleUCInfoResponse=function(t){
t=t._data;
if(!t||!t.GetUCInfoResponse){
this._popupErrorDlg(this.getMessage("err_failedFetchUCINfo"));
return
}
var o=t.GetUCInfoResponse;
if(!o.attrs||!(o.attrs instanceof Array)||o.attrs.length<1){
this._popupErrorDlg(this.getMessage("err_failedFetchUCINfo"));
return
}
var e=o.attrs[0]._attrs;
this.username=e.zimbraUCUsername;
this.password=e.zimbraUCPassword;
this.serverUrl=e.zimbraUCCallControlURL;
this.soapAPI=new ZmClick2CallProviderAPIs(this,this.serverUrl,this.username,this.password);
this._applicationSessionId=e.zimbraUCPresenceSessionId;
this._ciscoUser=e.zimbraUCUsername;
this.presenceServer=e.zimbraUCPresenceURL;
this.presenceAPI=new ZmClick2CallPresenceAPIs(this,this._ciscoUser,this.presenceServer,this._applicationSessionId);
var n=new AjxCallback(this,this._handleLoginResponse);
this.presenceAPI.login(n);
this.UC_INFO_LOADED=true
};
ZmClick2CallZimlet.prototype._popupErrorDlg=function(n,t){
var o=appCtxt.getErrorDialog();
o.reset();
var e=(t&&t.message)?t.message:t;
e=AjxUtil.isEmpty(e)?"":e;
o.setMessage(n,e,DwtMessageDialog.CRITICAL_STYLE,ZmMsg.zimbraTitle);
o.popup()
};
ZmClick2CallZimlet.prototype._handleErrorResponseVoiceInfo=function(e){
var t=appCtxt.getApp(ZmApp.VOICE);
if(!t){
return
}
t.processErrors(e);
return true
};
ZmClick2CallZimlet.prototype.getErrorDescription=function(t){
var e=ZmMsg.voicemailErrorUnknown;
if(!t.code){
return e
}
if(t.code.indexOf("voice.UNABLE_TO_AUTH")!=-1){
e=ZmMsg.voicemailErrorAuthFailure
}else{
if(t.code.indexOf("cisco")!=-1){
msg=t.msg||"";
if(msg.toLowerCase().indexOf("unable to auth")!=-1){
e=ZmMsg.voicemailErrorAuthFailure
}}}
return e
};
ZmClick2CallZimlet.prototype.hasVoicePIN=function(){
return false
};
ZmClick2CallZimlet.prototype.initializeToolbar=function(n,o,t,e){};
ZmClick2CallZimlet.prototype.getPresence=function(e,t){
if(!this.presenceAPI){
return null
}
this.presenceAPI.getPresence(e,t)
};
ZmClick2CallZimlet.prototype._changeVoicePinListener=function(){
if(!this._voicePINDlg){
this._voicePINDlg=new ZmClick2CallVoicePINDlg(this)
}
this._voicePINDlg.popup()
};
ZmClick2CallZimlet.prototype.toolTipPoppedUp=function(n,s,t,e){
var o={
contentObjText:s,phoneStr:ZmMsg.phone};
e.innerHTML=AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#Tooltip",o)
};
ZmClick2CallZimlet.prototype.clicked=function(t,e){
this.toPhoneNumber=e;
this._showFromPhoneDlg()
};
ZmClick2CallZimlet.prototype.display=function(e){
this.toPhoneNumber=e;
this._showFromPhoneDlg()
};
ZmClick2CallZimlet.prototype._showFromPhoneDlg=function(){
if(!this.UC_INFO_LOADED){
appCtxt.setStatusMsg(ZmMsg.loading);
try{
this.getUserUCInfo()
}
catch(e){
this._popupErrorDlg(this.getMessage("err_invalidUCInfo"),e);
return
}}
if(!this.zmFromPhoneDlg){
this.zmFromPhoneDlg=new ZmClick2CallFromPhoneDlg(this.getShell(),this)
}
this.zmFromPhoneDlg.toPhoneNumber=this.toPhoneNumber;
this.zmFromPhoneDlg.showDialog()
};
ZmClick2CallZimlet.prototype.onEmailHoverOver=function(e){
e.addSubscriberZimlet(this,false,{
presenceCallback:this.getPresence.bind(this)}
);
this.emailZimlet=e;
this._addSlide()
};
ZmClick2CallZimlet.prototype.onPhoneClicked=function(e){
if(!this.zmFromPhoneDlg){
this.zmFromPhoneDlg=new ZmClick2CallFromPhoneDlg(this.getShell(),this,this._destinationsInZimbra)
}
this.zmFromPhoneDlg.toPhoneNumber=this.toPhoneNumber=e;
this.zmFromPhoneDlg.showDialog()
};
ZmClick2CallZimlet.prototype.getEmailZimlet=function(){
return this.emailZimlet
};
ZmClick2CallZimlet.prototype._addSlide=function(){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
var t=this._getTooltipBGHtml();
var e=new AjxCallback(this,this._handleSlideSelect);
this._slide=new EmailToolTipSlide(t,true,"Click2CallZimletIcon",e,"Click to call");
this.emailZimlet.slideShow.addSlide(this._slide)
};
ZmClick2CallZimlet.prototype._handleSlideSelect=function(){
if(this._slide.loaded){
return
}
this.emailZimlet.tooltip.setSticky(false);
this.emailZimlet.popdown();
this._setDefaultPhoneNumber();
this._showFromPhoneDlg();
if(this._slide){
this._slide.loaded=true
}};
ZmClick2CallZimlet.prototype._setDefaultPhoneNumber=function(){
this.toPhoneNumber="";
if(!this.emailZimlet){
return
}
var t=this.emailZimlet._subscriberZimlets;
if(!AjxUtil.isArray(t)||AjxUtil.isEmpty(t)){
return
}
var o=false;
var e=t.length-1;
for(;
e>=0;
e--){
if(AjxUtil.isInstance(t[e],UnknownPersonSlide)){
o=true;
break
}}
if(!o){
return
}
this.toPhoneNumber=this._getContactPhoneNumber(t[e].attribs)
};
ZmClick2CallZimlet.prototype._getContactPhoneNumber=function(e){
if(!ZmEditContactView||!ZmEditContactView.prototype||!ZmEditContactView.prototype.getPhoneOptions){
return""
}
var n=ZmEditContactView.prototype.getPhoneOptions.call(this);
if(!AjxUtil.isArray(n)||AjxUtil.isEmpty(n)){
return""
}
if(!e){
return""
}
for(var o in e){
if(!o){
continue
}
for(var t=0;
t<n.length;
t++){
if(n[t].value.indexOf("Phone")>=0&&o.indexOf(n[t].value)>=0&&!AjxUtil.isEmpty(e[o])){
return e[o]
}}}
return""
};
ZmClick2CallZimlet.prototype._getTooltipBGHtml=function(){
return AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#Frame")
};
ZmClick2CallZimlet.prototype.match=function(o,s){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
var n=this.RE;
n.lastIndex=s;
var e=n.exec(o);
if(!e){
return e
}
var t=e[0];
if(t.length>10&&t[0]!="+"&&!(AjxUtil.arrayContains(t," "))&&!(AjxUtil.arrayContains(t,"."))&&!(AjxUtil.arrayContains(t,"-"))){
return null
}else{
e[0]=t;
return e
}};
var Base64={
_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(o){
var e="";
var u,l,r,d,h,s,n;
var t=0;
o=Base64._utf8_encode(o);
while(t<o.length){
u=o.charCodeAt(t++);
l=o.charCodeAt(t++);
r=o.charCodeAt(t++);
d=u>>2;
h=((u&3)<<4)|(l>>4);
s=((l&15)<<2)|(r>>6);
n=r&63;
if(isNaN(l)){
s=n=64
}else{
if(isNaN(r)){
n=64
}}
e=e+this._keyStr.charAt(d)+this._keyStr.charAt(h)+this._keyStr.charAt(s)+this._keyStr.charAt(n)
}
return e
}
,decode:function(o){
var e="";
var u,l,r;
var d,h,s,n;
var t=0;
o=o.replace(/[^A-Za-z0-9\+\/\=]/g,"");
while(t<o.length){
d=this._keyStr.indexOf(o.charAt(t++));
h=this._keyStr.indexOf(o.charAt(t++));
s=this._keyStr.indexOf(o.charAt(t++));
n=this._keyStr.indexOf(o.charAt(t++));
u=(d<<2)|(h>>4);
l=((h&15)<<4)|(s>>2);
r=((s&3)<<6)|n;
e=e+String.fromCharCode(u);
if(s!=64){
e=e+String.fromCharCode(l)
}
if(n!=64){
e=e+String.fromCharCode(r)
}}
e=Base64._utf8_decode(e);
return e
}
,_utf8_encode:function(t){
t=t.replace(/\r\n/g,"\n");
var e="";
for(var s=0;
s<t.length;
s++){
var o=t.charCodeAt(s);
if(o<128){
e+=String.fromCharCode(o)
}else{
if((o>127)&&(o<2048)){
e+=String.fromCharCode((o>>6)|192);
e+=String.fromCharCode((o&63)|128)
}else{
e+=String.fromCharCode((o>>12)|224);
e+=String.fromCharCode(((o>>6)&63)|128);
e+=String.fromCharCode((o&63)|128)
}}}
return e
}
,_utf8_decode:function(e){
var t="";
var o=0;
var n=c1=c2=0;
while(o<e.length){
n=e.charCodeAt(o);
if(n<128){
t+=String.fromCharCode(n);
o++
}else{
if((n>191)&&(n<224)){
c2=e.charCodeAt(o+1);
t+=String.fromCharCode(((n&31)<<6)|(c2&63));
o+=2
}else{
c2=e.charCodeAt(o+1);
c3=e.charCodeAt(o+2);
t+=String.fromCharCode(((n&15)<<12)|((c2&63)<<6)|(c3&63));
o+=3
}}}
return t
}};
function ZmClick2CallPresenceAPIs(o,t,e,n){
this.zimlet=o;
this._serverUrl=e;
this._username=t;
this._appSessionId=n
}
ZmClick2CallPresenceAPIs.prototype.login=function(o,e){
if(!this._appSessionId){
return
}
var t=new AjxCallback(this,this._loginContinuation);
if(!e){
this._getSessionIdFromMetadata(t,o)
}else{
t.run(o)
}};
ZmClick2CallPresenceAPIs.prototype._loginContinuation=function(r){
var o=[this._serverUrl,"/",this._username,"/session"].join("");
var s=[ZmZimletBase.PROXY,AjxStringUtil.urlComponentEncode(o)].join("");
var n={};
n["Presence-Session-Key"]=this._appSessionId;
var e=new AjxCallback(this,this._loginResponseHandler,[r]);
var t=AjxRpc.invoke(null,s,n,e,AjxRpcRequest.HTTP_PUT)
};
ZmClick2CallPresenceAPIs.prototype._getSessionIdFromMetadata=function(t,o){
var e=new ZmMetaData(appCtxt.getActiveAccount());
e.get("ciscoPresenceZimlet",null,new AjxCallback(this,this._handleSessionIdMetadata,[t,o]))
};
ZmClick2CallPresenceAPIs.prototype._handleSessionIdMetadata=function(n,s,e){
var t=e.getResponse();
if(t&&t.BatchResponse&&t.BatchResponse.GetMailboxMetadataResponse){
t=t.BatchResponse.GetMailboxMetadataResponse[0]
}else{
this._sessionId=null;
if(n){
n.run()
}}
try{
if(t.meta&&t.meta[0]&&t.meta[0]._attrs){
this._sessionId=t.meta[0]._attrs.cisco_enduser_sessionid
}else{
this._sessionId=null;
if(n){
n.run(s)
}
return
}
if(s){
s.run()
}}
catch(o){
this._sessionId=null;
if(n){
n.run(s)
}}};
ZmClick2CallPresenceAPIs.prototype._loginResponseHandler=function(h,s){
var e={};
if(s&&s.success){
var t=s.text.replace(/<!DOCTYPE.*>/,"");
e=AjxXmlDoc.createFromXml(t).toJSObject(true,false);
if(e&&e.sessionKey){
this._sessionId=e.sessionKey.__msh_content;
var n=new ZmMetaData(appCtxt.getActiveAccount());
var o=[];
o.cisco_enduser_sessionid=this._sessionId;
n.set("ciscoPresenceZimlet",o)
}}else{
var r=this._parseCiscoErrorCodes(s.text);
if(r){
e.errorCode=r
}else{
e.errorCode="unknown"
}}
if(h){
h.run(e)
}};
ZmClick2CallPresenceAPIs.prototype._parseCiscoErrorCodes=function(t){
if(t){
t=t.replace(/<!DOCTYPE.*>/,"");
var e=AjxXmlDoc.createFromXml(t);
var n=e&&e.getDoc();
var o=n.getElementsByTagName("code");
if(o&&o.length){
return AjxEnv.isIE?o[0].text:o[0].textContent
}}};
ZmClick2CallPresenceAPIs.prototype.getPresence=function(e,t){
if(!this._sessionId){
return
}
this.getRichPresence(e,t)
};
ZmClick2CallPresenceAPIs.prototype.getBasicPresence=function(t,r){
if(!this._sessionId){
return
}
var n=[this._serverUrl,"/",this._username,"/presence/basic/contacts/",t].join("");
var h=[ZmZimletBase.PROXY,AjxStringUtil.urlComponentEncode(n)].join("");
var s={};
s["Presence-Session-Key"]=this._sessionId;
var e=new AjxCallback(this,this._getPresenceResponse,[r,"basic"]);
var o=AjxRpc.invoke(null,h,s,e,AjxRpcRequest.HTTP_GET)
};
ZmClick2CallPresenceAPIs.prototype.getRichPresence=function(t,r){
if(!this._sessionId){
return
}
var n=[this._serverUrl,"/",this._username,"/presence/rich/contacts/",t].join("");
var h=[ZmZimletBase.PROXY,AjxStringUtil.urlComponentEncode(n)].join("");
var s={};
s["Presence-Session-Key"]=this._sessionId;
var e=new AjxCallback(this,this._getPresenceResponse,[r,"rich"]);
var o=AjxRpc.invoke(null,h,s,e,AjxRpcRequest.HTTP_GET)
};
ZmClick2CallPresenceAPIs.prototype._getPresenceResponse=function(t,d,o){
var p={};
if(o&&o.success){
var h=o.text.replace(/<!DOCTYPE.*>/,"");
p=AjxXmlDoc.createFromXml(h);
var r=p.getElementsByTagName("person");
if(r&&r.length>0){
var u=["dnd","vacation","on-the-phone","busy","unavailable","away","available","unknown"];
for(var n=0;
n<u.length;
n++){
var f=u[n];
var e=r[0].getElementsByTagName(f);
if(e&&e.length>0){
p.presenceStatus=f;
break
}}
var l=r[0].getElementsByTagName("note");
if(l&&l.length>0){
p.notes=AjxStringUtil.htmlEncode(AjxEnv.isIE?l[0].text:l[0].textContent)
}else{
p.notes=""
}}else{
p.presenceStatus="unknown"
}}else{
var m=this._parseCiscoErrorCodes(o.text);
if(m){
p.errorCode=m
}else{
p.errorCode="unknown"
}
if(m==101){
this._sessionId=null;
this.login(null,true);
return
}}
if(t){
t.run(p)
}};
function ZmClick2CallProviderAPIs(o,t,e,n){
this.zimlet=o;
this._serverUrl=t;
this._username=e;
this._password=n
}
ZmClick2CallProviderAPIs.prototype._getProfileXML=function(){
var e=[];
e.push('<?xml version="1.0" encoding="utf-8" ?>','<soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ',' xmlns:xsd="http://www.w3.org/2001/XMLSchema"',' xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:WD70">',"<soapenv:Header/>","<soapenv:Body>",'<urn:getProfileSoap soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">','<in0 xsi:type="urn:Credential">','<userID xsi:type="xsd:string">',this._username,"</userID>",'<password xsi:type="xsd:string">',this._password,"</password>","</in0>",'<in1 xsi:type="soapenc:string" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/">',this._username,"</in1>","</urn:getProfileSoap>","</soapenv:Body>","</soapenv:Envelope>");
return e.join("")
};
ZmClick2CallProviderAPIs.prototype.getMakeCallXML=function(o,s,t,e){
var n=[];
n.push('<?xml version="1.0" encoding="utf-8" ?>','<soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ',' xmlns:xsd="http://www.w3.org/2001/XMLSchema"',' xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:WD70">',"<soapenv:Header/>","<soapenv:Body>",'<urn:makeCallSoap soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">','<in0 xsi:type="urn:Credential">','<userID xsi:type="xsd:string">',this._username,"</userID>",'<password xsi:type="xsd:string">',this._password,"</password>","</in0>",'<in1 xsi:type="soapenc:string" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/">',o,"</in1>",'<in2 xsi:type="urn:UserProfile">','<user xsi:type="xsd:string">',this._username,"</user>",'<deviceName xsi:type="xsd:string">',s,"</deviceName>",'<lineNumber xsi:type="xsd:string">',t,"</lineNumber>","</in2>","</urn:makeCallSoap>","</soapenv:Body>","</soapenv:Envelope>");
return n.join("")
};
ZmClick2CallProviderAPIs.prototype.getClearConnectionXML=function(n,t,e){
var o=[];
o.push('<?xml version="1.0" encoding="utf-8" ?>','<soapenv:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ',' xmlns:xsd="http://www.w3.org/2001/XMLSchema"',' xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:urn="urn:WD70">',"<soapenv:Header/>","<soapenv:Body>",'<urn:endCallSoap soapenv:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/">','<in0 xsi:type="urn:Credential">','<userID xsi:type="xsd:string">',this._username,"</userID>",'<password xsi:type="xsd:string">',this._password,"</password>","</in0>",'<in1 xsi:type="urn:UserProfile">','<user xsi:type="xsd:string">',this._username,"</user>",'<deviceName xsi:type="xsd:string">',n,"</deviceName>",'<lineNumber xsi:type="xsd:string">',t,"</lineNumber>","</in1>","</urn:endCallSoap>","</soapenv:Body>","</soapenv:Envelope>");
return o.join("")
};
ZmClick2CallProviderAPIs.prototype.getUserProfile=function(s){
var e=this._getProfileXML();
var t=new Array();
t.Authorization=this.make_basic_auth(this._username,this._password);
t["content-type"]="text/xml";
t.SOAPAction="CUCM:DB ver=7.0";
t["content-length"]=e.length;
var n=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
var o=new AjxCallback(this,this._getUserProfileHandler,s);
AjxRpc.invoke(e,n,t,o,false)
};
ZmClick2CallProviderAPIs.prototype._getUserProfileHandler=function(l,o){
var h;
var e={};
if(!o.success){
h=this.xmlToObject(o);
if(h&&h.Body&&h.Body.Fault&&h.Body.Fault.faultstring){
e.success=false;
e.error=h.Body.Fault.faultstring.toString()
}else{
e.success=false;
e.error=""
}}else{
var n=this.xmlToObject(o,true);
var t=this.getResponseCode(n);
if(t=="0"){
var s=this._parseDeviceInfo(n);
e.success=true;
e.phoneInfo=s
}else{
e.success=false;
var r=this.getResponseDesc(n);
e.error=r==undefined?"":r
}}
if(l){
l.run(e)
}};
ZmClick2CallProviderAPIs.prototype._parseDeviceInfo=function(g){
var s=g.getElementsByTagName("deviceInfoList");
if(!s||s.length<1){
throw"Empty device number"
}
var n=s[0].childNodes;
var l=[];
for(var h=0;
h<n.length;
h++){
var t=n[h];
var e=t.getAttribute("href");
if(!e){
continue
}
var u=this._getMultiRefElementById(g,e.substring(1));
if(!u){
continue
}
var m;
if(AjxEnv.isIE){
m=AjxStringUtil.trim(u.firstChild.text)
}else{
m=AjxStringUtil.trim(u.firstChild.textContent)
}
var f=u.lastChild.childNodes;
for(var r=0;
r<f.length;
r++){
var o;
if(AjxEnv.isIE){
o=f[r].text
}else{
o=f[r].textContent
}
if(AjxUtil.isEmpty(o)){
continue
}
var d=o.indexOf(";");
if(d<0){
continue
}
var p=AjxStringUtil.trim(o.substring(0,d-1));
l.push({
deviceName:m,phoneNumber:p}
)
}}
return l
};
ZmClick2CallProviderAPIs.prototype._getMultiRefElementById=function(n,s){
if(!n||!s){
return null
}
var e=n.getElementsByTagName("multiRef");
if(!e){
return null
}
for(var t=0;
t<e.length;
t++){
var o=e[t].getAttribute("id");
if(o==s){
return e[t]
}}
return null
};
ZmClick2CallProviderAPIs.prototype.doClick2Call=function(l,e,t,h){
var o=this.getMakeCallXML(t,l,e,null);
var n=new Array();
n.Authorization=this.make_basic_auth(this._username,this._password);
n["content-type"]="text/xml";
n.SOAPAction="CUCM:DB ver=7.0";
n["content-length"]=o.length;
var r=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
var s=new AjxCallback(this,this._call2CallHandler,h);
AjxRpc.invoke(o,r,n,s,false)
};
ZmClick2CallProviderAPIs.prototype._call2CallHandler=function(h,o){
var r;
var e={};
if(!o.success){
r=this.xmlToObject(o);
e.success=false;
if(r&&r.Body&&r.Body.Fault&&r.Body.Fault.faultstring){
e.error=r.Body.Fault.faultstring.toString()
}else{
e.error=""
}}else{
var n=this.xmlToObject(o,true);
var t=this.getResponseCode(n);
if(t=="0"){
e.success=true
}else{
e.success=false;
var s=this.getResponseDesc(n);
e.error=s==undefined?"":s
}}
if(h){
h.run(e)
}};
ZmClick2CallProviderAPIs.prototype.doHangUp=function(r,e,s){
var t=this.getClearConnectionXML(r,e,null);
var o=new Array();
o.Authorization=this.make_basic_auth(this._username,this._password);
o["content-type"]="text/xml";
o.SOAPAction="CUCM:DB ver=7.0";
o["content-length"]=t.length;
var n=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(this._serverUrl);
AjxRpc.invoke(t,n,o,new AjxCallback(this,this._hangupHandler,s),false)
};
ZmClick2CallProviderAPIs.prototype._hangupHandler=function(o,t){
var e={};
e={
success:true};
if(o){
o.run(e)
}};
ZmClick2CallProviderAPIs.prototype.make_basic_auth=function(t,o){
var e=t+":"+o;
var n=Base64.encode(e);
return"Basic "+n
};
ZmClick2CallProviderAPIs.prototype.xmlToObject=function(e,t){
if(!e.success){
this.zimlet.displayErrorMessage(this.zimlet.getMessage("coulNotConnect"),e.text,this.zimlet.getMessage("providerError"));
return
}
if(t){
var o=new AjxXmlDoc.createFromDom(e.xml)
}else{
var o=new AjxXmlDoc.createFromDom(e.xml).toJSObject(true,false)
}
return o
};
ZmClick2CallProviderAPIs.prototype.getResponseCode=function(l){
if(!l){
return undefined
}
var o=l.getElementsByTagName("responseCode");
if(!o||o.length==0){
return undefined
}
var t=o[0].getAttribute("href");
if(!t){
if(AjxEnv.isIE){
return o[0].text
}
return o[0].textContent
}
var n=l.getElementsByTagName("multiRef");
if(!n||n.length==0){
return undefined
}
var r=false;
for(var s=0;
s<n.length&&r===false;
s++){
if(("#"+n[s].getAttribute("id"))==t){
if(AjxEnv.isIE){
r=n[s].text
}else{
r=n[s].textContent
}
break
}}
if(r){
return r
}else{
var h=l.getElementsByTagName("description");
var e=l.getElementsByTagName("responseDescription");
if(!h||h.length==0){
if(!e||e.length==0){
return undefined
}else{
h=e
}}
for(var s=0;
s<h.length;
s++){
r=AjxEnv.isIE?h[s].text:h[s].textContent;
if(r&&r.toLowerCase()=="success"){
return"0"
}}}
return undefined
};
ZmClick2CallProviderAPIs.prototype.getResponseDesc=function(t){
var e=t.getElementsByTagName("responseDescription");
if(!e||e.length==0){
return undefined
}
if(AjxEnv.isIE){
return e[0].text
}
return e[0].textContent
};
ZmClick2CallDlg=function(e,t){
this.toPhoneNumber="";
this.fromPhoneNumber="";
this.zimlet=t;
this.soapCalls=this.zimlet.soapAPI;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._dialogView.setSize(300,150);
DwtDialog.call(this,{
parent:e,className:"ZmClick2CallDlg",title:this.zimlet.getMessage("click2callDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.NO_BUTTONS],mode:DwtBaseDialog.MODELESS}
);
this._setWhiteBackground();
this._buttonDesc={};
this._callingStr=this.zimlet.getMessage("calling");
this._connectionFailedStr=this.zimlet.getMessage("connectionFailedTryRedialling");
this._connectionSuccessfulStr=this.zimlet.getMessage("connectionSuccessfulStr");
this._callHungUpStr=this.zimlet.getMessage("callHungUp");
this._addMinimizeAndCloseBtns()
};
ZmClick2CallDlg.prototype=new DwtDialog;
ZmClick2CallDlg.prototype.constructor=ZmClick2CallDlg;
ZmClick2CallDlg.prototype.CONTROLS_TEMPLATE=null;
ZmClick2CallDlg.PHOTO_ID="click2CallDlg_photoBG";
ZmClick2CallDlg.PHOTO_PARENT_ID="click2CallDlg_photoBGDiv";
ZmClick2CallDlg.TEXT_DIV_ID="click2CallDlg_TextDiv";
ZmClick2CallDlg.prototype._dragStart=function(e,t){};
ZmClick2CallDlg.prototype._setWhiteBackground=function(){
var e=this._dialogView.getHtmlElement();
while(e&&e.className&&e.className.indexOf("WindowInnerContainer")==-1){
e=e.parentNode
}
if(e==null){
return
}
e.style.backgroundColor="white"
};
ZmClick2CallDlg.prototype.popup=function(){
DwtDialog.prototype.popup.call(this);
this._searchAndShowContactInfo();
this._showAsCalling();
this._animateCallingText();
this._callingTxtInterval=setInterval(AjxCallback.simpleClosure(this._animateCallingText,this),700)
};
ZmClick2CallDlg.prototype._addMinimizeAndCloseBtns=function(){
var e=["<table><tbody><tr><td class='minWidth' ></td>","<td class='",this._titleEl.className,"' id='",this._titleEl.id,"'> ",this._titleEl.innerHTML,"</td>","<td  width='22px' align='center' ><div style='cursor:pointer;' id='FromPhoneDlg_minMaxBtn' class='ImgClick2Call-minimize-icon' /></td>","<td  width='22px' align='center' ><div style='cursor:pointer;' id='FromPhoneDlg_closeBtn' class='ImgCloseGray' /></td>","</tr></tbody></table>"];
var o=document.createElement("div");
o.innerHTML=e.join("");
var t=this._titleEl.parentNode.parentNode;
t.replaceChild(o.firstChild.firstChild.firstChild,this._titleEl.parentNode);
this._minMaxeDlgBtn=document.getElementById("FromPhoneDlg_minMaxBtn");
this._minMaxeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleMinMaxDlg,this);
this._closeDlgBtn=document.getElementById("FromPhoneDlg_closeBtn");
this._closeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleCloseDlg,this)
};
ZmClick2CallDlg.prototype._handleMinMaxDlg=function(){
if(this._minMaxeDlgBtn.className=="ImgClick2Call-minimize-icon"){
this._dlgTopPosB4Minimize=(this.getHtmlElement().style.top).replace("px","");
this._minMaxeDlgBtn.className="ImgClick2Call-maximize-icon";
this.getHtmlElement().style.top=(document.body.offsetHeight-25)+"px"
}else{
if(this._minMaxeDlgBtn.className=="ImgClick2Call-maximize-icon"){
this._minMaxeDlgBtn.className="ImgClick2Call-minimize-icon";
this.getHtmlElement().style.top=this._dlgTopPosB4Minimize+"px"
}}};
ZmClick2CallDlg.prototype._handleCloseDlg=function(){
this.popdown()
};
ZmClick2CallDlg.prototype._searchAndShowContactInfo=function(e,n,h){
if(!e){
e=1
}
if(!n){
n=this.toPhoneNumber
}
var r,o,t;
r={
SearchRequest:{
_jsns:"urn:zimbraMail"}};
o=r.SearchRequest;
o.types="contact";
o.query=n;
o.offset=0;
o.limit=e;
if(!h){
h=""
}
var s=new AjxCallback(this,this._handleContactSearch,h);
appCtxt.getAppController().sendRequest({
jsonObj:r,asyncMode:true,callback:s,noBusyOverlay:true}
)
};
ZmClick2CallDlg.prototype._handleContactSearch=function(e,t){
var r;
var u={};
if(t){
var h;
var s=t.getResponse();
var d=s.SearchResponse.cn;
if(e&&e!=""){
e.run(d);
return
}
if(d){
h=d[0]
}
if(h&&h._attrs){
u=h._attrs;
if(u.image){
var n=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);
r=[n,"/?auth=co&id=",h.id,"&part=",u.image.part,"&t=",(new Date()).getTime()].join("")
}
u.toPhoneNumber=this.toPhoneNumber;
this._setContactDetails(u,r);
return
}}
var f,o,l;
f={
SearchGalRequest:{
_jsns:"urn:zimbraAccount"}};
o=f.SearchGalRequest;
o.type="account";
o.name=this.toPhoneNumber;
o.offset=0;
o.limit=1;
var m=new AjxCallback(this,this._handleGalSearchResponse);
appCtxt.getAppController().sendRequest({
jsonObj:f,asyncMode:true,callback:m,noBusyOverlay:true}
)
};
ZmClick2CallDlg.prototype._handleGalSearchResponse=function(o){
var e=false;
var n={};
if(o){
var s=o.getResponse();
var h=s.SearchGalResponse.cn;
if(h&&h[0]&&h[0]._attrs){
n=s.SearchGalResponse.cn[0]._attrs;
e=true
}}
n.toPhoneNumber=this.toPhoneNumber;
var r;
if(n.photoFileName){
var t=n.photoFileName?n.photoFileName:"noname.jpg";
r=ZmZimletBase.PROXY+ZmClick2CallDlg.PHOTO_BASE_URL+n.photoFileName
}
this._setContactDetails(n,r)
};
ZmClick2CallDlg.prototype._getTooltipBGHtml=function(e){
var o=";";
var n=";";
if(AjxEnv.isIE){
var o="width:100%;";
var n="left:3%;"
}
var t={
photoParentId:ZmClick2CallDlg.PHOTO_PARENT_ID,textDivId:ZmClick2CallDlg.TEXT_DIV_ID,width:o,left:n};
return AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#Frame",t)
};
ZmClick2CallDlg.prototype._setContactDetails=function(l,s){
var o=l;
if(l.workState||l.workCity||l.workStreet||l.workPostalCode){
var e=l.workState?l.workState:"";
var n=l.workCity?l.workCity:"";
var d=l.workStreet?l.workStreet:"";
var u=l.workPostalCode?l.workPostalCode:"";
var h=[d," ",n," ",e," ",u].join("");
o.address=AjxStringUtil.trim(h)
}
o=this._formatTexts(o);
o.callingStr=this._callingStr;
o.connectionFailedStr=this._connectionFailedStr;
o.callSuccessfulStr=this._connectionSuccessfulStr;
o.callHungUpStr=this._callHungUpStr;
var r=AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#ContactDetails",o);
this._dialogView.getHtmlElement().innerHTML=r;
this._setProfileImage(s);
var t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("hangUp"));
t.setImage("Click2CallPhoneHangupBtn");
t.addSelectionListener(new AjxListener(this,this._handleHangUpBtnClick));
document.getElementById("click2CallDlg_hangupBtnDiv").appendChild(t.getHtmlElement());
t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("redial"));
t.setImage("Telephone");
t.addSelectionListener(new AjxListener(this,this._redialBtnHandler));
document.getElementById("click2CallDlg_reDialBtnDiv").appendChild(t.getHtmlElement());
this._removeCustomAttrs(l)
};
ZmClick2CallDlg.prototype._showAsCalling=function(){
var e={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"block",click2CallDlg_reDialBtnDiv:"none",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(e)
};
ZmClick2CallDlg.prototype.showErrorMsgAndRedial=function(e){
var t={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"block",click2callDlg_reDialMsgDiv:"block",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(t)
};
ZmClick2CallDlg.prototype._showHungUpMsgAndRedial=function(){
var e={
click2CallDlg_hangupBtnDiv:"none",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"block",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"none",click2callDlg_callHungUpMsgDiv:"block"};
this._showHideCardParts(e)
};
ZmClick2CallDlg.prototype._showCallCompleted=function(){
var e={
click2CallDlg_hangupBtnDiv:"block",ringingPhoneMsgDiv:"none",click2CallDlg_reDialBtnDiv:"none",click2callDlg_reDialMsgDiv:"none",click2callDlg_callCompletedMsgDiv:"block",click2callDlg_callHungUpMsgDiv:"none"};
this._showHideCardParts(e)
};
ZmClick2CallDlg.prototype._showHideCardParts=function(r){
clearInterval(this._callingTxtInterval);
var s=document.getElementById("click2CallDlg_hangupBtnDiv");
var t=document.getElementById("ringingPhoneMsgDiv");
var h=document.getElementById("click2CallDlg_reDialBtnDiv");
var n=document.getElementById("click2callDlg_reDialMsgDiv");
var o=document.getElementById("click2callDlg_callCompletedMsgDiv");
var e=document.getElementById("click2callDlg_callHungUpMsgDiv");
if(s){
document.getElementById("click2CallDlg_hangupBtnDiv").style.display=r.click2CallDlg_hangupBtnDiv
}
if(t){
document.getElementById("ringingPhoneMsgDiv").style.display=r.ringingPhoneMsgDiv
}
if(h){
document.getElementById("click2CallDlg_reDialBtnDiv").style.display=r.click2CallDlg_reDialBtnDiv
}
if(n){
document.getElementById("click2callDlg_reDialMsgDiv").style.display=r.click2callDlg_reDialMsgDiv
}
if(o){
document.getElementById("click2callDlg_callCompletedMsgDiv").style.display=r.click2callDlg_callCompletedMsgDiv
}
if(e){
document.getElementById("click2callDlg_callHungUpMsgDiv").style.display=r.click2callDlg_callHungUpMsgDiv
}};
ZmClick2CallDlg.prototype._animateCallingText=function(){
var e=document.getElementById("click2Call_callingLabel");
if(e){
if(this.__callingLableColor=="red"){
this.__callingLableColor="maroon"
}else{
this.__callingLableColor="red"
}
e.style.color=this.__callingLableColor
}else{
clearInterval(this._callingTxtInterval)
}};
ZmClick2CallDlg.prototype._redialBtnHandler=function(){
this._callingTxtInterval=setInterval(AjxCallback.simpleClosure(this._animateCallingText,this),700);
this._showAsCalling();
this.clickToCall(true)
};
ZmClick2CallDlg.prototype._removeCustomAttrs=function(o){
var t=["rightClickForMoreOptions","formattedEmail","address","toPhoneNumber","callingStr","connectionFailedStr","callSuccessfulStr","callHungUpStr"];
for(var n=0;
n<t.length;
n++){
var e=t[n];
if(o[e]){
delete o[e]
}}};
ZmClick2CallDlg.prototype._formatTexts=function(t){
var e=t.email?t.email:"";
t.formattedEmail=e;
if(e.length>25){
var o=e.split("@");
var n=o[0];
var r=o[1];
if(n.length>25){
n=n.substring(0,24)+".."
}
t.formattedEmail=[n," @",r].join("")
}
var s=t.fullName?t.fullName:"";
if(s==e){
t.fullName=""
}
return t
};
ZmClick2CallDlg.prototype._setProfileImage=function(o){
var t=document.getElementById(ZmClick2CallDlg.PHOTO_PARENT_ID);
t.width=65;
t.height=80;
t.style.width=65;
t.style.height=80;
if(!o||o==""){
this._handleImgLoadFailure();
return
}
var e=new Image();
e.src=o;
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e)
};
ZmClick2CallDlg.prototype._handleImgLoadFailure=function(){
var e=new Image();
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e);
e.id=ZmClick2CallDlg.PHOTO_ID;
e.src=this.zimlet.getResource("img/unknownPerson.jpg")
};
ZmClick2CallDlg.prototype._handleImageLoad=function(e){
var t=document.getElementById(ZmClick2CallDlg.PHOTO_PARENT_ID);
if(!t){
return
}
t.innerHTML="";
t.appendChild(e);
e.width=65;
e.height=80
};
ZmClick2CallDlg.prototype.clickToCall=function(e){
if(!e){
this.popup()
}
this.soapCalls.doClick2Call(this.fromDeviceName,this.fromPhoneNumber,this.toPhoneNumber,new AjxCallback(this,this._click2CallHandler))
};
ZmClick2CallDlg.prototype._click2CallHandler=function(e){
if(!e.success){
this.showErrorMsgAndRedial()
}else{
this._showCallCompleted()
}};
ZmClick2CallDlg.prototype._handleHangUpBtnClick=function(){
this.soapCalls.doHangUp(this.fromDeviceName,this.fromPhoneNumber,new AjxCallback(this,this._hangupHandler))
};
ZmClick2CallDlg.prototype._hangupHandler=function(e){
if(!e.success){
this.showErrorMsgAndRedial()
}else{
this._showHungUpMsgAndRedial("")
}};
ZmClick2CallFromPhoneDlg=function(e,t){
this.zimlet=t;
this.toPhoneNumber="";
this._dialogView=new DwtComposite(appCtxt.getShell());
this._dialogView.setSize(300,125);
DwtDialog.call(this,{
parent:e,className:"ZmClick2CallFromPhoneDlg",title:this.zimlet.getMessage("fromPhoneDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.NO_BUTTONS],mode:DwtBaseDialog.MODELESS}
);
this._setWhiteBackground();
if(!this.click2CallDlg){
this.click2CallDlg=new ZmClick2CallDlg(this.zimlet.getShell(),this.zimlet)
}
this._buttonDesc={};
this._isLoaded=false;
this.RE=new RegExp("\\+?\\b\\d([0-9\\(\\)\\.\\s\\-]){8,20}\\d\\b");
this.RE_EXT=new RegExp("\\d{1,8}")
};
ZmClick2CallFromPhoneDlg.prototype=new ZmDialog;
ZmClick2CallFromPhoneDlg.prototype.constructor=ZmClick2CallFromPhoneDlg;
ZmClick2CallFromPhoneDlg.prototype.CONTROLS_TEMPLATE=null;
ZmClick2CallFromPhoneDlg.prototype._setWhiteBackground=function(){
var e=this._dialogView.getHtmlElement();
while(e&&e.className&&e.className.indexOf("WindowInnerContainer")==-1){
e=e.parentNode
}
if(e==null){
return
}
e.style.backgroundColor="white"
};
ZmClick2CallFromPhoneDlg.prototype.showDialog=function(){
if(!this._isLoaded){
appCtxt.setStatusMsg(ZmMsg.loading);
this._getVoiceInfoAndShowDlg()
}else{
this.setToPhoneText();
if(AjxUtil.isEmpty(this.zimlet.toPhoneNumber)){
this.btnCall.setEnabled(false)
}else{
this.btnCall.setEnabled(true)
}
this.popup()
}};
ZmClick2CallFromPhoneDlg.prototype._getVoiceInfoAndShowDlg=function(){
var e=new AjxCallback(this,this._handleResponsePhoneInfo);
this.zimlet.soapAPI.getUserProfile(e)
};
ZmClick2CallFromPhoneDlg.prototype._handleResponsePhoneInfo=function(e){
if(!e.success||AjxUtil.isEmpty(e.phoneInfo)){
this.zimlet._popupErrorDlg(this.zimlet.getMessage("err_noPhoneNumber"));
return
}
this._createCallFromHtml(e.phoneInfo);
this.setToPhoneText();
this._addMinimizeAndCloseBtns();
this.popup();
this._isLoaded=true
};
ZmClick2CallFromPhoneDlg.prototype._addMinimizeAndCloseBtns=function(){
var e=["<table><tbody><tr><td colspan='4'>","<div id='",this._titleEl.id,"' style='position:relative;height:26px;'>","<div class='",this._titleEl.className,"' style='position:absolute;left:0;margin-right:44px;'>",this._titleEl.innerHTML,"</div>","<div id='fromPhoneDlg_minMaxBtn' class='ImgClick2Call-minimize-icon' style='cursor:pointer;position:absolute;right:25px;top:5px;'></div>","<div id='fromPhoneDlg_closeBtn' class='ImgCloseGray' style='cursor:pointer;position:absolute;right:3px;top:5px;'></div></div>","</td></tr></tbody></table>"];
var o=document.createElement("div");
o.innerHTML=e.join("");
var t=this._titleEl.parentNode.parentNode;
t.replaceChild(o.firstChild.firstChild.firstChild,this._titleEl.parentNode);
this._minMaxeDlgBtn=document.getElementById("fromPhoneDlg_minMaxBtn");
this._minMaxeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleMinMaxDlg,this);
this._closeDlgBtn=document.getElementById("fromPhoneDlg_closeBtn");
this._closeDlgBtn.onclick=AjxCallback.simpleClosure(this._handleCloseDlg,this)
};
ZmClick2CallFromPhoneDlg.prototype._handleMinMaxDlg=function(){
if(this._minMaxeDlgBtn.className=="ImgClick2Call-minimize-icon"){
this._dlgTopPosB4Minimize=(this.getHtmlElement().style.top).replace("px","");
this._minMaxeDlgBtn.className="ImgClick2Call-maximize-icon ";
this.getHtmlElement().style.top=(document.body.offsetHeight-25)+"px"
}else{
if(this._minMaxeDlgBtn.className=="ImgClick2Call-maximize-icon "){
this._minMaxeDlgBtn.className="ImgClick2Call-minimize-icon";
this.getHtmlElement().style.top=this._dlgTopPosB4Minimize+"px"
}}};
ZmClick2CallFromPhoneDlg.prototype._handleCloseDlg=function(){
this.popdown()
};
ZmClick2CallFromPhoneDlg.prototype._createCallFromHtml=function(e){
var o={
fromStr:this.zimlet.getMessage("from"),toStr:this.zimlet.getMessage("to")};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#fromPhoneDlg",o);
this._toPhoneTxtInput=document.getElementById("click2CallDlg_callToPHText");
this._toPhoneTxtInput.onkeyup=AjxCallback.simpleClosure(this._handleToPhChanged,this);
this._setFromPhoneMenu(e);
this._setToPhoneMenu();
var t=new DwtButton({
parent:this.zimlet.getShell()}
);
t.setText(this.zimlet.getMessage("call"));
t.setImage("Telephone");
t.addSelectionListener(new AjxListener(this,this._makeCall));
document.getElementById("click2CallFromPhoneDlg_callBtn").appendChild(t.getHtmlElement());
this.btnCall=t;
if(AjxUtil.isEmpty(this.zimlet.toPhoneNumber)){
this.btnCall.setEnabled(false)
}};
ZmClick2CallFromPhoneDlg.prototype._handleToPhChanged=function(){
if(AjxUtil.isEmpty(document.getElementById("click2CallDlg_callToPHText").value)){
this.btnCall.setEnabled(false);
return
}
this.btnCall.setEnabled(true)
};
ZmClick2CallFromPhoneDlg.prototype._setFromPhoneMenu=function(o){
if(!o){
return
}
var s=[];
var n=0;
s[n++]="<select id=\"click2CallFromPhoneDlg_callFromMenu\" style='width:200px' >";
for(var t=0;
t<o.length;
t++){
var e=o[t];
if(!e.deviceName){
continue
}
s[n++]=["<option value='",e.deviceName,"'>",e.phoneNumber,"</option>"].join("")
}
s[n++]="</select>";
document.getElementById("click2CallFromPhoneDlg_menuDiv").innerHTML=s.join("")
};
ZmClick2CallFromPhoneDlg.prototype._setToPhoneMenu=function(){
this.emailZimlet=this.zimlet.getEmailZimlet();
var e=this.emailZimlet&&this.emailZimlet.contactCard&&this.emailZimlet.contactCard.attribs;
if(!e){
return
}
this.click2CallDlg.toPhoneNumber=this.zimlet.toPhoneNumber=e.mobilePhone||e.workPhone
};
ZmClick2CallFromPhoneDlg.prototype._makeCall=function(){
this.click2CallDlg.toPhoneNumber=document.getElementById("click2CallDlg_callToPHText").value;
this.click2CallDlg.fromDeviceName=document.getElementById("click2CallFromPhoneDlg_callFromMenu").value;
this.click2CallDlg.fromPhoneNumber=document.getElementById("click2CallFromPhoneDlg_callFromMenu").textContent;
if(!this.isValidPhoneNumber(this.click2CallDlg.toPhoneNumber)){
this._showError(AjxMessageFormat.format(this.zimlet.getMessage("notAValidPhoneNumber"),[this.click2CallDlg.toPhoneNumber]));
return
}
this.popdown();
this.click2CallDlg.clickToCall()
};
ZmClick2CallFromPhoneDlg.prototype.isValidPhoneNumber=function(e){
return this.RE.test(e)||this.RE_EXT.test(e)
};
ZmClick2CallFromPhoneDlg.prototype.setToPhoneText=function(){
document.getElementById("click2CallDlg_callToPHText").value=this.zimlet.toPhoneNumber||""
};
ZmClick2CallFromPhoneDlg.prototype.popdown=function(){
ZmDialog.prototype.popdown.call(this)
};
ZmClick2CallVoicePINDlg=function(e){
if(!e){
return
}
this.zimlet=e;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._createView();
var t=new DwtDialog_ButtonDescriptor(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID,this.zimlet.getMessage("updatePin"),DwtDialog.ALIGN_RIGHT);
DwtDialog.call(this,{
parent:appCtxt.getShell(),title:this.zimlet.getMessage("voicePINDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.CANCEL_BUTTON],extraButtons:[t]}
);
this.setButtonListener(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID,new AjxListener(this,this._updateBtnHandler));
this._pinField=document.getElementById("click2CallVoicePINDlg_PIN_field");
this._confirmPinField=document.getElementById("click2CallVoicePINDlg_PIN_confirm_field");
this._addTabControl();
this.RE=new RegExp("\\d+","g")
};
ZmClick2CallVoicePINDlg.prototype=new DwtDialog;
ZmClick2CallVoicePINDlg.prototype.constructor=ZmClick2CallVoicePINDlg;
ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID="click2call_voice_pin_dlg_update_btn";
ZmClick2CallVoicePINDlg.PIN_FIELD_ID="click2CallVoicePINDlg_PIN_field";
ZmClick2CallVoicePINDlg.CONFIRM_PIN_FIELD_ID="click2CallVoicePINDlg_PIN_confirm_field";
ZmClick2CallVoicePINDlg.prototype._createView=function(){
var e={
pinStr:this.zimlet.getMessage("pinStr"),confirmPINStr:this.zimlet.getMessage("confirmPINStr"),pinFieldId:ZmClick2CallVoicePINDlg.PIN_FIELD_ID,confirmPinFieldId:ZmClick2CallVoicePINDlg.CONFIRM_PIN_FIELD_ID};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("com_zimbra_click2call.templates.ZmClick2Call#voicePINDlg",e)
};
ZmClick2CallVoicePINDlg.prototype._updateBtnHandler=function(){
if(this._pinField&&this._confirmPinField){
if(this._pinField.value==""&&this._confirmPinField.value==""){
return false
}else{
if(this._pinField.value!=this._confirmPinField.value){
this.zimlet.displayErrorMessage(this.zimlet.getMessage("pinAndConfirmPinDidntMatch"),this.zimlet.getMessage("pinAndConfirmPinDidntMatch"),this.zimlet.getMessage("invalidPin"));
return false
}else{
if(!this.isPINDigits(this._pinField.value)){
this.zimlet.displayErrorMessage(this.zimlet.getMessage("pinCanOnlyBeDigits"),this.zimlet.getMessage("pinCanOnlyBeDigits"),this.zimlet.getMessage("invalidPin"));
return false
}else{
this._updatePIN(this._pinField.value)
}}}}};
ZmClick2CallVoicePINDlg.prototype._addTabControl=function(){
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(this._pinField,0);
this._tabGroup.addMember(this._confirmPinField,1);
this._tabGroup.addMember(this.getButton(ZmClick2CallVoicePINDlg.UPDATE_PIN_BTN_ID),2);
this._tabGroup.addMember(this.getButton(ZmClick2CallVoicePINDlg.CANCEL_BUTTON),3)
};
ZmClick2CallVoicePINDlg.prototype.isPINDigits=function(e){
return this.RE.test(e)
};
ZmClick2CallVoicePINDlg.prototype._updatePIN=function(e){};
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call#Frame",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div id='Click2CallZimlet_MainDiv' align='center' \n";
e[o++]="\t\t\tstyle='display:block;overflow:auto;background:white;'></div>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_click2call.templates.ZmClick2Call#Frame"}
,true);
AjxPackage.define("com_zimbra_click2call.templates.ZmClick2Call");
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call",AjxTemplate.getTemplate("com_zimbra_click2call.templates.ZmClick2Call#Frame"),AjxTemplate.getParams("com_zimbra_click2call.templates.ZmClick2Call#Frame"));
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call#ContactDetails",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table height=\"100%\" width=\"100%\"><tr><td colspan=2><div id='ringingPhoneMsgDiv'><label id='click2Call_callingLabel' style='color:maroon;'>";
e[o++]=s.callingStr;
e[o++]="</label></div><div id='click2callDlg_reDialMsgDiv' style='display:none;'><div><label style='color:red;'>";
e[o++]=s.connectionFailedStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div><div id='click2callDlg_callCompletedMsgDiv' style='display:none;'><div><label style='color:green;'>";
e[o++]=s.callSuccessfulStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div><div id='click2callDlg_callHungUpMsgDiv' style='display:none;'><div><label style='color:green;'>";
e[o++]=s.callHungUpStr;
e[o++]="</label></div><div id='click2CallDlg_errDiv'></div></div></td></tr><tr><td style='width:75px;'><div id='click2CallDlg_photoBGDiv' align='center'></div></td><td><div id='click2CallDlg_TextDiv'>";
if(s.firstName&&s.lastName){
e[o++]="<div><label style='font-size:13px;'>";
e[o++]=s.firstName;
e[o++]=" ";
e[o++]=s.lastName;
e[o++]="</label></div><div><label class='FakeAnchor'>";
e[o++]=AjxStringUtil.htmlEncode(s.toPhoneNumber);
e[o++]="</label></div>"
}else{
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.toPhoneNumber);
e[o++]="</label></div>"
}
if(s.jobTitle){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.jobTitle);
e[o++]="</label></div>"
}
if(s.company){
e[o++]="<div><label>";
e[o++]=AjxStringUtil.htmlEncode(s.company);
e[o++]="</label></div>"
}
e[o++]="</div></td></tr><tr><td colspan=2 align='center'><table><tr><td><div id='click2CallDlg_hangupBtnDiv' style='display:none;'></div></td><td><div id='click2CallDlg_reDialBtnDiv' style='display:none;'></div></td></tr></table></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_click2call.templates.ZmClick2Call#ContactDetails"}
,true);
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call#fromPhoneDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div style='padding:5px;'><table class='ZPropertySheet' cellspacing='6' width='100%'><tr><td class='ZmFieldLabelRight'><label for='click2CallFromPhoneDlg_menuDiv'>";
e[o++]=s.fromStr;
e[o++]="</label></td><td><div id='click2CallFromPhoneDlg_menuDiv'></div></td></tr><tr><td class='ZmFieldLabelRight'><label for='click2CallDlg_callToPHText'>";
e[o++]=s.toStr;
e[o++]="</label></td><td><input type=text id='click2CallDlg_callToPHText' style='width:200px'></text></td></tr></table><table width='100%' style='margin-top:25px;'><tr><td id='click2CallFromPhoneDlg_callBtn' align='center'></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_click2call.templates.ZmClick2Call#fromPhoneDlg"}
,true);
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call#Tooltip",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table><tr><td>";
e[o++]=AjxImg.getImageHtml("Telephone");
e[o++]="</td><td><div style='white-space:nowrap'>";
e[o++]=s.phoneStr;
e[o++]=":</div></td><td><div style='white-space:nowrap'>";
e[o++]=AjxStringUtil.htmlEncode(s.contentObjText);
e[o++]="</div></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_click2call.templates.ZmClick2Call#Tooltip"}
,true);
AjxTemplate.register("com_zimbra_click2call.templates.ZmClick2Call#voicePINDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div style='padding:5px;' ><table class='ZPropertySheet' cellspacing='6'><tr><td class='ZmFieldLabelRight'><label for='";
e[o++]=pinFieldId;
e[o++]="'>";
e[o++]=s.pinStr;
e[o++]="</label></td><td><input style='width:200px' type=password id='";
e[o++]=s.pinFieldId;
e[o++]="'></text></td></tr><tr><td class='ZmFieldLabelRight'><label for='";
e[o++]=s.confirmPinFieldId;
e[o++]="'>";
e[o++]=s.confirmPINStr;
e[o++]="</label></td><td><input style='width:200px' type=password id='";
e[o++]=s.confirmPinFieldId;
e[o++]="'></text></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_click2call.templates.ZmClick2Call#voicePINDlg"}
,true);
var SMIME_SECURITY_BUTTON_CLASS="com_zimbra_smime_security_button";
var SMIME_ENVELOPE_CONTENT_TYPES=["application/pkcs7-mime","application/x-pkcs7-mime"];
var SMIME_SIGNATURE_CONTENT_TYPES=["application/pkcs7-signature","application/x-pkcs7-signature"];
var SMIME_CONTENT_TYPES=[].concat(SMIME_SIGNATURE_CONTENT_TYPES,SMIME_ENVELOPE_CONTENT_TYPES);
var SMIME_MAIL_PREF_SECURITY="MAIL_SECURITY";
var SMIME_MAIL_USER_SECURITY="MAIL_USER_SECURITY";
var SMIME_DONTSIGN=0;
var SMIME_SIGN=1;
var SMIME_SIGNENCRYPT=2;
var SMIME_DRAFT_HEADER_SIGN="X-Zimbra-SMIME-DRAFT-SIGN";
var SMIME_DRAFT_HEADER_ENCRYPT="X-Zimbra-SMIME-DRAFT-ENCRYPT";
var SMIME_SECURITY_TYPES=[{
label:com_zimbra_smime.dontsignMessage,className:"DontSign"}
,{
label:com_zimbra_smime.signMessage,className:"Sign"}
,{
label:com_zimbra_smime.signAndEncryptMessage,className:"SignEncrypt"}
];
function SecureEmail(){
var e=this;
this._msgDivCache={};
this._smimecache=appCtxt.isChildWindow?window.opener.SecureEmail.getInstance()._smimecache:{};
this._patchedFcts={};
this._pendingattachments=[];
this._active=false
}
SecureEmail.prototype=new ZmZimletBase();
SecureEmail.prototype.constructor=SecureEmail;
SecureEmail.prototype.toString=function(){
return"SecureEmail"
};
SecureEmail.prototype.init=function(){
function t(){
var n=appCtxt.get(ZmSetting.LICENSE_STATUS);
if(ZmSetting.LICENSE_MSG[n]){
return false
}
var r=appCtxt.getSettings().getInfoResponse.license;
for(var s=0;
r&&s<r.attr.length;
s++){
var o=r.attr[s];
if(o.name=="SMIME"){
return o._content=="TRUE"
}}
return false
}
if(!t()){
return
}
if(!applet.hasVersion("1.6")){
if(AjxEnv.isIE&&AjxEnv.isWindows64){
SecureEmail.popupErrorDialog("noJavaErrorIE64")
}else{
SecureEmail.popupErrorDialog("noJavaError")
}
return
}
this._active=true;
if(appCtxt.isChildWindow){
this._handleNewWindow_2Load()
}
AjxDispatcher.addPackageLoadFunction("Mail",new AjxCallback(this,this._handleMailLoad));
AjxDispatcher.addPackageLoadFunction("MailCore",new AjxCallback(this,this._handleMailCoreLoad));
AjxDispatcher.addPackageLoadFunction("Startup1_1",new AjxCallback(this,this._handleStartup1_1Load));
AjxDispatcher.addPackageLoadFunction("Startup1_2",new AjxCallback(this,this._handleStartup1_2Load));
AjxDispatcher.addPackageLoadFunction("NewWindow_2",new AjxCallback(this,this._handleNewWindow_2Load));
SecurityPrefsPage.init(this);
var e=[appCtxt.get(ZmSetting.CLIENT_RELEASE),this.getZimletContext().version].join(".");
this.applethandler=new SMIMEApplet(e,this.getResource(""));
this.certstore=new SMIMECertStore(this,this.applethandler)
};
SecureEmail.prototype.getDisplayName=function(){
return this.getMessage("label")
};
SecureEmail.prototype._processContentPartAttachUrl=function(r,n,o,s){
if(n&&n.match(/&part=$/)&&r.attachments&&r.attachments.length>0&&(o==ZmMailMsg.CONTENT_PART_ID||o==ZmMailMsg.CONTENT_PART_LOCATION)){
for(var t=0;
t<r.attachments.length;
t++){
var e=r.attachments[t];
if(e[ZmMailMsg.CONTENT_PART_LOCATION]&&e[o]==s){
return e.content
}}}
return n
};
SecureEmail.prototype._handleComposeViewInitialize=function(f){
var u=this._shouldSign(e)||this._shouldEncrypt(e);
var e=f.getController();
var l=f._attButton;
var t=l.getMenu();
t.addPopupListener(new AjxListener(this,this._checkAttachPopup,[e,t]));
var m=l._eventMgr._listeners[DwtEvent.SELECTION].clone();
l.removeAllListeners(DwtEvent.SELECTION);
var s=new AjxListener(this,function(y,g){
var b=this._shouldSign(e)||this._shouldEncrypt(e);
if(b){
this._doAttach(e)
}else{
y.foreach(function(w){
w.run(g)
}
)
}}
,[m]);
l.addListener(DwtEvent.SELECTION,s);
if(AjxEnv.supportsHTML5File){
var r=l.getHtmlElement();
SecureEmail.__adjustFormVisibility(r,!u);
var n=r.getElementsByClassName("ZWidgetTitle")[0];
n.firstChild.style.height="12px"
}
for(var h=0;
h<t.getItemCount();
h++){
var p=t.getItem(h);
if(p.value==ZmMsg.myComputer||p.value==ZmMsg.attachInline){
var d=p._eventMgr._listeners[DwtEvent.SELECTION].clone();
p.removeAllListeners(DwtEvent.SELECTION);
var o=new AjxListener(this,function(g,y){
var b=this._shouldSign(e)||this._shouldEncrypt(e);
if(b){
f._setAttInline(y.item.value==ZmMsg.attachInline);
this._doAttach(e)
}else{
g.foreach(function(w){
w.run(y)
}
)
}}
,[d]);
p.addListener(DwtEvent.SELECTION,o)
}}};
SecureEmail.__adjustFormVisibility=function(o,n){
if(AjxEnv.supportsHTML5File){
var e=o.getElementsByTagName("form");
for(var t=0;
t<e.length;
t++){
Dwt.setVisible(e.item(t),n)
}}};
SecureEmail.prototype._checkAttachPopup=function(n,r){
var s=this._shouldSign(n)||this._shouldEncrypt(n);
for(var t=0;
t<r.getItemCount();
t++){
var o=r.getItem(t);
if(o.value==ZmMsg.myComputer){
SecureEmail.__adjustFormVisibility(o.getHtmlElement(),!s)
}else{
if(o.value==ZmMsg.attachInline){
var e=n._composeView._composeMode==DwtHtmlEditor.HTML;
o.setEnabled(e);
SecureEmail.__adjustFormVisibility(o.getHtmlElement(),e&&!s)
}}}};
SecureEmail.prototype._processInlineImageElement=function(l,s){
if(!this._smimecache[l.id]){
return
}
try{
var n=s.getAttribute("src")
}
catch(h){
n=s.getAttribute("href")
}
if(n&&n.substring(0,4)==="cid:"&&l.attachments&&l.attachments.length>0){
for(var o=0;
o<l.attachments.length;
o++){
var t=l.attachments[o];
var d=t[ZmMailMsg.CONTENT_PART_ID];
if(!d){
continue
}
d=d.replace(/[<>]/g,"");
if(t[ZmMailMsg.CONTENT_PART_LOCATION]&&d==n.substring(4)){
var r=t.content;
s.setAttribute("src",r);
break
}}}};
SecureEmail.isSMIMEContentType=function(e){
return AjxUtil.indexOf(SMIME_CONTENT_TYPES,e)!==-1
};
SecureEmail._visitParts=function(e,o){
o(e);
if(e.mp){
SecureEmail._visitParts(e.mp,o)
}else{
for(var t=0;
t<e.length;
t++){
SecureEmail._visitParts(e[t],o)
}}};
SecureEmail.prototype._handleZmMailMsgLoad=function(){
var e=this;
ZmMailMsg.requestHeaders.xSign=SMIME_DRAFT_HEADER_SIGN;
ZmMailMsg.requestHeaders.xEncrypt=SMIME_DRAFT_HEADER_ENCRYPT;
this.override("ZmMailMsg._handleResponseFetchMsg",function(s,t){
var n=arguments.callee.func;
var o=new AjxCallback(this,function(r){
n.call(this,s,r||t)
}
);
e._processMessageResponse(o,t)
}
);
this.override("ZmMailMsg.prototype._sendMessage",function(t){
e._sendMessage(arguments.callee.func,this,t)
}
);
this.override("ZmMailMsg.prototype.getContentPartAttachUrl",function(o,n){
var t=arguments.callee.func.apply(this,arguments);
return e._processContentPartAttachUrl(this,t,o,n)
}
);
this.override("ZmAdvancedHtmlEditor.prototype.onPaste",function(t,o){
e._onPaste(arguments.callee.func,t,o)
}
);
this.override("ZmDragAndDrop.prototype._uploadFiles",function(t,o){
e._dndUploadFiles(arguments.callee.func,this,t,o)
}
)
};
SecureEmail.prototype._handleZmConvLoad=function(){
var e=this;
this.override("ZmConv.prototype._handleResponseLoadMsgs",function(s,t){
var n=arguments.callee.func;
var o=new AjxCallback(this,function(r){
n.call(this,s,r||t)
}
);
e._processMessageResponse(o,t)
}
)
};
SecureEmail.prototype._handleZmMailMsgViewLoad=function(){
var e=this;
this.override("ZmMailMsgView.__unfangInternalImage",function(s,n,t){
var o=arguments.callee.func.apply(this,arguments);
if(t=="src"){
e._processInlineImageElement(s,n)
}
return o
}
)
};
SecureEmail.prototype._handleZmSearchLoad=function(){
var e=this;
this.override("ZmSearch.prototype._handleResponseGetConv",function(s,t){
var n=arguments.callee.func;
var o=new AjxCallback(this,function(r){
n.call(this,s,r||t)
}
);
e._processMessageResponse(o,t)
}
);
this.override("ZmSearch.prototype._handleResponseExecute",function(s,t){
var n=arguments.callee.func;
var o=new AjxCallback(this,function(r){
n.call(this,s,r||t)
}
);
e._processMessageResponse(o,t)
}
)
};
SecureEmail.prototype._handleZmMimeTableLoad=function(){
this.override("ZmMimeTable.isIgnored",function(e){
return(e==ZmMimeTable.XML_ZIMBRA_SHARE)||arguments.callee.func.call(this,e)
}
)
};
SecureEmail.prototype._handleZmComposeControllerLoad=function(){
var s=this;
this.override("ZmComposeController.prototype._attachmentListener",function(d){
if(s._attachmentListener(this,d)){
return arguments.callee.func.apply(this,arguments)
}}
);
this.override("ZmComposeView.prototype._initialize",function(){
arguments.callee.func.apply(this,arguments);
s._handleComposeViewInitialize(this)
}
);
this.override("ZmComposeController.prototype._spellCheckListener",function(m){
var d=this._toolbar.getButton(ZmOperation.SPELL_CHECK);
var u=arguments.callee.func;
if(s._shouldEncrypt()&&d.isToggled()){
var f=appCtxt.getOkCancelMsgDialog();
f.reset();
f.setMessage(com_zimbra_smime.spellCheckWarning);
f.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,function(){
f.popdown();
u.call(this,m)
}
));
f.setButtonListener(DwtDialog.CANCEL_BUTTON,new AjxListener(this,function(){
f.popdown();
this.toggleSpellCheckButton(false)
}
));
f.popup()
}else{
u.call(this,m)
}}
);
var h=appCtxt.getApp("Mail")._sessionController.COMPOSE;
for(var r in h){
var n=h[r];
var l=ZmOperation.SPELL_CHECK;
var o=n._listeners[l];
var t=n._listeners[l]=new AjxListener(n,n._spellCheckListener);
var e=n._toolbar;
if(e){
e.removeSelectionListener(l,o);
e.addSelectionListener(l,t)
}}
this.override("ZmComposeController.prototype._uploadImage",function(d,u){
if(s._shouldSign(this)){
u.run()
}else{
arguments.callee.func.apply(this,arguments)
}}
)
};
SecureEmail.prototype._handleMailLoad=function(){
this._handleZmComposeControllerLoad()
};
SecureEmail.prototype._handleMailCoreLoad=function(){
this._handleZmMailMsgLoad();
this._handleZmConvLoad();
this._handleZmMailMsgViewLoad()
};
SecureEmail.prototype._handleStartup1_1Load=function(){
this._handleZmMimeTableLoad()
};
SecureEmail.prototype._handleStartup1_2Load=function(){
this._handleZmSearchLoad()
};
SecureEmail.prototype._handleNewWindow_2Load=function(){
this._handleZmSearchLoad();
this._handleZmMailMsgLoad();
this._handleZmMailMsgViewLoad();
this._handleZmComposeControllerLoad();
this._handleZmMimeTableLoad()
};
SecureEmail.prototype.override=function(n,l,o){
if(this._patchedFcts[n]&&!o){
if(window.console){
console.log("S/MIME: Not overriding "+n+"; Already overridden")
}}else{
if(!l){
if(window.console){
console.log("S/MIME: Not overriding "+n+"; New function not specified")
}}else{
var h=n.split(".");
var e=window;
for(var t=0;
t<h.length-1;
t++){
e=e[h[t]];
if(!e){
if(window.console){
console.log("S/MIME: Not overriding "+n+"; "+h.slice(0,t+1).join(".")+" doesn't exist")
}
return
}}
var r=h[h.length-1];
var s=e[r];
if(s){
if(window.console){
console.log("S/MIME: Overriding "+n)
}
e[r]=function(){
l.func=s;
return l.apply(this,arguments)
};
e[r].func=s;
this._patchedFcts[n]=true
}else{
console.log("S/MIME: Not overriding "+n+"; not defined")
}}}};
SecureEmail.prototype._attachmentListener=function(t,n){
var o=this;
if(!this._shouldSign()&&!this._shouldEncrypt()){
return true
}
var e=appCtxt.getCurrentView();
e._setAttInline(n);
this._doAttach(t)
};
SecureEmail.prototype._doAttach=function(t){
var e=appCtxt.getCurrentView();
var o=new AjxCallback(this,function(h){
if(h.success){
if(h.value){
var s=this.applethandler._jsonParse(h.value);
if(s.data){
var l="data:"+s.ct+";base64,"+s.data;
e._htmlEditor.insertImage(l,AjxEnv.isIE)
}else{
this._pendingattachments.push(s)
}
t.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO);
e._setAttInline(false)
}}else{
var n=new AjxException(h.error.code,ZmCsfeException.MAIL_SEND_FAILURE,"SecureEmail._doAttach",this.applethandler._jsonStringify(h,true));
SecureEmail.popupExceptionDialog(n.msg,n)
}}
);
this.applethandler.getFile(e._getIsAttInline()||false,o)
};
SecureEmail.prototype._onPaste=function(l,n,r){
if(!this._shouldEncrypt()&&!this._shouldSign()){
var e=appCtxt.getCurrentView();
l.apply(e.getHtmlEditor(),[n,r]);
return
}
var h=r.clipboardData,o,t,s,e;
if(!h){
return
}
o=h.items;
if(!o){
return
}
this._uploadBlob(o[0].getAsFile(),true,true)
};
SecureEmail.prototype._dndUploadFiles=function(n,t,e,o){
if(!this._shouldEncrypt()&&!this._shouldSign()){
n.call(t,e,o);
return
}
this._uploadBlob(e,o,(t._dndFilesLength==1));
t._dndFilesLength--;
if(t._dndFilesLength===0){
delete t._dndFilesLength;
t._setToolTip()
}};
SecureEmail.prototype._uploadBlob=function(o,n,s){
view=appCtxt.getCurrentView();
if(view&&view.toString()!=="ZmComposeView"){
return
}
var e=new FileReader();
var t=this;
e.onload=function(d){
if(n&&/^image\//.test(o.type)){
view._htmlEditor.insertImage(d.target.result,AjxEnv.isIE)
}else{
var u=o.name||o.fileName;
var h={
ct:o.type,cd:'attachment; filename="'+(u?AjxUtil.convertToEntities(u):new Date().getTime())+'"'};
var r=d.target.result.indexOf("base64,");
if(r==-1){
SecureEmail.popupErrorDialog("pasteFileError")
}else{
h.data=d.target.result.substring(r+7);
t._pendingattachments.push(h)
}}
if(s){
var l=view&&view.getController&&view.getController();
l.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO)
}};
e.readAsDataURL(o)
};
SecureEmail.prototype._processMessageResponse=function(d,f){
var u=this;
var t=false;
var o=f.getResponse();
function l(m){
var g=m.ct;
if(SecureEmail.isSMIMEContentType(g)){
return true
}else{
if(!m.mp){
return false
}}
if(g!=ZmMimeTable.MSG_RFC822){
for(var p=0;
p<m.mp.length;
p++){
if(l(m.mp[p])){
return true
}}}
return false
}
var s=[];
var h=[];
for(var r in o){
var e=o[r].m;
if(!e&&o[r].c){
e=o[r].c[0].m
}
if(e){
for(var n=0;
n<e.length;
n++){
if(e[n]){
h.push(e[n])
}}}}
for(var n=0;
n<h.length;
n++){
if(l(h[n])){
s.push(h[n])
}}
if(s.length==0){
d.run(f)
}else{
this._loadMessages(d,f,s)
}};
SecureEmail.prototype._decodeMessage=function(n,o,e){
if(e.success){
var t=new AjxCallback(this,this._onDecode,[n,o]);
this.applethandler.decodeMessage(e.text,t)
}else{
if(window.console){
console.warn("Failed to get message source:");
console.warn(e)
}
n.run()
}};
SecureEmail.prototype._onDecode=function(p,n,r){
var u=null,t,h,e=false;
var y=r;
if(r&&r.success){
y=r.value;
if(window.console){
console.log("S/MIME info:",y);
console.log(this.applethandler._jsonStringify(y,true))
}}
this._smimecache[n.id]=y;
if(y&&y.length){
var d=false;
for(var l=0;
l<y.length;
l++){
if(y[l].encrypted){
d=true;
break
}}
var s=y[y.length-1].contents;
var f=false;
n.mp=s.m.mp;
if(s.m.shr){
n.shr=s.m.shr
}
function g(b){
if(b.cachekey){
b.cl=SecureEmail.getCallbackURL(b.cachekey,b.filename||"");
b.relativeCl=true
}}
SecureEmail._visitParts(n,g);
function o(v,b){
if(b.mp){
o(v,b.mp)
}else{
if(b.ct){
if(b.ct==v){
b.body=f=true
}else{
if(b.cd=="inline"){
b.body=true
}}}else{
for(var w=0;
!f&&w<b.length;
w++){
o(v,b[w])
}}}}
o(ZmMimeTable.TEXT_HTML,n);
if(!f){
o(ZmMimeTable.TEXT_PLAIN,n)
}
var m={};
SecureEmail._visitParts(n,function(b){
if(b.ci&&b.content){
m["cid:"+b.ci.replace(/[<>]/g,"")]=b.content
}}
);
SecureEmail._visitParts(n,function(b){
if(b.ct==ZmMimeTable.TEXT_HTML){
b.content=SMIMESanitizer.sanitize(b.content,m)
}}
)
}
p.run()
};
SecureEmail.prototype._renderSMIMEInfo=function(f,r,u){
if(f.status){
var o=f.certchain&&f.certchain[0];
var h=f.status;
var m=f.emailaddrs;
var l=SecureEmail.getSignerName(o);
var t=false;
var d;
switch(h){
case"unsigned":d=null;
break;
case"signed":t=true;
d=AjxMessageFormat.format(com_zimbra_smime.signedBy,l);
break;
case"was-signed":d=AjxMessageFormat.format(com_zimbra_smime.signedByExpired,l);
break;
case"untrusted":d=AjxMessageFormat.format(com_zimbra_smime.signedByUntrusted,l);
break;
case"corrupt":d=AjxMessageFormat.format(com_zimbra_smime.signatureCorrupt);
break;
case"revoked":d=AjxMessageFormat.format(com_zimbra_smime.signatureRevoked);
break;
case"expired":d=AjxMessageFormat.format(com_zimbra_smime.signatureExpired);
break;
case"wrong-signer":d=AjxMessageFormat.format(com_zimbra_smime.signatureWrong,l);
break;
case"unapproved-algorithm":d=AjxMessageFormat.format(com_zimbra_smime.signatureUnapproved,l);
break;
case"unknown":case"error":d=AjxMessageFormat.format(com_zimbra_smime.signatureError,l);
break;
case"invalid":default:d=AjxMessageFormat.format(com_zimbra_smime.signatureInvalid);
break
}
if(t&&m&&!u.getMsg().isSent){
this.certstore.saveCertificate(o.data,m,u)
}}
if(f.encrypted){
r.push('<span class="ImgPadlock SMIMEImage"></span>');
r.push("<span>");
r.push(com_zimbra_smime.messageEncrypted);
r.push("</span>")
}
if(f.status){
var e=this.getResource(t?"imgs/valid.png":"imgs/corrupt.png");
r.push("<span>");
if(o){
var s=new AjxCallback(this.certstore,this.certstore.showCertificate,[o,h]);
var n=SMIMECertStore.store(s);
r.push('<a href="#" notoggle="1" onclick="SMIMECertStore.callStore('+n+')">')
}
r.push("");
r.push(AjxMessageFormat.format('<img class="SMIMEImage" src="{0}" />',e));
r.push(d);
if(o){
r.push("</a>")
}
r.push("</span>")
}};
SecureEmail.prototype._renderMessageInfo=function(h,f){
if(!h||!f._hdrTableId){
return
}
var j=this._smimecache[h.id];
if(!j){
return
}
var b=[];
if(!j.success&&j.error){
var w;
var d=j.error.code;
var e=com_zimbra_smime[d+"-shortMsg"];
if(com_zimbra_smime[d]){
w=(com_zimbra_smime.loadingError+" "+com_zimbra_smime[d])
}else{
w=com_zimbra_smime.loadingFail
}
if(e){
var r=new AjxCallback(function(){
SecureEmail.popupErrorDialog(d)
}
)
}else{
var v=this.applethandler._jsonStringify(j,true);
var t="com_zimbra_smime";
var n="SecureEmail._showMessage";
var q=j;
var g=new AjxException(null,t,n,v);
r=new AjxCallback(function(){
SecureEmail.popupExceptionDialog(null,g)
}
)
}
if(window.console){
console.warn("failed getting S/MIME info:");
console.warn(v?v:w)
}
b.push("<span>");
b.push('<a href="#" notoggle="1" onclick="SMIMECertStore.callStore('+SMIMECertStore.store(r)+')">');
b.push(AjxMessageFormat.format('<img class="SMIMEImage" src="{0}" />',this.getResource("imgs/corrupt.png")));
b.push(e?e:w);
b.push("</a>");
b.push("</span>")
}else{
for(var y=0;
y<j.length;
y++){
this._renderSMIMEInfo(j[y],b,f)
}}
var u=b.join("");
var s=this._msgDivCache[h.id]=this._msgDivCache[h.id]||[];
if(s&&s.length){
for(var y=0;
y<s.length;
y++){
var o=Dwt.byId(s[y]);
if(o){
o.innerHTML=u
}}}
var p=Dwt.getNextId();
s.push(p);
if(h.isDraft){
return
}
if(Dwt.byId((f._hdrTableId+"-smimeinfo"))){
return
}
var x={
info:u,id:f._hdrTableId+"-smimeinfo"};
var m=AjxTemplate.expand("com_zimbra_smime#securityHeader",x);
var l=Dwt.byId(f._hdrTableId);
l.firstChild.appendChild(Dwt.parseHtmlFragment(m,true))
};
SecureEmail.prototype.addCustomMimeHeaders=function(t){
var e=this._shouldSign(null,true);
var o=this._shouldEncrypt(null,true);
if(!e&&!o){
return
}
t.push({
name:SMIME_DRAFT_HEADER_SIGN,_content:e}
);
t.push({
name:SMIME_DRAFT_HEADER_ENCRYPT,_content:o}
)
};
SecureEmail.prototype._isSMIMEPart=function(e){
return(!/^[\d|\.]*$/.test(e))
};
SecureEmail.prototype._sendMessage=function(t,s,j){
var b=this;
var h=false,m=false;
var f=false;
if(j.jsonObj.SendMsgRequest||j.jsonObj.SaveDraftRequest){
h=this._shouldSign();
m=this._shouldEncrypt();
var g=appCtxt.getCurrentView();
var y=g&&g.getController&&g.getController()
}
var p=(j.jsonObj.SendMsgRequest||j.jsonObj.SaveDraftRequest);
var q=false;
if(p&&p.m&&p.m.attach&&p.m.attach.mp){
var O=p.m.attach.mp;
for(var x=0;
O&&x<O.length;
x++){
q=O[x].mid&&O[x].part&&this._isSMIMEPart(O[x].part);
if(q){
break
}}}
if(!m&&!h&&!q){
t.apply(s,[j]);
return
}
if(j.jsonObj.SaveDraftRequest){
if(j.jsonObj.SaveDraftRequest.m.autoSendTime){}else{
f=true;
h=false;
m=true;
j.certificates=[]
}}
var r=false;
for(var x=0;
!r&&x<p.m.e.length;
x++){
if(p.m.e[x].t=="f"){
r=true
}}
if(!r){
var o=(appCtxt.accountList.defaultAccount||appCtxt.accountList.activeAccount||appCtxt.accountList.mainAccount);
var A=appCtxt.getIdentityCollection(o).defaultIdentity;
var d=new AjxEmailAddress(A.sendFromAddress,AjxEmailAddress.FROM,A.sendFromDisplay);
p.m.e.push({
a:d.toString(),t:"f"}
)
}
function u(D,M){
var B,W,H,R;
if(D.id){
if(window.console){
console.log("an email attachment: "+JSON.stringify(D,null,2))
}
B=[M,"&id=",D.id].join("")
}else{
if(D.mid&&D.part){
if(window.console){
console.log("a msgpart attachment: "+JSON.stringify(D,null,2))
}
if(b._isSMIMEPart(D.part)){
return{
cachekey:D.part}
}
B=[M,"&id=",D.mid,"&part=",D.part].join("")
}else{
SecureEmail.popupErrorDialog("attach-convert-error");
if(window.console){
console.log("some other attachment: "+JSON.stringify(D,null,2))
}}}
if(B){
var C=new AjxRpcRequest();
B+="&timestamp="+new Date().getTime();
if(window.console){
console.warn(B)
}
var F=C.invoke("",B,{
"X-Zimbra-Encoding":"x-base64"}
,null,true);
if(window.console){
console.log(C,F)
}
if(window.console){
console.log(C.__httpReq.getAllResponseHeaders())
}
W=C.__httpReq.getResponseHeader("Content-Type");
if(window.console){
console.log(W)
}
H=C.__httpReq.getResponseHeader("Content-Disposition");
if(window.console){
console.log(H)
}
R=C.__httpReq.getResponseHeader("X-Zimbra-ItemType");
if(R=="message"){
H="attachment; ";
var S=appCtxt.cacheGet(D.id);
if(S&&S.subject){
H+='filename="'+S.subject+'"'
}}
if(F.success){
return{
data:F.text,ct:W,cd:H}
}}}
if(window.console){
console.log("input",p)
}
var b=this;
function e(M,R){
for(var D=0;
M&&D<M.length;
D++){
var B=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);
var W=u(M[D],B);
if(W){
if(R){
W.ci=R;
if(/^image\//.test(W.ct)){
var S="cid:"+R;
var C=W.ct.indexOf(";");
if(C==-1){
C=W.ct.length
}
var F="data:"+W.ct.substring(0,C)+";base64,"+W.data;
g._htmlEditor.replaceImageSrc(S,F)
}}
b._pendingattachments.push(W)
}else{
if(window.console){
console.warn("disregarding unknown part: "+b.applethandler._jsonStringify(M[D],true))
}}}}
if(p.m.attach){
e(p.m.attach.mp);
e(p.m.attach.m);
e(p.m.attach.cn);
e(p.m.attach.doc);
delete p.m.attach
}
function T(W){
for(var B=W.length-1;
B>=0;
B--){
var C=W[B];
if(C.attach){
e(C.attach.mp,C.ci);
e(C.attach.doc,C.ci);
W.splice(B,1)
}else{
if(C.mp){
T(C.mp)
}}}}
T(p.m.mp);
while(this._pendingattachments.length>0){
var v=p.m.mp[0];
if(v.ct!==ZmMimeTable.MULTI_MIXED){
p.m.mp[0]=v={
ct:ZmMimeTable.MULTI_MIXED,mp:[v]}
}
v.mp.push(this._pendingattachments.pop())
}
var l;
if(m){
if(!j.certificates){
var z=function(W){
j=AjxUtil.hashCopy(j);
j.certificates=W;
b._sendMessage(t,s,j)
};
var w=function(){
j.errorCallback.run()
};
this._getEncryptionCertificates(s,z,w);
return
}}
var n=new AjxCallback(this,this._onEncoded,[j,p,t,s,f]);
this.applethandler.encodeMessage(j.certificates,p,h,m,n)
};
SecureEmail.prototype._onEncoded=function(s,r,h,t,o,d){
if(!d.success){
this._onEncodeError(s,d);
return
}
var n=d.value;
var e=(appCtxt.get(ZmSetting.CSFE_ATTACHMENT_UPLOAD_URI)+"?fmt=raw");
var l=new AjxCallback(this,function(f){
var m=null;
if(f.success){
var y="["+f.text.replace(/'/g,'"')+"]";
m=this.applethandler._jsonParse(y)
}
if(m&&m.length==3&&m[0]==200){
var b=m[2];
var g=s.callback;
var p=r.m;
s.callback=new AjxCallback(this,function(x){
var j=x.getResponse();
for(var q=0;
j.m&&q<j.m.length;
q++){
var w=j.m[q];
if(w.id==p.id||!p.id){
w.mp=j.m[q].mp=n.display.m.mp
}
if(o){
function T(W){
if(W.cachekey){
var O=W.cachekey;
var B=W.filename;
var A=SecureEmail.getCallbackURL(O,B);
W.url=W.cl=A;
W.cachekey=O
}}
SecureEmail._visitParts(w.mp,T);
var v=appCtxt.getCurrentView();
if(v&&v.processMsgDraft){
v.processMsgDraft(t)
}}}
try{
g.run(x)
}
catch(z){
if(window.console){
console.error(z)
}
throw z
}}
);
r.m={
aid:b};
for(var u in p){
if(u!="mp"){
r.m[u]=p[u]
}}
h.apply(t,[s])
}else{
if(s.errorCallback){
s.errorCallback.run(exc)
}}}
);
AjxRpc.invoke(n.message,e,{
"Content-Type":ZmMimeTable.MSG_RFC822,"Content-Disposition":'attachment; filename="message.eml"'}
,l)
};
SecureEmail.prototype._onEncodeError=function(h,s){
var r=this.applethandler._jsonStringify(s,true);
if(window.console){
console.error("Signing failed:");
console.error(r)
}
var o=ZmCsfeException.MAIL_SEND_FAILURE;
var n=s.error.code;
var l="SecureEmail._sendMessage";
var t=r;
var e=new AjxException(n,o,l,t);
if(h.errorCallback){
h.errorCallback.run(e)
}
SecureEmail.popupExceptionDialog(n,e)
};
SecureEmail.prototype._getEncryptionCertificates=function(n,t,o){
var e=[];
AjxUtil.foreach(ZmMailMsg.COMPOSE_ADDRS,function(r){
n.getAddresses(r).foreach(function(h){
e.push(h.getAddress())
}
)
}
);
var s=new AjxCallback(this,function(f){
var l=[];
var u=[];
for(var m=0;
m<e.length;
m++){
var p=e[m];
if(f[p]&&f[p].length>=1){
l.push.apply(l,f[p])
}else{
u.push(p)
}}
if(u.length>0){
var h=ZmCsfeException.MAIL_SEND_FAILURE;
var g="encrypt-cert-not-found";
var r="SecureEmail._sendMessage";
var d=" "+u.join(", ");
var y=new AjxException(g,h,r,null);
SecureEmail.popupExceptionDialog(g,y,d);
o()
}else{
t(l)
}}
);
this.certstore.getCertificatesForEmails(e,s);
return
};
SecureEmail.prototype._loadMessages=function(m,f,l){
var d=0;
var s=new AjxCallback(function(){
d+=1;
if(d==l.length){
m.run(f)
}}
);
for(var r=0;
r<l.length;
r++){
var t=l[r];
var o=new AjxCallback(this,this._decodeMessage,[s,t]);
var h=t.part?"&part="+t.part:"";
var u="&timestamp="+new Date().getTime();
var n=[appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI),"&id=",t.id,h,u].join("");
function e(g,p){
setTimeout(function(){
AjxRpc.invoke("",g,{
"X-Zimbra-Encoding":"x-base64"}
,p,true)
}
,0)
}
e(n,o)
}};
SecureEmail.prototype._shouldSign=function(e,o){
var t=this._getUserSecuritySetting(e,o);
return(t==SMIME_SIGN||t==SMIME_SIGNENCRYPT)
};
SecureEmail.prototype._shouldEncrypt=function(e,t){
return this._getUserSecuritySetting(e,t)==SMIME_SIGNENCRYPT
};
SecureEmail.prototype._getUserSecuritySetting=function(e,h){
var r=appCtxt.getApp("Mail");
AjxDispatcher.require(["MailCore","Mail"]);
var t=appCtxt.getAppViewMgr().getCurrentView();
e=e||((t instanceof ZmComposeView)&&t.getController())||r.getComposeController(r.getCurrentSessionId("COMPOSE"));
var n=e&&e._toolbar;
var o=n&&this._getSecurityButtonFromToolbar(n);
var s=o&&o.getMenu();
if(s){
return s.getSelectedItem().getData("sign")
}else{
if(h){
return false
}else{
return this._getSecuritySetting()
}}};
SecureEmail.prototype._getSecuritySetting=function(){
if(appCtxt.isChildWindow){
return window.opener.appCtxt.getZimletMgr().getZimletByName("com_zimbra_smime").handlerObject._getUserSecuritySetting()
}else{
var e=appCtxt.get(SMIME_MAIL_PREF_SECURITY);
if(e=="auto"){
return Number(this.getUserProperty(SMIME_MAIL_USER_SECURITY)||0)
}else{
return Number(e)
}}};
SecureEmail.prototype.getActiveCertStore=function(e){
this.applethandler.getInfo(new AjxCallback(this,function(n){
if(n.success){
var t=[n.value.name,n.value.platform];
var o=(n.value.fips?com_zimbra_smime.storeInfoFormatFIPS:com_zimbra_smime.storeInfoFormat);
t=AjxUtil.map(t,function(s){
return com_zimbra_smime["store."+s]||s
}
);
e.run(AjxMessageFormat.format(o,t))
}else{
e.run(com_zimbra_smime.errorOccurred)
}}
))
};
SecureEmail.prototype._handleSelectSigning=function(n,o){
var s=o.dwtObj.getData("sign");
this._setSecurityImage(n,s);
var e=appCtxt.getCurrentView();
var t=e&&e.getController&&e.getController();
SecureEmail.__adjustFormVisibility(e._attButton.getHtmlElement(),s==SMIME_DONTSIGN);
this.setUserProperty(SMIME_MAIL_USER_SECURITY,s);
this.saveUserProperties();
t.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO)
};
SecureEmail.prototype.initializeToolbar=function(d,m,g,j){
if(!this._active){
return
}
if(j.indexOf("COMPOSE")>=0){
var e;
var n=m.getChildren();
for(var v=0;
v<n.length&&!e;
v++){
if(Dwt.hasClass(n[v].getHtmlElement(),SMIME_SECURITY_BUTTON_CLASS)){
e=n[v];
break
}}
var f;
var w=true;
var s=g.getMsg();
if(s&&s.isInvite()){
f=SMIME_DONTSIGN;
w=false
}else{
if(s&&s.isDraft){
var z=s.getMimeHeader(SMIME_DRAFT_HEADER_SIGN)=="true";
var y=s.getMimeHeader(SMIME_DRAFT_HEADER_ENCRYPT)=="true";
if(z&&y){
f=SMIME_SIGNENCRYPT
}else{
if(z){
f=SMIME_SIGN
}else{
f=SMIME_DONTSIGN
}}}else{
f=this._getSecuritySetting()
}}
if(!e){
var h=AjxUtil.indexOf(m.opList,ZmOperation.COMPOSE_OPTIONS)+1;
var b=Dwt.getNextId()+"_"+SMIME_SECURITY_BUTTON_CLASS;
var x=new DwtToolBarButton({
parent:m,id:b+"_checkbox",index:h,className:SMIME_SECURITY_BUTTON_CLASS+" ZToolbarButton"}
);
var r=new DwtMenu({
parent:x,id:b+"_menu"}
);
var u=b+"_menu_sign";
x.setMenu(r);
var o=new AjxListener(this,this._handleSelectSigning,[x]);
var p=new DwtMenuItem({
parent:r,style:DwtMenuItem.RADIO_STYLE,radioGroupId:u}
);
p.setText(com_zimbra_smime.dontsignMessage);
p.addSelectionListener(o);
p.setData("sign",SMIME_DONTSIGN);
var q=new DwtMenuItem({
parent:r,style:DwtMenuItem.RADIO_STYLE,radioGroupId:u}
);
q.setText(com_zimbra_smime.signMessage);
q.addSelectionListener(o);
q.setData("sign",SMIME_SIGN);
var l=new DwtMenuItem({
parent:r,style:DwtMenuItem.RADIO_STYLE,radioGroupId:u}
);
l.setText(com_zimbra_smime.signAndEncryptMessage);
l.addSelectionListener(o);
l.setData("sign",SMIME_SIGNENCRYPT);
r.checkItem("sign",f,true);
this._setSecurityImage(x,f);
x.setEnabled(w)
}else{
var t=e.getMenu();
if(t){
t.checkItem("sign",f,true);
this._setSecurityImage(e,f)
}
e.setEnabled(w)
}}};
SecureEmail.prototype._setSecurityImage=function(e,t){
e.setImage(SMIME_SECURITY_TYPES[t].className);
e.setText(SMIME_SECURITY_TYPES[t].label)
};
SecureEmail.prototype._getSecurityButtonFromToolbar=function(o){
var t=o.getChildren();
for(var e=0;
e<t.length;
e++){
if(Dwt.hasClass(t[e].getHtmlElement(),SMIME_SECURITY_BUTTON_CLASS)){
return t[e]
}}};
SecureEmail.prototype.onMsgView=function(o,e,t){
this._renderMessageInfo(o,t)
};
SecureEmail.prototype.onConvView=function(o,e,t){
this._renderMessageInfo(o,t)
};
SecureEmail.prototype.addExtraMsgParts=function(){};
SecureEmail.getCallbackURL=function(t,e){
var o='SecureEmail.saveCachedPartCallback("'+t+'")';
return"javascript:"+AjxStringUtil.urlComponentEncode(o)
};
SecureEmail.getSignerName=function(e){
return e&&(e.subject.cn||(e.subject.altnames&&(e.subject.altnames.otherName||e.subject.altnames.rfc822Name)))
};
SecureEmail.saveCachedPartCallback=function(t){
var o=appCtxt.getZimletMgr().getZimletByName("com_zimbra_smime");
var e=o.handlerObject;
e.applethandler.saveCachedPart(t)
};
SecureEmail.getInstance=function(){
return appCtxt.getZimletMgr().getZimletByName("com_zimbra_smime").handlerObject
};
SecureEmail.popupErrorDialog=function(t){
if(!t){
t="unknown-error"
}
var n=com_zimbra_smime[t];
var o=com_zimbra_smime[t+"-title"];
var e=appCtxt.getMsgDialog();
e.setMessage(n,DwtMessageDialog.CRITICAL_STYLE,o);
e.popup()
};
SecureEmail.popupExceptionDialog=function(o,t,e){
if(!o){
o="unknown-error"
}
var s=com_zimbra_smime[o];
var n=com_zimbra_smime[o+"-title"];
if(e){
s+=e
}
SMIMEExceptionDialog.popup(n,s,t)
};
var SMIME_APPLET_ID="smime-applet";
var SMIME_APPLET_CHUNK_SIZE=1024*1024;
var SMIME_USAGE_SIGN="sign";
var SMIME_USAGE_ENCRYPT="encrypt";
function SMIMEApplet(e,t){
this._version=e;
this._codebase=t;
this._appleturl=AjxUtil.formatUrl({
path:appContextPath+"/public/com_zimbra_smime.jarx",qsReset:true}
);
this._load()
}
SMIMEApplet.prototype=new Object();
SMIMEApplet.prototype.constructor=SMIMEApplet;
SMIMEApplet.prototype.toString=function(){
return"SMIMEApplet"
};
SMIMEApplet.prototype._processException=function(t){
if(t){
var o={};
for(var e in t){
o[e]=t[e]
}
if(t.message){
o.message=t.message
}
if(t.fileName){
o.fileName=t.fileName
}
if(t.lineNumber){
o.lineNumber=t.lineNumber
}
if(t.name){
o.name=t.name
}
if(t.stack){
o.stack=t.stack
}
DBG.println(AjxDebug.NONE,"<b>S/MIME ERROR: "+t.toString()+"</b>","SMIMEAppletResponse");
if(window.console){
console.error("S/MIME ERROR: ",t,this._jsonStringify(o,true))
}
return{
success:false,error:o}
}};
SMIMEApplet.prototype._logCall=function(t,e){
DBG.println(AjxDebug.NONE,"<b>S/MIME applet request: "+t+"</b>","SMIMEAppletRequest");
for(k in e){
break
}};
SMIMEApplet.prototype._logResult=function(t,e){
DBG.println(AjxDebug.NONE,"<b>S/MIME applet response: "+t+"</b>","SMIMEAppletResponse")
};
SMIMEApplet.prototype._jsonParse=function(str){
if(window.JSON){
return JSON.parse(str)
}else{
return eval("("+str+")")
}};
SMIMEApplet.prototype._jsonStringify=function(t,e){
if(window.JSON){
if(e){
return JSON.stringify(t,null,2)
}else{
return JSON.stringify(t)
}}else{
return AjxStringUtil.objToString(t)
}};
SMIMEApplet.prototype._partitionString=function(n){
var e=this;
if(typeof n==="string"&&n.length>SMIME_APPLET_CHUNK_SIZE){
var t=0;
function o(){
try{
var h=t++;
var l=h*SMIME_APPLET_CHUNK_SIZE;
var s=(h+1)*SMIME_APPLET_CHUNK_SIZE;
if(l>=n.length){
return null
}
if(s>=n.length){
s=n.length
}
return n.slice(l,s)
}
catch(r){
e._processException(r);
return null
}}
return o
}else{
return n
}};
SMIMEApplet.prototype._load=function(){
try{
var s={
style:"width: 1px; height: 1px",type:"application/x-java-applet",id:SMIME_APPLET_ID};
var h={
zimbra_locale:appCtxt.get(ZmSetting.LOCALE_NAME),code:"com.zimbra.smime.applet.SMIMEApplet.class",java_version:"1.6+",java_arguments:"-Xmx256m",mayscript:true,codebase:this._codebase,cache_version:this._version,cache_archive:this._appleturl,archive:this._appleturl};
var o="";
o+="<object";
for(var n in s){
o+=" "+n+'="'+s[n]+'"'
}
o+=">";
for(var n in h){
o+=('<param name="'+n+'" value="'+h[n]+'">')
}
o+="</object>";
var t=document.createElement("div");
t.innerHTML=o;
document.body.appendChild(t)
}
catch(r){
this._processException(r)
}};
SMIMEApplet.prototype._sendRequest=function(r,l){
var o=this;
var s=l.callback;
delete l.callback;
this._logCall(r,l);
try{
var n=document.getElementById(SMIME_APPLET_ID);
n.check()
}
catch(h){
this._processException(h);
if(n){
n.parentNode.removeChild(n)
}
this._load();
n=document.getElementById(SMIME_APPLET_ID)
}
for(var t in l){
l[t]=this._partitionString(l[t])
}
l.callback=function(g){
try{
var f;
if(typeof g==="string"){
f=o._jsonParse(g)
}else{
if(g){
var u=[];
for(var m=0,d=g.size();
m<d;
m++){
u[m]=g.get(m)
}
f=o._jsonParse(u.join(""))
}else{
f=g
}}
o._logResult(r,f);
if(s){
s.run(f)
}}
catch(p){
return o._processException(p)
}};
try{
n.handleRequest(r,l)
}
catch(h){
return this._processException(h)
}};
SMIMEApplet.prototype.getInfo=function(t){
var e={
callback:t};
return this._sendRequest("get-info",e)
};
SMIMEApplet.prototype.decodeCertificate=function(e,o){
var t={
data:e,callback:o};
return this._sendRequest("get-cert",t)
};
SMIMEApplet.prototype.decodeMessage=function(e,o){
var t={
data:e,callback:o};
return this._sendRequest("decode",t)
};
SMIMEApplet.prototype.encodeMessage=function(o,n,t,e,r){
var s={
certificates:o&&o.join(","),sign:t,encrypt:e,data:this._jsonStringify(n),callback:r};
return this._sendRequest("encode",s)
};
SMIMEApplet.prototype.getIdentityCertificate=function(e,t,n){
var o={
email:e,usage:t,callback:n};
return this._sendRequest("get-ident",o)
};
SMIMEApplet.prototype.saveCachedPart=function(e,o){
var t={
key:e,callback:o};
return this._sendRequest("save-file",t)
};
SMIMEApplet.prototype.getFile=function(e,o){
var t={
isInline:e,callback:o};
return this._sendRequest("read-file",t)
};
SMIME_CONTACT_CERT_CLASS="com_zimbra_smime_contact_cert";
function SMIMECertStore(e,t){
var o=new AjxCallback(this,this._handleContactsLoad);
AjxDispatcher.addPackageLoadFunction("Contacts",o);
this._zimlethandler=e;
this._applethandler=t;
this._certdialog=new CertificateDialog(this._zimlethandler)
}
SMIMECertStore.prototype.toString=function(){
return"SMIMECertStore"
};
SMIMECertStore.prototype._handleContactsLoad=function(){
var t=this;
var o=ZmContactSplitView._showContactListItem;
ZmContactSplitView._showContactListItem=function(r){
return t._showContactListItem(o,r)
};
var n=ZmEditContactView.prototype.__initRowsOther;
ZmEditContactView.prototype.__initRowsOther=function(h,u,l,r,d){
return t.__initRowsOther(n,this,h,u,l,r,d)
};
var s=ZmEditContactView.prototype.set;
ZmEditContactView.prototype.set=function(r,h){
return t.editSet(s,this,r,h)
};
var e=ZmEditContactView.prototype.getModifiedAttrs;
ZmEditContactView.prototype.getModifiedAttrs=function(){
return t.getModifiedAttrs(e,this)
}
};
SMIMECertStore.prototype.showCertificate=function(n,t){
var o=AjxUtil.isString(n)?n:this._getCertificate(n);
var e=new AjxCallback(this,this._setCertificate,[t]);
if(AjxUtil.isString(o)){
this._applethandler.decodeCertificate(o,e)
}else{
e.run(o)
}};
SMIMECertStore.prototype._setCertificate=function(e,o){
var t;
if(o&&o.success&&o.value){
t=o.value
}else{
if(o.success!==false){
t=o
}}
if(AjxUtil.isObject(t)){
this._certdialog.setCertificate(t,e);
this._certdialog.popup()
}};
SMIMECertStore.prototype.isCertificateValid=function(e,o,t){
if(AjxUtil.isString(e)){
this._applethandler.decodeCertificate(e,function(n){
if(n.success&&n.value){
o.run(n.value)
}else{
t.run()
}}
)
}else{
t.run()
}};
SMIMECertStore.prototype.saveCertificate=function(n,o,t){
var e=new AjxCallback(this,function(d){
for(var r=0;
r<o.length;
r++){
var m=o[r];
var u=d[m];
if(u==n||(AjxUtil.isArray(u)&&AjxUtil.indexOf(u,n)!=-1)){
return
}}
var l=false;
var s=o.slice(0);
var h=new AjxCallback(this,function(f){
if(f){
var x=f.getAttr("userCertificate");
if(!x){
f.modify({
userCertificate:n}
,null,true)
}else{
if(x!=n){
if(Dwt.byId((t._hdrTableId+"-replacecertinfo"))){
return
}
var v={
id:t._hdrTableId+"-replacecertinfo",actionMsg:AjxMessageFormat.format(com_zimbra_smime.certReplaceAction,f.getEmail())};
var p=AjxTemplate.expand("com_zimbra_smime#securityReplaceCert",v);
var y=Dwt.byId(t._hdrTableId);
y.firstChild.appendChild(Dwt.parseHtmlFragment(p,true));
var g=document.getElementById(id+"-actionMsg");
Dwt.setHandler(g,DwtEvent.ONCLICK,function(){
f.modify({
userCertificate:n}
);
Dwt.setVisible(Dwt.byId(id),false);
Dwt.clearHandler(g,DwtEvent.ONCLICK)
}
)
}}
l=true
}
var b=s.pop();
if(b){
appCtxt.getApp(ZmApp.CONTACTS).getContactByEmail(b,h)
}else{
if(!l){
var w=new AjxCallback(this,function(q){
var j=new AjxCallback(this,function(B){
if(!B.success){
return
}
var W=B.value.subject;
var D=W.altnames;
var z=new ZmContact(null,q);
var O={
folderId:q.search.folderId,workCountry:W.country,workState:W.state,company:W.org,department:W.orgunit,userCertificate:n};
if(W.cn){
var C=W.cn.split(" ");
O.firstName=C.shift();
O.lastName=C.pop();
O.middleName=C.join(" ")
}else{
var A=m.indexOf("@");
if(A>0){
O.firstName=m.substr(0,A)
}}
var T=o;
if(W.emailaddress){
T.push(W.emailaddress)
}
if(D){
T.push.apply(T,D.rfc822Name)
}
T=AjxUtil.uniq(T);
for(var A=0;
A<T.length;
A++){
if(A){
O["email"+(A+1)]=T[A]
}else{
O.email=T[A]
}}
z.create(O,null,true)
}
);
this._applethandler.decodeCertificate(n,j)
}
);
SMIMECertStore.getCertificateContactList(w)
}}}
);
h.run()
}
);
this.getCertificatesForEmails(o,e)
};
SMIMECertStore.prototype.getCertificateForUser=function(o,e,t){
var n=new AjxCallback(function(s){
if(s.success){
e.run(s.value)
}else{
if(s.error&&s.error.code=="cert-not-found"){
e.run(null)
}else{
if(t){
t.run(s)
}}}}
);
this._applethandler.getIdentityCertificate(o,SMIME_USAGE_SIGN,n)
};
SMIMECertStore.prototype.getCertificatesForEmails=function(r,s){
var o=AjxSoapDoc.create("GetSMIMEPublicCertsRequest","urn:zimbraAccount");
if(appCtxt.isChildWindow){
if(AjxEnv.isIE){
var e=[];
for(var t=0;
t<r.length;
t++){
e[t]=r[t]
}
r=e
}else{
r=Array.prototype.slice.call(r)
}}
o.set(null,{
store:"CONTACT,GAL,LDAP",email:r}
);
var n=new AjxCallback(this,function(l){
var p={};
var f=l.getResponse().GetSMIMEPublicCertsResponse.certs;
for(var u=0;
f&&u<f.length;
u++){
var h=f[u];
var m=p[h.email]=[];
for(var d=0;
d<h.cert.length;
d++){
m.push(h.cert[d]._content)
}}
s.run(p)
}
);
appCtxt.getAppController().sendRequest({
soapDoc:o,callback:n,asyncMode:true}
)
};
SMIMECertStore.getCertificateContactList=function(e){
SMIMECertStore.getCertificateAddressBook(new AjxCallback(function(t){
var o=t?t.createQuery():null;
if(o){
var n={
query:o,types:[ZmItem.CONTACT],noRender:true,callback:new AjxCallback(function(s){
var r=s.getResponse().getResults();
if(e instanceof AjxCallback){
e.run(r)
}}
)};
appCtxt.getSearchController().search(n)
}}
))
};
SMIMECertStore.getCertificateAddressBook=function(s){
var e;
for(var o=0;
o<1000;
o++){
var t=ZmFolder.QUERY_NAME[ZmFolder.ID_CONTACTS]+(o==0?"":o);
var n=appCtxt.getFolderTree().getByName(t);
if(n&&n.type==ZmOrganizer.ADDRBOOK){
if(s instanceof AjxCallback){
s.run(n)
}
return n
}
if(!e&&!n){
e=t
}}
if(e){
appCtxt.getAppController().sendRequest({
jsonObj:{
CreateFolderRequest:{
_jsns:"urn:zimbraMail",folder:{
color:0,l:"1",fie:"1",name:e,url:null,view:"contact"}}}
,asyncMode:true,callback:new AjxCallback(function(h){
var l=h.getResponse().CreateFolderResponse.folder[0].id;
if(s instanceof AjxCallback){
function r(){
setTimeout(function(){
s.run(appCtxt.getById(l))
}
,0)
}
AjxDispatcher.require(["Contacts"],true,new AjxCallback(r))
}}
)}
)
}};
SMIMECertStore.prototype._showContactListItem=function(n,t){
if(t.name=="userCertificate"){
var o=SMIMECertStore.store(new AjxCallback(this,this.showCertificate,[t.attrs.userCertificate,null]));
var e="javascript:SMIMECertStore.callStore("+o+")";
return AjxTemplate.expand("com_zimbra_smime#ShowContactCertRow",{
id:id,link:e}
)
}else{
return n(t)
}};
SMIMECertStore.prototype.__initRowsOther=function(l,t,o,h,n,e,s){
var r=AjxUtil.hashCopy(o);
delete r.userCertificate;
return l.call(t,r,h,n,e,s)
};
SMIMECertStore.prototype.getFormItems=function(o,e){
var t=o.call(e);
t.push({
id:"SMIME",type:"ZmEditContactViewInputSelectRows",rowitem:{
type:"ZmEditContactViewInputSelect",equals:ZmEditContactViewInputSelect.equals,params:{
inputWidth:351,hint:"Certificate 1",options:e.getURLOptions()}}}
);
return t
};
SMIMECertStore.prototype.editSet=function(p,m,d,b){
p.call(m,d,b);
delete m._newCert;
var o=m.getHTMLElId()+"_EMAIL";
var n=AjxTemplate.expand("com_zimbra_smime#EditContactCertRow",{
id:o,className:SMIME_CONTACT_CERT_CLASS}
);
var s=document.createElement("div");
s.innerHTML="<table><tbody>"+n+"</tbody></table>";
var u=Dwt.byId(o);
var h=u.parentNode.parentNode;
var e=h.parentNode;
for(var t=s;
t&&t.className!=SMIME_CONTACT_CERT_CLASS;
t=t.firstChild){}
for(var r=0;
r<e.childNodes.length;
r++){
var y=e.childNodes.item(r);
if(y.className==t.className){
e.removeChild(y)
}}
e.insertBefore(t,h.nextSibling);
var l=this._showButton=new DwtButton({
parent:m}
);
l.setText(com_zimbra_smime.showCertificate);
l.addSelectionListener(new AjxListener(this,this.showCertificate,[m,null]));
l.replaceElement(o+"_show");
var f=this._deleteButton=new DwtButton({
parent:m}
);
f.setText(com_zimbra_smime.deleteCertificate);
f.addSelectionListener(new AjxListener(this,this._deleteCertificate,[m]));
f.replaceElement(o+"_delete");
var g=this._uploadButton=new DwtButton({
parent:m}
);
g.setText(com_zimbra_smime.upload);
g.addSelectionListener(new AjxListener(this,this._chooseCertificate,[m]));
g.replaceElement(o+"_upload");
this._refreshButtons(m)
};
SMIMECertStore.prototype.getModifiedAttrs=function(o,e){
var t=o.call(e);
if(e._newCert){
if(!t){
t={}
}
t.userCertificate=e._newCert
}else{
if(e._newCert===null){
t.userCertificate=null
}}
return t
};
SMIMECertStore.prototype._chooseCertificate=function(t){
var n=this.getEchoUploadDialog();
n.setAllowedExtensions(["cer","crt"]);
var r=null;
var l=new AjxCallback(this,this._handleChooseCertificate,[t]);
var h=com_zimbra_smime.upload;
var o=null;
var s=true;
var e=true;
n.popup(r,l,h,o,s,e)
};
SMIMECertStore.prototype._deleteCertificate=function(e,t){
e._newCert=null;
e.setDirty(true);
this._refreshButtons(e)
};
SMIMECertStore.prototype._refreshButtons=function(e){
var o=this;
function t(l){
l.getHtmlElement().parentNode.style.display="table-cell"
}
function n(l){
l.getHtmlElement().parentNode.style.display="none"
}
function h(){
t(o._uploadButton);
n(o._showButton);
n(o._deleteButton)
}
function s(){
n(o._uploadButton);
t(o._showButton);
t(o._deleteButton)
}
var r=!!this._getCertificate(e);
r?s():h()
};
SMIMECertStore.prototype._isCertificateUpdated=function(e){
return typeof e._newCert!=="undefined"
};
SMIMECertStore.prototype._getCertificate=function(e){
if(this._isCertificateUpdated(e)){
return e._newCert
}else{
if(e.data){
return e.data
}else{
return ZmContact.getAttr(e.getContact(),"userCertificate")
}}};
SMIMECertStore.prototype._handleChooseCertificate=function(e,s){
var t=s[0].base64;
this.getEchoUploadDialog().popdown();
var n=new AjxCallback(this,function(h){
e._newCert=t;
e.setDirty(true);
this._refreshButtons(e)
}
);
var o=new AjxCallback(this,function(){
this._zimlethandler.displayErrorMessage(com_zimbra_smime.uploadInvalid,t,ZmMsg.errorCap)
}
);
this.isCertificateValid(t,n,o)
};
SMIMECertStore.prototype.getEchoUploadDialog=function(){
if(!this._echoUploadDialog){
this._echoUploadDialog=new SMIMEUploadEchoDialog(this._zimlethandler,appCtxt.getShell())
}
return this._echoUploadDialog
};
SMIMECertStore._storedCallbacks=[];
SMIMECertStore._storedCount=0;
SMIMECertStore.store=function(t){
if(t instanceof AjxCallback){
var e=SMIMECertStore._storedCount++;
SMIMECertStore._storedCallbacks[e]=t;
return e
}
return null
};
SMIMECertStore.callStore=function(o){
var t=SMIMECertStore._storedCallbacks[o];
if(t){
var e=Array.prototype.slice.call(arguments,1);
t.run.apply(t,e)
}};
var SMIMESanitizer={};
SMIMESanitizer.sanitize=function sanitize(e,o){
function s(r){
var l;
for(var h=0;
h<r.length;
h+=2){
if(r[h]==="href"){
l=r[h+1]
}}
html.sanitizeAttribs("a",r);
if(l){
r.push("href");
r.push(l);
r.push("target");
r.push("_blank")
}
return r
}
function t(r){
var l;
for(var h=0;
h<r.length;
h+=2){
if(r[h]==="src"){
l=r[h+1]
}}
html.sanitizeAttribs("img",r);
if(o&&l in o){
l=o[l]
}
if(l&&l.indexOf("data:image/")==0){
for(var h=0;
h<r.length;
h+=2){
if(r[h]==="src"){
r[h+1]=l
}}}
return r
}
function n(h,r){
if(!(html4.ELEMENTS[h]&html4.eflags.UNSAFE)){
if(h==="a"){
return s(r)
}
if(h==="img"){
return t(r)
}
return html.sanitizeAttribs(h,r)
}
return null
}
return html.sanitizeWithPolicy(e,n)
};
SMIMEDialog=function(e,r,o,s,t){
if(!arguments.length){
return
}
ZmDialog.call(this,{
parent:appCtxt.getShell(),className:"SMIME dialog",standardButtons:t}
);
this._controller=e;
this.handler=e.handler;
this.id="com_zimbra_smime_dialog_"+SMIMEDialog.counter++;
this.setTitle(r);
this._okListener=o;
this._cancelListener=s;
var n=new AjxListener(this,this._dialogSubmit);
var s=new AjxListener(this,this._dialogCancel);
if(this._button[DwtDialog.OK_BUTTON]){
this.setButtonListener(DwtDialog.OK_BUTTON,n)
}
if(this._button[DwtDialog.CANCEL_BUTTON]){
this.registerCallback(DwtDialog.CANCEL_BUTTON,s)
}
this.setEnterListener(n);
this._createContent();
this._initialize()
};
SMIMEDialog.prototype=new ZmDialog;
SMIMEDialog.prototype.constructor=SMIMEDialog;
SMIMEDialog.counter=0;
SMIMEDialog.prototype.toString=function(){
return"SMIMEDialog"
};
SMIMEDialog.prototype._dialogSubmit=function(){
var e;
if(this._okListener instanceof AjxCallback){
e=this._okListener.run()
}else{
if(AjxUtil.isFunction(this._okListener)){
e=this._okListener()
}}
if(e!==false){
this.popdown()
}};
SMIMEDialog.prototype._dialogCancel=function(){
this.popdown();
if(this._cancelListener instanceof AjxCallback){
this._cancelListener.run()
}else{
if(AjxUtil.isFunction(this._cancelListener)){
this._cancelListener()
}}};
SMIMEDialog.prototype.popup=function(e,t){
if(e){
this._okListener=e
}
if(t){
this._cancelListener=t
}
DwtDialog.prototype.popup.call(this);
if(this._focusElement){
appCtxt.getKeyboardMgr().grabFocus(this._focusElement)
}};
SMIMEDialog.prototype.clearContentElement=function(){
while(this._contentEl.hasChildNodes()){
this._contentEl.removeChild(this._contentEl.firstChild)
}};
SMIMEDialog.prototype.setContentElement=function(e){
this.clearContentElement();
this._contentEl.appendChild(e)
};
SMIMEDialog.prototype.getContentContainer=function(e){
return this._contentEl
};
SMIMEDialog.prototype._createContent=function(){
if(this.CONTENT_TEMPLATE){
this.setContent(AjxTemplate.expand(this.CONTENT_TEMPLATE,this._getTemplateData()))
}};
SMIMEDialog.prototype._getTemplateData=function(){
return{}
};
SMIMEDialog.prototype._initialize=function(){};
function SMIMEExceptionDialog(){}
SMIMEExceptionDialog.popup=function(m,e,d){
var r=appCtxt.getErrorDialog();
var o="";
if(typeof d=="string"){
o=d
}else{
if(d instanceof Object){
d.msg=d.msg||e;
var l=["method","msg","code","detail","trace","request","fileName","lineNumber","message","name","stack"];
var h=[],s=0;
h[s++]="<table>";
for(var n=0;
n<l.length;
n++){
var t=l[n];
var f=AjxStringUtil.htmlEncode(d[t]);
if(f){
if(t=="request"){
f=["<pre>",f,"</pre>"].join("");
var u=document.getElementById(r._msgCellId);
if(u){
u.className="DwtMsgDialog-wide"
}}
h[s++]=["<tr><td valign='top'>",l[n],":</td><td valign='top'>",f,"</td></tr>"].join("")
}}
h[s++]="</table>";
o=h.join("")
}}
r.registerCallback(DwtDialog.OK_BUTTON,SMIMEExceptionDialog.popdown);
r.setMessage(e,o,DwtMessageDialog.CRITICAL_STYLE,m);
r.popup(null,true)
};
SMIMEExceptionDialog.popdown=function(){
appCtxt.getErrorDialog().popdown()
};
SMIMEUploadEchoDialog=function(o,e,t){
if(!arguments.length){
return
}
this._handler=o;
ZmUploadDialog.call(this,e,t)
};
SMIMEUploadEchoDialog.__dummyProto=function(){};
SMIMEUploadEchoDialog.__dummyProto.prototype=appCtxt.getUploadDialog();
SMIMEUploadEchoDialog.prototype=new SMIMEUploadEchoDialog.__dummyProto();
SMIMEUploadEchoDialog.prototype.constructor=SMIMEUploadEchoDialog;
SMIMEUploadEchoDialog.prototype.toString=function(){
return"SMIMEUploadEchoDialog"
};
SMIMEUploadEchoDialog.prototype._createUploadHtml=function(){
var r=this._htmlElId;
var n=SMIMECertStore.store(new AjxCallback(this,this._receiveResponse));
var o=this._handler.getResource("jsp/echo.jsp?jsonp=window.parent.SMIMECertStore.callStore&jsonp_args="+n);
var t={
id:r,uri:o};
this.setContent(AjxTemplate.expand("share.Dialogs#UploadDialog",t));
this._uploadForm=document.getElementById((r+"_form"));
this._tableEl=document.getElementById((r+"_table"));
this._msgInfo=document.getElementById((r+"_msg"));
this._notes=document.getElementById((r+"_notes"));
this._selector=new DwtSelect({
parent:this}
);
this._selector.addOption(ZmMsg.uploadActionKeepMine,false,ZmUploadDialog.ACTION_KEEP_MINE);
this._selector.addOption(ZmMsg.uploadActionKeepTheirs,false,ZmUploadDialog.ACTION_KEEP_THEIRS);
this._selector.addOption(ZmMsg.uploadActionAsk,true,ZmUploadDialog.ACTION_ASK);
this._selector.reparentHtmlElement((r+"_conflict"));
var e=document.getElementById((r+"_info"));
if(e){
var s=AjxUtil.formatSize(appCtxt.get(ZmSetting.DOCUMENT_SIZE_LIMIT)||0,true);
e.innerHTML=AjxMessageFormat.format(ZmMsg.attachmentLimitMsg,s)
}};
SMIMEUploadEchoDialog.prototype._receiveResponse=function(e){
if(this._uploadCallback){
this._uploadCallback.run(e)
}};
CertificateView=function(e){
e.className=e.className||"DwtControl CertificateView";
DwtControl.call(this,e);
this._cert=e.cert;
this._status=e.status;
this._createHtmlFromTemplate(this.TEMPLATE,{
cert:this.getProcessedCert(),id:this.getHTMLElId()}
)
};
CertificateView.prototype=new DwtControl;
CertificateView.prototype.constructor=CertificateView;
CertificateView.prototype.toString=function(){
return"CertificateView"
};
CertificateView.prototype.TEMPLATE="com_zimbra_smime#Certificate";
CertificateView.prototype.EXPAND_CLASS="expanded";
CertificateView.prototype.getProcessedCert=function(){
var n={};
var s=AjxCallback.simpleClosure(this._getValue,this);
var o=function(u){
return com_zimbra_smime[u]||""
};
var l=n._summary_={};
l.imgClassName="CertificateValidImg";
l.header=SecureEmail.getSignerName(this._cert);
l.lines=[AjxMessageFormat.format(o("certSummaryIssuer"),s("issuer.cn")),AjxMessageFormat.format(o("certSummaryExpires"),s("not-after",CertificateView._formatDate))];
var t=o("certificate."+this._status);
l.statusMsg=!AjxUtil.isUndefined(t)?t:o("certificate.default");
l.statusClass=!AjxUtil.isUndefined(t)?this._status:"default";
var d=n[o("certSubject")]={};
d[o("certSubjectCN")]=s("subject.cn");
d[o("certSubjectCity")]=s("subject.city");
d[o("certSubjectCountry")]=s("subject.country");
d[o("certSubjectOrg")]=s("subject.org");
d[o("certSubjectOrgUnit")]=s("subject.orgunit");
d[o("certSubjectOtherName")]=s("subject.altnames.otherName");
d[o("certSubjectEmail")]=s("subject.altnames.rfc822Name");
d[o("certSubjectDNS")]=s("subject.altnames.dNSName");
d[o("certSubjectX400")]=s("subject.altnames.x400Address");
d[o("certSubjectDirectory")]=s("subject.altnames.directoryName");
d[o("certSubjectEDI")]=s("subject.altnames.ediPartyName");
d[o("certSubjectURI")]=s("subject.altnames.uniformResourceIdentifier");
d[o("certSubjectIP")]=s("subject.altnames.iPAddress");
d[o("certSubjectID")]=s("subject.altnames.registeredID");
var r=n[o("certIssuer")]={};
r[o("certIssuerCN")]=s("issuer.cn");
r[o("certIssuerCity")]=s("issuer.city");
r[o("certIssuerOrg")]=s("issuer.org");
r[o("certIssuerOrgUnit")]=s("issuer.orgunit");
r[o("certIssuerCountry")]=s("issuer.country");
var h=n[o("certValidity")]={};
h[o("certValidityBegin")]=s("not-before",CertificateView._formatDate);
h[o("certValidityEnd")]=s("not-after",CertificateView._formatDate);
var e=n[o("certInfo")]={};
e[o("certInfoSN")]=s("sn");
e[o("certInfoAlg")]=s("sigalg",CertificateView._formatAlgorithm);
CertificateView._removeEmptyLeaves(n);
return n
};
CertificateView.prototype._getValue=function(u,r){
var n=u.split(".");
var o=/([^\[]+)\[(\d)\]/;
try{
var l=this._cert;
for(var s=0;
s<n.length;
s++){
var t=n[s];
var d=o.exec(t);
if(d){
l=l[d[1]][d[2]]
}else{
l=l[t]
}}
return(AjxUtil.isFunction(r))?r(l):l
}
catch(h){}
return null
};
CertificateView.prototype.setMaxHeight=function(e){
var t=this.getHtmlElement().style;
if(AjxEnv.isIE){
t.setExpression("height","this.scrollHeight >= "+e+" ? '"+e+"px' : 'auto'")
}else{
t.maxHeight=e+"px"
}};
CertificateView._removeEmptyLeaves=function(o){
for(var e in o){
var t=o[e];
if(!t){
delete o[e]
}else{
if(AjxUtil.isObject(t)){
CertificateView._removeEmptyLeaves(t)
}}}};
CertificateView._formatDate=function(e){
return e&&AjxDateUtil.longComputeDateStr(new Date(e))
};
CertificateView._formatAlgorithm=function(e){
e=e.replace(/([A-Z])([a-z])/g,function(n,o,t){
return" "+n
}
);
e=e.replace(/([a-z])([A-Z])/g,function(n,o,t){
return o+" "+t
}
);
return e
};
CertificateUserView=function(e){
DwtComposite.call(this,e);
this._email=e.email;
this._name=e.name||e.email;
this._handler=e.handler;
this._createHtmlFromTemplate(this.TEMPLATE,{
id:this.getHTMLElId()}
);
this._toggleListener=AjxCallback.simpleClosure(this._toggleCertVisible,this);
this._initialize();
this._load()
};
CertificateUserView.prototype=new DwtComposite;
CertificateUserView.prototype.constructor=CertificateUserView;
CertificateUserView.prototype.TEMPLATE="com_zimbra_smime#CertificateUser";
CertificateUserView.prototype._initialize=function(){
var o=this.getHTMLElId();
var e=this._userLabel=new DwtLabel({
parent:this}
);
e.setText(AjxStringUtil.htmlEncode(this._name));
e.replaceElement(o+"_userLabel");
var t=this._expandButton=new DwtLabel({
parent:this,className:"Status"}
);
t.replaceElement(o+"_expandButton")
};
CertificateUserView.prototype._load=function(){
this._expandButton.setText(com_zimbra_smime.searchingCertificate);
this._expandButton.addClassName("Searching");
var e=new AjxCallback(this,this._handleLoad);
var t=new AjxCallback(this,this._handleLoadFailure);
this._handler.certstore.getCertificateForUser(this._email,e,t)
};
CertificateUserView.prototype._handleLoadFailure=function(e){
var t=this._expandButton;
t.delClassName("Searching");
t.setText(com_zimbra_smime.errorOccurred);
t.addClassName("NoCert");
t.clearHandler(DwtEvent.ONCLICK)
};
CertificateUserView.prototype._handleLoad=function(t){
var o=this._expandButton;
o.delClassName("Searching");
if(t){
o.setText(com_zimbra_smime.showCertificate);
o.addClassName("Expand");
if(this._certificateView){
this._certificateView.dispose()
}
var e=this._certificateView=new CertificateView({
parent:this,cert:t}
);
e.setVisible(false);
o.setHandler(DwtEvent.ONCLICK,this._toggleListener)
}else{
o.setText(com_zimbra_smime.noCertificateFound);
o.addClassName("NoCert");
o.clearHandler(DwtEvent.ONCLICK)
}};
CertificateUserView.prototype._toggleCertVisible=function(){
var e=!this._certificateView.getVisible();
this._certificateView.setVisible(e);
this._expandButton.setText(e?com_zimbra_smime.hideCertificate:com_zimbra_smime.showCertificate)
};
CertificateDialog=function(e){
if(!arguments.length){
return
}
SMIMEDialog.call(this,{
handler:e}
,e.getMessage("certificate"));
appCtxt.getShell().addControlListener(new AjxListener(this,this.shellSizeListener))
};
CertificateDialog.prototype=new SMIMEDialog;
CertificateDialog.prototype.constructor=CertificateDialog;
CertificateDialog.prototype.toString=function(){
return"CertificateDialog"
};
CertificateDialog.prototype.setCertificate=function(o,t){
var e=new CertificateView({
parent:this,cert:o,status:t}
);
this.setView(e);
this.shellSizeListener()
};
CertificateDialog.prototype.setView=function(n,e){
this.reset();
if(n){
var o=this._getContentDiv();
var t=n.getHtmlElement();
o.parentNode.replaceChild(t,o);
this._contentEl=t;
this._view=n
}};
CertificateDialog.prototype.shellSizeListener=function(){
if(this._view){
var e=appCtxt.getShell().getSize().y-200;
if(e<100){
e=100
}
this._view.setMaxHeight(e)
}};
SecurityPrefsPage=function(t,n,e,o){
if(!arguments.length){
return
}
this._handler=o;
ZmPreferencesPage.call(this,t,n,e)
};
SecurityPrefsPage.SECURITY=SMIME_MAIL_PREF_SECURITY;
SecurityPrefsPage.STORE="MAIL_SECURITY_STORE";
SecurityPrefsPage.CERTS="MAIL_SECURITY_CERTS";
SMIME_SECUREEMAIL_SETTINGS=[SecurityPrefsPage.SECURITY];
SecurityPrefsPage._loadListeners=[];
SecurityPrefsPage.registerSettings=function(n){
appCtxt.getSettings().registerSetting(SecurityPrefsPage.SECURITY,{
type:ZmSetting.T_PREF,dataType:ZmSetting.D_STRING,defaultValue:"auto"}
);
appCtxt.getSettings().registerSetting(SecurityPrefsPage.CERTS,{
type:ZmSetting.T_PREF,dataType:ZmSetting.D_NONE}
);
appCtxt.getSettings().registerSetting(SecurityPrefsPage.STORE,{
type:ZmSetting.T_PREF,dataType:ZmSetting.D_STRING}
);
var o=SMIME_SECUREEMAIL_SETTINGS;
for(var e=0;
e<o.length;
e++){
var t=appCtxt.getSettings().getSetting(o[e]);
t.setValue(n.getUserProperty(t.id))
}};
AjxDispatcher.addPackageLoadFunction("Preferences",new AjxCallback(function(){
SecurityPrefsPage.prototype=new ZmPreferencesPage;
SecurityPrefsPage.prototype.constructor=SecurityPrefsPage;
SecurityPrefsPage.prototype.toString=function(){
return"SecurityPrefsPage"
};
SecurityPrefsPage.registerPrefs=function(t){
var n=function(s){
return com_zimbra_smime[s]
};
ZmPref.registerPref(SecurityPrefsPage.SECURITY,{
displayContainer:ZmPref.TYPE_RADIO_GROUP,orientation:ZmPref.ORIENT_VERTICAL,displayOptions:[n("prefSecurityAuto"),n("prefSecurityNone"),n("prefSecuritySign"),n("prefSecurityBoth")],options:["auto","0","1","2"]}
);
ZmPref.registerPref(SecurityPrefsPage.STORE,{
displayContainer:ZmPref.TYPE_STATIC}
);
ZmPref.registerPref(SecurityPrefsPage.CERTS,{
displayContainer:ZmPref.TYPE_CUSTOM}
);
var o={
title:n("prefSection"),icon:"SecureEmail",templateId:"com_zimbra_smime#Preferences",priority:49,manageDirty:true,prefs:[ZmSetting[SecurityPrefsPage.SECURITY],ZmSetting[SecurityPrefsPage.STORE],ZmSetting[SecurityPrefsPage.CERTS]],createView:function(h,r,s){
return new SecurityPrefsPage(h,r,s,t)
}};
ZmPref.registerPrefSection("SECURITY",o)
};
SecurityPrefsPage.prototype.addCommand=function(t){
t.add(new AjxCallback(this,this._save));
t.size=function(){
return this.curId||this._cmds.length
}
};
SecurityPrefsPage.prototype._save=function(r){
var s=SMIME_SECUREEMAIL_SETTINGS;
var l=appCtxt.getSettings();
for(var t=0;
t<s.length;
t++){
var n=l.getSetting(s[t]);
var h=n.getValue();
this._handler.setUserProperty(n.id,h);
n.origValue=h
}
this._controller.setDirty(this._section.id,false);
if(r){
var o=AjxSoapDoc.create("NoOpRequest","urn:zimbraMail");
r.addRequestParams(o)
}
this._handler.saveUserProperties()
};
SecurityPrefsPage.prototype._setupCustom=function(n,t,o){
if(n==SecurityPrefsPage.CERTS){
this._certList=new DwtComposite({
parent:this}
);
setTimeout(AjxCallback.simpleClosure(this._loadCertificates,this),0);
return this._certList
}else{
return ZmPreferencesPage.prototype._setupCustom.call(this,n,t,o)
}};
SecurityPrefsPage.prototype._setupStatic=function(s,t,o){
if(s==SecurityPrefsPage.STORE){
var n=new DwtText({
parent:this,id:s}
);
this._handler.getActiveCertStore(new AjxCallback(function(r){
n.setText(r)
}
));
return n
}else{
return ZmPreferencesPage.prototype._setupStatic.apply(this,arguments)
}};
SecurityPrefsPage.prototype._loadCertificates=function(){
AjxDispatcher.require(["Mail","MailCore"]);
var n=appCtxt.getDataSourceCollection();
var o=appCtxt.accountList.visibleAccounts;
var h=[];
for(var r=0;
r<o.length;
r++){
var u=o[r];
if(u.active&&u.visible){
var m=appCtxt.getIdentityCollection(u).getIdentities(true);
for(var s=0;
s<m.length;
s++){
var d=m[s];
var t=new ZmComposeView()._getIdentityText(d);
var l=(d.isFromDataSource?n.getById(d.id).getEmail():d.sendFromAddress);
new CertificateUserView({
parent:this._certList,handler:this._handler,email:l,name:t}
)
}}}};
SecurityPrefsPage.prototype.setCerts=function(n){
if(this._certList){
delete this._pendingCerts;
this._certList.removeChildren();
for(var t=0;
t<n.length;
t++){
var o=new CertificateView({
parent:this._certList,cert:n[t]}
)
}}else{
this._pendingCerts=n
}};
for(var e=0;
e<SecurityPrefsPage._loadListeners.length;
e++){
SecurityPrefsPage._loadListeners[e].run()
}
delete SecurityPrefsPage._loadListeners
}
));
SecurityPrefsPage.init=function(t){
SecurityPrefsPage.registerSettings(t);
var e=new AjxCallback(function(){
SecurityPrefsPage.registerPrefs(t)
}
);
if(SecurityPrefsPage._loadListeners){
SecurityPrefsPage._loadListeners.push(e)
}else{
e.run()
}};
AjxTemplate.register("com_zimbra_smime#Preferences",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div align=right style='margin-right: 20px; margin-bottom: 10px;'><div id='";
e[o++]=s.id;
e[o++]="_REVERT_PAGE' tabindex='10' style='margin-right: 25px;'></div></div><table border=0 cellspacing=0 cellpadding=0 width=100%><tr class='ZOptionsHeaderRow'><td class='ZOptionsHeaderL'><div class='ImgPrefsHeader_L'></div></td><td class='ZOptionsHeader ImgPrefsHeader'>";
e[o++]=com_zimbra_smime.prefHeader;
e[o++]="</td><td class='ZOptionsHeaderR'><div class='ImgPrefsHeader_R'></div></td></tr></table><table class='ZOptionsSectionTable' border=0 cellspacing=0 cellpadding=0 width=100%><tr><td class='ZOptionsSectionMain'><table width=100%><tr><td class='ZOptionsLabelTop'>";
e[o++]=com_zimbra_smime.prefSign;
e[o++]="</td><td class='ZOptionsField'><div id='";
e[o++]=s.id;
e[o++]="_MAIL_SECURITY' tabindex='35'></div></td></tr><tr><td class='ZOptionsLabelTop'>";
e[o++]=com_zimbra_smime.prefStore;
e[o++]="</td><td class='ZOptionsField'><div id='";
e[o++]=s.id;
e[o++]="_MAIL_SECURITY_STORE'></div></td></tr><tr><td class='ZOptionsLabelTop'>";
e[o++]=com_zimbra_smime.prefCerts;
e[o++]="</td><td class='ZOptionsField'><div id='";
e[o++]=s.id;
e[o++]="_MAIL_SECURITY_CERTS' tabindex='37'></div></td></tr></table></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#Preferences"}
,true);
AjxPackage.define("com_zimbra_smime");
AjxTemplate.register("com_zimbra_smime",AjxTemplate.getTemplate("com_zimbra_smime#Preferences"),AjxTemplate.getParams("com_zimbra_smime#Preferences"));
AjxTemplate.register("com_zimbra_smime#CertificateUser",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table class='CertificateUser'><tr><td><div id='";
e[o++]=s.id;
e[o++]="_userLabel'></div></td><td><div id='";
e[o++]=s.id;
e[o++]="_expandButton'></div></td></tr><tr><td colspan='2'><div id='";
e[o++]=s.id;
e[o++]="_certificate'></div></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#CertificateUser"}
,true);
AjxTemplate.register("com_zimbra_smime#Certificate",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table id='";
e[o++]=s.id;
e[o++]="_table' class='Certificate'><tr><td id='";
e[o++]=s.id;
e[o++]="_summary'>";
e[o++]=AjxTemplate.expand("com_zimbra_smime#CertificateSummary",s);
e[o++]="</td></tr><tr><td id='";
e[o++]=s.id;
e[o++]="_details'>";
e[o++]=AjxTemplate.expand("com_zimbra_smime#CertificateDetails",s);
e[o++]="</td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#Certificate"}
,true);
AjxTemplate.register("com_zimbra_smime#CertificateSummary",function(t,h,r,e){
var s=Boolean(e);
r=(typeof r=="string"?{
id:r}
:r)||{};
e=e||[];
var n=e.length;
if(r.cert._summary_){
e[n++]="<table class='CertificateSummary'><tr><td class='SummaryImage' rowspan='100'><div class='";
e[n++]=r.cert._summary_.imgClassName;
e[n++]="'></div></td></tr><tr><td class='SummaryHeader'>";
e[n++]=r.cert._summary_.header;
e[n++]="</td></tr>";
for(var o=0;
o<r.cert._summary_.lines.length;
o++){
e[n++]="<tr><td class='SummaryLine'>";
e[n++]=r.cert._summary_.lines[o];
e[n++]="</td></tr>"
}
e[n++]="<tr><td class='StatusLine ";
e[n++]=r.cert._summary_.statusClass;
e[n++]="'>";
e[n++]=r.cert._summary_.statusMsg;
e[n++]="</td></tr></table>"
}
return s?e.length:e.join("")
}
,{
id:"com_zimbra_smime#CertificateSummary"}
,true);
AjxTemplate.register("com_zimbra_smime#CertificateDetails",function(e,t,l,r){
var o=Boolean(r);
l=(typeof l=="string"?{
id:l}
:l)||{};
r=r||[];
var n=r.length;
r[n++]="<table class='CertificateDetails'>";
for(var d in l.cert){
if(d!="_summary_"){
if(AjxUtil.isObject(l.cert[d])){
r[n++]="<tr><td class='Label1'>";
r[n++]=d;
r[n++]="</td><td><hr/></td></tr>";
for(var s in l.cert[d]){
if(AjxUtil.isArray(l.cert[d][s])){
for(var h=0;
h<l.cert[d][s].length;
h++){
r[n++]="<tr><td class='Label2'>";
r[n++]=(h==0)?s:"&nbsp;";
r[n++]="</td><td class='Value'>";
r[n++]=l.cert[d][s][h];
r[n++]="</td></tr>"
}}else{
r[n++]="<tr><td class='Label2'>";
r[n++]=s;
r[n++]="</td><td class='Value'>";
r[n++]=l.cert[d][s];
r[n++]="</td></tr>"
}}}else{
r[n++]="<tr><td class='Label1'>";
r[n++]=d;
r[n++]="</td><td class='Value'>";
r[n++]=l.cert[d];
r[n++]="</td></tr>"
}}}
r[n++]="</table>";
return o?r.length:r.join("")
}
,{
id:"com_zimbra_smime#CertificateDetails"}
,true);
AjxTemplate.register("com_zimbra_smime#EditContactCertRow",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]='<tr class="';
e[o++]=s.className;
e[o++]='" vAlign="top"><td class="rowLabel">';
e[o++]=com_zimbra_smime.certificateLabel;
e[o++]='</td><td><table cellspacing=\'6\' class="ZPropertySheet"><tr><td><div id="';
e[o++]=s.id;
e[o++]='_show"></div></td><td><div id="';
e[o++]=s.id;
e[o++]='_delete"></div></td><td><div id="';
e[o++]=s.id;
e[o++]='_upload"></div></td></tr></table></td></tr>';
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#EditContactCertRow"}
,true);
AjxTemplate.register("com_zimbra_smime#ShowContactCertRow",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]='<td class="rowLabel">';
e[o++]=com_zimbra_smime.certificateLabel;
e[o++]='</td><td id="';
e[o++]=s.id;
e[o++]='_certificate" class="rowValue"><a href="';
e[o++]=s.link;
e[o++]='">';
e[o++]=com_zimbra_smime.showCertificate;
e[o++]='</a></td><td style="color:gray" class="rowType">';
e[o++]=com_zimbra_smime.smimeCertificate;
e[o++]="</td>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#ShowContactCertRow"}
,true);
AjxTemplate.register("com_zimbra_smime#securityHeader",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]='<tr id="';
e[o++]=s.id;
e[o++]='" class=\'SMIMESecurityRow\'><td class="LabelColName">';
e[o++]=com_zimbra_smime.messageSecurityHeader;
e[o++]='</td><td class="LabelColValue"><span id="';
e[o++]=s.id;
e[o++]='" class="SMIMEHeader">';
e[o++]=s.info;
e[o++]="</span></td><td></td></tr>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#securityHeader"}
,true);
AjxTemplate.register("com_zimbra_smime#securityReplaceCert",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]='<tr id="';
e[o++]=s.id;
e[o++]='" class="rowLabel"><td colspan="2"  class="LabelColValue CertificateReplaceMsg"><span style="padding-right: 5px;">';
e[o++]=com_zimbra_smime.certReplaceMessage;
e[o++]='</span><a id="';
e[o++]=s.id;
e[o++]='-actionMsg" href="javascript:void(0);" notoggle="1">\n';
e[o++]="\t\t\t\t\t";
e[o++]=s.actionMsg;
e[o++]="\n";
e[o++]="\t\t\t\t</a></td></tr>";
return n?e.length:e.join("")
}
,{
id:"com_zimbra_smime#securityReplaceCert"}
,true);
var CSS_PROP_BIT_QUANTITY=1;
var CSS_PROP_BIT_HASH_VALUE=2;
var CSS_PROP_BIT_NEGATIVE_QUANTITY=4;
var CSS_PROP_BIT_QSTRING_CONTENT=8;
var CSS_PROP_BIT_QSTRING_URL=16;
var CSS_PROP_BIT_HISTORY_INSENSITIVE=32;
var CSS_PROP_BIT_Z_INDEX=64;
var cssSchema=(function(){
var t=["rgb(?:\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)|a\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0(?:\\.\\d+)?|\\.\\d+|1(?:\\.0+)?|0|\\d+(?:\\.\\d+)?%)) *\\)"],o=[/^ *$/i,RegExp("^ *(?:\\s*"+t[0]+"|(?:\\s*"+t[0]+")?)+ *$","i"),RegExp("^ *\\s*"+t[0]+" *$","i"),RegExp("^ *\\s*"+t[0]+"\\s*"+t[0]+" *$","i")],e=[["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],["all-scroll","col-resize","crosshair","default","e-resize","hand","help","move","n-resize","ne-resize","no-drop","not-allowed","nw-resize","pointer","progress","row-resize","s-resize","se-resize","sw-resize","text","vertical-text","w-resize","wait"],["-moz-inline-box","-moz-inline-stack","block","inline","inline-block","inline-table","list-item","run-in","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],["armenian","circle","decimal","decimal-leading-zero","disc","georgian","lower-alpha","lower-greek","lower-latin","lower-roman","square","upper-alpha","upper-latin","upper-roman"],["100","200","300","400","500","600","700","800","900","bold","bolder","lighter"],["condensed","expanded","extra-condensed","extra-expanded","narrower","semi-condensed","semi-expanded","ultra-condensed","ultra-expanded","wider"],["behind","center-left","center-right","far-left","far-right","left-side","leftwards","right-side","rightwards"],["large","larger","small","smaller","x-large","x-small","xx-large","xx-small"],["-moz-pre-wrap","-o-pre-wrap","-pre-wrap","nowrap","pre","pre-line","pre-wrap"],["dashed","dotted","double","groove","outset","ridge","solid"],["baseline","middle","sub","super","text-bottom","text-top"],["caption","icon","menu","message-box","small-caption","status-bar"],["fast","faster","slow","slower","x-fast","x-slow"],["above","below","higher","level","lower"],["border-box","contain","content-box","cover","padding-box"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["high","low","x-high","x-low"],["absolute","relative","static"],["capitalize","lowercase","uppercase"],["child","female","male"],["bidi-override","embed"],["bottom","top"],["clip","ellipsis"],["continuous","digits"],["hide","show"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["code"],["collapse"],["fixed"],["hidden"],["inherit"],["inset"],["invert"],["justify"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["transparent"],["visible"]];
return{
"-moz-border-radius":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[36]]}
,"-moz-border-radius-bottomleft":{
cssExtra:o[0],cssPropBits:5}
,"-moz-border-radius-bottomright":{
cssExtra:o[0],cssPropBits:5}
,"-moz-border-radius-topleft":{
cssExtra:o[0],cssPropBits:5}
,"-moz-border-radius-topright":{
cssExtra:o[0],cssPropBits:5}
,"-moz-box-shadow":{
cssExtra:o[1],cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[e[0],e[35],e[48],e[54]]}
,"-moz-opacity":{
cssPropBits:1,cssLitGroup:[e[47]]}
,"-moz-outline":{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[49],e[52],e[54]]}
,"-moz-outline-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[49]]}
,"-moz-outline-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"-moz-outline-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,"-o-text-overflow":{
cssPropBits:0,cssLitGroup:[e[25]]}
,"-webkit-border-bottom-left-radius":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-bottom-right-radius":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-radius":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[36]]}
,"-webkit-border-radius-bottom-left":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-radius-bottom-right":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-radius-top-left":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-radius-top-right":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-top-left-radius":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-border-top-right-radius":{
cssExtra:o[0],cssPropBits:5}
,"-webkit-box-shadow":{
cssExtra:o[1],cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[e[0],e[35],e[48],e[54]]}
,azimuth:{
cssPropBits:5,cssLitGroup:[e[6],e[30],e[42],e[47]]}
,background:{
cssExtra:RegExp("^ *(?:\\s*"+t[0]+"){0,2} *$","i"),cssPropBits:23,cssLitGroup:[e[0],e[14],e[17],e[24],e[30],e[35],e[36],e[38],e[42],e[45],e[47],e[51],e[54],e[57],e[58],e[62]]}
,"background-attachment":{
cssExtra:o[0],cssPropBits:0,cssLitGroup:[e[35],e[45],e[51],e[58]]}
,"background-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"background-image":{
cssExtra:o[0],cssPropBits:16,cssLitGroup:[e[35],e[54]]}
,"background-position":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[24],e[30],e[35],e[42]]}
,"background-repeat":{
cssExtra:o[0],cssPropBits:0,cssLitGroup:[e[17],e[35],e[57]]}
,border:{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[52],e[54],e[62]]}
,"border-bottom":{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[52],e[54],e[62]]}
,"border-bottom-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"border-bottom-left-radius":{
cssExtra:o[0],cssPropBits:5}
,"border-bottom-right-radius":{
cssExtra:o[0],cssPropBits:5}
,"border-bottom-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"border-bottom-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,"border-collapse":{
cssPropBits:0,cssLitGroup:[e[44],e[47],e[59]]}
,"border-color":{
cssExtra:RegExp("^ *(?:\\s*"+t[0]+"){1,4} *$","i"),cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"border-left":{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[52],e[54],e[62]]}
,"border-left-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"border-left-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"border-left-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,"border-radius":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[36]]}
,"border-right":{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[52],e[54],e[62]]}
,"border-right-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"border-right-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"border-right-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,"border-spacing":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[47]]}
,"border-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"border-top":{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[52],e[54],e[62]]}
,"border-top-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[62]]}
,"border-top-left-radius":{
cssExtra:o[0],cssPropBits:5}
,"border-top-right-radius":{
cssExtra:o[0],cssPropBits:5}
,"border-top-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"border-top-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,"border-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,bottom:{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"box-shadow":{
cssExtra:o[1],cssPropBits:7,cssLitGroup:[e[0],e[35],e[48],e[54]]}
,"caption-side":{
cssPropBits:0,cssLitGroup:[e[24],e[47]]}
,clear:{
cssPropBits:0,cssLitGroup:[e[30],e[40],e[47],e[54]]}
,clip:{
cssExtra:/^ *\s*rect\(\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto) *\) *$/i,cssPropBits:0,cssLitGroup:[e[38],e[47]]}
,color:{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47]]}
,content:{
cssPropBits:0}
,"counter-increment":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[47],e[54]]}
,"counter-reset":{
cssExtra:o[0],cssPropBits:5,cssLitGroup:[e[47],e[54]]}
,cue:{
cssPropBits:16,cssLitGroup:[e[47],e[54]]}
,"cue-after":{
cssPropBits:16,cssLitGroup:[e[47],e[54]]}
,"cue-before":{
cssPropBits:16,cssLitGroup:[e[47],e[54]]}
,cursor:{
cssExtra:o[0],cssPropBits:16,cssLitGroup:[e[1],e[35],e[38],e[47]]}
,direction:{
cssPropBits:0,cssLitGroup:[e[31],e[47]]}
,display:{
cssPropBits:32,cssLitGroup:[e[2],e[47],e[54]]}
,elevation:{
cssPropBits:5,cssLitGroup:[e[13],e[47]]}
,"empty-cells":{
cssPropBits:0,cssLitGroup:[e[27],e[47]]}
,filter:{
cssExtra:/^ *(?:\s*alpha\(\s*opacity\s*=\s*(?:0|\d+(?:\.\d+)?%|[+\-]?\d+(?:\.\d+)?) *\))+ *$/i,cssPropBits:32}
,"float":{
cssAlternates:["cssFloat","styleFloat"],cssPropBits:32,cssLitGroup:[e[30],e[47],e[54]]}
,font:{
cssExtra:o[0],cssPropBits:9,cssLitGroup:[e[4],e[7],e[11],e[15],e[29],e[35],e[36],e[47],e[52],e[55],e[60]]}
,"font-family":{
cssExtra:o[0],cssPropBits:8,cssLitGroup:[e[15],e[35],e[47]]}
,"font-size":{
cssPropBits:1,cssLitGroup:[e[7],e[47],e[52]]}
,"font-stretch":{
cssPropBits:0,cssLitGroup:[e[5],e[55]]}
,"font-style":{
cssPropBits:0,cssLitGroup:[e[29],e[47],e[55]]}
,"font-variant":{
cssPropBits:0,cssLitGroup:[e[47],e[55],e[60]]}
,"font-weight":{
cssPropBits:0,cssLitGroup:[e[4],e[47],e[55]]}
,height:{
cssPropBits:37,cssLitGroup:[e[38],e[47]]}
,left:{
cssPropBits:37,cssLitGroup:[e[38],e[47]]}
,"letter-spacing":{
cssPropBits:5,cssLitGroup:[e[47],e[55]]}
,"line-height":{
cssPropBits:1,cssLitGroup:[e[47],e[55]]}
,"list-style":{
cssPropBits:16,cssLitGroup:[e[3],e[28],e[47],e[54]]}
,"list-style-image":{
cssPropBits:16,cssLitGroup:[e[47],e[54]]}
,"list-style-position":{
cssPropBits:0,cssLitGroup:[e[28],e[47]]}
,"list-style-type":{
cssPropBits:0,cssLitGroup:[e[3],e[47],e[54]]}
,margin:{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"margin-bottom":{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"margin-left":{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"margin-right":{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"margin-top":{
cssPropBits:5,cssLitGroup:[e[38],e[47]]}
,"max-height":{
cssPropBits:1,cssLitGroup:[e[38],e[47],e[54]]}
,"max-width":{
cssPropBits:1,cssLitGroup:[e[38],e[47],e[54]]}
,"min-height":{
cssPropBits:1,cssLitGroup:[e[38],e[47]]}
,"min-width":{
cssPropBits:1,cssLitGroup:[e[38],e[47]]}
,opacity:{
cssPropBits:33,cssLitGroup:[e[47]]}
,outline:{
cssExtra:o[3],cssPropBits:7,cssLitGroup:[e[0],e[9],e[34],e[46],e[47],e[48],e[49],e[52],e[54]]}
,"outline-color":{
cssExtra:o[2],cssPropBits:2,cssLitGroup:[e[0],e[47],e[49]]}
,"outline-style":{
cssPropBits:0,cssLitGroup:[e[9],e[46],e[47],e[48],e[54]]}
,"outline-width":{
cssPropBits:5,cssLitGroup:[e[34],e[47],e[52]]}
,overflow:{
cssPropBits:32,cssLitGroup:[e[38],e[46],e[47],e[58],e[63]]}
,"overflow-x":{
cssPropBits:0,cssLitGroup:[e[32],e[38],e[46],e[58],e[63]]}
,"overflow-y":{
cssPropBits:0,cssLitGroup:[e[32],e[38],e[46],e[58],e[63]]}
,padding:{
cssPropBits:1,cssLitGroup:[e[47]]}
,"padding-bottom":{
cssPropBits:33,cssLitGroup:[e[47]]}
,"padding-left":{
cssPropBits:33,cssLitGroup:[e[47]]}
,"padding-right":{
cssPropBits:33,cssLitGroup:[e[47]]}
,"padding-top":{
cssPropBits:33,cssLitGroup:[e[47]]}
,"page-break-after":{
cssPropBits:0,cssLitGroup:[e[30],e[37],e[38],e[39],e[47]]}
,"page-break-before":{
cssPropBits:0,cssLitGroup:[e[30],e[37],e[38],e[39],e[47]]}
,"page-break-inside":{
cssPropBits:0,cssLitGroup:[e[38],e[39],e[47]]}
,pause:{
cssPropBits:5,cssLitGroup:[e[47]]}
,"pause-after":{
cssPropBits:5,cssLitGroup:[e[47]]}
,"pause-before":{
cssPropBits:5,cssLitGroup:[e[47]]}
,pitch:{
cssPropBits:5,cssLitGroup:[e[19],e[47],e[52]]}
,"pitch-range":{
cssPropBits:5,cssLitGroup:[e[47]]}
,"play-during":{
cssExtra:o[0],cssPropBits:16,cssLitGroup:[e[38],e[47],e[53],e[54],e[57]]}
,position:{
cssPropBits:32,cssLitGroup:[e[20],e[47]]}
,quotes:{
cssExtra:o[0],cssPropBits:0,cssLitGroup:[e[47],e[54]]}
,richness:{
cssPropBits:5,cssLitGroup:[e[47]]}
,right:{
cssPropBits:37,cssLitGroup:[e[38],e[47]]}
,speak:{
cssPropBits:0,cssLitGroup:[e[47],e[54],e[55],e[61]]}
,"speak-header":{
cssPropBits:0,cssLitGroup:[e[37],e[47],e[56]]}
,"speak-numeral":{
cssPropBits:0,cssLitGroup:[e[26],e[47]]}
,"speak-punctuation":{
cssPropBits:0,cssLitGroup:[e[43],e[47],e[54]]}
,"speech-rate":{
cssPropBits:5,cssLitGroup:[e[12],e[47],e[52]]}
,stress:{
cssPropBits:5,cssLitGroup:[e[47]]}
,"table-layout":{
cssPropBits:0,cssLitGroup:[e[38],e[45],e[47]]}
,"text-align":{
cssPropBits:0,cssLitGroup:[e[30],e[42],e[47],e[50]]}
,"text-decoration":{
cssPropBits:0,cssLitGroup:[e[18],e[47],e[54]]}
,"text-indent":{
cssPropBits:5,cssLitGroup:[e[47]]}
,"text-overflow":{
cssPropBits:0,cssLitGroup:[e[25]]}
,"text-shadow":{
cssExtra:o[1],cssPropBits:7,cssLitGroup:[e[0],e[35],e[48],e[54]]}
,"text-transform":{
cssPropBits:0,cssLitGroup:[e[21],e[47],e[54]]}
,"text-wrap":{
cssPropBits:0,cssLitGroup:[e[33],e[54],e[55]]}
,top:{
cssPropBits:37,cssLitGroup:[e[38],e[47]]}
,"unicode-bidi":{
cssPropBits:0,cssLitGroup:[e[23],e[47],e[55]]}
,"vertical-align":{
cssPropBits:5,cssLitGroup:[e[10],e[24],e[47]]}
,visibility:{
cssPropBits:32,cssLitGroup:[e[44],e[46],e[47],e[63]]}
,"voice-family":{
cssExtra:o[0],cssPropBits:8,cssLitGroup:[e[22],e[35],e[47]]}
,volume:{
cssPropBits:1,cssLitGroup:[e[16],e[47],e[52]]}
,"white-space":{
cssPropBits:0,cssLitGroup:[e[8],e[47],e[55]]}
,width:{
cssPropBits:33,cssLitGroup:[e[38],e[47]]}
,"word-spacing":{
cssPropBits:5,cssLitGroup:[e[47],e[55]]}
,"word-wrap":{
cssPropBits:0,cssLitGroup:[e[41],e[55]]}
,"z-index":{
cssPropBits:69,cssLitGroup:[e[38],e[47]]}
,zoom:{
cssPropBits:1,cssLitGroup:[e[55]]}}
}
)();
var lexCss,decodeCss;
(function(){
function z(S){
var W=parseInt(S.substring(1),16);
if(W>65535){
return W-=65536,String.fromCharCode(55296+(W>>10),56320+(W&1023))
}else{
if(W==W){
return String.fromCharCode(W)
}else{
if(S[1]<" "){
return""
}else{
return S[1]
}}}}
function L(S,W){
return'"'+S.replace(/[\u0000-\u001f\\"<>]/g,W)+'"'
}
function q(W){
return j[W]||(j[W]="\\"+W.charCodeAt(0).toString(16)+" ")
}
function o(W){
return O[W]||(O[W]=(W<"\x10"?"%0":"%")+W.charCodeAt(0).toString(16))
}
var j={
"\\":"\\\\"};
var O={
"\\":"%5c"};
var Z="[\\t\\n\\f ]";
var s=Z+"*";
var E="[\\n\\f]";
var b="[\\ud800-\\udbff][\\udc00-\\udfff]";
var A="[\\u0080-\\ud7ff\\ue000-\\ufffd]|"+b;
var U="[0-9a-fA-F]{1,6}"+Z+"?";
var X="\\\\"+U;
var f="(?:"+U+"|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|"+b+")";
var e="\\\\"+f;
var P="(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|"+A+"|"+e+")";
var C="[^'\"\\n\\f\\\\]|\\\\[\\s\\S]";
var J="\"(?:'|"+C+')*"|\'(?:"|'+C+")*'";
var x="[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)";
var B="(?:[a-zA-Z_]|"+A+"|"+e+")";
var y="(?:[a-zA-Z0-9_-]|"+A+"|"+e+")";
var R=y+"+";
var F="-?"+B+y+"*";
var N="@"+F;
var p="#"+R;
var D=x;
var T="(?:@?-?"+B+"|#)"+y+"*";
var V=x+"%";
var m=x+F;
var u=x+"(?:%|"+F+")?";
var M="url[(]"+s+"(?:"+J+"|"+P+"*)"+s+"[)]";
var Q="U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?";
var g="<!--";
var v="-->";
var l=Z+"+";
var d="/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)";
var t="(?!url[(])"+F+"[(]";
var w="~=";
var H="[|]=";
var Y="[^]=";
var n="[$]=";
var h="[*]=";
var K="[~|^$*]=";
var r="[^\"'\\\\/]|/(?![/*])";
var G="\\uFEFF";
var I=new RegExp([G,Q,M,t,T,J,u,g,v,l,d,K,r].join("|"),"gi");
decodeCss=function(W){
return W.replace(new RegExp("\\\\(?:"+f+"|"+E+")","g"),z)
};
lexCss=function(_e){
_e=""+_e;
var _o=_e.replace(/\r\n?/g,"\n").match(I)||[];
var _t=0;
var _n=" ";
for(var _a=0,W=_o.length;
_a<W;
++_a){
var _s=decodeCss(_o[_a]);
var _i=_s.length;
var S=_s.charCodeAt(0);
_s=(S=='"'.charCodeAt(0)||S=="'".charCodeAt(0))?L(_s.substring(1,_i-1),q):(S=="/".charCodeAt(0)&&_i>1||_s=="\\"||_s==v||_s==g||_s=="\ufeff"||S<=" ".charCodeAt(0))?" ":/url\(/i.test(_s)?"url("+L(_s.replace(new RegExp("^url\\("+s+"[\"']?|[\"']?"+s+"\\)$","gi"),""),o)+")":_s;
if(_n!=_s||_s!=" "){
_o[_t++]=_n=_s
}}
_o.length=_t;
return _o
}
}
)();
var sanitizeCssProperty=(function(){
var n=/[\n\f\r\"\'()*<>]/g;
var o={
"\n":"%0a","\f":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"};
function s(l){
if("string"===typeof l){
return'url("'+l.replace(n,t)+'")'
}else{
return'url("about:blank")'
}}
function t(l){
return o[l]
}
function e(u){
var f={};
for(var m=u.length;
--m>=0;
){
var l=u[m];
for(var d=l.length;
--d>=0;
){
f[l[d]]=r
}}
return f
}
function h(u,p){
var m=1,l=p+1,f=u.length;
while(l<f&&m){
var d=u[l++];
m+=(d==="("?1:d===")"?-1:0)
}
return l
}
var r={};
return function(g,w,b){
var u=g.cssPropBits;
var f=u&(CSS_PROP_BIT_QSTRING_CONTENT|CSS_PROP_BIT_QSTRING_URL);
var O=NaN;
var y=0,p=0;
for(;
y<w.length;
++y){
var d=w[y].toLowerCase();
var l=d.charCodeAt(0),T,z,j,q,m;
var v,x;
d=((l===" ".charCodeAt(0))?"":(l==='"'.charCodeAt(0))?((f===CSS_PROP_BIT_QSTRING_URL&&b)?(s(b(decodeCss(w[y].substring(1,d.length-1))))):(f===CSS_PROP_BIT_QSTRING_CONTENT)?d:""):(l==="#".charCodeAt(0)&&/^#(?:[0-9a-f]{3}){1,2}$/.test(d))?(u&CSS_PROP_BIT_HASH_VALUE?d:""):("0".charCodeAt(0)<=l&&l<="9".charCodeAt(0))?((u&CSS_PROP_BIT_QUANTITY)?((u&CSS_PROP_BIT_Z_INDEX)?(d.match(/^\d{1,7}$/)?d:""):d):""):(T=d.charCodeAt(1),z=d.charCodeAt(2),j="0".charCodeAt(0)<=T&&T<="9".charCodeAt(0),q="0".charCodeAt(0)<=z&&z<="9".charCodeAt(0),(l==="+".charCodeAt(0)&&(j||(T===".".charCodeAt(0)&&q))))?((u&CSS_PROP_BIT_QUANTITY)?((u&CSS_PROP_BIT_Z_INDEX)?(d.match(/^\+\d{1,7}$/)?d:""):((j?"":"0")+d.substring(1))):""):(l==="-".charCodeAt(0)&&(j||(T===".".charCodeAt(0)&&q)))?((u&CSS_PROP_BIT_NEGATIVE_QUANTITY)?((u&CSS_PROP_BIT_Z_INDEX)?(d.match(/^\-\d{1,7}$/)?d:""):((j?"-":"-0")+d.substring(1))):((u&CSS_PROP_BIT_QUANTITY)?"0":"")):(l===".".charCodeAt(0)&&j)?((u&CSS_PROP_BIT_QUANTITY)?"0"+d:""):("url("===d.substring(0,4))?((b&&(f&CSS_PROP_BIT_QSTRING_URL))?s(b(w[y].substring(5,d.length-2))):""):((d.charAt(d.length-1)==="(")&&(m=h(w,y),w.splice(y,m-y,d=w.slice(y,m).join(" "))),v=g.cssLitGroup,x=(v?(g.cssLitMap||(g.cssLitMap=e(v))):r),(x[d]===r||g.cssExtra&&g.cssExtra.test(d)))?d:(/^\w+$/.test(d)&&(f===CSS_PROP_BIT_QSTRING_CONTENT))?(O+1===p?(w[O]=w[O].substring(0,w[O].length-1)+" "+d+'"',d=""):(O=p,'"'+d+'"')):"");
if(d){
w[p++]=d
}}
w.length=p
}
}
)();
function sanitizeCssSelectors(o){
var h=[];
var s=[];
var e=0,t;
for(t=0;
t<o.length;
++t){
if(!(o[t]==" "&&(o[t-1]==">"||o[t+1]==">"))){
o[e++]=o[t]
}}
o.length=e;
var d=o.length,l=0;
for(t=0;
t<d;
++t){
if(o[t]==","){
r(l,t);
l=t+1
}}
r(l,d);
function r(u,f){
var w=false;
if(o[u]===" "){
++u
}
if(f-1!==u&&o[f]===" "){
--f
}
var p=[];
var y=u;
var m="";
for(var g=u;
g<f;
++g){
var v=o[g];
var n=(v===">");
if(n||v===" "){
m=b(y,g,false);
if(!m||(n&&/^html/i.test(m))){
return
}
y=g+1;
p.push(m,n?" > ":" ")
}}
m=b(y,f,true);
if(!m){
return
}
p.push(m);
function b(x,z,B){
var q=x,j=z;
var T,A,W,C,O;
T="";
if(x<z){
C=o[x].toLowerCase();
if(C==="*"||(C==="html"&&!B)||(C==="body"&&x+1!==z&&!B)||("number"===typeof(O=html4.ELEMENTS[C])&&!(O&html4.eflags.UNSAFE))){
++x;
T=C
}}
A="";
while(x<z){
C=o[x];
if(C.charAt(0)==="#"){
if(/^#_|__$|[^#0-9A-Za-z:_\-]/.test(C)){
return null
}
A+=C
}else{
if(C==="."){
if(++x<z&&/^[0-9A-Za-z:_\-]+$/.test(C=o[x])&&!/^_|__$/.test(C)){
A+="."+C
}else{
return null
}}else{
break
}}
++x
}
W="";
if(x<z&&o[x]===":"){
C=o[++x];
if(C==="visited"||C==="link"){
if(!/^[a*]?$/.test(T)){
return null
}
w=true;
W=":"+C;
T="a";
++x
}}
if(x===z){
return T+A+W
}
return null
}
(w?h:s).push(p.join(""))
}
return[s,h]
}
var sanitizeStylesheet=(function(){
var t={};
var e={
braille:t,embossed:t,handheld:t,print:t,projection:t,screen:t,speech:t,tty:t,tv:t};
function o(n){
return"{}"
}
return function(h){
var l=void 0;
var s=[];
var r=false;
parseCssStylesheet(h,{
startStylesheet:function(){
l=[]
}
,endStylesheet:function(){}
,startAtrule:function(u,d){
if(r){
u=null
}else{
if(u==="@media"){
d=d.filter(function(m){
return e[m]==t
}
);
if(d.length){
l.push(u,d.join(","),"{")
}else{
u=null
}}else{
if(u==="@import"){
if("undefined"!==typeof console){
console.log("@import "+d.join(" ")+" elided")
}}
u=null
}}
r=!u;
s.push(u)
}
,endAtrule:function(){
var d=s.pop();
if(!r){
l.push(";")
}
n()
}
,startBlock:function(){
if(!r){
l.push("{")
}}
,endBlock:function(){
if(!r){
l.push("}");
r=true
}}
,startRuleset:function(g){
var f=void 0;
var p=false;
if(!r){
var u=sanitizeCssSelectors(g);
var m=u[0];
f=u[1];
if(!m.length&&!f.length){
r=true
}else{
var d=m.join(", ");
if(!d){
d="head > html";
p=true
}
l.push(d,"{")
}}
s.push(r?null:{
historySensitiveSelectors:f,endOfSelectors:l.length-1,removeHistoryInsensitiveSelectors:p}
)
}
,endRuleset:function(){
var f=s.pop();
var m=l.length;
if(!r){
l.push("}");
if(f){
var u=f.historySensitiveSelectors;
if(u.length){
var d=l.slice(f.endOfSelectors);
l.push(u.join(", "),o(d))
}}}
if(f&&f.removeHistoryInsensitiveSelectors){
l.splice(f.endOfSelectors-1,m+1)
}
n()
}
,declaration:function(f,u){
if(!r){
var m=cssSchema[f];
var d=void 0;
if(m){
sanitizeCssProperty(m,u,d);
if(u.length){
l.push(f,":",u.join(" "),";")
}}}}}
);
function n(){
r=s.length!==0&&s[s.length-1]!==null
}
return l.join("")
}
}
)();
var parseCssStylesheet;
var parseCssDeclarations;
(function(){
parseCssStylesheet=function(u,d){
var f=lexCss(u);
if(d.startStylesheet){
d.startStylesheet()
}
for(var l=0,m=f.length;
l<m;
){
l=f[l]===" "?l+1:n(f,l,m,d)
}
if(d.endStylesheet){
d.endStylesheet()
}};
function n(f,d,m,u){
if(d<m){
var l=f[d];
if(l.charAt(0)==="@"){
return o(f,d,m,u,true)
}else{
return t(f,d,m,u)
}}else{
return d
}}
function o(y,l,g,m,u){
var p=l++;
while(l<g&&y[l]!=="{"&&y[l]!==";"){
++l
}
if(l<g&&(u||y[l]===";")){
var d=p+1,f=l;
if(d<g&&y[d]===" "){
++d
}
if(f>d&&y[f-1]===" "){
--f
}
if(m.startAtrule){
m.startAtrule(y[p].toLowerCase(),y.slice(d,f))
}
l=(y[l]==="{")?r(y,l,g,m):l+1;
if(m.endAtrule){
m.endAtrule()
}}
return l
}
function r(f,l,m,u){
++l;
if(u.startBlock){
u.startBlock()
}
while(l<m){
var d=f[l].charAt(0);
if(d=="}"){
++l;
break
}
if(d===" "||d===";"){
l=l+1
}else{
if(d==="@"){
l=o(f,l,m,u,false)
}else{
if(d==="{"){
l=r(f,l,m,u)
}else{
l=t(f,l,m,u)
}}}}
if(u.endBlock){
u.endBlock()
}
return l
}
function t(g,d,p,m){
var u=d,f=e(g,d,p,true);
if(f<0){
f=~f;
return d===f?f+1:f
}
d=f;
if(f>u&&g[f-1]===" "){
--f
}
var l=g[d];
++d;
if(l!=="{"){
return d
}
if(m.startRuleset){
m.startRuleset(g.slice(u,f))
}
while(d<p){
l=g[d];
if(l==="}"){
++d;
break
}
if(l===" "){
d=d+1
}else{
d=h(g,d,p,m)
}}
if(m.endRuleset){
m.endRuleset()
}
return d<p?d+1:d
}
function e(y,d,g,p){
var u=d;
var l;
var f=[],m=-1;
for(;
d<g;
++d){
l=y[d].charAt(0);
if(l==="["||l==="("){
f[++m]=l
}else{
if((l==="]"&&f[m]==="[")||(l===")"&&f[m]==="(")){
--m
}else{
if(l==="{"||l==="}"||l===";"||l==="@"||(l===":"&&!p)){
break
}}}}
if(m>=0){
d=~(d+1)
}
return d
}
var s=/^-?[a-z]/i;
function h(p,u,l,b){
var y=p[u++];
if(!s.test(y)){
return u+1
}
var w;
if(u<l&&p[u]===" "){
++u
}
if(u==l||p[u]!==":"){
while(u<l&&(w=p[u])!==";"&&w!=="}"){
++u
}
return u
}
++u;
if(u<l&&p[u]===" "){
++u
}
var v=u,m=e(p,u,l);
if(m<0){
m=~m
}else{
var g=[],f=0;
for(var d=v;
d<m;
++d){
w=p[d];
if(w!==" "){
g[f++]=w
}}
if(m<l){
do{
w=p[m];
if(w===";"||w==="}"){
break
}
f=0
}
while(m<l);
if(w===";"){
++m
}}
if(f&&b.declaration){
b.declaration(y.toLowerCase(),g)
}}
return m
}
parseCssDeclarations=function(u,d){
var f=lexCss(u);
for(var l=0,m=f.length;
l<m;
){
l=f[l]!==" "?h(f,l,m,d):l+1
}}
}
)();
var html4={};
html4.atype={
NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10};
html4.ATTRIBS={
"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0};
html4.eflags={
OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128};
html4.ELEMENTS={
a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nav:0,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0};
html4.ueffects={
NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};
html4.URIEFFECTS={
"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0};
html4.ltypes={
UNSANDBOXED:2,SANDBOXED:1,DATA:0};
html4.LOADERTYPES={
"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};
var html=(function(f){
var t;
if("script"==="SCRIPT".toLowerCase()){
t=function(D){
return D.toLowerCase()
}
}else{
t=function(D){
return D.replace(/[A-Z]/g,function(S){
return String.fromCharCode(S.charCodeAt(0)|32)
}
)
}
}
var v={
lt:"<",gt:">",amp:"&",nbsp:"\240",quot:'"',apos:"'"};
var b=/^(?:https?|mailto)$/i;
var g=/^#(\d+)$/;
var A=/^#x([0-9A-Fa-f]+)$/;
function d(S){
S=t(S);
if(v.hasOwnProperty(S)){
return v[S]
}
var D=S.match(g);
if(D){
return String.fromCharCode(parseInt(D[1],10))
}else{
if(!!(D=S.match(A))){
return String.fromCharCode(parseInt(D[1],16))
}}
return""
}
function o(S,D){
return d(D)
}
var j=/\0/g;
function p(D){
return D.replace(j,"")
}
var T=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g;
function r(D){
return D.replace(T,o)
}
var q=/&/g;
var C=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;
var e=/</g;
var h=/>/g;
var y=/\"/g;
function l(D){
return(""+D).replace(q,"&amp;").replace(e,"&lt;").replace(h,"&gt;").replace(y,"&#34;")
}
function m(D){
return D.replace(C,"&amp;$1").replace(e,"&lt;").replace(h,"&gt;")
}
var W=new RegExp("^\\s*(?:"+("(?:([a-z][a-z-]*)"+("(\\s*=\\s*"+("(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*)")+")")+"?)")+"|(/?>)|[\\s\\S][^a-z\\s>]*)","i");
var B=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i");
function w(D){
return function S(N,G){
N=String(N);
var P=null;
var R=false;
var F=[];
var H=void 0;
var I=void 0;
var M=void 0;
if(D.startDoc){
D.startDoc(G)
}
while(N){
var E=N.match(R?W:B);
N=N.substring(E[0].length);
if(R){
if(E[1]){
var Y=t(E[1]);
var J;
if(E[2]){
var L=E[3];
switch(L.charCodeAt(0)){
case 34:case 39:L=L.substring(1,L.length-1);
break
}
J=r(p(L))
}else{
J=Y
}
F.push(Y,J)
}else{
if(E[4]){
if(I!==void 0){
if(M){
if(D.startTag){
D.startTag(H,F,G)
}}else{
if(D.endTag){
D.endTag(H,G)
}}}
if(M&&(I&(f.eflags.CDATA|f.eflags.RCDATA))){
if(P===null){
P=t(N)
}else{
P=P.substring(P.length-N.length)
}
var U=P.indexOf("</"+H);
if(U<0){
U=N.length
}
if(U){
if(I&f.eflags.CDATA){
if(D.cdata){
D.cdata(N.substring(0,U),G)
}}else{
if(D.rcdata){
D.rcdata(m(N.substring(0,U)),G)
}}
N=N.substring(U)
}}
H=I=M=void 0;
F.length=0;
R=false
}}}else{
if(E[1]){
if(D.pcdata){
D.pcdata(E[0],G)
}}else{
if(E[3]){
M=!E[2];
R=true;
H=t(E[3]);
I=f.ELEMENTS.hasOwnProperty(H)?f.ELEMENTS[H]:void 0
}else{
if(E[4]){
if(D.pcdata){
D.pcdata(E[4],G)
}}else{
if(E[5]){
if(D.pcdata){
switch(E[5]){
case"<":D.pcdata("&lt;",G);
break;
case">":D.pcdata("&gt;",G);
break;
case"&":D.pcdata("&amp;",G);
break
}}}}}}}}
if(D.endDoc){
D.endDoc(G)
}}
}
function O(S){
var D;
var F;
return w({
startDoc:function(M){
D=[];
F=false
}
,startTag:function(I,G,R){
if(F){
return
}
if(!f.ELEMENTS.hasOwnProperty(I)){
return
}
var M=f.ELEMENTS[I];
if(M&f.eflags.FOLDABLE){
return
}
G=S(I,G);
if(!G){
F=!(M&f.eflags.EMPTY);
return
}
if(!(M&f.eflags.EMPTY)){
D.push(I)
}
R.push("<",I);
for(var H=0,L=G.length;
H<L;
H+=2){
var Y=G[H],E=G[H+1];
if(E!==null&&E!==void 0){
R.push(" ",Y,'="',l(E),'"')
}}
R.push(">")
}
,endTag:function(Y,H){
if(F){
F=false;
return
}
if(!f.ELEMENTS.hasOwnProperty(Y)){
return
}
var M=f.ELEMENTS[Y];
if(!(M&(f.eflags.EMPTY|f.eflags.FOLDABLE))){
var R;
if(M&f.eflags.OPTIONAL_ENDTAG){
for(R=D.length;
--R>=0;
){
var E=D[R];
if(E===Y){
break
}
if(!(f.ELEMENTS[E]&f.eflags.OPTIONAL_ENDTAG)){
return
}}}else{
for(R=D.length;
--R>=0;
){
if(D[R]===Y){
break
}}}
if(R<0){
return
}
for(var I=D.length;
--I>R;
){
var E=D[I];
if(!(f.ELEMENTS[E]&f.eflags.OPTIONAL_ENDTAG)){
H.push("</",E,">")
}}
D.length=R;
H.push("</",Y,">")
}}
,pcdata:function(R,M){
if(!F){
M.push(R)
}}
,rcdata:function(R,M){
if(!F){
M.push(R)
}}
,cdata:function(R,M){
if(!F){
M.push(R)
}}
,endDoc:function(M){
for(var R=D.length;
--R>=0;
){
M.push("</",D[R],">")
}
D.length=0
}}
)
}
var x=new RegExp("^(?:([^:/?#]+):)?");
function z(S,D,L,R){
for(var I=0;
I<D.length;
I+=2){
var F=D[I];
var E=D[I+1];
var M=null,H;
if((H=S+"::"+F,f.ATTRIBS.hasOwnProperty(H))||(H="*::"+F,f.ATTRIBS.hasOwnProperty(H))){
M=f.ATTRIBS[H]
}
if(M!==null){
switch(M){
case f.atype.NONE:break;
case f.atype.SCRIPT:E=null;
break;
case f.atype.STYLE:if("undefined"===typeof parseCssDeclarations){
E=null;
break
}
var G=[];
parseCssDeclarations(E,{
declaration:function(U,J){
var P=U.toLowerCase();
var N=cssSchema[P];
if(!N){
return
}
sanitizeCssProperty(N,J,L?function(K){
return L(K,f.ueffects.SAME_DOCUMENT,f.ltypes.SANDBOXED,{
CSS_PROP:P}
)
}
:null);
G.push(U+": "+J.join(" "))
}}
);
E=G.length>0?G.join(" ; "):null;
break;
case f.atype.ID:case f.atype.IDREF:case f.atype.IDREFS:case f.atype.GLOBAL_NAME:case f.atype.LOCAL_NAME:case f.atype.CLASSES:E=R?R(E):E;
break;
case f.atype.URI:var Y=(""+E).match(x);
if(!Y){
E=null
}else{
if(!Y[1]||b.test(Y[1])){
E=L?L(E):null
}else{
E=null
}}
break;
case f.atype.URI_FRAGMENT:if(E&&"#"===E.charAt(0)){
E=E.substring(1);
E=R?R(E):E;
if(E!==null&&E!==void 0){
E="#"+E
}}else{
E=null
}
break;
default:E=null;
break
}}else{
E=null
}
D[I+1]=E
}
return D
}
function n(D,S){
return function(F,M){
if(!(f.ELEMENTS[F]&f.eflags.UNSAFE)){
return z(F,M,D,S)
}}
}
function u(S,F){
var D=[];
O(F)(S,D);
return D.join("")
}
function s(D,S,M){
var F=n(S,M);
return u(D,F)
}
return{
escapeAttrib:l,makeHtmlSanitizer:O,makeSaxParser:w,makeTagPolicy:n,normalizeRCData:m,sanitize:s,sanitizeAttribs:z,sanitizeWithPolicy:u,unescapeEntities:r}
}
)(html4);
var html_sanitize=html.sanitize;
if(typeof window!=="undefined"){
window.html=html;
window.html_sanitize=html_sanitize
}
(function(h){
var s=["1.4.2","1.5","1.6","1.7"],d="-1";
function t(u){
if(u>d){
d=u
}}
function n(){
if(navigator.userAgent.indexOf("MSIE")!=-1){
e()
}else{
o()
}}
function e(){
function p(g){
var y=3;
var b=g.replace(/[^.]/g,"").length;
for(;
b<y;
b++){
g=g+".0"
}
return g
}
for(var m=0;
m<s.length;
m++){
var u=p(s[m]);
try{
if(new ActiveXObject("JavaWebStart.isInstalled."+u)!=null){
t(u)
}}
catch(f){}}}
function o(){
if(navigator.mimeTypes){
for(var m=0;
m<s.length;
m++){
var u=s[m];
if(navigator.mimeTypes["application/x-java-applet;version="+u]){
t(u)
}}
if(navigator.mimeTypes["application/x-java-applet"]){
t("")
}}}
function l(){
return(d==="-1")?false:true
}
function r(u){
if(navigator.vendor&&(navigator.vendor.indexOf("Apple")!==-1)){
return l()
}
if(u!==undefined){
return u<=d
}else{
return l()
}}
n();
h.applet={
hasVersion:r}
}
)(window);
ZmVoicePrefs=function(){};
ZmVoicePrefs.prototype=new ZmZimletBase;
ZmVoicePrefs.prototype.constructor=ZmVoicePrefs;
ZmVoicePrefs.prototype.init=function(){
if(!appCtxt.getSettings()._hasVoiceFeature()){
return
}
ZmZimletBase.call(this);
if(!ZmVoicePrefs._INSTANCE){
ZmVoicePrefs._INSTANCE=this
}
this.sections={
VOICE:{
title:com_zimbra_voiceprefs.voice,icon:"VoicemailApp",templateId:"voicemail.VoicePrefs#VoicePrefsGeneralView",priority:60,precondition:ZmSetting.VOICE_ENABLED,prefs:[ZmSetting.VOICE_ACCOUNTS],manageDirty:true,createView:function(t,o,e){
return ZmVoicePrefsGeneralController.getInstance(t).getListView()
}}};
AjxPackage.require({
name:"PreferencesCore",callback:new AjxCallback(this,this._registerPrefs)}
);
AjxPackage.require({
name:"Voicemail",callback:new AjxCallback(this,this._handleVoicemailLoad)}
);
this.getUserUCInfo()
};
ZmVoicePrefs.prototype.toString=function(){
return"ZmVoicePrefs"
};
ZmVoicePrefs.prototype.getZimlet=function(){
return ZmVoicePrefs._INSTANCE
};
ZmVoicePrefs.prototype._registerPrefs=function(){
for(var e in this.sections){
ZmPref.registerPrefSection(e,this.sections[e])
}};
ZmVoicePrefs.prototype.getUserUCInfo=function(){
var e=AjxSoapDoc.create("GetUCInfoRequest","urn:zimbraVoice");
var o=new AjxCallback(this,this._handleUCInfoResponse);
var t={
soapDoc:e,asyncMode:true,noBusyOverlay:true,callback:o};
appCtxt.getAppController().sendRequest(t)
};
ZmVoicePrefs.prototype._handleUCInfoResponse=function(t){
t=t._data;
if(!t||!t.GetUCInfoResponse){
this._popupErrorDlg(this.getMessage("err_failedFetchUCINfo"));
return
}
var o=t.GetUCInfoResponse;
if(!o.attrs||!(o.attrs instanceof Array)||o.attrs.length<1){
this._popupErrorDlg(this.getMessage("err_failedFetchUCINfo"));
return
}
var e=o.attrs[0]._attrs;
this.username=e.zimbraUCUsername;
this.UC_INFO_LOADED=true
};
ZmVoicePrefs.prototype._popupErrorDlg=function(n,t){
var o=appCtxt.getErrorDialog();
o.reset();
var e=(t&&t.message)?t.message:t;
e=AjxUtil.isEmpty(e)?"":e;
o.setMessage(n,e,DwtMessageDialog.CRITICAL_STYLE,ZmMsg.zimbraTitle);
o.popup()
};
ZmVoicePrefsController=function(e,t,o){
if(arguments.length==0){
return
}
ZmController.call(this,e,t);
this._prefsView=o;
this._count=0
};
ZmVoicePrefsController.prototype=new ZmController();
ZmVoicePrefsController.prototype.constructor=ZmVoicePrefsController;
ZmVoicePrefsController.prototype.getListView=function(){
return this._listView
};
ZmVoicePrefsController.prototype.getPrefsView=function(){
return this._prefsView
};
ZmVoicePrefsController.prototype._setup=function(e){
var o=e.getList();
var t=this._getListData();
o.set(t)
};
ZmVoicePrefsController.prototype._resetOperations=function(){
var e=this._prefsView._controller._toolbar;
e.enable(ZmOperation.SAVE,true);
e.enable(ZmOperation.CANCEL,true)
};
ZmVoicePrefsController.prototype.checkPreCondition=function(e,t){
return ZmPrefController.prototype.checkPreCondition.call(this,e,t)
};
ZmVoicePrefsController.prototype._listSelectionListener=function(e,n){
if(n.detail==DwtListView.ITEM_SELECTED){
var s=e.getList();
var t=s.getSelection()[0];
if(!e.validate()){
var o=e.getErrorMessage(true);
appCtxt.setStatusMsg(o,ZmStatusView.LEVEL_CRITICAL);
e.setSelectedItems([e._item])
}else{
e.setItem(t)
}}};
ZmVoicePrefsController.prototype._getListData=function(){
var e=new AjxVector();
var n=appCtxt.getApp(ZmApp.VOICE);
if(!n){
return e
}
for(var t=0,o=n.phones.length;
t<o;
t++){
e.add(n.phones[t])
}
return e
};
ZmVoicePrefsGeneralController=function(e,t,o){
ZmVoicePrefsController.call(this,e,t,o);
var n=ZmPref.getPrefSectionWithPref(ZmSetting.VOICE_ACCOUNTS);
this._listView=new ZmVoicePrefsGeneralPage(o._parent,n,this);
this._editPhoneDlg=new ZmVoiceEditPhoneDlg(o)
};
ZmVoicePrefsGeneralController.prototype=new ZmVoicePrefsController();
ZmVoicePrefsGeneralController.prototype.constructor=ZmVoicePrefsGeneralController;
ZmVoicePrefsGeneralController.prototype.toString=function(){
return"ZmVoicePrefsGeneralController"
};
ZmVoicePrefsGeneralController.getInstance=function(t){
if(!ZmVoicePrefsGeneralController._INSTANCE){
var o=AjxDispatcher.run("GetPrefController").getPrefsView();
var e=appCtxt.getApp(ZmApp.PREFERENCES);
ZmVoicePrefsGeneralController._INSTANCE=new ZmVoicePrefsGeneralController(this._container,e,o)
}
ZmVoicePrefsGeneralController._INSTANCE.zimlet=t;
return ZmVoicePrefsGeneralController._INSTANCE
};
ZmVoicePrefsGeneralController.prototype.deletePhone=function(e){
this._updatePhone({
phone:e,newPhoneNumber:"",newLabel:""}
)
};
ZmVoicePrefsGeneralController.prototype.editPhone=function(e){
this._editPhoneDlg.setPhone(e);
this._editPhoneDlg.setEditPhoneCallback(new AjxCallback(this,this._getNewPhoneInfo));
this._editPhoneDlg.popup()
};
ZmVoicePrefsGeneralController.prototype._getNewPhoneInfo=function(n){
var e=n.phone;
var o=n.newLabel;
var t=n.newPhoneNumber;
if(o!=""&&t!=""&&!(o==e.label&&t==e.name)){
this._updatePhone(n)
}};
ZmVoicePrefsGeneralController.prototype.updatePIN=function(h){
var s=AjxSoapDoc.create("ModifyVoiceMailPinRequest","urn:zimbraVoice");
var t=appCtxt.getApp(ZmApp.VOICE);
if(!t){
return
}
t.setStorePrincipal(s);
var n=null;
for(var o=0;
o<t.phones.length;
o++){
var e=t.phones[o];
if(e.hasVoiceMail){
n=t.phones[o];
break
}}
var r=s.set("phone");
r.setAttribute("name",n&&n.name);
s.set("oldPin",h.oldPin,r);
s.set("pin",h.newPin,r);
var l=new AjxCallback(this,this._handleUpdatePinResponse,h);
appCtxt.getAppController().sendRequest({
soapDoc:s,noBusyOverlay:false,asyncMode:true,callback:l,errorCallback:l}
)
};
ZmVoicePrefsGeneralController.prototype._updatePhone=function(s){
var t=s.phone;
var o=AjxSoapDoc.create("ModifyFromNumRequest","urn:zimbraVoice");
var e=appCtxt.getApp(ZmApp.VOICE);
if(!e){
return
}
e.setStorePrincipal(o);
var n=o.set("phone");
n.setAttribute("id",t.id);
n.setAttribute("oldPhone",t.name);
n.setAttribute("phone",s.newPhoneNumber);
n.setAttribute("label",s.newLabel);
n.setAttribute("numpublishable",t.allProps.numpublishable);
appCtxt.getAppController().sendRequest({
soapDoc:o,noBusyOverlay:false,asyncMode:true,callback:(new AjxCallback(this,this._handleUpdatePhoneResponse,s))}
)
};
ZmVoicePrefsGeneralController.prototype._updateAccountSettings=function(s){
var t=s.password;
var o=AjxSoapDoc.create("ChangeUCPasswordRequest","urn:zimbraVoice");
var e=appCtxt.getApp(ZmApp.VOICE);
if(!e){
return
}
e.setStorePrincipal(o);
var n=o.set("password",t);
appCtxt.getAppController().sendRequest({
soapDoc:o,noBusyOverlay:false,asyncMode:true,callback:(new AjxCallback(this,this._handleUpdateAccountSettingsResponse,s))}
)
};
ZmVoicePrefsGeneralController.prototype._handleUpdatePhoneResponse=function(o,e){
var t=e.getResponse();
if(!t.ModifyFromNumResponse||!t.ModifyFromNumResponse.phone){
this.displayErrorMessage(com_zimbra_voiceprefs.couldNotEditOrUpdatePhone,com_zimbra_voiceprefs.couldNotEditOrUpdatePhone,com_zimbra_voiceprefs.voiceError);
return
}
this._listView.updatePhone(o)
};
ZmVoicePrefsGeneralController.prototype._handleUpdatePinResponse=function(s,e){
var n=e&&e.code;
if(n){
var t=appCtxt.getApp(ZmApp.VOICE);
if(!t){
var o=appCtxt.getErrorDialog();
o.setMessage(ZmMsg.voicemailErrorUnknown,ZmMsg.voicemailErrorUnknown,DwtMessageDialog.CRITICAL_STYLE);
o.popup();
return
}
t.processErrors(e)
}else{
appCtxt.setStatusMsg(com_zimbra_voiceprefs.voicePINUpdated)
}
if(s.callback){
s.callback.run()
}
return true
};
ZmVoicePrefsGeneralController.prototype._handleUpdateAccountSettingsResponse=function(o,e){
var t=e&&e.code;
if(t){
appCtxt.setStatusMsg(com_zimbra_voiceprefs.invalidAccountSettings,ZmStatusView.LEVEL_WARNING)
}else{
appCtxt.setStatusMsg(com_zimbra_voiceprefs.accountSettingsUpdated);
this._listView.showMe()
}
if(o.callback){
o.callback.run()
}
return true
};
ZmVoicePrefsGeneralController.prototype.displayErrorMessage=function(n,e,o){
var t=appCtxt.getErrorDialog();
t.reset();
t.setMessage(n,e,DwtMessageDialog.WARNING_STYLE,o);
t.popup(null,true)
};
ZmVoicePrefsGeneralController.prototype._stateChangeListener=function(e){
return
};
ZmVoicePrefsPhoneList=function(t){
var e=[new DwtListHeaderItem({
field:1,text:ZmMsg.number}
)];
DwtListView.call(this,{
parent:t,className:"ZmVoicePrefsPhoneList",headerList:e}
);
this.multiSelectEnabled=false
};
ZmVoicePrefsPhoneList.prototype=new DwtListView;
ZmVoicePrefsPhoneList.prototype.constructor=ZmVoicePrefsPhoneList;
ZmVoicePrefsPhoneList.prototype.toString=function(){
return"ZmVoicePrefsPhoneList"
};
ZmVoicePrefsPhoneList.prototype._getCellContents=function(t,e,o,n,r,s){
t[e++]=AjxStringUtil.htmlEncode(o.getDisplay(),true);
return e
};
ZmVoicePrefsPage=function(t,o,e){
if(arguments.length==0){
return
}
DwtTabViewPage.call(this,t,"ZmVoicePrefsPage ZmPreferencesPage");
this._className="ZmVoicePrefsPage ZmPreferencesPage";
this._controller=e;
this._hasRendered=false;
this._item=null;
this._section=o;
this._title=[ZmMsg.zimbraTitle,e.getApp().getDisplayName(),this._section&&this._section.title].join(": ");
this._ui=[];
this._changes=null;
this._myCard=null
};
ZmVoicePrefsPage.prototype=new DwtTabViewPage;
ZmVoicePrefsPage.prototype.constructor=ZmVoicePrefsPage;
ZmVoicePrefsPage.prototype.toString=function(){
return"ZmVoicePrefsPage"
};
ZmVoicePrefsPage.prototype.hasRendered=function(){
return this._hasRendered
};
ZmVoicePrefsPage.prototype.resetOnAccountChange=function(){
this._hasRendered=false
};
ZmVoicePrefsPage.prototype.getPreSaveCallback=function(){
return new AjxCallback(this,this._preSaveCallback)
};
ZmVoicePrefsPage.prototype._preSaveCallback=function(o){
var e=this.getPreSaveCallbacks();
if(e&&e.length>0){
var t=new AjxCallback(this,this._doPreSave);
t.args=[t,e,o];
this._doPreSave.apply(this,t.args)
}else{
o.run(true)
}};
ZmVoicePrefsPage.prototype._doPreSave=function(s,t,r,o,n){
if(n!=null&&!n){
return
}
if(t.length==0){
r.run(true)
}else{
var e=t.shift();
e.run(s)
}};
ZmVoicePrefsPage.prototype.getPreSaveCallbacks=function(){
var t=[];
if(this._hasRendered){
for(var e=0;
e<this._ui.length;
e++){
var o=this._ui[e];
if(o&&o.getPreSaveCallback){
var n=o.getPreSaveCallback();
if(n){
t.push(n)
}}}}
return t
};
ZmVoicePrefsPage.prototype.getList=function(){
return this._list
};
ZmVoicePrefsPage.prototype.getUIByName=function(e){
for(var t=0;
t<this._ui.length;
t++){
var o=this._ui[t];
if(o.getName()==e){
return o
}}
return null
};
ZmVoicePrefsPage.prototype.setItem=function(e){
if(e){
this._item=e;
this._getChanges(false);
this.showItem(e)
}};
ZmVoicePrefsPage.prototype.validate=function(n){
n=n||[];
if(!this._item){
return true
}
for(var e=0,t=this._ui.length;
e<t;
e++){
var o=this._ui[e];
if(!o._checkbox||o._checkbox.isSelected()){
o.validate(n)
}}
this._errors=n;
return this._errors.length==0
};
ZmVoicePrefsPage.prototype.getErrorMessage=function(){
if(!this._errors.length){
return null
}else{
return this._errors.join("<br/>").replace(/\{\d+\}/g,"")
}};
ZmVoicePrefsPage.prototype.getTitle=function(){
return this._title
};
ZmVoicePrefsPage.prototype.showMe=function(){
var e=AjxDispatcher.run("GetPrefController");
this._section.manageChanges=true;
e._resetOperations(e._toolbar,this._section&&this._section.id);
Dwt.setTitle(this._title);
this._handleResponseGetFeaturesObj=new AjxCallback(this,this._handleResponseGetFeatures);
this._handleErrorGetFeaturesObj=new AjxCallback(this,this._handleErrorGetFeatures);
var n=new AjxCallback(this,this._handleResponseGetVoiceInfo);
var o=new AjxCallback(this,this._handleErrorGetVoiceInfo);
var t=appCtxt.getApp(ZmApp.VOICE);
if(!t){
return
}
t.phones=[];
t.getVoiceInfo(n,o)
};
ZmVoicePrefsPage.prototype._handleErrorGetVoiceInfo=function(t){
if(t.code=="voice.SECONDARY_NOT_ALLOWED"){
if(!this._showingErrorMessage){
this._showingErrorMessage=true;
this.getHtmlElement().innerHTML=ZMsg["voice.SECONDARY_NOT_ALLOWED_PREFS"]
}
return true
}
var e=appCtxt.getApp(ZmApp.VOICE);
if(!e){
return
}
e.processErrors(t);
this._handleResponseGetVoiceInfo();
this._hasRendered=false;
return true
};
ZmVoicePrefsPage.prototype._handleResponseGetVoiceInfo=function(){
var n=this._htmlElId;
var o={
id:n,userName:ZmVoicePrefs._INSTANCE.username};
this.getHtmlElement().innerHTML=AjxTemplate.expand(this._template,o);
this._showingErrorMessage=false;
this._list=new ZmVoicePrefsPhoneList(this);
this._list.setEnabled(false);
this._list.replaceElement(n+"_list");
this._list.sortingEnabled=false;
for(var e=0,t=this._ui.length;
e<t;
e++){
this._ui[e]._initialize(n)
}
this._controller._setup(this);
this._hasRendered=true
};
ZmVoicePrefsPage.prototype.isDirty=function(){
this._getChanges();
return this._changes!=null
};
ZmVoicePrefsPage.prototype._getChanges=function(){
if(!this._phone){
return
}
for(var e=0,t=this._ui.length;
e<t;
e++){
if(this._ui[e].isDirty()){
this._addChange(this._ui[e])
}}};
ZmVoicePrefsPage.prototype._addChange=function(t){
if(!this._changes){
this._changes={}
}
if(!this._changes[this._phone.name]){
this._changes[this._phone.name]={
phone:this._phone,features:{}}
}
var e=t.getFeature();
if(e){
this._changes[this._phone.name].features[e.name]=e
}};
ZmVoicePrefsPage.prototype.reset=function(){
this._changes=null;
this.showItem(this._item)
};
ZmVoicePrefsPage.prototype.showItem=function(e){
if(e instanceof ZmPhone){
this._phone=e;
e.getCallFeatures(this._handleResponseGetFeaturesObj,this._handleErrorGetFeaturesObj)
}};
ZmVoicePrefsPage.prototype._handleResponseGetFeatures=function(s,e){
var h=(this._changes&&this._changes[e.name])?this._changes[e.name].features:null;
for(var n=0,r=this._ui.length;
n<r;
n++){
var t=this._ui[n].getName();
var o;
if(h&&h[t]){
o=h[t]
}else{
o=s[t]
}
if(o){
this._ui[n].setFeature(o)
}}};
ZmVoicePrefsPage.prototype._handleErrorGetFeatures=function(t){
for(var e=0,o=this._ui.length;
e<o;
e++){
var n=this._ui[e];
n.setEnabled(false);
if(n._checkbox){
n._checkbox.setEnabled(false)
}}};
ZmVoicePrefsPage.prototype.addCommand=function(t){
var s=true;
for(var n in this._changes){
var l=this._changes[n];
var h=l.phone;
var d=null;
if(s){
if(!this._handleResponseObj){
this._handleResponseObj=new AjxCallback(this,this._handleResponseCallFeatures)
}
d=this._handleResponseObj;
s=false
}
var r=[];
var o=l.features;
for(var e in o){
r.push(o[e])
}
h.modifyCallFeatures(t,r,d)
}};
ZmVoicePrefsPage.prototype._handleResponseCallFeatures=function(){
this._changes=null
};
ZmVoicePrefsPage.prototype._validatePhoneNumber=function(e){
if(AjxStringUtil.trim(e)==""){
throw AjxMsg.valueIsRequired
}
var t=[];
if(!this._phone.validate(e,t)){
throw AjxMessageFormat.format(t[0],[""])
}
return e
};
ZmVoicePrefsPage.prototype._validatePhoneNumberFct=function(t){
try{
this._validatePhoneNumber(t)
}
catch(o){
return o
}
return null
};
ZmVoicePrefsPage._validateEmailAddress=function(e){
if(e==""){
throw AjxMsg.valueIsRequired
}else{
if(!AjxEmailAddress.isValid(e)||e.length>ZmCallFeature.EMAIL_MAX_LENGTH){
throw AjxMsg.invalidEmailAddr
}}
return e
};
ZmVoicePrefsGeneralPage=function(t,n,e){
ZmVoicePrefsPage.call(this,t,n,e);
this._controller=e;
this._hasRendered=false;
this._item=null;
this._ui=[new ZmVoicePrefsGeneralUI(this)];
this._changes=null;
this._template="voicemail.VoicePrefs#VoicePrefsGeneralView";
var o={
userName:ZmVoicePrefs._INSTANCE.usernames};
this.getHtmlElement().innerHTML=AjxTemplate.expand(this._template,o);
this._title=[ZmMsg.zimbraTitle,e.getApp().getDisplayName(),this._section&&this._section.title].join(": ")
};
ZmVoicePrefsGeneralPage.prototype=new ZmVoicePrefsPage;
ZmVoicePrefsGeneralPage.prototype.constructor=ZmVoicePrefsGeneralPage;
ZmVoicePrefsGeneralPage.prototype.toString=function(){
return"ZmVoicePrefsGeneralPage"
};
ZmVoicePrefsGeneralPage.prototype.hasRendered=function(){
return this._hasRendered
};
ZmVoicePrefsGeneralPage.prototype.updatePhone=function(t){
var e=t.phone;
this._list.removeItem(e);
e.label=t.newLabel;
e.name=t.newPhoneNumber;
this._list.addItem(e)
};
ZmVoicePINDlg=function(){
this.zimlet=ZmVoicePrefs._INSTANCE;
this.controller=ZmVoicePrefsGeneralController._INSTANCE;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._createView();
var e=new DwtDialog_ButtonDescriptor(ZmVoicePINDlg.UPDATE_PIN_BTN_ID,this.zimlet.getMessage("updatePin"),DwtDialog.ALIGN_RIGHT);
DwtDialog.call(this,{
parent:appCtxt.getShell(),title:this.zimlet.getMessage("voicePINDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.CANCEL_BUTTON],extraButtons:[e]}
);
this.setButtonListener(ZmVoicePINDlg.UPDATE_PIN_BTN_ID,new AjxListener(this,this._updateBtnHandler));
this._oldpinField=document.getElementById("voicePINDlg_old_PIN_field");
this._pinField=document.getElementById("voicePINDlg_PIN_field");
this._confirmPinField=document.getElementById("voicePINDlg_PIN_confirm_field");
this._addTabControl();
this.RE=new RegExp("^\\d+$")
};
ZmVoicePINDlg.prototype=new DwtDialog;
ZmVoicePINDlg.prototype.constructor=ZmVoicePINDlg;
ZmVoicePINDlg.UPDATE_PIN_BTN_ID="voice_pin_dlg_update_btn";
ZmVoicePINDlg.OLD_PIN_FIELD_ID="voicePINDlg_old_PIN_field";
ZmVoicePINDlg.PIN_FIELD_ID="voicePINDlg_PIN_field";
ZmVoicePINDlg.CONFIRM_PIN_FIELD_ID="voicePINDlg_PIN_confirm_field";
ZmVoicePINDlg.prototype._createView=function(){
var e={
oldpinStr:this.zimlet.getMessage("oldPinLabel"),pinStr:this.zimlet.getMessage("newPinLabel"),confirmPINStr:this.zimlet.getMessage("confirmNewPinLabel"),oldpinFieldId:ZmVoicePINDlg.OLD_PIN_FIELD_ID,pinFieldId:ZmVoicePINDlg.PIN_FIELD_ID,confirmPinFieldId:ZmVoicePINDlg.CONFIRM_PIN_FIELD_ID};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("voicemail.VoicePrefs#voicePINDlg",e)
};
ZmVoicePINDlg.prototype._updateBtnHandler=function(){
var n=this.zimlet.getMessage("invalidPin");
var o="";
var e=false;
if(this._oldpinField.value==""){
o=this.zimlet.getMessage("missingOldPin");
e=true
}
if(this._pinField.value==""&&this._confirmPinField.value==""){
o=this.zimlet.getMessage("missingNewPin");
e=true
}
if(!this.isPINDigits(this._pinField.value)){
o=this.zimlet.getMessage("pinCanOnlyBeDigits");
e=true
}
if(this._pinField.value!=this._confirmPinField.value){
o=this.zimlet.getMessage("pinAndConfirmPinDidntMatch");
e=true
}
if(e){
this.zimlet.displayErrorMessage(o,o,n);
return false
}
var t={};
t.oldPin=this._oldpinField.value;
t.newPin=this._pinField.value;
this._updatePIN(t)
};
ZmVoicePINDlg.prototype._addTabControl=function(){
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(this._oldpinField,0);
this._tabGroup.addMember(this._pinField,1);
this._tabGroup.addMember(this._confirmPinField,2);
this._tabGroup.addMember(this.getButton(ZmVoicePINDlg.UPDATE_PIN_BTN_ID),3);
this._tabGroup.addMember(this.getButton(ZmVoicePINDlg.CANCEL_BUTTON),4)
};
ZmVoicePINDlg.prototype.isPINDigits=function(e){
return this.RE.test(e)
};
ZmVoicePINDlg.prototype._updatePIN=function(e){
e.callback=new AjxCallback(this,this._handleUpdatePinResponse,e);
this.controller.updatePIN(e)
};
ZmVoicePINDlg.prototype._handleUpdatePinResponse=function(e){
this.popdown()
};
ZmVoiceAccountSettingsDlg=function(){
this.zimlet=ZmVoicePrefs._INSTANCE;
this.controller=ZmVoicePrefsGeneralController._INSTANCE;
this._dialogView=new DwtComposite(appCtxt.getShell());
this._createView();
DwtDialog.call(this,{
parent:appCtxt.getShell(),title:this.zimlet.getMessage("voiceAccountSettingsDlgTitle"),view:this._dialogView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._updateBtnHandler));
var e=this.getButton(DwtDialog.OK_BUTTON);
e.setText(this.zimlet.getMessage("updatePasswordDlgBtn"));
this._passwordField=document.getElementById("voiceAccountSettingsDlg_PASSWORD_field");
this._addTabControl()
};
ZmVoiceAccountSettingsDlg.prototype=new DwtDialog;
ZmVoiceAccountSettingsDlg.prototype.constructor=ZmVoiceAccountSettingsDlg;
ZmVoiceAccountSettingsDlg.PASSWORD_FIELD_ID="voiceAccountSettingsDlg_PASSWORD_field";
ZmVoiceAccountSettingsDlg.prototype._createView=function(){
var e={
usernameStr:this.zimlet.getMessage("usernameLabel"),passwordStr:this.zimlet.getMessage("passwordLabel"),username:ZmVoicePrefs._INSTANCE.username,passwordFieldId:ZmVoiceAccountSettingsDlg.PASSWORD_FIELD_ID};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("voicemail.VoicePrefs#voiceAccountSettingsDlg",e)
};
ZmVoiceAccountSettingsDlg.prototype._updateBtnHandler=function(){
var n=this.zimlet.getMessage("invalidAccountSettings");
var o="";
var e=false;
if(!AjxStringUtil.trim(this._passwordField.value)){
o=this.zimlet.getMessage("missingPassword");
e=true
}
if(e){
this.zimlet.displayErrorMessage(o,o,n);
return false
}
var t={};
t.password=this._passwordField.value;
this._updateAccountSettings(t)
};
ZmVoiceAccountSettingsDlg.prototype._addTabControl=function(){
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(this._passwordField,0);
this._tabGroup.addMember(this.getButton(DwtDialog.OK_BUTTON),1);
this._tabGroup.addMember(this.getButton(DwtDialog.CANCEL_BUTTON),2)
};
ZmVoiceAccountSettingsDlg.prototype._updateAccountSettings=function(e){
e.callback=new AjxCallback(this,this._handleUpdateAccountSettingsResponse,e);
this.controller._updateAccountSettings(e)
};
ZmVoiceAccountSettingsDlg.prototype._handleUpdateAccountSettingsResponse=function(e){
this.popdown()
};
ZmVoicePrefsFeatureUI=function(e){
this._view=e
};
ZmVoicePrefsFeatureUI.prototype.setFeature=function(e){
this._feature=e;
this.show(e);
if(this._checkbox){
this._checkbox.setSelected(e.isActive);
this._checkbox.setEnabled(e.isSubscribed)
}
this.setEnabled(e.isActive)
};
ZmVoicePrefsFeatureUI.prototype.getFeature=function(){
if(this._feature){
var e=this._feature.createProxy();
e.isActive=this._checkbox?this._checkbox.isSelected():true;
return e
}
return null
};
ZmVoicePrefsFeatureUI.prototype.isDirty=function(){
if(!this._feature||!this._feature.isSubscribed){
return false
}
if(this._checkbox&&(this._feature.isActive!=this._checkbox.isSelected())){
return true
}
return this._isValueDirty()
};
ZmVoicePrefsFeatureUI.prototype._createCheckbox=function(e,t){
this._checkbox=new DwtCheckbox({
parent:this._view}
);
this._checkbox.setText(e);
this._checkbox.replaceElement(t);
this._checkbox.addSelectionListener(new AjxListener(this,this._checkboxListener))
};
ZmVoicePrefsFeatureUI.prototype._checkboxListener=function(e){
this.setEnabled(this._checkbox.isSelected())
};
ZmVoicePrefsFeatureUI.prototype._populateEmailComboBox=function(t){
t.removeAll();
var e=appCtxt.get(ZmSetting.USERNAME);
this._comboBox.add(e,false)
};
ZmVoicePrefsFeatureUI.prototype._isComboBoxValid=function(e){
return e&&e.input&&e.input.isValid()!==null
};
ZmVoicePrefsFeatureUI.prototype._validateComboBox=function(t,o,e){
if(!this._isComboBoxValid(t)){
o.push(e)
}};
ZmVoicePrefsFeatureUI.prototype._clearField=function(e){
if(e instanceof DwtComboBox||e instanceof DwtInputField){
e.setValue(null,true);
e.focus()
}};
ZmVoicePrefsFeatureUI.prototype.getFaqLink=function(){
return AjxMessageFormat.format(com_zimbra_voiceprefs.FAQLink,[com_zimbra_voiceprefs.FAQURL])
};
ZmVoicePrefsFeatureUI.prototype.showDialog=function(s,n){
var o=appCtxt.getShell();
var t=new ZmDialog({
parent:o,title:ZmMsg.errorCap}
);
t.setContent(s);
if(n instanceof AjxCallback){
var e=new AjxListener(t,function(){
n.run();
this.popdown()
}
);
t.setButtonListener(DwtDialog.OK_BUTTON,e)
}
t.popup()
};
ZmVoicePrefsFeatureUI.prototype.showDialogWithFAQ=function(o,e){
if(AjxUtil.isString(o)){
var t=AjxStringUtil.trim(o);
if(t.length>0){
if(t.indexOf("{0}")==-1){
if(!t.match(/\.$/)){
t+="."
}}else{
t=AjxMessageFormat.format(t,[this.getFaqLink()])
}
this.showDialog(t,e)
}}};
ZmVoicePrefsFeatureUI.prototype.getName=function(){};
ZmVoicePrefsFeatureUI.prototype._initialize=function(e){};
ZmVoicePrefsFeatureUI.prototype.setEnabled=function(e){};
ZmVoicePrefsFeatureUI.prototype.validate=function(e){};
ZmVoicePrefsGeneralUI=function(e){
ZmVoicePrefsFeatureUI.call(this,e)
};
ZmVoicePrefsGeneralUI.prototype=new ZmVoicePrefsFeatureUI;
ZmVoicePrefsGeneralUI.prototype.constructor=ZmVoicePrefsGeneralUI;
ZmVoicePrefsGeneralUI.prototype.toString=function(){
return"ZmVoicePrefsGeneralUI"
};
ZmVoicePrefsGeneralUI.prototype._initialize=function(o){
this.zimlet=ZmVoicePrefs._INSTANCE;
var l=document.getElementById(o+"_DELETE");
if(l){
var r=new DwtButton({
parent:this._view}
);
r.setText(ZmMsg.del);
r.setEnabled(true);
r.addSelectionListener(new AjxListener(this,this._handleDeleteButton));
r.replaceElement(l);
this._deleteButton=r
}
var n=document.getElementById(o+"_EDIT");
if(n){
r=new DwtButton({
parent:this._view}
);
r.setText(ZmMsg.edit);
r.setEnabled(true);
r.addSelectionListener(new AjxListener(this,this._handleEditButton));
r.replaceElement(n);
this._editButton=r
}
var d=document.getElementById(o+"_UPDATE_PASSWORD");
if(d){
r=new DwtButton({
parent:this._view}
);
r.setText(this.zimlet.getMessage("updatePassword"));
r.setEnabled(true);
r.addSelectionListener(new AjxListener(this,this._handleUpdatePasswordBtn,o));
r.replaceElement(d);
this._updatePasswordButton=r
}
var h=appCtxt.getApp(ZmApp.VOICE);
var t=h&&h.hasVoicePIN();
if(t){
var s=document.getElementById(o+"_UPDATE_PIN");
var e=document.getElementById(o+"_td_UPDATE_PIN");
if(s){
r=new DwtButton({
parent:this._view}
);
r.setText(this.zimlet.getMessage("updatePIN"));
r.setEnabled(true);
r.addSelectionListener(new AjxListener(this,this._handleUpdatePinBtn,o));
r.replaceElement(s);
this._updatePinButton=r;
e.style.display=""
}}};
ZmVoicePrefsGeneralUI.prototype._handleUpdatePasswordBtn=function(e){
if(!this._voiceAccountSettingsDlg){
this._voiceAccountSettingsDlg=new ZmVoiceAccountSettingsDlg(this)
}
this._voiceAccountSettingsDlg.popup()
};
ZmVoicePrefsGeneralUI.prototype._handleUpdatePinBtn=function(e){
if(!this._voicePINDlg){
this._voicePINDlg=new ZmVoicePINDlg(this)
}
this._voicePINDlg.popup()
};
ZmVoicePrefsGeneralUI.prototype._handleEditButton=function(){
var e=this._view._item;
if(e.allProps&&!e.allProps.editable){
appCtxt.setStatusMsg(com_zimbra_voiceprefs.phoneNotEditable,ZmStatusView.LEVEL_WARNING);
return
}
this._view._controller.editPhone(e)
};
ZmVoicePrefsGeneralUI.prototype._handleDeleteButton=function(){
var e=this._view._item;
if(e.allProps&&!e.allProps.editable){
appCtxt.setStatusMsg(com_zimbra_voiceprefs.phoneNotEditable,ZmStatusView.LEVEL_WARNING);
return
}
this._view._controller.deletePhone(e)
};
ZmVoicePrefsGeneralUI.prototype._editPhoneHandler=function(t){
var e=t.phone;
this._view._list.removeItem(e);
e.label=t.newLabel;
e.name=t.newPhoneNumber;
this._view._list.addItem(e)
};
AjxTemplate.register("voicemail.VoicePrefs#VoicePrefsGeneralView",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<table width='100%'><tr class='ZOptionsHeaderRow'><td class='ZOptionsHeaderL'><div class='ImgPrefsHeader_L'></div></td><td class='ZOptionsHeader ImgPrefsHeader'>";
e[o++]=com_zimbra_voiceprefs.generalHeader;
e[o++]="</td><td class='ZOptionsHeaderR'><div class='ImgPrefsHeader_R'></div></td></tr></table><table class='ZOptionsSectionTable' width='100%'><tr><td class='ZOptionsSectionMain'><table cellspacing='6'><tr><td class='ZOptionsLabel'>";
e[o++]=com_zimbra_voiceprefs.usernameLabel;
e[o++]="</td><td class='ZOptionsField'><label>";
e[o++]=s.userName;
e[o++]="</label></td></tr><tr><td class='ZOptionsLabelTop'>";
e[o++]=com_zimbra_voiceprefs.voicePrefsInstruction;
e[o++]=":\n";
e[o++]="\t\t\t\t\t\t</td><td class='ZOptionsField' style='min-width:200px;'><div id='";
e[o++]=s.id;
e[o++]="_list'></div></td></tr><tr><td></td><td><table><tr><td id=\"";
e[o++]=s.id;
e[o++]='_td_UPDATE_PASSWORD"><button id="';
e[o++]=s.id;
e[o++]='_UPDATE_PASSWORD">';
e[o++]=com_zimbra_voiceprefs.updatePassword;
e[o++]='</button></td><td id="';
e[o++]=s.id;
e[o++]="_td_UPDATE_PIN\" style='display:none;'><button id=\"";
e[o++]=s.id;
e[o++]="_UPDATE_PIN\" style='margin-left:10px;'>";
e[o++]=com_zimbra_voiceprefs.updatePIN;
e[o++]="</button></td></tr></table></td></tr></table></td></tr></table>";
return n?e.length:e.join("")
}
,{
id:"voicemail.VoicePrefs#VoicePrefsGeneralView"}
,true);
AjxPackage.define("voicemail.VoicePrefs");
AjxTemplate.register("voicemail.VoicePrefs",AjxTemplate.getTemplate("voicemail.VoicePrefs#VoicePrefsGeneralView"),AjxTemplate.getParams("voicemail.VoicePrefs#VoicePrefsGeneralView"));
AjxTemplate.register("voicemail.VoicePrefs#updatePINDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div><table class='ZOptionsSectionTable' width='100%'><tr><td class='ZOptionsSectionMain' colspan='3'><table cellspacing='6'><tr><td class='ZOptionsLabel'>";
e[o++]=com_zimbra_voiceprefs.oldPinLabel;
e[o++]="</td><td class='ZOptionsField' width='100%'><input id='";
e[o++]=s.id;
e[o++]="_OLD_PIN' type='password' style='width:200px'></input></td></tr><tr><td class='ZOptionsLabel'>";
e[o++]=com_zimbra_voiceprefs.newPinLabel;
e[o++]="</td><td class='ZOptionsField'><input id='";
e[o++]=s.id;
e[o++]="_NEW_PIN' type='password' style='width:200px'></input></td></tr><tr><td class='ZOptionsLabel'>";
e[o++]=com_zimbra_voiceprefs.confirmNewPinLabel;
e[o++]="</td><td class='ZOptionsField'><input id='";
e[o++]=s.id;
e[o++]="_CONFIRM_NEW_PIN' type='password' style='width:200px'></input></td></tr><tr><td colspan=2><button id=\"";
e[o++]=s.id;
e[o++]='_UPDATE_PIN">';
e[o++]=com_zimbra_voiceprefs.update;
e[o++]="</button></td></tr></table></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"voicemail.VoicePrefs#updatePINDlg"}
,true);
AjxTemplate.register("voicemail.VoicePrefs#voicePINDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div><table class='ZPropertySheet' cellspacing='6'><tr><td class='ZOptionsLabel'><label>";
e[o++]=s.oldpinStr;
e[o++]="</label></td><td class='ZOptionsField' width='100%'><input type=password id='";
e[o++]=s.oldpinFieldId;
e[o++]="' style='width:200px'></text></td></tr><tr><td class='ZOptionsLabel'><label>";
e[o++]=s.pinStr;
e[o++]="</label></td><td class='ZOptionsField'><input type=password id='";
e[o++]=s.pinFieldId;
e[o++]="' style='width:200px'></text></td></tr><tr><td class='ZOptionsLabel'><label>";
e[o++]=s.confirmPINStr;
e[o++]="</label></td><td class='ZOptionsField'><input style='width:200px' type=password id='";
e[o++]=s.confirmPinFieldId;
e[o++]="'></text></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"voicemail.VoicePrefs#voicePINDlg"}
,true);
AjxTemplate.register("voicemail.VoicePrefs#voiceAccountSettingsDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div><table class='ZPropertySheet' cellspacing='6'><tr><td class='ZOptionsLabel'><label>";
e[o++]=s.usernameStr;
e[o++]="</label></td><td class='ZOptionsField' width='100%'><label>";
e[o++]=s.username;
e[o++]="</label></td></tr><tr><td class='ZOptionsLabel'><label>";
e[o++]=s.passwordStr;
e[o++]="</label></td><td class='ZOptionsField'><input style='width:200px' type=password id='";
e[o++]=s.passwordFieldId;
e[o++]="'></text></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"voicemail.VoicePrefs#voiceAccountSettingsDlg"}
,true);
AjxTemplate.register("voicemail.VoicePrefs#voiceEditPhoneDlg",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div><table class='ZPropertySheet' cellspacing='6'><tr><td class='ZOptionsLabel'><label>";
e[o++]=ZmMsg.nameLabel;
e[o++]="</label></td><td class='ZOptionsField' width='100%'><input style='width:200px' id='";
e[o++]=s.nameFieldId;
e[o++]="'></text></td></tr><tr><td class='ZOptionsLabel'><label>";
e[o++]=ZmMsg.phoneLabel;
e[o++]="</label></td><td class='ZOptionsField'><input style='width:200px' id='";
e[o++]=s.phoneFieldId;
e[o++]="'></text></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"voicemail.VoicePrefs#voiceEditPhoneDlg"}
,true);
ZmVoiceEditPhoneDlg=function(e){
if(!e){
return
}
this._dialogView=new DwtComposite(appCtxt.getShell());
this._createView();
DwtDialog.call(this,{
parent:appCtxt.getShell(),title:com_zimbra_voiceprefs.editPhone,view:this._dialogView,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]}
);
this.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._editPhoneListener));
this._nameField=document.getElementById("voice_phone_name_field_id");
this._phoneField=document.getElementById("voice_phone_field_id");
this._editTabControl();
this.RE=new RegExp("\\d+","g")
};
ZmVoiceEditPhoneDlg.prototype=new DwtDialog;
ZmVoiceEditPhoneDlg.prototype.constructor=ZmVoiceEditPhoneDlg;
ZmVoiceEditPhoneDlg.PHONE_FIELD_ID="voice_phone_field_id";
ZmVoiceEditPhoneDlg.PHONE_NAME_FIELD_ID="voice_phone_name_field_id";
ZmVoiceEditPhoneDlg.prototype._createView=function(){
var e={
nameFieldId:ZmVoiceEditPhoneDlg.PHONE_NAME_FIELD_ID,phoneFieldId:ZmVoiceEditPhoneDlg.PHONE_FIELD_ID};
this._dialogView.getHtmlElement().innerHTML=AjxTemplate.expand("voicemail.VoicePrefs#voiceEditPhoneDlg",e)
};
ZmVoiceEditPhoneDlg.prototype._editPhoneListener=function(){
if(this._editPhonePostCallback){
this._editPhonePostCallback.run({
phone:this._phone,newLabel:this._nameField.value,newPhoneNumber:this._phoneField.value}
)
}
this.popdown()
};
ZmVoiceEditPhoneDlg.prototype._editTabControl=function(){
this._tabGroup.removeAllMembers();
this._tabGroup.addMember(this._nameField,1);
this._tabGroup.addMember(this._phoneField,2);
this._tabGroup.addMember(this.getButton(DwtDialog.OK_BUTTON),3);
this._tabGroup.addMember(this.getButton(DwtDialog.CANCEL_BUTTON),4)
};
ZmVoiceEditPhoneDlg.prototype.popup=function(){
DwtDialog.prototype.popup.call(this);
if(this._phone){
this._nameField.value=this._phone.label;
this._phoneField.value=this._phone.name
}};
ZmVoiceEditPhoneDlg.prototype.setEditPhoneCallback=function(e){
this._editPhonePostCallback=e
};
ZmVoiceEditPhoneDlg.prototype.setPhone=function(e){
this._phone=e
};