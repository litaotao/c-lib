<!DOCTYPE html>
<!-- saved from url=(0366)http://mp.weixin.qq.com/s?__biz=MzA4NjA4MTkzMw==&mid=203965305&idx=1&sn=056688e3bee08b3599e936ef60d942fd&scene=4&key=79cf83ea5128c3e5ba21b28c2bedf7241e2c52cd652dd24a5eb41d3ff17d173f7fab71118d796ef999798b4cce9a8486&ascene=1&uin=MTAzNTc2NzM4Mg%3D%3D&devicetype=webwx&version=70000001&pass_ticket=XkqQX1UfkIN5f%2FFuwJWHZv1bIKTIFKwoQhvcV%2FDbwqU1Av%2B%2FWPko9KYt7H7CHQfs -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">        <script type="text/javascript">
    var sampling = Math.random() < 0.001;
    var page_begintime = (+new Date());
    (sampling) && ((new Image()).src = "http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=7839&flag2=7&flag3=8&15=1000&r=" + Math.random());

    var biz = "MzA4NjA4MTkzMw==";
    var sn = "056688e3bee08b3599e936ef60d942fd";
    var mid = "203965305" || "";
    var idx = "1" || "" ;
    
    //辟谣需求
    var is_rumor = ""*1;
    var norumor = ""*1;
    if (!!is_rumor&&!norumor){
      if (!document.referrer || document.referrer.indexOf("mp.weixin.qq.com/mp/rumor") == -1){
        location.href = "http://mp.weixin.qq.com/mp/rumor?action=info&__biz=" + biz + "&mid=" + mid + "&idx=" + idx + "&sn=" + sn + "#wechat_redirect";
      }
    }
</script>        <meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0"><link rel="shortcut icon" type="image/x-icon" href="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/common/favicon22c41b.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"><script type="text/javascript">
    var uin = "MTAzNTc2NzM4Mg==";
    var key = "79cf83ea5128c3e5ba21b28c2bedf7241e2c52cd652dd24a5eb41d3ff17d173f7fab71118d796ef999798b4cce9a8486";
    var pass_ticket = "XkqQX1UfkIN5f/FuwJWHZv1bIKTIFKwoQhvcV/DbwqU1Av+/WPko9KYt7H7CHQfs";
</script>        <title>数盟</title>        <link rel="stylesheet" type="text/css" href="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/page_mp_article_improve2318b8.css"><style>             .list-paddingleft-2{padding-left:30px;}    blockquote{margin:0;padding-left:10px;border-left:3px solid #DBDBDB;}</style><!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_pc22ebff.css"><![endif]--><script type="text/javascript">
    document.domain = "qq.com";
</script>    <script src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/share224ef3.js" type="text/javascript" async="" crossorigin="true"></script><script src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/index231943.js" type="text/javascript" async="" crossorigin="true"></script><style type="text/css"></style></head>    <body id="activity-detail" class="zh_CN ">            <script type="text/javascript">
        var write_sceen_time = (+new Date());
        (sampling) && ((new Image()).src = "http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=7839&flag2=7&flag3=8&16=1000&r=" + Math.random());
    </script>        <div id="js_cmt_more" class="discuss_container access" style="display:none;">        <div class="discuss_container_inner">            <h2 class="rich_media_title" id="activity-name">《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统</h2>            <div class="discuss_list_wrp">                <div class="line_tips_wrp">                    <span class="line_tips">精选评论<span class="error_tips" id="js_cmt_nofans3" style="display:none">关注该公众号可参与评论</span></span>                </div>                <p class="discuss_access_tips" id="js_cmt_addbtn3" style="display:none"><a href="http://mp.weixin.qq.com/s?__biz=MzA4NjA4MTkzMw==&mid=203965305&idx=1&sn=056688e3bee08b3599e936ef60d942fd&scene=4&key=79cf83ea5128c3e5ba21b28c2bedf7241e2c52cd652dd24a5eb41d3ff17d173f7fab71118d796ef999798b4cce9a8486&ascene=1&uin=MTAzNTc2NzM4Mg%3D%3D&devicetype=webwx&version=70000001&pass_ticket=XkqQX1UfkIN5f%2FFuwJWHZv1bIKTIFKwoQhvcV%2FDbwqU1Av%2B%2FWPko9KYt7H7CHQfs#comment">写评论<img class="icon_edit" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/icon_edit227bf3.png" alt=""></a></p>                <ul class="discuss_list" id="js_cmt_morelist"></ul>            </div>            <div class="loadmore" id="js_cmt_more_loading">                <div class="tips_wrp">                    <img src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/icon_loading_white22c04a.gif" class="loading_icon icon_loading_white" alt="">                    <span class="tips">加载中</span>                </div>            </div>            <div class="loadmore with_line" id="js_cmt_more_end" style="display:none">                <div class="tips_wrp"><span class="tips">以上评论由公众帐号筛选后显示</span></div>            </div>        </div>    </div>        <div id="js_cmt_mine" class="discuss_container editing access" style="display:none;">        <div class="discuss_container_inner">            <h2 class="rich_media_title" id="activity-name">《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统</h2>            <div class="frm_textarea_box_wrp">                <span class="frm_textarea_box">                    <textarea id="js_cmt_input" class="frm_textarea" placeholder="评论将由公众帐号筛选后显示，对所有人可见。"></textarea>                </span>            </div>            <div class="discuss_btn_wrp"><a id="js_cmt_submit" class="btn btn_inline btn_primary btn_discuss btn_disabled" href="javascript:;">提交</a></div>            <div class="discuss_list_wrp" style="display:none">                <div class="line_tips_wrp">                    <span class="line_tips">我的评论</span>                </div>                <ul class="discuss_list" id="js_cmt_mylist"></ul>            </div>            <div class="wx_poptips" id="js_cmt_toast" style="display:none;">                <img alt="" class="icon_toast" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABqCAYAAABUIcSXAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA3NpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyMTUxMzkxZS1jYWVhLTRmZTMtYTY2NS0xNTRkNDJiOGQyMWIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTA3QzM2RTg3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTA3QzM2RTc3N0UwMTFFNEIzQURGMTQzNzQzMDAxQTUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NWMyOGVjZTMtNzllZS00ODlhLWIxZTYtYzNmM2RjNzg2YjI2IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjIxNTEzOTFlLWNhZWEtNGZlMy1hNjY1LTE1NGQ0MmI4ZDIxYiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pmvxj1gAAAVrSURBVHja7J15rF1TFMbXk74q1ZKHGlMkJVIhIgg1FH+YEpEQJCKmGBpThRoSs5jVVNrSQUvEEENIhGiiNf9BiERICCFIRbUiDa2qvudbOetF3Tzv7XWGffa55/uS7593977n3vO7e5+199p7v56BgQGh0tcmvAUERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERREUQVEERVAUQVEERVAUQbVYk+HdvZVG8b5F0xj4RvhouB+eCy8KrdzDJc1RtAX8ILxvx98V1GyCSkN98Cx4z/95/Wn4fj6j6tUEeN4wkFSnw1MJqj5NhBfAuwaUHREUg4lqNMmePVsHll/HFhVfe1t3FwpJI8DXCCquDrCWNN4B6Tb4M3Z98aTPmTvh0YHl18PXw29yZiKejoPvcUD6E74yFBJbVDk6Bb7K8aP/Hb4c/tRzEYIqprPhSxzlf4Uvhb/0Xoig8qnHAJ3lqPMzfDH8XZ4LEpRf2sVdA5/sqPO9Qfop70UJyn+/boaPddT5yrq7VUUvTIVJI7q74MMddXR8NB1eXcYvhBpZm0s2w72/o86HFoKvLau/pYaXzjLMdUJ6y0LwtWV9CIIaXtvA8+G9HHV03u5q+K+yH47U0NoRngPv7KjzHDwTLj0bS1BDazfJJlcnOOostC6ysnCT+q80G/sIvFVgeW09D8FPVT0uoP7VfvAD8NjA8pqmuAN+OcYAjso0RbIZ8DGB5TVNcRO8JMaHY9SXSdfa3eeANJimWBLrA7JFiZwIXye+NMUV8CcxP2SRFjXefok7NRjSGZJlWUPvw2/wtNiQirSoXWyMsR28wR7AzzYM0oXw+Y7yK+CLJGeaoqjyrJSdZJD6Ov4+z5y6NJc0Az7NUecHydIUy+v60KNyQHoM3nKI1y7YCFiq0i7uBvgER52vDdKqWn9djhY1Dn4G3n6Ecqm2rF74dvgoR53S0hQxW9RJAZAGW5bSn58QJA27dQ7uIEedjywEX5NKVxCqsY6y+qA+LxFI4+yZ6oH0trWkNan80jygtIUsc5SflgAsDXgehfdx1KkkTRE76tN+Xue2jnTU0Ru1oIbvpt30bBtKhOp5yaaRkts0lic8V1i6dPcIRx2d/l8Y8XtNNEg7OOo8bl1kmmOKnDsO88CaYzejau0hWZqiL7C83oCH4SeTHvwV2BqqsHRVztSEYOmWF80NeXZT6Hd4KflResE9vCnBOlCyGfDNAstHTVPUDWoQ1t3iW+9WNizvlhfd4aerXd+ThqiMfNR6+9LvOOro5OY5JX2H4+F7HZD+kGzlamMgldWiirQsjcwWFbjmqZJteekJLK9pisvgL6RhKvuciZiwzrWWGapfrPy30kBVcSBIrw0aD3PU0XB6cehntq7rTMf7/2iQlktDVdXJLXlg6VjmiYBn6rWSTRCH6hvJ0hQrpcGq8oidsmHpTP8t8DGO9/vcWt9qabiqPgup1yKyQwvC2tSefZ73SSpNkUJ4PlLorlHZ+446nc8f3fIyywlJhwrTuwVSjBa1ccvSxN0hjjoK5xVrYZMd9V6XbFfgBukixTwGLg8sDam3dZR/wZ6L/dJlin1en8LS+bgpFbz3Ygvzu1J1HKxYNqxGpCmaCEo12rrBorD6LRp8UbpcdR5VWhTW35KlKd6QFqjuM2XzwlpnMxTvSkuUwuG/Xlg6NtPjbT6WFimF/VG6LEvXgn8QGDjMbBukVECFwhpoS+CQatfX2Q1q6H7wENHdrfCr0lKleEB9JyxNneus+VJpsVL9TwI6W65LovWIGl3KtVJaLv7LBwYTFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFEVQFEERFFWq/hFgADUMN4RzT6/OAAAAAElFTkSuQmCC">                <p class="toast_content">已评论</p>            </div>        </div>    </div>    <div id="js_article" class="rich_media">                <div id="js_top_ad_area" class="top_banner"></div>                        <div class="rich_media_inner">            <h2 class="rich_media_title" id="activity-name">                《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统             </h2>            <div class="rich_media_meta_list">                                <em id="post-date" class="rich_media_meta rich_media_meta_text">2015-01-15</em>                                <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="javascript:void(0);" id="post-user">数盟</a>            </div>            <div id="page-content">                <div id="img-content">                                                                                                                                                                <div class="rich_media_content" id="js_content"><h2 style="white-space: normal;"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHLy7XicYMANy9eEdfSZe4UcXPY3OYIkRQ9poJgibPc60Ato5X6HyfEpX6ictkUUT1SByctgUTQWAbxKQ/0" data-ratio="0.1067193675889328" data-w="506" width="auto" style="word-wrap: break-word !important; box-sizing: border-box !important; width: auto !important; visibility: visible !important; height: auto !important;" _width="auto" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0"></span></h2><h2 style="white-space: normal;"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"></span></h2><h2 style="white-space: normal;"><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">【数盟倡导“数据创造价值”，致力于打造最卓越的数据科学交流平台，为企业、个人提供最卓越的服务】</span></h2><p><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">————————————————————————<br></span></p><p><span style="color: rgb(255, 0, 0);"><strong><span style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">致歉：关于昨天推送的作者@<span class="name W_fb" style="">wzyer</span>的《关于拉格朗日乘子法与KKT条件》文章，因数盟君疏忽大意文章出处有误，现更正文章出自：慕知网http://www.moozhi.com/topic/show/54a8a261c555c08b3d59d996，数盟君在这里表示诚挚的歉意，跪求原谅T^T </span></strong></span></p><p><strong>———————————————————————</strong></p><p><br></p><p style="">翻译：jizhang</p><p style=""><br></p><p style="">内容：</p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>推荐系统工作原理</p></li><li><p>社会化协同过滤工作原理</p></li><li><p>如何找到相似物品</p></li><li><p>曼哈顿距离</p></li><li><p>欧几里得距离</p></li><li><p>闵可夫斯基距离</p></li><li><p>皮尔逊相关系数</p></li><li><p>余弦相似度</p></li><li><p>使用Python实现K最邻近算法</p></li><li><p>图书漂流站（BookCrossing）数据集</p></li></ul><h2 style=""><strong>你喜欢的东西我也喜欢</strong></h2><p style="">我们将从推荐系统开始，开启数据挖掘之旅。推荐系统无处不在，如亚马逊网站的“看过这件商品的顾客还购买过”板块：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uIKbGicISic8oiaAWOMFbTOOKNfqEiaGPjbxmgShTVss7nkfP9cXzv51bWw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095199" data-type="png" data-ratio="0.4407114624505929" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(1)"></p><p style="">last.fm上对音乐和演唱会的推荐（相似歌手）：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uT1TaOG0ZNkUmXEvYKD87FQN70iaEMEhffHwJibfS9oZaUNXES2ezbI0g/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095200" data-type="png" data-ratio="0.7391304347826086" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(2)"></p><p style="">在亚马逊的例子里，它用了两个元素来进行推荐：一是我浏览了里维斯翻译的《法华经》一书；二是其他浏览过该书的顾客还浏览过的译作。</p><p style="">本章我们讲述的推荐方法称为协同过滤。顾名思义，这个方法是利用他人的喜好来进行推荐，也就是说，是大家一起产生的推荐。他的工作原理是这样的：如果要推荐一本书给你，我会在网站上查找一个和你类似的用户，然后将他喜欢的书籍推荐给你——比如巴奇加卢比的《发条女孩》。</p><h3 style=""><strong>如何找到相似的用户？</strong></h3><p style="">所以首先要做的工作是找到相似的用户。这里用最简单的二维模型来描述。假设用户会在网站用五颗星来评价一本书——没有星表示书写得很糟，五颗星表示很好。因为我们用的是二维模型，所以仅对两本书进行评价：史蒂芬森的《雪崩》（纵轴）和拉尔森的《龙纹身的女孩》（横轴）。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uv5WuaqMpBOghHg2V1KJFGhzjq7VG4c5h6FJZb7K2TFbsujMvgUDHYg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095201" data-type="png" data-ratio="0.9175257731958762" data-w="388" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(3)"></p><p style="">首先，下表显示有三位用户对这两本书做了评价：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uia7V3Y2k9JZsjjc3UMctTKbICRVUZFml4tib6gz4jiawsYppytgiaIGveg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095202" data-type="png" data-ratio="0.18379446640316205" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(4)"></p><p style="">现在我想为神秘的X先生推荐一本书，他给《雪崩》打了四星，《龙纹身的女孩》两星。第一个任务是找出哪个用户和他最为相似。我们用距离来表示。</p><h3 style=""><strong>曼哈顿距离</strong></h3><p style="">最简单的距离计算方式是曼哈顿距离。在二维模型中，每个人都可以用(x, y)的点来表示，这里我用下标来表示不同的人，(x<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">1</span>, y<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">1</span>)表示艾米，(x<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">2</span>, y<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">2</span>)表示那位神秘的X先生，那么他们之间的曼哈顿距离就是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uuYz9n6uvB0DFTygdfo9ic4Kl214dzNbnRhztkjD9tRCpUiawv6W1FHEg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095203" data-type="png" data-ratio="0.21084337349397592" data-w="166" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(5)"></p><p style="">也就是x之差的绝对值加上y之差的绝对值，这样他们的距离就是4。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1ulicsOkWzunUnW0Qlh54sHBar2shKcIWcNiabv6AhIknZV9VHibA4ia1fqA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095204" data-type="png" data-ratio="0.9587628865979382" data-w="388" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(6)"></p><p style="">完整的计算结果如下：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uHcGNsKSvORgw4OnlcmHGPq98GFjQzrvfQyJeMFvsPKVug0pbPEiacicA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095205" data-type="png" data-ratio="0.17984189723320157" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(7)"></p><p style="">艾米的距离最近，在她的浏览历史中可以看到她曾给巴奇加卢比的《发条女孩》打过五星，于是我们就可以把这本书推荐给X先生。</p><h3 style=""><strong>欧几里得距离</strong></h3><p style="">曼哈顿距离的优点之一是计算速度快，对于Facebook这样需要计算百万用户之间的相似度时就非常有利。</p><p style=""><strong>勾股定理</strong></p><p style="">也许你还隐约记得勾股定理。另一种计算距离的方式就是看两点之间的直线距离：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uv1SIphMMicGw31bJiaA0ibJybMKibH33DXs4a42NC5m8QSELpfJZxdCBxQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095206" data-type="png" data-ratio="0.9522388059701492" data-w="335" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(8)"></p><p style="">利用勾股定理，我们可以如下计算距离：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uZ74NqI2163jdV7diampXYMfiae2l2T7jlymgOjdibBdVicTiawdQagR3jaQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095207" data-type="png" data-ratio="0.35883905013192613" data-w="379" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(9)"></p><p style="">这条斜线就是欧几里得距离，公式是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1urExMTqTHp2NbXEWTfibLbFUmPfnFkCXHicewRXNibmiaTX0vZIhyHLopzg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095208" data-type="png" data-ratio="0.18840579710144928" data-w="207" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(10)"></p><p style="">回顾一下，这里的x<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">1</span>表示用户1喜欢《龙纹身》的程度，x<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">2</span>是用户2喜欢这本书的程度；y<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">1</span>则是用户1喜欢《雪崩》的程度，y<span style="   font-size: 12px; line-height: 0; vertical-align: baseline; bottom: -0.25em; ">2</span>是用户2喜欢这本书的程度。</p><p style="">艾米给《龙纹身》和《雪崩》都打了五颗星，神秘的X先生分别打了两星和四星，这样他们之间的欧几里得距离就是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uiabc8UTgTZWwzGwRiazNhHTODGlrFWTmuY7XLEogk1UwQibE6kfOeA03A/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095209" data-type="png" data-ratio="0.08115183246073299" data-w="382" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(11)"></p><p style="">以下是全部用户的计算结果：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uGXx39BFF2mX3wufIPm6sCZgXysnc9micV1xzFMTCWWLpxWoF2CXiawgA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095210" data-type="png" data-ratio="0.17984189723320157" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(12)"></p><h3 style=""><strong>N维模型</strong></h3><p style="">刚才我们仅仅对两本书进行评价（二维模型），下面让我们扩展一下，尝试更复杂的模型。假设我们现在要为一个在线音乐网站的用户推荐乐队。用户可以用1至5星来评价一个乐队，其中包含半星（如2.5星）。下表展示了8位用户对8支乐队的评价：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uIUyeGp0CIQpSwsibfy9tQIdJv76TN4tjk7Q3R3eEzy6TMib75iadvZtgQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095211" data-type="png" data-ratio="0.39723320158102765" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(13)"></p><p style="">表中的短横表示这位用户没有给这支乐队打分。我们在计算两个用户的距离时，只采用他们都评价过的乐队，比如要计算Angelica和Bill的距离，我们只会用到5支乐队。这两个用户的曼哈顿距离为：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uibQmbeIxYaPBzUmZWt1shkbCHbayjsibzRSPSCazVwQC4nXoYEa6b5WQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095212" data-type="png" data-ratio="0.48221343873517786" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(14)"></p><p style="">最后距离即是上方数据的加和：(1.5 + 1.5 + 3 + 2 + 1)。</p><p style="">计算欧几里得距离的方法也是类似的，我们也只取双方都评价过的乐队。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u2oU7Wib2liczFzb38RuW1BDLBXGichxdicyic9SpwAu4c81NDozOdFG7p5Q/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095213" data-type="png" data-ratio="0.48221343873517786" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(15)"></p><p style="">用公式来描述即：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u5HgsuTq0EyfFCbCW2fK6IiclelYTKGHfqgB4luW2wCMictwtGSDWc5Hw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095214" data-type="png" data-ratio="0.4268774703557312" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(16)"></p><p style=""><strong>掌握了吗？</strong> 那就试试计算其他几个用户之间的距离吧。</p><p style=""><img class="alignnone size-full wp-image-8062" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uibLqcFuOlMB9564wowz0wwEEDXfNIBRlKUvzCJL8cNO8zjiaDrW0Zic6w/0" width="331" height="428" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095215" data-type="png" data-ratio="1.2930513595166162" data-w="331" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(17)"></p><p style=""><strong>有个瑕疵</strong></p><p style="">当我们计算Hailey和Veronica的距离时会发现一个问题：他们共同评价的乐队只有两支（Norah Jones和The Strokes），而Hailey和Jordyn共同评价了五支乐队，这似乎会影响我们的计算结果，因为Hailey和Veronica之间是二维的，而Haily和Veronica之间是五维的。曼哈顿距离和欧几里得距离在数据完整的情况下效果最好。如何处理缺失数据，这在研究领域仍是一个活跃的话题。本书的后续内容会进行一些讨论，这里先不展开。现在，让我们开始构建一个推荐系统吧。</p><h3 style=""><strong>推广：闵可夫斯基距离</strong></h3><p style="">我们可以将曼哈顿距离和欧几里得距离归纳成一个公式，这个公式称为闵可夫斯基距离：</p><p style=""><img class="alignnone size-full wp-image-8063" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uWHoiaXohzMByKgicJxLz2INEu2WznqHeia4hnu5ibJIAicukd9sNqqY2SPQ/0" width="246" height="78" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095216" data-type="png" data-ratio="0.3170731707317073" data-w="246" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(18)"></p><p style="">其中：</p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p><code style="">r = 1</code> 该公式即曼哈顿距离</p></li><li><p><code style="">r = 2</code> 该公式即欧几里得距离</p></li><li><p><code style="">r = ∞</code> 极大距离</p></li></ul><p style=""><img class="alignnone size-full wp-image-8064" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u86qGj6W0mliaZKVvU9O7OaHmu5o45OOJSHXVdDJ72LhaEIhc3xjauhA/0" width="665" height="211" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095217" data-type="png" data-ratio="0.3181818181818182" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(19)"></p><p style="">当你在书中看到这些数学公式，你可以选择快速略过它，继续读下面的文字，过去我就是这样；你也可以停下来，好好分析一下这些公式，会发现其实它们并不难理解。比如上面的公式，当r = 1时，可以简化成如下形式：</p><p style=""><img class="alignnone size-full wp-image-8065" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uWBEB9e7yCcnYzt2dl1m95JypU7AS4nvnvCaT6KNRTdWBL89ibUHBPrw/0" width="173" height="43" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095218" data-type="png" data-ratio="0.24855491329479767" data-w="173" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(20)"></p><p style="">仍用上文的音乐站点为例，x和y分别表示两个用户，d(x, y)表示他们之间的距离，n表示他们共同评价过的乐队数量，我们之前已经做过计算：</p><p style=""><img class="alignnone size-full wp-image-8066" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uDHLybyBhT12nfVstMzswpzHDdIJTug7UDeiaoiaWqIBic7fXdMORsBInA/0" width="600" height="283" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095219" data-type="png" data-ratio="0.4723320158102767" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(21)"></p><p style="">其中Difference一栏表示两者评分之差的绝对值，加起来等于9，也就是他们之间的距离。</p><p style="">当r = 2时，我们得到欧几里得距离的计算公式：</p><p style=""><img class="alignnone size-full wp-image-8067" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u9k4xk8pv8vkq79ibiaattQP1sSP0egMOiasnHBpj3BAicTCic5137FyEFSA/0" width="192" height="46" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095220" data-type="png" data-ratio="0.23958333333333334" data-w="192" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(22)"></p><p style=""><strong>提前预告一下：r值越大，单个维度的差值大小会对整体距离有更大的影响。</strong></p><p style=""><img class="alignnone size-full wp-image-8068" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u3icuOKaicerW9j61EiclKdh0TibL7GgBdPgzTwPCzThWPCEZGHckKFgZcQ/0" width="254" height="292" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095221" data-type="png" data-ratio="1.1496062992125984" data-w="254" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(23)"></p><h2 style=""><span style="font-size: 18px;"><strong>使用Python代码来表示数据（终于要开始编程了）</strong></span></h2><p style="">在Python中，我们可以用多种方式来描述上表中的数据，这里我选择Python的字典类型（或者称为关联数组、哈希表）。</p><p style="">注：本书的所有代码可以在这里找到。</p><pre style="">users <span class="pl-k">=</span> {<span class="pl-s1"><span class="pl-pds">"</span>Angelica<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">3.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">1.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">2.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Vampire Weekend<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Bill<span class="pl-pds">"</span></span>:{<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">3.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Deadmau5<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">3.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Vampire Weekend<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Chan<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">1.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Deadmau5<span class="pl-pds">"</span></span>: <span class="pl-c1">1.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">1.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Dan<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Deadmau5<span class="pl-pds">"</span></span>: <span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Vampire Weekend<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Hailey<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Deadmau5<span class="pl-pds">"</span></span>: <span class="pl-c1">1.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Vampire Weekend<span class="pl-pds">"</span></span>: <span class="pl-c1">1.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Jordyn<span class="pl-pds">"</span></span>:  {<span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>Deadmau5<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Vampire Weekend<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Sam<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Broken Bells<span class="pl-pds">"</span></span>: <span class="pl-c1">2.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>},         <span class="pl-s1"><span class="pl-pds">"</span>Veronica<span class="pl-pds">"</span></span>: {<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">2.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>}
        }</pre><p style="">我们可以用以下方式来获取某个用户的评分：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> user[<span class="pl-s1"><span class="pl-pds">"</span>Veronica<span class="pl-pds">"</span></span>]
{<span class="pl-s1"><span class="pl-pds">"</span>Blues Traveler<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Norah Jones<span class="pl-pds">"</span></span>: <span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Phoenix<span class="pl-pds">"</span></span>: <span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">"</span>Slightly Stoopid<span class="pl-pds">"</span></span>: <span class="pl-c1">2.5</span>, <span class="pl-s1"><span class="pl-pds">"</span>The Strokes<span class="pl-pds">"</span></span>: <span class="pl-c1">3.0</span>}<span class="pl-k">&gt;&gt;&gt;</span></pre><h3 style=""><strong>计算曼哈顿距离</strong></h3><pre style=""><span class="pl-st">def</span> <span class="pl-en">manhattan</span>(<span class="pl-vpf">rating1</span>, <span class="pl-vpf">rating2</span>):    <span class="pl-s1"><span class="pl-pds">"""</span>计算曼哈顿距离。rating1和rating2参数中存储的数据格式均为</span><span class="pl-s1">    {'The Strokes': 3.0, 'Slightly Stoopid': 2.5}<span class="pl-pds">"""</span></span>
    distance <span class="pl-k">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">for</span> key <span class="pl-k">in</span> rating1:        <span class="pl-k">if</span> key <span class="pl-k">in</span> rating2:
            distance <span class="pl-k">+=</span> <span class="pl-s3">abs</span>(rating1[key] <span class="pl-k">-</span> rating2[key])    <span class="pl-k">return</span> distance</pre><p style="">我们可以做一下测试：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> manhattan(users[<span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>], users[<span class="pl-s1"><span class="pl-pds">'</span>Veronica<span class="pl-pds">'</span></span>])<span class="pl-c1">2.0</span><span class="pl-k">&gt;&gt;&gt;</span> manhattan(users[<span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>], users[<span class="pl-s1"><span class="pl-pds">'</span>Jordyn<span class="pl-pds">'</span></span>])<span class="pl-c1">7.5</span><span class="pl-k">&gt;&gt;&gt;</span></pre><p style="">下面我们编写一个函数来找出距离最近的用户（其实该函数会返回一个用户列表，按距离排序）：</p><pre style=""><span class="pl-st">def</span> <span class="pl-en">computeNearestNeighbor</span>(<span class="pl-vpf">username</span>, <span class="pl-vpf">users</span>):    <span class="pl-s1"><span class="pl-pds">"""</span>计算所有用户至username用户的距离，倒序排列并返回结果列表<span class="pl-pds">"""</span></span>
    distances <span class="pl-k">=</span> []    <span class="pl-k">for</span> user <span class="pl-k">in</span> users:        <span class="pl-k">if</span> user <span class="pl-k">!=</span> username:
            distance <span class="pl-k">=</span> manhattan(users[user], users[username])
            distances.append((distance, user))    <span class="pl-c"># 按距离排序——距离近的排在前面</span>
    distances.sort()    <span class="pl-k">return</span> distances</pre><p style="">简单测试一下：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> computeNearestNeighbor(<span class="pl-s1"><span class="pl-pds">"</span>Hailey<span class="pl-pds">"</span></span>, users)
[(<span class="pl-c1">2.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Veronica<span class="pl-pds">'</span></span>), (<span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Chan<span class="pl-pds">'</span></span>), (<span class="pl-c1">4.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Sam<span class="pl-pds">'</span></span>), (<span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Dan<span class="pl-pds">'</span></span>), (<span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>), (<span class="pl-c1">5.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Bill<span class="pl-pds">'</span></span>), (<span class="pl-c1">7.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Jordyn<span class="pl-pds">'</span></span>)]</pre><p style="">最后，我们结合以上内容来进行推荐。假设我想为Hailey做推荐，这里我找到了离他距离最近的用户Veronica。然后，我会找到出Veronica评价过但Hailey没有评价的乐队，并假设Hailey对这些陌生乐队的评价会和Veronica相近。比如，Hailey没有评价过Phoenix乐队，而Veronica对这个乐队打出了4分，所以我们认为Hailey也会喜欢这支乐队。下面的函数就实现了这一逻辑：</p><pre style=""><span class="pl-st">def</span> <span class="pl-en">recommend</span>(<span class="pl-vpf">username</span>, <span class="pl-vpf">users</span>):    <span class="pl-s1"><span class="pl-pds">"""</span>返回推荐结果列表<span class="pl-pds">"""</span></span>
    <span class="pl-c"># 找到距离最近的用户</span>
    nearest <span class="pl-k">=</span> computeNearestNeighbor(username, users)[<span class="pl-c1">0</span>][<span class="pl-c1">1</span>]
    recommendations <span class="pl-k">=</span> []    <span class="pl-c"># 找出这位用户评价过、但自己未曾评价的乐队</span>
    neighborRatings <span class="pl-k">=</span> users[nearest]
    userRatings <span class="pl-k">=</span> users[username]    <span class="pl-k">for</span> artist <span class="pl-k">in</span> neighborRatings:        <span class="pl-k">if</span> <span class="pl-k">not</span> artist <span class="pl-k">in</span> userRatings:
            recommendations.append((artist, neighborRatings[artist]))    <span class="pl-c"># 按照评分进行排序</span>
    <span class="pl-k">return</span> <span class="pl-s3">sorted</span>(recommendations, <span class="pl-vpf">key</span><span class="pl-k">=</span><span class="pl-st">lambda</span> <span class="pl-vpf">artistTuple</span>: artistTuple[<span class="pl-c1">1</span>], <span class="pl-vpf">reverse</span> <span class="pl-k">=</span> <span class="pl-c1">True</span>)</pre><p style="">下面我们就可以用它来为Hailey做推荐了：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> recommend(<span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>, users)
[(<span class="pl-s1"><span class="pl-pds">'</span>Phoenix<span class="pl-pds">'</span></span>, <span class="pl-c1">4.0</span>), (<span class="pl-s1"><span class="pl-pds">'</span>Blues Traveler<span class="pl-pds">'</span></span>, <span class="pl-c1">3.0</span>), (<span class="pl-s1"><span class="pl-pds">'</span>Slightly Stoopid<span class="pl-pds">'</span></span>, <span class="pl-c1">2.5</span>)]</pre><p style="">运行结果和我们的预期相符。我们看可以看到，和Hailey距离最近的用户是Veronica，Veronica对Phoenix乐队打了4分。我们再试试其他人：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> recommend(<span class="pl-s1"><span class="pl-pds">'</span>Chan<span class="pl-pds">'</span></span>, users)
[(<span class="pl-s1"><span class="pl-pds">'</span>The Strokes<span class="pl-pds">'</span></span>, <span class="pl-c1">4.0</span>), (<span class="pl-s1"><span class="pl-pds">'</span>Vampire Weekend<span class="pl-pds">'</span></span>, <span class="pl-c1">1.0</span>)]<span class="pl-k">&gt;&gt;&gt;</span> recommend(<span class="pl-s1"><span class="pl-pds">'</span>Sam<span class="pl-pds">'</span></span>, users)
[(<span class="pl-s1"><span class="pl-pds">'</span>Deadmau5<span class="pl-pds">'</span></span>, <span class="pl-c1">1.0</span>)]</pre><p style="">我们可以猜想Chan会喜欢The Strokes乐队，而Sam不会太欣赏Deadmau5。</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> recommend(<span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>, users)
[]</pre><p style="">对于Angelica，我们得到了空的返回值，也就是说我们无法对其进行推荐。让我们看看是哪里有问题：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> computeNearestNeighbor(<span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>, users)
[(<span class="pl-c1">3.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Veronica<span class="pl-pds">'</span></span>), (<span class="pl-c1">4.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Chan<span class="pl-pds">'</span></span>), (<span class="pl-c1">5.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>), (<span class="pl-c1">8.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Sam<span class="pl-pds">'</span></span>), (<span class="pl-c1">9.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Bill<span class="pl-pds">'</span></span>), (<span class="pl-c1">9.0</span>, <span class="pl-s1"><span class="pl-pds">'</span>Dan<span class="pl-pds">'</span></span>), (<span class="pl-c1">9.5</span>, <span class="pl-s1"><span class="pl-pds">'</span>Jordyn<span class="pl-pds">'</span></span>)]</pre><p style="">Angelica最相似的用户是Veronica，让我们回头看看数据：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u89ePvdNyT9wwQe82FOYNRU29go83ZEzvjlDF66fCNkhQ3MgLeX2VGg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095222" data-type="png" data-ratio="0.39723320158102765" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(24)"></p><p style="">我们可以看到，Veronica评价过的乐队，Angelica也都评价过了，所以我们没有推荐。</p><p style="">之后，我们会讨论如何解决这一问题。</p><p style=""><strong>作业：实现一个计算闵可夫斯基距离的函数，并在计算用户距离时使用它。</strong></p><pre style=""><span class="pl-st">def</span> <span class="pl-en">minkowski</span>(<span class="pl-vpf">rating1</span>, <span class="pl-vpf">rating2</span>, <span class="pl-vpf">r</span>):
    distance <span class="pl-k">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">for</span> key <span class="pl-k">in</span> rating1:        <span class="pl-k">if</span> key <span class="pl-k">in</span> rating2:
            distance <span class="pl-k">+=</span> <span class="pl-s3">pow</span>(<span class="pl-s3">abs</span>(rating1[key] <span class="pl-k">-</span> rating2[key]), r)    <span class="pl-k">return</span> <span class="pl-s3">pow</span>(distance, <span class="pl-c1">1.0</span> <span class="pl-k">/</span> r)<span class="pl-c"># 修改computeNearestNeighbor函数中的一行</span>distance <span class="pl-k">=</span> minkowski(users[user], users[username], <span class="pl-c1">2</span>)<span class="pl-c"># 这里2表示使用欧几里得距离</span></pre><h3 style=""><strong>用户的问题</strong></h3><p style="">让我们仔细看看用户对乐队的评分，可以发现每个用户的打分标准非常不同：</p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>Bill没有打出极端的分数，都在2至4分之间；</p></li><li><p>Jordyn似乎喜欢所有的乐队，打分都在4至5之间；</p></li><li><p>Hailey是一个有趣的人，他的分数不是1就是4。</p></li></ul><p style="">那么，如何比较这些用户呢？比如Hailey的4分相当于Jordan的4分还是5分呢？我觉得更接近5分。这样一来就会影响到推荐系统的准确性了。</p><p style=""><img class="alignnone size-full wp-image-8069" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uvC8YLKGTIr2qXjmAqe6jGuM2bGOdKkA2g4OkVKmySRmqDtH9cKX2FA/0" width="628" height="392" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095223" data-type="png" data-ratio="0.6245059288537549" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(25)"></p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>左：我非常喜欢Broken Bells乐队，所以我给他们打4分！</p></li><li><p>右：Broken Bells乐队还可以，我打4分。</p></li></ul><h3 style=""><strong>皮尔逊相关系数</strong></h3><p style="">解决方法之一是使用皮尔逊相关系数。简单起见，我们先看下面的数据（和之前的数据不同）：</p><p style=""><img class="alignnone size-full wp-image-8070" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uvGt7J6eeGtF9VDOt8NoOGfdNaBFapjEucLlBkKl1XKsFyWO6Au92sA/0" width="683" height="171" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095224" data-type="png" data-ratio="0.2509881422924901" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(26)"></p><p style="">这种现象在数据挖掘领域称为“分数膨胀”。Clara最低给了4分——她所有的打分都在4至5分之间。我们将它绘制成图表：</p><p style=""><img class="alignnone size-full wp-image-8071" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uPNwn9z2xu4gj8en1l2HIibyesuTickOXariaMdTOd9A349juJUXOvJF4g/0" width="599" height="363" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095225" data-type="png" data-ratio="0.6067193675889329" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(27)"></p><p style=""><strong>一条直线——完全吻合！！！</strong></p><p style="">直线即表示Clara和Robert的偏好完全一致。他们都认为Phoenix是最好的乐队，然后是Blues Traveler、Norah Jones。如果Clara和Robert的意见不一致，那么落在直线上的点就越少。</p><p style=""><strong>意见基本一致的情形</strong></p><p style=""><img class="alignnone size-full wp-image-8072" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uMy0MRlEwQeQQpDVzXYwvaytBia5GmLQlaiaXNibIUhrfmtlugvNRIqTYQ/0" width="530" height="318" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095226" data-type="png" data-ratio="0.6007905138339921" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(28)"></p><p style=""><strong>意见不太一致的情形</strong></p><p style=""><img class="alignnone size-full wp-image-8073" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1ujlqPiaafXicBSuAFtKIEallqOugznIibCFRzfzrYvrTh14T6rog1xw4RQ/0" width="522" height="336" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095227" data-type="png" data-ratio="0.6442687747035574" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(29)"></p><p style="">所以从图表上理解，意见相一致表现为一条直线。皮尔逊相关系数用于衡量两个变量之间的相关性（这里的两个变量指的是Clara和Robert），它的值在-1至1之间，1表示完全吻合，-1表示完全相悖。从直观上理解，最开始的那条直线皮尔逊相关系数为1，第二张是0.91，第三张是0.81。因此我们利用这一点来找到相似的用户。</p><p style="">皮尔逊相关系数的计算公式是：</p><p style=""><img class="alignnone size-full wp-image-8075" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uZs24O46ib16Uu042GsZKJ5ia0tmkVuWU8ibLKDr4tvKhPUn39LXIPkxBA/0" width="710" height="429" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095228" data-type="png" data-ratio="0.6047430830039525" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(30)"></p><p style="">这里我说说自己的经历。我大学读的是现代音乐艺术，课程包括芭蕾、现代舞、服装设计等，没有任何数学课程。我高中读的是男子学校，学习了管道工程和汽车维修，只懂得很基础的数学知识。不知是因为我的学科背景，还是习惯于用直觉来思考，当我遇到这样的数学公式时会习惯性地跳过，继续读下面的文字。如果你和我一样，我强烈建议你与这种惰性抗争，试着去理解这些公式。它们虽然看起来很复杂，但还是能够被常人所理解的。</p><p style="">上面的公式除了看起来比较复杂，另一个问题是要获得计算结果必须对数据做多次遍历。好在我们有另外一个公式，能够计算皮尔逊相关系数的近似值：</p><p style=""><img class="alignnone size-full wp-image-8076" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1ueICwiat6BSvQAuOqrMR53QqRYfdGV4Licsib91SeYPDu0CAJgtN6AXJHw/0" width="533" height="189" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095229" data-type="png" data-ratio="0.35375494071146246" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(31)"></p><p style="">这个公式虽然看起来更加复杂，而且其计算结果会不太稳定，有一定误差存在，但它最大的优点是，用代码实现的时候可以只遍历一次数据，我们会在下文看到。首先，我们将这个公式做一个分解，计算下面这个表达式的值：</p><p style=""><img class="alignnone size-full wp-image-8079" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u7M69ggpmHd9XRqwdn7q9wB3t4FvAZQ3H0gvdXNTdPmrGCCLmvic3kwQ/0" width="89" height="49" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095230" data-type="png" data-ratio="0.550561797752809" data-w="89" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(32)"></p><p style="">对于Clara和Robert，我们可以得到：</p><p style=""><img class="alignnone size-full wp-image-8080" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u6EBz1Pno0pGiaPDylDPQc9W6RLicUtb3ZArY5dFMtsGGZYbMXHUibHBXw/0" width="399" height="95" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" id="c1421325095231" data-type="png" data-ratio="0.23809523809523808" data-w="399" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(33)"></p><p style="">很简单把？下面我们计算这个公式：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uYlllVmG8v6wL0bLcvHNJCaiaEKgkUpMlnZsKVXUiaYH3sibVGN8Skhnbw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095232" data-type="png" data-ratio="0.5448275862068965" data-w="145" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(34)"></p><p style="">Clara的总评分是22.5， Robert是15，他们评价了5支乐队，因此：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uoI489MfPbdgnHOUicA8hibREA4U9ib7OMbn6CA5yAl8XyrxAm1qibfunbQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095233" data-type="png" data-ratio="0.40559440559440557" data-w="143" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(35)"></p><p style="">所以，那个巨型公式的分子就是70 – 67.5 = 2.5。</p><p style="">下面我们来看分母：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uDabJ7ict71X64akPhD5kxlRFJrEzVavVXvJyU1ZLbuicdUERQXzr0INg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095234" data-type="png" data-ratio="0.4714285714285714" data-w="210" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(36)"></p><p style="">首先：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uExnAWhEJosS8ZR5rky5YSib7gdOicdVyEQsgVBqK0XtkdjGlE8CibCdKQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095235" data-type="png" data-ratio="0.35177865612648224" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(37)"></p><p style="">我们已经计算过Clara的总评分是22.5，它的平方是506.25，除以乐队的数量5，得到101.25。综合得到：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1ulMYfMDdIb8vcfI4O7ic2dUib3JIMpQ8GAUvPw5QERfuDNiaibJ496l4xTw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095236" data-type="png" data-ratio="0.12459016393442623" data-w="305" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(38)"></p><p style="">对于Robert，我们用同样的方法计算：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1ugJzZe9icRiatVCx033FgScibDBgfpLsOY8UBvQS04wj42t3VlVic1yV1Yg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095237" data-type="png" data-ratio="0.2358974358974359" data-w="390" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(39)"></p><p style="">最后得到：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1unA2TrrUXGtbKEcX8QpECyTpzkBu5Gicn4j6AweGcTQwqDG18QZzS1UA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095238" data-type="png" data-ratio="0.21637426900584794" data-w="342" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(40)"></p><p style="">因此，1表示Clara和Robert的偏好完全吻合。</p><p style=""><strong>先休息一下吧</strong></p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uQHl8BfibZy8fcWu3sicawHExIiaq1ibWiaNveKMCby7joiatvxFxibA5ldrJw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095239" data-type="png" data-ratio="1.0188679245283019" data-w="265" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(41)"></p><p style=""><strong>计算皮尔逊相关系数的代码</strong></p><pre style=""><span class="pl-k">from</span> math <span class="pl-k">import</span> sqrt<span class="pl-st">def</span> <span class="pl-en">pearson</span>(<span class="pl-vpf">rating1</span>, <span class="pl-vpf">rating2</span>):
    sum_xy <span class="pl-k">=</span> <span class="pl-c1">0</span>
    sum_x <span class="pl-k">=</span> <span class="pl-c1">0</span>
    sum_y <span class="pl-k">=</span> <span class="pl-c1">0</span>
    sum_x2 <span class="pl-k">=</span> <span class="pl-c1">0</span>
    sum_y2 <span class="pl-k">=</span> <span class="pl-c1">0</span>
    n <span class="pl-k">=</span> <span class="pl-c1">0</span>
    <span class="pl-k">for</span> key <span class="pl-k">in</span> rating1:        <span class="pl-k">if</span> key <span class="pl-k">in</span> rating2:
            n <span class="pl-k">+=</span> <span class="pl-c1">1</span>
            x <span class="pl-k">=</span> rating1[key]
            y <span class="pl-k">=</span> rating2[key]
            sum_xy <span class="pl-k">+=</span> x <span class="pl-k">*</span> y
            sum_x <span class="pl-k">+=</span> x
            sum_y <span class="pl-k">+=</span> y
            sum_x2 <span class="pl-k">+=</span> <span class="pl-s3">pow</span>(x, <span class="pl-c1">2</span>)
            sum_y2 <span class="pl-k">+=</span> <span class="pl-s3">pow</span>(y, <span class="pl-c1">2</span>)    <span class="pl-c"># 计算分母</span>
    denominator <span class="pl-k">=</span> sqrt(sum_x2 <span class="pl-k">-</span> <span class="pl-s3">pow</span>(sum_x, <span class="pl-c1">2</span>) <span class="pl-k">/</span> n) <span class="pl-k">*</span> sqrt(sum_y2 <span class="pl-k">-</span> <span class="pl-s3">pow</span>(sum_y, <span class="pl-c1">2</span>) <span class="pl-k">/</span> n)    <span class="pl-k">if</span> denominator <span class="pl-k">==</span> <span class="pl-c1">0</span>:        <span class="pl-k">return</span> <span class="pl-c1">0</span>
    <span class="pl-k">else</span>:        <span class="pl-k">return</span> (sum_xy <span class="pl-k">-</span> (sum_x <span class="pl-k">*</span> sum_y) <span class="pl-k">/</span> n) <span class="pl-k">/</span> denominator</pre><p style="">测试一下：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> pearson(users[<span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>], users[<span class="pl-s1"><span class="pl-pds">'</span>Bill<span class="pl-pds">'</span></span>])<span class="pl-k">-</span><span class="pl-c1">0.9040534990682699</span><span class="pl-k">&gt;&gt;&gt;</span> pearson(users[<span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>], users[<span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>])<span class="pl-c1">0.42008402520840293</span><span class="pl-k">&gt;&gt;&gt;</span> pearson(users[<span class="pl-s1"><span class="pl-pds">'</span>Angelica<span class="pl-pds">'</span></span>], users[<span class="pl-s1"><span class="pl-pds">'</span>Jordyn<span class="pl-pds">'</span></span>])<span class="pl-c1">0.7639748605475432</span></pre><h2 style=""><strong>最后一个公式：余弦相似度</strong></h2><p style="">这里我将奉上最后一个公式：余弦相似度。它在文本挖掘中应用得较多，在协同过滤中也会使用到。为了演示如何使用该公式，我们换一个示例。这里记录了每个用户播放歌曲的次数，我们用这些数据进行推荐：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uWq0CBg76hu1oGZUpVCSM4IRObn1KzCIiax4YqztudjgLP945ZdgWt3A/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095240" data-type="png" data-ratio="0.3616600790513834" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(42)"></p><p style="">简单扫一眼上面的数据（或者用之前讲过的距离计算公式），我们可以发现Ann的偏好和Sally更为相似。</p><p style=""><strong>问题在哪儿？</strong></p><p style="">我在iTunes上有大约4000首歌曲，下面是我最常听的音乐：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u3iarjmaoyib2ibXP5Ufibx5QDVc01icGUPeKHePrZYR6miaASHS6ibXX7gqJA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095241" data-type="png" data-ratio="0.3221343873517787" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(43)"></p><p style="">可以看到，Moonlight Sonata这首歌我播放了25次，但很有可能你一次都没有听过。事实上，上面列出的这些歌曲可能你一首都没听过。此外，iTunes上有1500万首音乐，而我只听过4000首。所以说单个用户的数据是 <em>稀疏</em> 的，因为非零值较总体要少得多。当我们用1500万首歌曲来比较两个用户时，很有可能他们之间没有任何交集，这样一来就无从计算他们之间的距离了。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u0iaP7vibEkDhCkwJYEnPTOCAkhYuiaX86ibjGPHSE2keITaAgEk0yXKKsw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095242" data-type="png" data-ratio="1.3482758620689654" data-w="290" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(44)"></p><p style="">类似的情况是在计算两篇文章的相似度时。比如说我们想找一本和《The Space Pioneers》相类似的书，方法之一是利用单词出现的频率，即统计每个单词在书中出现的次数占全书单词的比例，如“the”出现频率为6.13%，“Tom” 0.89%，“space” 0.25%。我们可以用这些数据来寻找一本相近的书。但是，这里同样有数据的稀疏性问题。《The Space Pioneers》中有6629个不同的单词，但英语语言中有超过100万个单词，这样一来非零值就很稀少了，也就不能计算两本书之间的距离。</p><p style="">余弦相似度的计算中会略过这些非零值。它的计算公式是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uJzBlSOiat9o07nIiaQ2xRbXy4w0IQic5icqfbGvibjZzSfvZhJP9viaDcaPA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095243" data-type="png" data-ratio="0.336322869955157" data-w="223" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(45)"></p><p style="">其中，“·”号表示数量积。“||x||”表示向量x的模，计算公式是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1u3FlImsRbFbWGSLk57MtTgcqK6BKiajWRFc0SCQFPaLCiaxM1Rjic3tTGg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095244" data-type="png" data-ratio="0.6373626373626373" data-w="91" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(46)"></p><p style="">我们用上文中“偏好完全一致”的示例：</p><p style=""><img class="alignnone size-full wp-image-8077" data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uLFBJAzZcpHMCBe4ICeTYWMe0j3qfrDicOxJRbiaZfwfjribepsPnXe1qg/0" width="683" height="171" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: 506px !important; visibility: visible !important; height: 127px !important;" id="c1421325095245" data-type="png" data-ratio="0.2509881422924901" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(47)"></p><p style="">所以两个向量为：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uI0Ft70GmKNxtCqPm88Jn29eL7zoPNAibzxhYVdvKUvkWwnQctvTicbyw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095246" data-type="png" data-ratio="0.29591836734693877" data-w="196" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(48)"></p><p style="">它们的模是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uia5cDuZDk2MVf3jwRTR95utbDefmfJraNb2yia0PAAdFWY08b1tUKMLQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095247" data-type="png" data-ratio="0.24678111587982832" data-w="466" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(49)"></p><p style="">数量积的计算：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uiaX7KLnClnaPteTazkVicvBxrPGqqkECgFk3auNy5LSMHyKNOwIsFUjg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095248" data-type="png" data-ratio="0.07739307535641547" data-w="491" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(50)"></p><p style="">因此余弦相似度是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uRXFNsDSlfZqs2oCic7iahtAERlWm71cHd0ictIAibBcABELtKiccT2AwxLA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095249" data-type="png" data-ratio="0.1977077363896848" data-w="349" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(51)"></p><p style="">余弦相似度的范围从1到-1，1表示完全匹配，-1表示完全相悖。所以0.935表示匹配度很高。</p><p style=""><strong>作业：尝试计算Angelica和Veronica的余弦相似度</strong></p><h3 style=""><strong>应该使用哪种相似度？</strong></h3><p style="">我们整本书都会探索这个问题，以下是一些提示：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uSHJckyia5egII2rvTHiaNKy5ULzVycFQlLJ3SHdMWwAbvTxurCcGEtTw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095250" data-type="png" data-ratio="0.8901601830663616" data-w="437" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(52)"></p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>如果数据存在“分数膨胀”问题，就使用皮尔逊相关系数。</p></li><li><p>如果数据比较“密集”，变量之间基本都存在公有值，且这些距离数据是非常重要的，那就使用欧几里得或曼哈顿距离。</p></li><li><p>如果数据是稀疏的，则使用余弦相似度。</p></li></ul><p style="">所以，如果数据是密集的，曼哈顿距离和欧几里得距离都是适用的。那么稀疏的数据可以使用吗？我们来看一个也和音乐有关的示例：假设有三个人，每人都给100首音乐评过分。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uNkovJN8LRglLk1dgYEsHSpx3Eic6j3KxiaShcCmfkicqxEGcNYp0GUv8Q/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095251" data-type="png" data-ratio="0.6778656126482213" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(53)"></p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>Jake（左）：乡村音乐的忠实听众。</p></li><li><p>Linda和Eric（右）：我们爱六十年代的摇滚乐！</p></li></ul><p style="">Linda和Eric喜欢相同的音乐，他们的评分列表中有20首相同的的歌曲，且评分均值相差不到0.5！所以他们之间的曼哈顿距离为20 x 0.5 = 10，欧几里得距离则为：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uDlF6tYlKicfniaV5fOgxkWV1Tv1Zf1kHm4v02CfOpU5pPg7fHAcZbm5w/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095252" data-type="png" data-ratio="0.11566265060240964" data-w="415" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(54)"></p><p style="">Linda和Jake只共同评分了一首歌曲：Chris Cagle的 <em>What a Beautiful Day</em> 。Linda打了3分，Jake打了5分，所以他们之间的曼哈顿距离为2，欧几里得距离为：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uRGJKYia6iaaoicEbauTtugzEbRq07kB1W0ufrqDy2x7LC5LaZdPbSOzEA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095253" data-type="png" data-ratio="0.23651452282157676" data-w="241" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(55)"></p><p style="">所以不管是曼哈顿距离还是欧几里得距离，Jake都要比Eric离Linda近，这不符合实际情况。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uicdWQJJCgbp0EYzwyfgMSEzpSdFqrMQQVEFjLBkJdBdqxvPB2jQzWJA/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095254" data-type="png" data-ratio="0.7372093023255814" data-w="430" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(56)"></p><blockquote style=""><p style="margin-top: 6px; padding: 0px;">嘿，我想到一个办法。人们给音乐打分是从1到5分，那些没有打分的音乐就统一给0分好了，这样就能解决数据稀疏的问题了！</p></blockquote><p style="">想法不错，但是这样做也不行。为了解释这一问题，我们再引入两个人到例子里来：Cooper和Kelsey。他们和Jake都有着非常相似的音乐偏好，其中Jake在我们网站上评价了25首歌曲。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uwEXz2CYOL8pMUUXJS9OcDJ6wkpibW7oybWp64HmO1okjQAkvibIuiaZqg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095255" data-type="png" data-ratio="0.717391304347826" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(57)"></p><p style="">Cooper评价了26首歌曲，其中25首和Jake是一样的。他们对每首歌曲的评价差值只有0.25！</p><p style="">Kelsey在我们网站上评价了150首歌曲，其中25首和Jake相同。和Cooper一样，她和Jake之间的评价差值也只有0.25！</p><p style="">所以我们从直觉上看Cooper和Keylsey离Jake的距离应该相似。但是，当我们计算他们之间的曼哈顿距离和欧几里得距离时（代入0值），会发现Cooper要比Keylsey离Jake近得多。</p><p style=""><strong>为什么呢？</strong></p><p style="">我们来看下面的数据：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1usxgfQ3vuYrZ8uiaaT63OU6CAyAg4CogA6BW2iaUekgSa01lXGBvh8kQw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095256" data-type="png" data-ratio="0.24110671936758893" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(58)"></p><p style="">从4、5、6这三首歌来看，两人离Jake的距离是相同的，但计算出的曼哈顿距离却不这么显示：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uEIVGpI229xCWgeN9WdvP3r59DExc0OzribbOmkKj8UZlRZiayh8sJibKQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095257" data-type="png" data-ratio="0.2924901185770751" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(59)"></p><p style="">问题就在于数据中的0值对结果的影响很大，所以用0代替空值的方法并不比原来的方程好。还有一种变通的方式是计算“平均值”——将两人共同评价过的歌曲分数除以歌曲数量。</p><p style="">总之，曼哈顿距离和欧几里得距离在数据完整的情况下会运作得非常好，如果数据比较稀疏，则要考虑使用余弦距离。</p><h3 style=""><strong>古怪的现象</strong></h3><p style="">假设我们要为Amy推荐乐队，她喜欢Phoenix、Passion Pit、以及Vampire Weekend。和她最相似的用户是Bob，他也喜欢这三支乐队。他的父亲为Walter Ostanek乐队演奏手风琴，所以受此影响，他给了这支乐队5星评价。按照我们现在的推荐逻辑，我们会将这支乐队推荐给Amy，但有可能她并不喜欢。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uWt4iaXa4tBibqCwjkSj2htHUkf8j95xiaxiccgHypiaqAV3HO67cEibEaOPQ/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: 350px !important; visibility: visible !important; height: 413px !important;" class="" id="c1421325095258" data-type="png" data-ratio="1.18" data-w="350" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(60)"></p><p style="">或者试想一下，Billy Bob Olivera教授喜欢阅读数据挖掘方面的书籍以及科幻小说，他最邻近的用户是我，因为我也喜欢这两种书。然而，我又是一个贵宾犬的爱好者，所以给《贵宾犬的隐秘生活》这本书打了很高的分。这样一来，现有的推荐方法会将这本书介绍给Olivera教授。</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uibcmlLxnWBa2Jm4nDBSbQtv4Ygh5WaNVSoCzcZSmXgTEY8YAdaQicc8A/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095259" data-type="png" data-ratio="0.8870056497175142" data-w="354" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(61)"></p><p style="">问题就在于我们只依靠最相似的 <strong>一个</strong> 用户来做推荐，如果这个用户有些特殊的偏好，就会直接反映在推荐内容里。解决方法之一是找寻多个相似的用户，这里就要用到K最邻近算法了。</p><h3 style=""><strong>K最邻近算法</strong></h3><p style="">在协同过滤中可以使用K最邻近算法来找出K个最相似的用户，以此作为推荐的基础。不同的应用有不同的K值，需要做一些实验来得出。以下给到读者一个基本的思路。</p><p style="">假设我要为Ann做推荐，并令K=3。使用皮尔逊相关系数得到的结果是：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uTwDpwT4ic1wcorISMIlhIy6YgUeSvVJ7GGAhkic2qlRDQ15KwaJb6rsw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095260" data-type="png" data-ratio="0.19367588932806323" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(62)"></p><p style="">这三个人都会对推荐结果有所贡献，问题在于我们如何确定他们的比重呢？我们直接用相关系数的比重来描述，Sally的比重是0.8/2=40%，Eric是0.7/2=35%，Amanda则是25%：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uyic6Lb7b6l7XSia3bkw83TKAR74DtwnyHysBBXKFE1vicKfXOSwujmp1g/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095261" data-type="png" data-ratio="0.7688172043010753" data-w="372" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(63)"></p><p style="">假设他们三人对Grey Wardens的评分以及加权后的结果如下：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uCT5gCWyvvbCPymsgGthYxh1f4Ez481Rwibhola8SaslfXia3WaLmsZMw/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095262" data-type="png" data-ratio="0.2391304347826087" data-w="506" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(64)"></p><p style="">最后计算得到的分数为：</p><p style=""><img data-src="http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1uEWUDgbc2NCfc5IHkauswxF7mAHGibZDoNBaiclxUZpj0ibloCn43QD6mg/0" style="vertical-align: middle; border: 0px; margin: 0px auto; display: block; width: auto !important; visibility: visible !important; height: auto !important;" class="" id="c1421325095263" data-type="png" data-ratio="0.1632183908045977" data-w="435" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(65)"></p><h2 style=""><strong>Python推荐模块</strong></h2><p style="">我将本章学到的内容都汇集成了一个Python类，虽然代码有些长，我还是贴在了这里：</p><p style="">因文章长度受限，代码请查看“<span style="color: rgb(255, 0, 0);"><strong>阅读原文</strong></span>”</p><p style=""><strong>运行示例</strong></p><p style="">首先构建一个推荐类，然后获取推荐结果：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> r <span class="pl-k">=</span> recommender(users)<span class="pl-k">&gt;&gt;&gt;</span> r.recommend(<span class="pl-s1"><span class="pl-pds">'</span>Jordyn<span class="pl-pds">'</span></span>)
[(<span class="pl-s1"><span class="pl-pds">'</span>Blues Traveler<span class="pl-pds">'</span></span>, <span class="pl-c1">5.0</span>)]<span class="pl-k">&gt;&gt;&gt;</span> r.recommend(<span class="pl-s1"><span class="pl-pds">'</span>Hailey<span class="pl-pds">'</span></span>)
[(<span class="pl-s1"><span class="pl-pds">'</span>Phoenix<span class="pl-pds">'</span></span>, <span class="pl-c1">5.0</span>), (<span class="pl-s1"><span class="pl-pds">'</span>Slightly Stoopid<span class="pl-pds">'</span></span>, <span class="pl-c1">4.5</span>)]</pre><h3 style=""><strong>新的数据集</strong></h3><p style="">现在让我们使用一个更为真实的数据集。Cai-Nicolas Zeigler从图书漂流站收集了超过100万条评价数据——278,858位用户为271,379本书打了分。这份数据（匿名）可以从这个地址获得，有SQL和CSV两种格式。由于特殊符号的关系，这些数据无法直接加载到Python里。我做了一些清洗，可以从这里下载。</p><p style="">CSV文件包含了三张表：</p><ul class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>用户表，包括用户ID、位置、年龄等信息。其中用户的姓名已经隐去；</p></li><li><p>书籍表，包括ISBN号、标题、作者、出版日期、出版社等；</p></li><li><p>评分表，包括用户ID、书籍ISBN号、以及评分（0-10分）。</p></li></ul><p style="">上文Python代码中的loadBookDB方法可以加载这些数据，用法如下：</p><pre style=""><span class="pl-k">&gt;&gt;&gt;</span> r.loadBookDB(<span class="pl-s1"><span class="pl-pds">'</span>/Users/raz/Downloads/BX-Dump/<span class="pl-pds">'</span></span>)<span class="pl-c1">1700018</span><span class="pl-k">&gt;&gt;&gt;</span> r.recommend(<span class="pl-s1"><span class="pl-pds">'</span>171118<span class="pl-pds">'</span></span>)</pre><p style=""><strong>注意</strong> 由于数据集比较大，大约需要几十秒的时间加载和查询。</p><h3 style=""><strong>项目实践</strong></h3><p style="">只有运行调试过书中的代码后才能真正掌握这些方法，以下是一些实践建议：</p><ol class="task-list list-paddingleft-2" style="list-style-type: none;"><li><p>实现一个计算曼哈顿距离和欧几里得距离的方法；</p></li><li><p>本书的网站上有一个包含25部电影评价的数据集，实现一个推荐算法。</p></li></ol><p style=""><br></p><p style="">英文原文：http://guidetodatamining.com/chapter-2/</p><p style="">文章出处：https://github.com/jizhang/guidetodatamining/blob/master/chapter-2.md</p><p style="white-space: normal;">—————————————————<br style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"></p><p style="white-space: normal;">数盟网站：www.dataunion.org</p><p style="white-space: normal;">数盟微博：@数盟社区</p><p style="white-space: normal;">数盟微信：DataScientistUnion</p><p style="white-space: normal;">数盟【大数据群】272089418</p><p style="white-space: normal;">数盟【数据可视化群】 179287077</p><p style="white-space: normal;">数盟【数据分析群】 110875722</p><p style="white-space: normal;">—————————————————</p><p style="white-space: normal;"><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">点击阅读原文<strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">，<span style="color: rgb(255, 0, 0);"><span style="color: rgb(0, 0, 0);">更多<span style="color: rgb(255, 0, 0);">技术、资讯</span>内容</span></span></strong><strong style="max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;">~</strong></strong></strong></p><p style="white-space: normal;"><img data-src="http://mmbiz.qpic.cn/mmbiz/Zoo8sHWUo2z3h7y6bO5HJDPQJBU7RzDvY04SsPkpvNX8znMMKEXicAELJ1Tb4uF77TXknPztVCqQSDhEibkfPqdg/0" data-ratio="0.56" data-w="125" width="auto" style="word-wrap: break-word !important; box-sizing: border-box !important; width: auto !important; visibility: visible !important; height: auto !important;" _width="auto" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/0(66)"></p></div>                    <script type="text/javascript">
                        var first_sceen__time = (+new Date());
                    </script>                    <link rel="stylesheet" type="text/css" href="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/page_mp_article_improve_combo231ee1.css">                                                            <div class="rich_media_tool" id="js_toobar">                                                <a class="media_tool_meta meta_primary" id="js_view_source" href="javascript:void(0);">阅读原文</a>                                                <div id="js_read_area" class="media_tool_meta link_primary meta_primary" style="display:none;">阅读 <span id="readNum"></span></div>                        <a style="display:none;" class="media_tool_meta meta_primary link_primary meta_praise" href="javascript:void(0);" id="like">                            <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum"></span>                        </a>                        <a id="js_report_article" class="media_tool_meta link_primary meta_extra" href="javascript:void(0);">举报</a>                    </div>                </div>                                <div id="js_bottom_ad_area"></div>                                <div id="js_iframetest" style="display:none;"></div>                                                           </div>            <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display: block;">                <div class="qr_code_pc_inner">                    <div class="qr_code_pc">                        <img id="js_pc_qr_code_img" class="qr_code_pc_img" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/qrcode">                        <p>微信扫一扫<br>获得更多内容</p>                    </div>                </div>            </div>        </div>    </div>                <script>window.moon_map = {"a/gotoappdetail.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/gotoappdetail2318b8.js","a/ios.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/ios2318b8.js","a/android.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/a/android22772d.js","biz_common/utils/url/parse.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/url/parse224ef3.js","biz_common/utils/report.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/report224ef3.js","biz_common/utils/cookie.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/cookie224ef3.js","appmsg/like.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/like224ef3.js","appmsg/a.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/a2318b8.js","biz_common/tmpl.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/tmpl224ef3.js","biz_common/dom/class.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/class224ef3.js","biz_wap/utils/ajax.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/ajax22589f.js","biz_common/utils/string/html.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/utils/string/html224ef3.js","biz_common/ui/imgonepx.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/ui/imgonepx224ef3.js","biz_common/dom/attr.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/attr22f190.js","appmsg/report.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/report22f190.js","appmsg/report_and_source.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/report_and_source224ef3.js","appmsg/share.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/share224ef3.js","appmsg/comment.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/comment22dbe5.js","appmsg/page_pos.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/page_pos22f190.js","appmsg/cdn_speed_report.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/cdn_speed_report224ef3.js","appmsg/iframe.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/iframe23127b.js","appmsg/review_image.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/review_image224ef3.js","appmsg/outer_link.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/outer_link224ef3.js","biz_wap/jsapi/core.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/jsapi/core22589f.js","biz_wap/utils/mmversion.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/utils/mmversion224ef3.js","biz_common/dom/event.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/dom/event22772d.js","appmsg/async.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/async2318b8.js","biz_wap/ui/lazyload_img.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_wap/ui/lazyload_img231943.js","biz_common/log/jserr.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/biz_common/log/jserr22589f.js","appmsg/index.js":"http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/appmsg/index231943.js"};window.moon_crossorigin = true;</script><script type="text/javascript" src="./《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统_files/moon230eaa.js" crossorigin=""></script>    <script id="t_cmt" type="text/html">
        <li class="discuss_item">
            <span class="discuss_time"><#=time#></span>
            <div class="user_info">
                <strong class="nickname"><#=nick_name#></strong>
                <img class="avatar" src="<#=logo_url#>">
            </div>
            <div class="discuss_message">
                <span class="discuss_status"><#=status#></span>
                <#=content#>
            </div>
        </li>
    </script>  <script id="t_ad" type="text/html">
    <div class="rich_media_extra" id="gdt_area">
        <# if(pos_type==0){ #>
        <div class="line_tips_wrp">
            <span class="line_tips">推广</span>
        </div>
        <# } #>
        <div class="js_ad_link extra_link" data-type="<#=type#>" data-url="<#=url#>" data-rl="<#=rl#>"  data-aid="<#=aid#>" data-pt="<#=pt#>" data-tid="<#=traceid#>" data-gid="<#=group_id#>" data-apurl="<#=apurl#>">
            <# if(pt==1){ #>
            <#=hint_txt#>
            <img class="icon_arrow_gray" src="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/common/icon_arrow_gray1ef6d4.png">
            <img class="icon_loading_white icon_after" style="display:none;" id="loading_<#=traceid#>" src="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/icon/common/icon_loading_white22c04a.gif">
            <# }else if(pt==2){ #>
            <img class="appmsg_banner" src="<#=image_url#>">
            <# }else if(pt==7){ #>
            
            <div class="preview_group preview_card">
                <div class="preview_group_inner card_inner">
                    <div class="preview_group_info">
                        <strong class="preview_group_title2"><#=hint_txt#></strong>
                        <div class="preview_group_desc"><#=ad_desc#></div>
                        <img src="<#=image_url#>" alt="" class="preview_card_avatar">
                    </div>
                </div>                        
            </div>
            <# }else if(pt==100){ #>
            <div class="preview_group">
                <div class="preview_group_inner">
                    <div class="preview_group_info append_btn">
                        <strong class="preview_group_title"><#=biz_info.nick_name#></strong>
                        <div class="preview_group_desc"><#=hint_txt#></div>
                        <# if(!!biz_info.head_img){ #>
                        <img src="<#=biz_info.head_img#>" alt="" class="preview_group_avatar br_radius">
                        <# }else{ #>
                        <img class="preview_group_avatar br_radius" src="http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8p5jb6RZ8aYfjfS2AVle8URwBt8QIu6XbGewB9wiaWYWkPwq4R7pfdsFibuLkic16UcxDSNYtB8HnC1Q/0" alt="<#=biz_info.nick_name#>">
                        <# } #>                                 
                    </div>
                    <div class="preview_group_opr">
                        <a class="btn btn_inline btn_default btn_line" href="javascript:void(0);">详情</a>
                    </div>
                </div>
            </div>
            <# }else if(pt==102){ #>
            <div class="preview_group">
                <div class="preview_group_inner">
                    <div class="preview_group_info append_btn">
                        <strong class="preview_group_title"><#=app_info.app_name#></strong>
                        <div class="preview_group_desc"><#=hint_txt#></div>
                        <img src="<#=app_info.icon_url#>" alt="" class="preview_group_avatar br_radius">
                    </div>
                    <div class="preview_group_opr">
                        <a id="js_app_action" class="btn btn_inline btn_primary js_ad_btn btn_download" href="javascript:void(0);">下载</a>
                    </div>
                </div>
            </div>
            <# }else if(pt==101){ #>
            <div class="preview_group preview_card">
                <div class="preview_group_inner card_inner">                            
                    <div class="preview_group_info append_btn">
                        <strong class="preview_group_title"><#=app_info.app_name#></strong>
                        <div class="preview_group_desc"><#=hint_txt#></div>
                        <img src="<#=app_info.icon_url#>" alt="" class="preview_card_avatar">                               
                    </div>
                    <div class="preview_group_opr">
                        <a href="javascript:void(0);" id="js_app_action" class="btn btn_inline btn_primary js_ad_btn">下载</a>
                    </div>
                </div>                        
            </div>
            <# }else if(pt==103||pt==104){ #>
            <div class="preview_group obvious_app">
                <div class="preview_group_inner">
                    <div class="pic_app">
                        <img src="<#=image_url#>" alt="">
                    </div>
                    <div class="info_app">
                        <p class="name_app"><#=app_info.app_name#></p>
                        <# if(pt==103){ #>
                        <p class="profile_app"><span class="fun_exp"><#=app_info._category#></span><em>|</em><span class="compacity"><#=app_info._app_size#></span></p>
                        <# } else if(pt==104){ #>
                        <p class="profile_app"><span class="fun_exp"><#=app_info._app_size#></span><em>|</em><span class="compacity"><#=app_info._down_count#></span></p>
                        <# } #>
                        <div class="dm_app">
                            <a href="javascript:void(0);" id="js_appdetail_action" class="ad_btn btn_download js_ad_btn">下载</a>
                            <p class="extra_info">来自<# if(pt==103){ #>Appstore<# }else{ #>腾讯应用宝<# } #></p>
                        </div>
                    </div>
                </div>            
            </div>
            <# } #>
        </div>
    </div>
  </script>  <script type="text/javascript">
      var tid = "";
      var aid = "";
      var appuin = "MzA4NjA4MTkzMw==";

      var source = "4";
      var scene = 75;
      
      var itemidx = "";
      var nickname = "数盟";
      var ct = "1421330175";
      var user_name = "gh_a72e2d40abec";
      var fakeid   = "MTAzNTc2NzM4Mg==";
      var version   = "";
      var is_limit_user   = "0";
      var msg_title = "《面向程序员的数据挖掘指南》之推荐系统入门，Python代码手把手教你写推荐系统";
      var msg_desc = "【数盟倡导“数据创造价值”，致力于打造最卓越的数据科学交流平台，为企业、个人提供最卓越的服务】———————";
      var msg_cdn_url = "http://mmbiz.qpic.cn/mmbiz/ymzg67DoLHIVhbDWo8u2Owj9MTqxoc1udn7HerPoicqHt5PjaonuiclEoOEic2RPTORdza0584NyX6dJeHTZk6o8w/0";
      var msg_link = "http://mp.weixin.qq.com/s?__biz=MzA4NjA4MTkzMw==&amp;mid=203965305&amp;idx=1&amp;sn=056688e3bee08b3599e936ef60d942fd#rd";
      var user_uin = "1035767382"*1;
      var msg_source_url = 'http://dataunion.org/?p=7989#rd';
      var networkType;
      var appmsgid = '' || '203965305';
      var comment_id = "0" * 1;
      var svr_time = "" * 1;
      var comment_enabled = "" * 1;

      var devicetype = "webwx";

      
            seajs.use("appmsg/index.js");
  </script>    <embed id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd" type="application/thunder_download_plugin" height="0" width="0"></body></html>